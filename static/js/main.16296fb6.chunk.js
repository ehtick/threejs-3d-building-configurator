(this["webpackJsonpthreejs-building-configurator"]=this["webpackJsonpthreejs-building-configurator"]||[]).push([[0],{17:function(e,t,n){"use strict";n.r(t),n.d(t,"dimInch",(function(){return a})),n.d(t,"dimFeet",(function(){return s})),n.d(t,"dimMeter",(function(){return l})),n.d(t,"dimCentiMeter",(function(){return c})),n.d(t,"dimMilliMeter",(function(){return u})),n.d(t,"unitScale",(function(){return h})),n.d(t,"Dimensioning",(function(){return d}));var r=n(3),i=n(4),o=n(2),a="inch",s="ft",l="m",c="cm",u="mm",h=1,d=function(){function e(){Object(r.a)(this,e)}return Object(i.a)(e,null,[{key:"getUnit",value:function(){switch(o.a.Configuration.getStringValue(o.a.configDimUnit)){case a:return"in";case u:return"mm";case c:return"cm";case l:default:return"m"}}},{key:"cmToMeasure",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;switch(o.a.Configuration.getStringValue(o.a.configDimUnit)){case a:return"".concat(Math.round(e/Math.pow(2.54,t))," in");case u:return"".concat(Math.round(e*Math.pow(10,t))," mm");case c:return"".concat(Math.round(10*e)/10," cm");case l:default:return"".concat(Math.round(e/Math.pow(100,t)*100)/100," m")}}},{key:"cmToMeasureWithoutUnit",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;switch(o.a.Configuration.getStringValue(o.a.configDimUnit)){case a:return Math.round(e/Math.pow(2.54,t));case u:return Math.round(e*Math.pow(10,t));case c:return Math.round(10*e)/10;case l:default:return Math.round(e/Math.pow(100,t)*100)/100}}},{key:"measureToCm",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;switch(o.a.Configuration.getStringValue(o.a.configDimUnit)){case a:return e*Math.pow(2.54,t);case u:return e/Math.pow(10,t);case c:return e;case l:default:return e*Math.pow(100,t)}}}]),e}()},2:function(e,t,n){"use strict";var r={};n.r(r),n.d(r,"configDimUnit",(function(){return f})),n.d(r,"configDefaultPathPrefix",(function(){return p})),n.d(r,"configWallHeight",(function(){return v})),n.d(r,"configWallThickness",(function(){return g})),n.d(r,"configWallThicknessDirection",(function(){return y})),n.d(r,"configWallIsOutside",(function(){return m})),n.d(r,"configFloorThickness",(function(){return b})),n.d(r,"configSceneLocked",(function(){return x})),n.d(r,"configXRayMode",(function(){return w})),n.d(r,"configSnapMode",(function(){return k})),n.d(r,"configDimensionVisible",(function(){return O})),n.d(r,"configShellMode",(function(){return j})),n.d(r,"configSnapTolernance",(function(){return C})),n.d(r,"configCompassVisible",(function(){return E})),n.d(r,"Configuration",(function(){return M}));var i={};n.r(i),n.d(i,"ELogContext",(function(){return P})),n.d(i,"ELogLevel",(function(){return T})),n.d(i,"logContext",(function(){return _})),n.d(i,"isLogging",(function(){return D})),n.d(i,"log",(function(){return L}));var o={};n.r(o),n.d(o,"Utils",(function(){return z})),n.d(o,"Utils3D",(function(){return V}));var a={};n.r(a),n.d(a,"Version",(function(){return A}));var s={};n.r(s),n.d(s,"BP3D_EVENT_CONFIG_CHANGED",(function(){return R})),n.d(s,"BP3D_EVENT_HIGHLIGHT_CHANGED",(function(){return U})),n.d(s,"BP3D_EVENT_ADD_TO_UNDO_STACK",(function(){return F}));var l=n(11),c=n(12),u=n(3),h=n(4),d=n(17),f="dimUnit",p="defaultPathPrefix",v="wallHeight",g="wallThickness",y="wallThicknessDirection",m="wallIsOutside",b="floorThickness",x="scene-locked",w="xRay",k="snap",O="dimensionVisible",j="shellMode",C="snapTolerance",E="compassVisible",S=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_BLUEPRINT_ASSETS_PREFIX||"",M=function(){function e(){Object(u.a)(this,e)}return Object(h.a)(e,null,[{key:"setValue",value:function(e,t){this.data[e]=t,document.dispatchEvent(new CustomEvent(H.BP3D_EVENT_CONFIG_CHANGED,{detail:Object(c.a)({},e,t)}))}},{key:"getStringValue",value:function(e){switch(e){case f:case p:return this.data[e];default:throw new Error("Invalid string configuration parameter: "+e)}}},{key:"getBooleanValue",value:function(e){switch(e){case x:case w:case k:case O:case j:case m:case E:return this.data[e];default:throw new Error("Invalid boolean configuration parameter: "+e)}}},{key:"getNumericValue",value:function(e){switch(e){case v:case g:case y:case b:case C:return this.data[e];default:throw new Error("Invalid numeric configuration parameter: "+e)}}}]),e}();M.data={defaultPathPrefix:"".concat(S,"Blueprint3D-assets/"),dimUnit:d.dimMeter,wallHeight:2.5,wallThickness:.2,wallThicknessDirection:0,wallIsOutside:!0,floorThickness:.1,sceneLocked:!1,xRay:!1,snap:!0,snapTolerance:.2,dimensionVisible:!1,shellMode:!1,autoMergeVertices:!0,compassVisible:!1};var P={None:"None",All:"All",Interaction2d:"Interaction2d",Item:"Item",Wall:"Wall",Room:"Room"},T={Information:"Information",Warning:"Warning",Error:"Error",Fatal:"Fatal",Debug:"Debug"},_=P.None;function D(e,t){return _===P.All||_===e||t===T.Warning||t===T.Error||t===T.Fatal}function L(e,t,n){if(!1!==D(e,t)){switch(t){case T.Information:"[INFO_] ";break;case T.Warning:"[WARING] ";break;case T.Error:"[ERROR] ";break;case T.Fatal:"[FATAL] ";break;case T.Debug:"[DEBUG] "}}}var I=n(18),W=n(9),N=n(0),z=function(){function e(){Object(u.a)(this,e)}return Object(h.a)(e,null,[{key:"absoluteAngle",value:function(e,t){if(0===e&&0===t)return 0;var n=Math.atan(t/e);return 0===n?e<0&&(n=Math.PI):n===Math.PI||(n===-Math.PI/2?n=3*Math.PI/2:n>0?e<0&&t<0&&(n=Math.PI+n):e<0&&t>0?n=Math.PI+n:e>0&&t<0&&(n=2*Math.PI+n)),n}},{key:"projectionPointToLine",value:function(e,t,n,r,i,o){try{var a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[{x:0,y:0},{x:100,y:0}],n=JSON.parse(JSON.stringify(e)),r=JSON.parse(JSON.stringify(t));n[1].x-=n[0].x,n[1].y-=n[0].y,n[0]={x:0,y:0},r[1].x-=r[0].x,r[1].y-=r[0].y,r[0]={x:0,y:0};try{var i=(n[1].x*r[1].x+n[1].y*r[1].y)/(Math.sqrt(Math.pow(n[1].x,2)+Math.pow(n[1].y,2))*Math.sqrt(Math.pow(r[1].x,2)+Math.pow(r[1].y,2)));return i>1?i=1:i<-1&&(i=-1),Math.acos(i)}catch(o){return 0}}([{x:n,y:r},{x:e,y:t}],[{x:n,y:r},{x:i,y:o}]),s=Math.sqrt(Math.pow(n-i,2)+Math.pow(r-o,2)),l=Math.sqrt(Math.pow(n-e,2)+Math.pow(r-t,2))*Math.cos(a);return{x:n+(i-n)*l/s,y:r+(o-r)*l/s}}catch(c){return{x:0,y:0}}}},{key:"pointDistanceFromLine",value:function(t,n,r,i,o,a){var s=e.closestPointOnLine(t,n,r,i,o,a),l=t-s.x,c=n-s.y;return Math.sqrt(l*l+c*c)}},{key:"closestPointOnLine",value:function(e,t,n,r,i,o){var a,s,l=i-n,c=o-r,u=((e-n)*l+(t-r)*c)/(l*l+c*c);return u<0||n===i&&r===o?(a=n,s=r):u>1?(a=i,s=o):(a=n+u*l,s=r+u*c),{x:a,y:s}}},{key:"distance",value:function(e,t,n,r){return Math.sqrt(Math.pow(n-e,2)+Math.pow(r-t,2))}},{key:"angle",value:function(e,t,n,r){var i=e*n+t*r,o=e*r-t*n;return-Math.atan2(o,i)}},{key:"angle2pi",value:function(t,n,r,i){var o=e.angle(t,n,r,i);return o<0&&(o+=2*Math.PI),o}},{key:"isClockwise",value:function(t){for(var n=Math.min(0,Math.min.apply(null,e.map(t,(function(e){return e.x})))),r=Math.min(0,Math.min.apply(null,e.map(t,(function(e){return e.x})))),i=e.map(t,(function(e){return{x:e.x-n,y:e.y-r}})),o=0,a=0;a<i.length;a++){var s,l=i[a];o+=((s=a===i.length-1?i[0]:i[a+1]).x-l.x)*(s.y+l.y)}return o>=0}},{key:"guid",value:function(){var e=function(){return Math.floor(65536*(1+Math.random())).toString(16).slice(1)};return"".concat(e()+e(),"-").concat(e(),"-").concat(e(),"-").concat(e(),"-").concat(e()).concat(e()).concat(e())}},{key:"polygonPolygonIntersect",value:function(t,n){for(var r=0;r<t.length;r++){var i,o=t[r];if(i=r===t.length-1?t[0]:t[r+1],e.linePolygonIntersect(o.x,o.y,i.x,i.y,n))return!0}return!1}},{key:"linePolygonIntersect",value:function(t,n,r,i,o){for(var a=0;a<o.length;a++){var s,l=o[a];if(s=a===o.length-1?o[0]:o[a+1],e.lineLineIntersect(t,n,r,i,l.x,l.y,s.x,s.y))return!0}return!1}},{key:"findLineLineCrossPoint",value:function(e,t,n,r,i,o,a,s){var l=arguments.length>8&&void 0!==arguments[8]&&arguments[8];if(e===n&&t===r||i===a&&o===s)return!1;var c=(s-o)*(n-e)-(a-i)*(r-t);if(0===c)return!1;var u=((a-i)*(t-o)-(s-o)*(e-i))/c,h=((n-e)*(t-o)-(r-t)*(e-i))/c;if(l&&(u<0||u>1||h<0||h>1))return!1;var d=e+u*(n-e),f=t+u*(r-t);return{x:d,y:f}}},{key:"lineLineIntersect",value:function(e,t,n,r,i,o,a,s){function l(e,t,n){var r=e.x,i=e.y,o=t.x,a=t.y,s=n.x;return(n.y-i)*(o-r)>(a-i)*(s-r)}var c={x:e,y:t},u={x:n,y:r},h={x:i,y:o},d={x:a,y:s};return l(c,h,d)!==l(u,h,d)&&l(c,u,h)!==l(c,u,d)}},{key:"pointInPolygon",value:function(t,n,r,i,o){var a=0,s=0;if(void 0===i||void 0===o){for(var l=0;l<r.length;l++)a=Math.min(a,r[l].x),s=Math.min(a,r[l].y);i=a-10,o=s-10}var c=0;for(l=0;l<r.length;l++){var u,h=r[l];u=l===r.length-1?r[0]:r[l+1],e.lineLineIntersect(i,o,t,n,h.x,h.y,u.x,u.y)&&c++}return c%2===1}},{key:"polygonInsidePolygon",value:function(t,n,r,i){r=r||0,i=i||0;var o,a=Object(W.a)(t);try{for(a.s();!(o=a.n()).done;){var s=o.value;if(!e.pointInPolygon(s.x,s.y,n,r,i))return!1}}catch(l){a.e(l)}finally{a.f()}return!0}},{key:"polygonOutsidePolygon",value:function(t,n,r,i){r=r||0,i=i||0;var o,a=Object(W.a)(t);try{for(a.s();!(o=a.n()).done;){var s=o.value;if(e.pointInPolygon(s.x,s.y,n,r,i))return!1}}catch(l){a.e(l)}finally{a.f()}return!0}},{key:"forEach",value:function(e,t){var n,r=Object(W.a)(e);try{for(r.s();!(n=r.n()).done;){t(n.value)}}catch(i){r.e(i)}finally{r.f()}}},{key:"forEachIndexed",value:function(e,t){var n,r=Object(W.a)(e.entries());try{for(r.s();!(n=r.n()).done;){var i=Object(I.a)(n.value,2);t(i[0],i[1])}}catch(o){r.e(o)}finally{r.f()}}},{key:"map",value:function(e,t){var n=[];return e.forEach((function(e){n.push(t(e))})),n}},{key:"removeIf",value:function(e,t){var n=[];return e.forEach((function(e){t(e)||n.push(e)})),n}},{key:"cycle",value:function(e,t){for(var n=e.slice(0),r=0;r<t;r++){var i=n.shift();n.push(i)}return n}},{key:"unique",value:function(e,t){var n,r=[],i={},o=Object(W.a)(e);try{for(o.s();!(n=o.n()).done;){var a=n.value;i.hasOwnProperty(a)||(r.push(a),i[t(a)]=!0)}}catch(s){o.e(s)}finally{o.f()}return r}},{key:"removeValue",value:function(e,t){for(var n=e.length-1;n>=0;n--)e[n]===t&&e.splice(n,1)}},{key:"subtract",value:function(t,n){return e.removeIf(t,(function(t){return e.hasValue(n,t)}))}},{key:"area",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!Array.isArray(e)||0===e.length)return 0;var t,n,r,i,o=e.length,a=0;for(t=0,n=o-1;t<o;n=t,t+=1)r=e[t],i=e[n],a+=r.x*i.y,a-=r.y*i.x;return a*=.5,Math.abs(a)}},{key:"centroid",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!Array.isArray(e)||0===e.length)return null;for(var t,n,r,i=e.length,o=0,a=0,s=0;s<i;s++){var l=(s+1)%i;n=e[s],r=e[l],t=n.x*r.y-r.x*n.y,o+=(n.x+r.x)*t,a+=(n.y+r.y)*t}return{x:o/(t=6*this.area(e)),y:a/t}}},{key:"argsort",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=Array.from(new Array(e.length),(function(e,t){return t}));return n.map((function(t,n){return[e[n],t]})).sort((function(e,n){return(Object(I.a)(e,1)[0]-Object(I.a)(n,1)[0])*t})).map((function(e){return Object(I.a)(e,2)[1]}))}},{key:"getCyclicOrder",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;n||(n=new N.Nb(0,0));for(var r=[],i=0;i<t.length;i++){var o=t[i],a=o.clone().sub(n),s=Math.atan2(a.y,a.x),l=N.R.radToDeg(s);l=l>0?l:(l+360)%360,r.push(l)}var c=e.argsort(r),u=[],h=[];for(i=0;i<c.length;i++)u.push(r[c[i]]),h.push(t[c[i]]);return{indices:c,angles:u,points:h}}}]),e}();z.hasValue=function(e,t){var n,r=Object(W.a)(e);try{for(r.s();!(n=r.n()).done;){if(n.value===t)return!0}}catch(i){r.e(i)}finally{r.f()}return!1};var V=function(){function e(){Object(u.a)(this,e)}return Object(h.a)(e,null,[{key:"checkIf4PointsOnSamePlane",value:function(e,t,n,r){var i=new N.Ob(t.x-e.x,t.y-e.y,t.z-e.z),o=new N.Ob(n.x-e.x,n.y-e.y,n.z-e.z),a=new N.Ob(r.x-e.x,r.y-e.y,r.z-e.z),s=i.clone().cross(o).normalize(),l=s.clone().negate(),c=o.clone().cross(a).normalize();return 0===s.distanceTo(c)||0===l.distanceTo(c)}},{key:"findLineLineCrossPoint",value:function(e,t,n,r){if(!this.checkIf4PointsOnSamePlane(e,t,n,r))return null;var i=z.findLineLineCrossPoint(e.x,e.z,t.x,t.z,n.x,n.z,r.x,r.z,!0);if(!i)return null;var o=new N.Ob(i.x,0,i.y),a=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.z-e.z,2)),s=Math.sqrt(Math.pow(o.x-e.x,2)+Math.pow(o.y-e.z,2));return o.y=e.y+(t.y-e.y)*s/a,o}}]),e}(),A=function(){function e(){Object(u.a)(this,e)}return Object(h.a)(e,null,[{key:"getInformalVersion",value:function(){return"1.0 Beta 1"}},{key:"getTechnicalVersion",value:function(){return"1.0.0.1"}}]),e}();console.log("Blueprint3D ".concat(A.getInformalVersion()," (").concat(A.getTechnicalVersion(),")"));var R="bp3dEvent.config_changed",U="bp3dEvent.highlight_changed",F="bp3dEvent.addToUndoStack",B=Object(l.a)(Object(l.a)(Object(l.a)(Object(l.a)(Object(l.a)(Object(l.a)({},r),d),i),o),a),s),H=t.a=B},28:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return Face3D}));var D_01_Daily_Working_2022_02_22_building_blueprint3d_building_configurator_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(3),D_01_Daily_Working_2022_02_22_building_blueprint3d_building_configurator_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_createClass__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(4),_core__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(2),Face3D=function(){function Face3D(e){Object(D_01_Daily_Working_2022_02_22_building_blueprint3d_building_configurator_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_0__.a)(this,Face3D),this.vertices=[],this.color=0,this.vertices=e}return Object(D_01_Daily_Working_2022_02_22_building_blueprint3d_building_configurator_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_createClass__WEBPACK_IMPORTED_MODULE_1__.a)(Face3D,[{key:"setColor",value:function setColor(color){Number.isInteger(color)?this.color=color:"string"===typeof color&&"#"===color[0]&&(color=color.replace("#",""),this.color=eval("0x".concat(color)))}},{key:"getUuid",value:function(){return this.constructor.getUuidByCorners(this.vertices)}}]),Face3D}();Face3D.getUuidByCorners=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return _core__WEBPACK_IMPORTED_MODULE_2__.a.Utils.map(e,(function(e){return e.id})).sort().join()}},48:function(e,t,n){},52:function(e,t,n){},53:function(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"Factory",(function(){return me}));var i=n(7),o=n.n(i),a=n(23),s=n.n(a),l=n(15),c=n.n(l),u=n(19),h=n(3),d=n(4),f=n(5),p=n(6),v=n(8),g=n(11),y=n(9),m=n(0),b=n(1),x=function(e){Object(f.a)(n,e);var t=Object(p.a)(n);function n(){return Object(h.a)(this,n),t.apply(this,arguments)}return Object(d.a)(n,[{key:"render",value:function(){var e=this,t=this.props.hidden;return Object(b.jsx)("div",{style:{display:t?"none":"inherit",width:"100%",height:"100%"},children:Object(b.jsx)("div",{style:{width:"100%",height:"100%"},ref:function(t){return"function"===typeof e.props.onDomLoaded&&e.props.onDomLoaded(t)}})})}}]),n}(o.a.Component),w=n(2),k=[0,90,180,270,360],O=function(e){Object(f.a)(n,e);var t=Object(p.a)(n);function n(e){var r;return Object(h.a)(this,n),(r=t.call(this,e)).handleCompassClicked=function(){var e=r.props.orientation,t=0;if(k.includes(e)){var n=k.indexOf(e);t=k[(n+1)%k.length]}else t=[].concat(k).sort((function(t,n){return Math.abs(t-e)-Math.abs(n-e)}))[0],console.log(t);t%=360,r.props.onOrientationChanged(t)},r.handleGridSpacingChanged=function(e){var t=parseFloat(e.target.value,10),n=w.a.Dimensioning.measureToCm(t)/100;r.props.onGridSpacingChanged(n)},r._renderCompass=function(){var e=r.props.orientation;return Object(b.jsxs)("div",{style:{position:"absolute",top:0,right:0},children:[Object(b.jsx)("div",{style:{display:"flex",width:150,height:150,alignItems:"center",justifyContent:"center"},children:Object(b.jsx)("img",{onClick:r.handleCompassClicked,style:{width:"70%",height:"70%",transform:"rotate(".concat(e||0,"deg)"),cursor:"pointer"},src:"/Blueprint3D-assets/textures/compass.png",alt:"compass"})}),Object(b.jsxs)("div",{style:{textAlign:"center"},children:[Object(b.jsx)("input",{type:"number",style:{textAlign:"right",width:50},step:1,min:0,max:360,value:e,onChange:function(e){var t=parseInt(e.target.value,10);e.target.value||(t=0),t<0&&(t=0),t>360&&(t=0),r.props.onOrientationChanged(t)}}),Object(b.jsx)("label",{children:" \xb0"})]})]})},r._renderGridSpacing=function(){var e=r.props,t=e.gridSpacing,n=(e.gridSpacingInCanvas,w.a.Dimensioning.getUnit()),i=w.a.Dimensioning.cmToMeasureWithoutUnit(100*t);return Object(b.jsxs)("div",{style:{position:"absolute",bottom:20,right:20,cursor:"pointer",display:"flex",flexDirection:"column",textAlign:"center"},children:[Object(b.jsx)("div",{children:"Grid Size"}),Object(b.jsxs)("div",{className:"grid-size-indicator",style:{width:50,height:50},children:[Object(b.jsx)("div",{className:"main-line"}),Object(b.jsx)("div",{className:"arrow-top"}),Object(b.jsx)("div",{className:"arrow-bottom"})]}),Object(b.jsxs)("div",{children:[Object(b.jsx)("input",{type:"number",style:{width:60},step:.1,value:i,onChange:r.handleGridSpacingChanged}),Object(b.jsx)("label",{children:n})]})]})},r.state={editGrid:!1},r}return Object(d.a)(n,[{key:"render",value:function(){var e=this,t=this.props.hidden;return Object(b.jsxs)("div",{style:{width:"100%",height:"100%",display:"block",position:"absolute",top:0,left:0,opacity:t?0:100,pointerEvents:t?"none":"inherit"},children:[Object(b.jsx)("canvas",{className:"canvas-floor-plan",ref:function(t){return"function"===typeof e.props.onDomLoaded&&e.props.onDomLoaded(t)},children:"Floor plan viewer"}),this._renderCompass(),this._renderGridSpacing()]})}}]),n}(o.a.Component),j=n(18),C=n(17),E={url:"".concat(w.a.Configuration.getStringValue("defaultPathPrefix"),"/rooms/textures/blank.png"),stretch:!0,scale:0},S=function(){function e(t,n){var r=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Object(h.a)(this,e),this.layer=null,this.edge=null,this.orphan=!1,this.locked=!1,this.items=[],this.onItems=[],this.interiorTexture=E,this.exteriorTexture=E,this.thickness=w.a.Configuration.getNumericValue(w.a.configWallThickness),this.thicknessDirection=w.a.Configuration.getNumericValue(w.a.configWallThicknessDirection),this.isOutsideWall=w.a.Configuration.getBooleanValue(w.a.configWallIsOutside),this.offset=0,this.height=0,this.layer=null,this.moved_callbacks=[],this.deleted_callbacks=[],this.action_callbacks=[],this.isStart=function(e){return r.start===e},this.isEnd=function(e){return r.end===e},this.handleStartMoved=function(e,t,n,i){var o={prev:{start:{x:n,y:i},end:{x:r.getEndX(),y:r.getEndY()}},current:{start:{x:e,y:t},end:{x:r.getEndX(),y:r.getEndY()}}};r.moveWallItems(o)},this.handleEndMoved=function(e,t,n,i){var o={prev:{start:{x:r.getStartX(),y:r.getStartY()},end:{x:n,y:i}},current:{start:{x:r.getStartX(),y:r.getStartY()},end:{x:e,y:t}}};r.moveWallItems(o)},this.exteriorDirectionVector=function(){var e=r.getWallCenter(),t=r.toVec2().normalize().multiplyScalar(.1),n=new m.Nb(e.x,e.y);return n.clone().add(t).rotateAround(n,Math.PI/2)},this.interiorDirectionVector=function(){var e=r.getWallCenter(),t=r.toVec2().normalize().multiplyScalar(.1),n=new m.Nb(e.x,e.y);return n.clone().add(t).rotateAround(n,-Math.PI/2)},this.getRoomInteractionSide=function(e){var t=r.exteriorDirectionVector(),n=r.interiorDirectionVector(),i=w.a.Utils.pointInPolygon(t.x,t.y,e.corners),o=w.a.Utils.pointInPolygon(n.x,n.y,e.corners);return i?1:o?-1:0},this.start=t,this.end=n,this.height=i||w.a.Configuration.getNumericValue(w.a.configWallHeight),this.thickness=w.a.Configuration.getNumericValue(w.a.configWallThickness),this.thicknessDirection=w.a.Configuration.getNumericValue(w.a.configWallThicknessDirection),this.isOutsideWall=w.a.Configuration.getBooleanValue(w.a.configWallIsOutside),this.id=this.getUuid(),this.start.attachStart(this),this.end.attachEnd(this)}return Object(d.a)(e,[{key:"toVec2",value:function(){var e=this.start,t=this.end;return new m.Nb(t.x-e.x,t.y-e.y)}},{key:"getUuid",value:function(){return[this.start.id,this.end.id].join()}},{key:"resetFrontBack",value:function(){this.edge=null}},{key:"snapToAxis",value:function(){var e=this,t=(arguments.length>0&&void 0!==arguments[0]||w.a.Configuration.getNumericValue(w.a.configSnapTolernance),this.start.floorplan),n=t.getCorners(t.activeLayerIndex),r=[];n.forEach((function(t){t!==e.start&&t!==e.end&&r.push(t)}))}},{key:"fireOnMove",value:function(e){this.moved_callbacks.push(e)}},{key:"fireOnDelete",value:function(e){this.deleted_callbacks.push(e)}},{key:"dontFireOnDelete",value:function(e){var t=this.deleted_callbacks.indexOf(e);this.deleted_callbacks.splice(t,1)}},{key:"fireOnAction",value:function(e){this.action_callbacks.push(e)}},{key:"fireAction",value:function(e){this.action_callbacks.forEach((function(t){return"function"===typeof t&&t(e)}))}},{key:"move",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=this.getWallCenter();this.relativeMove(e-r.x,t-r.y,n)}},{key:"relativeMove",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!(this.locked||this.start.locked||this.end.locked)){var i=this.start,o=this.end,a=i.x,s=i.y,l=o.x,c=o.y,u=a+e,h=s+t,d=l+e,f=c+t,p=[].concat(Object(v.a)(i.wallStarts),Object(v.a)(i.wallEnds)),g=[].concat(Object(v.a)(o.wallStarts),Object(v.a)(o.wallEnds));w.a.Utils.removeValue(p,this),w.a.Utils.removeValue(g,this);var y=w.a.Utils,b=y.projectionPointToLine,x=y.pointDistanceFromLine,k=new m.Ob(e,0,t),O=new m.Ob(a-l,0,s-c),j=k.angleTo(O);if(0!==j&&j!==Math.PI){if(1===p.length){var C=p[0],E=C.start===i?C.end:C.start,S=_(E,a,s);u=S.x,h=S.y}if(1===g.length){var M=g[0],P=M.start===o?M.end:M.start,T=_(P,l,c);d=T.x,f=T.y}}this.start.move(u,h,!1,r),this.end.move(d,f,!1,r),n&&this.snapToAxis()}function _(e,t,n){var r={x:t,y:n};try{var i=e.x,o=e.y,p=b(i,o,a,s,l,c),v=b(i,o,u,h,d,f),g=x(i,o,a,s,l,c),y=x(i,o,u,h,d,f),m={x:t-p.x,y:n-p.y};m.x*=y/g,m.y*=y/g,r.x=v.x+m.x,r.y=v.y+m.y}catch(w){r.x=t,r.y=n}return r}}},{key:"moveWallItems",value:function(e){var t=e.prev,n=e.current;this.items.length&&this.items.forEach((function(e){var r=e.position,i=Math.sqrt(Math.pow(t.start.x-t.end.x,2)+Math.pow(t.start.y-t.end.y,2)),o=Math.sqrt(Math.pow(t.start.x-r.x,2)+Math.pow(t.start.y-r.z,2))/i,a=n.start.x+(n.end.x-n.start.x)*o,s=(r.y,n.start.y+(n.end.y-n.start.y)*o),l=a-r.x,c=s-r.z;e.relativeMove(l,c);var u=new m.Ob(t.end.x-t.start.x,0,t.end.y-t.start.y),h=new m.Ob(n.end.x-n.start.x,0,n.end.y-n.start.y),d=(new m.Ob).copy(u).cross(h),f=u.angleTo(h);d.y<0&&(f=-f);var p=e.rotation.y;p+=f,e.rotation.y=p,e.dimensionHelper.rotation.y=p}))}},{key:"fireMoved",value:function(){this.moved_callbacks.forEach((function(e){return"function"===typeof e&&e()}))}},{key:"fireRedraw",value:function(){this.edge&&this.edge.redrawCallbacks.forEach((function(e){return"function"===typeof e&&e()}))}},{key:"getStart",value:function(){return this.start}},{key:"getEnd",value:function(){return this.end}},{key:"getStartX",value:function(){return this.start.getX()}},{key:"getEndX",value:function(){return this.end.getX()}},{key:"getStartY",value:function(){return this.start.getY()}},{key:"getEndY",value:function(){return this.end.getY()}},{key:"remove",value:function(){var e=this;this.start.detachWall(this),this.end.detachWall(this),this.deleted_callbacks.forEach((function(t){return"function"===typeof t&&t(e)}))}},{key:"setStart",value:function(e){this.start.detachWall(this),e.attachStart(this),this.start=e,this.fireMoved()}},{key:"setEnd",value:function(e){this.end.detachWall(this),e.attachEnd(this),this.end=e,this.fireMoved()}},{key:"distanceFrom",value:function(e,t){return w.a.Utils.pointDistanceFromLine(e,t,this.getStartX(),this.getStartY(),this.getEndX(),this.getEndY())}},{key:"closestPoint",value:function(e,t){return{point:w.a.Utils.closestPointOnLine(e,t,this.getStartX(),this.getStartY(),this.getEndX(),this.getEndY()),distance:this.distanceFrom(e,t)}}},{key:"oppositeCorner",value:function(e){return this.start===e?this.end:this.end===e?this.start:void console.log("Wall does not connect to corner")}},{key:"setLocked",value:function(e){this.locked=e,this.start.setLocked(e),this.end.setLocked(e)}},{key:"getWallCenter",value:function(){var e=this.start.x,t=this.start.y;return{x:(e+this.end.x)/2,y:(t+this.end.y)/2}}},{key:"getWallArea",value:function(){return this.getWallLength()*this.height}},{key:"getWallLength",value:function(){var e=this.start.x,t=this.start.y,n=this.end.x,r=this.end.y;return Math.sqrt(Math.pow(e-n,2)+Math.pow(t-r,2))}},{key:"setWallLength",value:function(e){if(e>0){var t=e/this.getWallLength(),n={x:0,y:0};if(this.start.locked||this.end.locked)if(this.start.locked&&!this.end.locked)n={x:this.getStartX(),y:this.getStartY()};else{if(this.start.locked||!this.end.locked)return;n={x:this.getEndX(),y:this.getEndY()}}else n=this.getWallCenter();var r=0,i=0;r=n.x+(this.start.x-n.x)*t,i=n.y+(this.start.y-n.y)*t,this.start.move(r,i,!1),r=n.x+(this.end.x-n.x)*t,i=n.y+(this.end.y-n.y)*t,this.end.move(r,i,!1)}}},{key:"setIsOutsideWall",value:function(e){this.isOutsideWall=e}},{key:"checkIsOutsideWall",value:function(){var e=this.layer.getRooms(),t=this.exteriorDirectionVector(),n=this.interiorDirectionVector(),r=0;return e.forEach((function(e){var i=w.a.Utils.pointInPolygon(t.x,t.y,e.corners);i&&r++,(i=w.a.Utils.pointInPolygon(n.x,n.y,e.corners))&&r++})),1===r}},{key:"findInsideRoomPoint",value:function(){if(this.checkIsOutsideWall()){var e=this.layer.getRooms(),t=this.exteriorDirectionVector(),n=this.interiorDirectionVector(),r=null;return e.forEach((function(e){var i=w.a.Utils.pointInPolygon(t.x,t.y,e.corners);i&&(r=t),(i=w.a.Utils.pointInPolygon(n.x,n.y,e.corners))&&(r=n)})),r}return null}},{key:"checkIsSameFace",value:function(e){var t=.1;return this.start.distanceFromCorner(e.start)<t&&this.end.distanceFromCorner(e.end)<t||this.start.distanceFromCorner(e.end)<t&&this.end.distanceFromCorner(e.start)<t}},{key:"setTexture",value:function(e){this.interiorTexture=e,this.exteriorTexture=e,document.dispatchEvent(new CustomEvent(w.a.BP3D_EVENT_ADD_TO_UNDO_STACK))}},{key:"setInteriorTexture",value:function(e){this.interiorTexture=e,document.dispatchEvent(new CustomEvent(w.a.BP3D_EVENT_ADD_TO_UNDO_STACK))}},{key:"setExteriorTexture",value:function(e){this.exteriorTexture=e,document.dispatchEvent(new CustomEvent(w.a.BP3D_EVENT_ADD_TO_UNDO_STACK))}},{key:"detachFromAdjacentWalls",value:function(){var e=this.start,t=this.end;e.detachWall(this),t.detachWall(this);var n=e.clone(),r=t.clone();this.start=n,this.end=r,this.id=this.getUuid(),this.start.attachStart(this),this.end.attachEnd(this),this.start.moved_callbacks.push(this.handleStartMoved),this.end.moved_callbacks.push(this.handleEndMoved)}},{key:"detachCorner",value:function(e){var t=this.start,n=this.end,r=null;if(e===t){t.detachWall(this);var i=t.clone();this.start=i,this.id=this.getUuid(),this.start.attachStart(this),this.start.moved_callbacks.push(this.handleStartMoved),r=i}else if(e===n){n.detachWall(this);var o=n.clone();this.end=o,this.id=this.getUuid(),this.end.attachEnd(this),this.end.moved_callbacks.push(this.handleEndMoved),r=o}return r}}]),e}(),M=w.a.Configuration.getNumericValue(w.a.configSnapTolernance),P=function(){function e(t,n,r,i){Object(h.a)(this,e),this.layer=null,this.wallStarts=[],this.wallEnds=[],this.moved_callbacks=[],this.deleted_callbacks=[],this.action_callbacks=[],this.locked=!1,this.angles=[],this.angleDirections=[],this.startAngles=[],this.endAngles=[],this.cyclicNeighbors=[],this.floorplan=t,this.x=n,this.y=r,this.id=i||w.a.Utils.guid()}return Object(d.a)(e,[{key:"clone",value:function(){var e=this.x,t=this.y,n=this.floorplan,r=this.layer,i=n.newCorner(e,t);return r.addCorner(i),i}},{key:"fireOnMove",value:function(e){this.moved_callbacks.push(e)}},{key:"fireOnDelete",value:function(e){this.deleted_callbacks.push(e)}},{key:"fireOnAction",value:function(e){this.action_callbacks.push(e)}},{key:"getX",value:function(){return this.x}},{key:"getY",value:function(){return this.y}},{key:"getLocation",value:function(){return new m.Nb(this.x,this.y)}},{key:"snap",value:function(){var e=this,t=this.getSnapByAxis(),n=this.getSnapByAngles(),r=[];t&&r.push(t),n&&r.push(n);var i=r.sort((function(t,n){return e.distanceFrom(t.x,t.y)-e.distanceFrom(n.x,n.y)}));i.length&&(this.x=i[0].x,this.y=i[0].y)}},{key:"getSnapByAxis",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;if(w.a.Configuration.getBooleanValue(w.a.configSnapMode)){n=n||{x:this.x,y:this.y};var r=!1;t=t||this.adjacentCorners();var i,o=Object(y.a)(t);try{for(o.s();!(i=o.n()).done;){var a=i.value;Math.abs(a.x-this.x)<e&&(n.x=a.x,r=!0),Math.abs(a.y-this.y)<e&&(n.y=a.y,r=!0)}}catch(s){o.e(s)}finally{o.f()}return r?n:null}}},{key:"getSnapByAngles",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;if(w.a.Configuration.getBooleanValue(w.a.configSnapMode)){var r=[30,45,60,90,120,135,150,210,225,240,270,300,315,330],i=this.adjacentCorners();if(!(i.length<2)){t=t||this.x,n=n||this.y;for(var o=new m.Nb(t,n),a=[],s=0;s<i.length;s++)a.push(new m.Nb(i[s].x,i[s].y));var l=w.a.Utils.getCyclicOrder(a,o),c=l.indices,u=l.angles,h=c.length<3?1:c.length,d=function(){var t=(s+1)%c.length,n=c[s],i=c[t],l=a[n].clone(),h=a[i].clone(),d=Math.abs(u[t]-u[s]),f=[].concat(r).sort((function(e,t){return Math.abs(e-d)-Math.abs(t-d)}))[0];if(Math.abs(f-d)>e)return"continue";var p=f-d,v=h.clone().rotateAround(o.clone(),p*Math.PI/180),g=o.clone().add(h.clone().sub(v)),y=w.a.Utils.findLineLineCrossPoint(l.x,l.y,o.x,o.y,h.x,h.y,g.x,g.y);return y?(180===f&&console.log(y),{v:{x:y.x,y:y.y}}):void 0};for(s=0;s<h;s++){var f=d();if("continue"!==f&&"object"===typeof f)return f.v}return null}}}},{key:"relativeMove",value:function(e,t){this.locked||this.move(this.x+e,this.y+t)}},{key:"fireAction",value:function(e){this.action_callbacks.forEach((function(t){return"function"===typeof t&&t(e)}))}},{key:"remove",value:function(){var e=this;this.deleted_callbacks.forEach((function(t){return"function"===typeof t&&t(e)}))}},{key:"removeAll",value:function(){[].concat(Object(v.a)(this.wallStarts),Object(v.a)(this.wallEnds)).forEach((function(e){return e.remove()})),this.remove()}},{key:"move",value:function(e,t){var n=this,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!this.locked){var i=this.x,o=this.y;this.x=e,this.y=t,r&&this.mergeWithIntersected(),this.moved_callbacks.forEach((function(e){return"function"===typeof e&&e(n.x,n.y,i,o)})),this.wallStarts.forEach((function(e){e.fireMoved()})),this.wallEnds.forEach((function(e){e.fireMoved()}))}}},{key:"adjacentCorners",value:function(){for(var e=[],t=0;t<this.wallStarts.length;t++)e.push(this.wallStarts[t].getEnd());for(t=0;t<this.wallEnds.length;t++)e.push(this.wallEnds[t].getStart());return e}},{key:"isWallConnected",value:function(e){for(var t=0;t<this.wallStarts.length;t++)if(this.wallStarts[t]===e)return!0;for(t=0;t<this.wallEnds.length;t++)if(this.wallEnds[t]===e)return!0;return!1}},{key:"distanceFrom",value:function(e,t){return w.a.Utils.distance(e,t,this.x,this.y)}},{key:"distanceFromWall",value:function(e){return e.distanceFrom(this.x,this.y)}},{key:"distanceFromCorner",value:function(e){return this.distanceFrom(e.x,e.y)}},{key:"detachWall",value:function(e){w.a.Utils.removeValue(this.wallStarts,e),w.a.Utils.removeValue(this.wallEnds,e),0===this.wallStarts.length&&0===this.wallEnds.length&&this.remove()}},{key:"attachStart",value:function(e){this.wallStarts.push(e)}},{key:"attachEnd",value:function(e){this.wallEnds.push(e)}},{key:"wallTo",value:function(e){for(var t=0;t<this.wallStarts.length;t++)if(this.wallStarts[t].getEnd()===e)return this.wallStarts[t];return null}},{key:"wallFrom",value:function(e){for(var t=0;t<this.wallEnds.length;t++)if(this.wallEnds[t].getStart()===e)return this.wallEnds[t];return null}},{key:"wallToOrFrom",value:function(e){return this.wallTo(e)||this.wallFrom(e)}},{key:"combineWithCorner",value:function(e){this.x=e.x,this.y=e.y;for(var t=e.wallStarts.length-1;t>=0;t--)e.wallStarts[t].setStart(this);for(t=e.wallEnds.length-1;t>=0;t--)e.wallEnds[t].setEnd(this);e.removeAll(),this.removeDuplicateWalls()}},{key:"mergeWithIntersected",value:function(){var e=this,t=this.layer;if(t){console.log("merge with wall");for(var n=t.getCorners(),r=0;r<n.length;r++){var i=n[r];if(this.distanceFromCorner(i)<M&&i!==this)return console.log("combine corner",i),this.combineWithCorner(i),!0}var o=t.getWalls(),a=t.getRooms();for(r=0;r<o.length;r++){var s=o[r];if(this.distanceFromWall(s)<M&&!this.isWallConnected(s)){var l=function(){console.log(s);var n=w.a.Utils.closestPointOnLine(e.x,e.y,s.getStart().x,s.getStart().y,s.getEnd().x,s.getEnd().y);e.x=n.x,e.y=n.y;var r=t.height||0,i=e.floorplan.newWall(e,s.getEnd(),r);i.thickness=s.thickness,i.thicknessDirection=s.thicknessDirection,i.isOutsideWall=s.isOutsideWall;var o=s.start,l=s.end;return a.forEach((function(t){var n=t.corners;n.includes(o)&&n.includes(l)&&t.corners.push(e)})),t.addWall(i),s.setEnd(e),{v:!0}}();if("object"===typeof l)return l.v}}return!1}}},{key:"removeDuplicateWalls",value:function(){for(var e={},t={},n=this.wallStarts.length-1;n>=0;n--)this.wallStarts[n].getEnd()===this||this.wallStarts[n].getEnd().id in e?this.wallStarts[n].remove():e[this.wallStarts[n].getEnd().id]=!0;for(n=this.wallEnds.length-1;n>=0;n--)this.wallEnds[n].getStart()===this||this.wallEnds[n].getStart().id in t?this.wallEnds[n].remove():t[this.wallEnds[n].getStart().id]=!0}},{key:"setLocked",value:function(e){this.locked=e}},{key:"updateAngles",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=this.adjacentCorners();if(e&&t.push(e),this.angles=[],this.angleDirections=[],this.startAngles=[],this.endAngles=[],this.cyclicNeighbors=[],!(t.length<2)){for(var n=new m.Nb(this.x,this.y),r=[],i=0;i<t.length;i++)r.push(new m.Nb(t[i].x,t[i].y));var o=w.a.Utils.getCyclicOrder(r,n),a=o.indices,s=o.angles,l=a.length<3?1:a.length;for(i=0;i<l;i++){var c=(i+1)%a.length,u=a[i],h=a[c],d=r[u].clone().sub(n).normalize(),f=r[h].clone().sub(n).normalize(),p=d.add(f).normalize().multiplyScalar(.4),v=Math.abs(s[c]-s[i]);v=v>180?360-v:v,v=Math.round(10*v)/10,this.startAngles.push(s[i]),this.endAngles.push(s[c]),this.angles.push(v),this.angleDirections.push(p),this.cyclicNeighbors.push(t[a[i]])}}}}]),e}(),T=function(){function e(t,n,r){Object(h.a)(this,e),this.layerOffset=0,this.plane=null,this.interiorTransform=new m.T,this.invInteriorTransform=new m.T,this.exteriorTransform=new m.T,this.invExteriorTransform=new m.T,this.redrawCallbacks=[],this.generatePlane=function(){var e=this;function t(t){return new m.Ob(t.x,e.layerOffset,t.y)}var n=t(this.interiorStart()),r=t(this.interiorEnd()),i=r.clone();i.y+=this.wall.height;var o=n.clone();o.y+=this.wall.height;var a=new m.w;a.vertices=[n,r,i,o],a.faces.push(new m.s(0,1,2)),a.faces.push(new m.s(0,2,3)),a.computeFaceNormals(),a.computeBoundingBox(),this.plane=new m.U(a,new m.V),this.plane.visible=!1,this.plane.edge=this,this.computeTransforms(this.interiorTransform,this.invInteriorTransform,this.interiorStart(),this.interiorEnd()),this.computeTransforms(this.exteriorTransform,this.invExteriorTransform,this.exteriorStart(),this.exteriorEnd())},this.layer=t,this.wall=n,this.offset=n.thickness/2,this.height=n.height,this.layerOffset=r,this.wall.edge=this}return Object(d.a)(e,[{key:"getTexture",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return e?this.wall.interiorTexture:this.wall.exteriorTexture}},{key:"setTexture",value:function(e,t,n,r,i){var o={url:e,stretch:t,scale:n,width:r,height:i},a=this.isInterior,s=this.isExterior;a?this.wall.setInteriorTexture(o):s?this.wall.setExteriorTexture(o):this.wall.setTexture(o),this.redrawCallbacks.forEach((function(e){return"function"===typeof e&&e()}))}},{key:"interiorDistance",value:function(){var e=this.interiorStart(),t=this.interiorEnd();return w.a.Utils.distance(e.x,e.y,t.x,t.y)}},{key:"computeTransforms",value:function(e,t,n,r){var i=n,o=r,a=w.a.Utils.angle(1,0,o.x-i.x,o.y-i.y),s=new m.T;s.makeTranslation(-i.x,0,-i.y);var l=new m.T;l.makeRotationY(-a),e.multiplyMatrices(l,s),t.copy(e).invert()}},{key:"distanceTo",value:function(e,t){return w.a.Utils.pointDistanceFromLine(e,t,this.interiorStart().x,this.interiorStart().y,this.interiorEnd().x,this.interiorEnd().y)}},{key:"getStart",value:function(){return this.wall.getStart()}},{key:"getEnd",value:function(){return this.wall.getEnd()}},{key:"interiorLine",value:function(){var e=this.wall,t=e.start,n=e.end,r=e.thickness,i=e.thicknessDirection,o=new m.Nb,a=e.getWallLength(),s=1;i>0?s=0:i<0&&(s=2),s*=.5;var l=e.toVec2().rotateAround(o,-Math.PI/2).multiplyScalar(r/a*s);return{start:{x:t.x+l.x,y:t.y+l.y},end:{x:n.x+l.x,y:n.y+l.y}}}},{key:"exteriorLine",value:function(){var e=this.wall,t=e.start,n=e.end,r=e.thickness,i=e.thicknessDirection,o=new m.Nb,a=e.getWallLength(),s=1;i>0?s=2:i<0&&(s=0),s*=.5;var l=e.toVec2().rotateAround(o,Math.PI/2).multiplyScalar(r/a*s);return{start:{x:t.x+l.x,y:t.y+l.y},end:{x:n.x+l.x,y:n.y+l.y}}}},{key:"getEdgeCrossPoints",value:function(e,t,n){var r=[],i=.1;return[t.interiorLine(),t.exteriorLine()].forEach((function(t){if(!(n>.9*Math.PI&&n<1.1*Math.PI||n<Math.PI*i||n>1.9*Math.PI)){var o=w.a.Utils.findLineLineCrossPoint(e.start.x,e.start.y,e.end.x,e.end.y,t.start.x,t.start.y,t.end.x,t.end.y);o&&r.push(o)}})),r}},{key:"calculateAngle",value:function(e,t){var n=e.angleTo(t);return e.clone().cross(t).y<0&&(n=2*Math.PI-n),n}},{key:"sortWalls",value:function(e,t,n,r){var i=this;try{var o=this.wall.oppositeCorner(t),a=new m.Ob(o.x-t.x,0,o.y-t.y);return e.filter((function(e){return e!==i.wall})).sort((function(e,r){try{var o=e.oppositeCorner(t),s=r.oppositeCorner(t),l=new m.Ob(o.x-t.x,0,o.y-t.y),c=new m.Ob(s.x-t.x,0,s.y-t.y);return(i.calculateAngle(a,l)-i.calculateAngle(a,c))*n}catch(u){return 0}}))}catch(s){return e}}},{key:"findBestCandidate",value:function(e,t,n,r,i,o){var a=e[0],s=new m.Ob(r.x-i.x,0,r.y-i.y);try{var l=a.oppositeCorner(o),c=new m.Ob(l.x-o.x,0,l.y-o.y),u=this.calculateAngle(s,c);n<0&&(u=2*Math.PI-u),t.sort((function(e,t){var n=Math.sqrt(Math.pow(e.x-r.x,2)+Math.pow(e.y-r.y,2));return(Math.sqrt(Math.pow(t.x-r.x,2)+Math.pow(t.y-r.y,2))-n)*(u>Math.PI?1:-1)}))}catch(h){}return t[0]}},{key:"interiorEnd",value:function(e){var t=this,n=this.interiorLine(),r=this.wall.end,i=[],o=[],a=this.sortWalls([].concat(Object(v.a)(r.wallStarts),Object(v.a)(r.wallEnds)),r,-1);a.length&&o.push(a[0]);var s=new m.Ob(n.start.x-n.end.x,0,n.start.y-n.end.y);return o.forEach((function(e){try{var o=e.oppositeCorner(r),a=new m.Ob(o.x-r.x,0,o.y-r.y),l=t.calculateAngle(s,a,-1),c=e.edge;c&&i.push.apply(i,Object(v.a)(t.getEdgeCrossPoints(n,c,l)))}catch(u){}})),0===i.length?n.end:this.findBestCandidate(o,i,-1,n.start,n.end,r)}},{key:"interiorStart",value:function(e){var t=this,n=this.interiorLine(),r=this.wall.start,i=[],o=[],a=this.sortWalls([].concat(Object(v.a)(r.wallStarts),Object(v.a)(r.wallEnds)),r,1);a.length&&o.push(a[0]);var s=new m.Ob(n.end.x-n.start.x,0,n.end.y-n.start.y);return o.forEach((function(e){try{var o=e.oppositeCorner(r),a=new m.Ob(o.x-r.x,0,o.y-r.y),l=t.calculateAngle(s,a,1),c=e.edge;c&&i.push.apply(i,Object(v.a)(t.getEdgeCrossPoints(n,c,l)))}catch(u){}})),0===i.length?n.start:this.findBestCandidate(o,i,1,n.end,n.start,r)}},{key:"interiorCenter",value:function(){return{x:(this.interiorStart().x+this.interiorEnd().x)/2,y:(this.interiorStart().y+this.interiorEnd().y)/2}}},{key:"exteriorEnd",value:function(e){var t=this,n=this.exteriorLine(),r=this.wall.end,i=[],o=[],a=this.sortWalls([].concat(Object(v.a)(r.wallStarts),Object(v.a)(r.wallEnds)),r,1);a.length&&o.push(a[0]);var s=new m.Ob(n.start.x-n.end.x,0,n.start.y-n.end.y);return o.forEach((function(e){try{var o=e.oppositeCorner(r),a=new m.Ob(o.x-r.x,0,o.y-r.y),l=t.calculateAngle(s,a,1),c=e.edge;c&&i.push.apply(i,Object(v.a)(t.getEdgeCrossPoints(n,c,l)))}catch(u){}})),0===i.length?n.end:this.findBestCandidate(o,i,1,n.start,n.end,r)}},{key:"exteriorStart",value:function(e){var t=this,n=this.exteriorLine(),r=this.wall.start,i=[],o=[],a=this.sortWalls([].concat(Object(v.a)(r.wallStarts),Object(v.a)(r.wallEnds)),r,-1,e);a.length&&o.push(a[0]);var s=new m.Ob(n.end.x-n.start.x,0,n.end.y-n.start.y);return o.forEach((function(e){try{var o=e.oppositeCorner(r),a=new m.Ob(o.x-r.x,0,o.y-r.y),l=t.calculateAngle(s,a,-1),c=e.edge;c&&i.push.apply(i,Object(v.a)(t.getEdgeCrossPoints(n,c,l)))}catch(u){}})),0===i.length?n.start:this.findBestCandidate(o,i,-1,n.end,n.start,r)}},{key:"midStart",value:function(){var e=this.wall.start;return{x:e.x,y:e.y}}},{key:"midEnd",value:function(){var e=this.wall.end;return{x:e.x,y:e.y}}},{key:"corners",value:function(){var e=this.wall,t=e.start,n=(e.end,-9===t.x&&6===t.y);return[this.midStart(n),this.interiorStart(n),this.interiorEnd(n),this.midEnd(n),this.exteriorEnd(n),this.exteriorStart(n)]}}]),e}(),_={url:"".concat(w.a.Configuration.getStringValue("defaultPathPrefix"),"/rooms/textures/marbletiles.jpg"),scale:4},D=function(){function e(t,n,r,i){Object(h.a)(this,e),this.interiorCorners=[],this.corners=[],this.walls=[],this.name="A Room",this.area=0,this.areaCenter={},this.edgePointer=null,this.floorPlane=null,this.customTexture=!1,this.floorChangeCallbacks=[],this.layer=null,this.texture=_,this.offset=0,this.height=w.a.Configuration.getNumericValue(w.a.configWallHeight),this.layer=t,this.corners=n,this.offset=r,this.height=i,this.updateWalls(),this.updateInteriorCorners(),this.generatePlane(),this.updateArea()}return Object(d.a)(e,[{key:"getUuid",value:function(){return this.constructor.getUuidByCorners(this.corners)}},{key:"fireOnFloorChange",value:function(e){this.floorChangeCallbacks.push(e)}},{key:"getTexture",value:function(){return this.texture||_}},{key:"updateArea",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.area=w.a.Utils.area(this.corners),this.areaCenter=w.a.Utils.centroid(this.corners);var n=0;return this.walls.forEach((function(t){var r=t.getRoomInteractionSide(e);if(0!==r){var i=t.edge;1===r?n+=w.a.Utils.area([i.midStart(),i.exteriorStart(),i.exteriorEnd(),i.midEnd()]):-1===r&&(n+=w.a.Utils.area([i.midStart(),i.interiorStart(),i.interiorEnd(),i.midEnd()]))}})),!t&&(this.area-=n),this}},{key:"setTexture",value:function(e){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;this.texture={url:e,scale:t,width:n,height:r},document.dispatchEvent(new CustomEvent(w.a.BP3D_EVENT_ADD_TO_UNDO_STACK)),this.floorChangeCallbacks.forEach((function(e){return"function"===typeof e&&e()}))}},{key:"generatePlane",value:function(){var e=[];this.interiorCorners.forEach((function(t){e.push(new m.Nb(t.x,t.y))}));var t=new m.xb(e),n=new m.yb(t);this.floorPlane=new m.U(n,new m.V({side:m.q})),this.floorPlane.visible=!1,this.floorPlane.rotation.set(Math.PI/2,0,0),this.floorPlane.position.set(0,this.offset,0),this.floorPlane.updateMatrix(),this.floorPlane.geometry.applyMatrix4(this.floorPlane.matrix),this.floorPlane.matrix.identity(),this.floorPlane.room=this}},{key:"cycleIndex",value:function(e){return e<0?e+this.corners.length:e%this.corners.length}},{key:"updateInteriorCorners",value:function(){var e=this,t={};this.interiorCorners=[];for(var n=this.corners[0],r=this.corners[0];;){t[r.id]=!0,this.interiorCorners.push({x:r.x,y:r.y});var i=[].concat(Object(v.a)(r.wallStarts),Object(v.a)(r.wallEnds)).filter((function(t){var n=0;return e.corners.includes(t.start)&&n++,e.corners.includes(t.end)&&n++,2==n}));if(0===i.length)break;var o,a=null,s=Object(y.a)(i);try{for(s.s();!(o=s.n()).done;){var l=o.value,c=l.oppositeCorner(r);if(!t[c.id]){l.edge&&l.edge.generatePlane(),a=c;break}}}catch(u){s.e(u)}finally{s.f()}if(!a)break;if((r=a)===n)break}}},{key:"updateWalls",value:function(){this.walls=[];for(var e=0;e<this.corners.length;e++){var t=this.corners[e],n=this.corners[(e+1)%this.corners.length],r=t.wallTo(n),i=t.wallFrom(n);if(r){var o=new T(this,r,this.offset);this.walls.push(r),o.generatePlane()}else i?(o=new T(this,i,this.offset),this.walls.push(i),o.generatePlane()):console.log("corners arent connected by a wall, uh oh")}}}]),e}();D.getUuidByCorners=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return w.a.Utils.map(e,(function(e){return e.id})).sort().join()};var L=function(){function e(t,n,r){var i=this;Object(h.a)(this,e),this.floorplan=null,this.layerIndex=100,this.offset=0,this.height=w.a.Configuration.getNumericValue(w.a.configWallHeight),this.floorThickness=w.a.Configuration.getNumericValue(w.a.configFloorThickness),this.visible=!0,this.corners=[],this.walls=[],this.rooms=[],this.updated_callbacks=[],this.setLayerIndex=function(e){i.layerIndex=e},this.setOffset=function(e){var t=i.offset-e;i.offset=e;var n=[];i.walls.forEach((function(e){n.push.apply(n,Object(v.a)(e.items))})),n.forEach((function(e){e.position.y-=t,e.moveChildMeshes(),e.rotateChildMeshes()})),i.calculateRooms()},this.setHeight=function(e){i.height=e,i.walls.forEach((function(t){t.height=e}))},this.setVisible=function(e){return i.visible=e},this.setFloorThickness=function(e){i.floorThickness=e},this.remove=function(){},this.update=function(){i.calculateRooms(),i.updated_callbacks.forEach((function(e){return e()}))},this.addCorner=function(e){e.layer=i,e.fireOnDelete(i.removeCorner),i.corners.push(e)},this.getCorners=function(){return i.corners},this.removeCorner=function(e){w.a.Utils.removeValue(i.corners,e),i.rooms.forEach((function(t){var n=t.corners;n.includes(e)&&w.a.Utils.removeValue(n,e)}))},this.addWall=function(e){e.layer=i,e.height=i.height,e.fireOnDelete(i.removeWall),i.walls.push(e)},this.getWalls=function(){return i.walls.forEach((function(e){e.edge||(e.orphan=!0,new T(null,e,i.offset).generatePlane())})),i.walls},this.removeWall=function(e){var t=[];if(e.items.forEach((function(e){return t.push(e)})),t.length)for(var n=t.length-1;n>=0;n--)t[n].remove();w.a.Utils.removeValue(i.walls,e)},this.getRooms=function(){return i.rooms.forEach((function(e){return e.floorThickness=i.floorThickness})),i.rooms},this.layerIndex=t,this.offset=n,this.height=r}return Object(d.a)(e,[{key:"reduceWalls",value:function(){for(var e=this.corners.length-1;e>=0;e--){var t=this.corners[e],n=[].concat(Object(v.a)(t.wallStarts),Object(v.a)(t.wallEnds));if(2===n.length&&(t.updateAngles(),180===t.angles[0])){var r=n[1].oppositeCorner(t);r.detachWall(n[1]),n[0].isStart(t)?(n[0].start=r,r.attachStart(n[0])):(n[0].end=r,r.attachEnd(n[0])),this.removeCorner(t),this.removeWall(n[1])}}}},{key:"calculateRooms",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=[],r=this.findRooms(this.corners);r.forEach((function(r){var i=D.getUuidByCorners(r),o=new D(e,r,e.offset,e.height);if(t[i])o.name=t[i].name,o.texture=t[i].texture;else{var a=e.rooms.filter((function(e){return e.getUuid()===i}));a.length?(o.name=a[0].name,o.texture=a[0].texture):o.name="A Room ".concat(n.length+1)}n.push(o)})),this.rooms=n,this.walls.forEach((function(e){e.checkIsOutsideWall()?e.isOutsideWall=!0:e.isOutsideWall=!1}))}},{key:"findRooms",value:function(e){function t(e,t,n){return w.a.Utils.angle2pi(e.x-t.x,e.y-t.y,n.x-t.x,n.y-t.y)}var n=[];e.forEach((function(e){e.adjacentCorners().forEach((function(r){n.push(function(e,n){var r=[],i={corner:n,previousCorners:[e]},o={};o[e.id]=!0;for(var a=function(){var a=i.corner;if(o[a.id]=!0,i.corner===e&&a!==n)return{v:i.previousCorners};for(var s=[],l=i.corner.adjacentCorners(),c=0;c<l.length;c++){var u=l[c];(!(u.id in o)||u===e&&a!==n)&&s.push(u)}var h=i.previousCorners.slice(0);if(h.push(a),s.length>1){var d=i.previousCorners[i.previousCorners.length-1];s.sort((function(e,n){return t(d,a,n)-t(d,a,e)}))}s.length>0&&s.forEach((function(e){r.push({corner:e,previousCorners:h})})),i=r.pop()};i;){var s=a();if("object"===typeof s)return s.v}return[]}(e,r))}))}));var r=function(e){for(var t=[],n={},r=function(e){return e.id},i=0;i<e.length;i++){for(var o=!0,a=e[i],s=0;s<a.length;s++){var l=w.a.Utils.cycle(a,s),c=w.a.Utils.map(l,r).join("-");n.hasOwnProperty(c)&&(o=!1)}o&&(t.push(e[i]),n[c]=!0)}return t}(n);return w.a.Utils.removeIf(r,w.a.Utils.isClockwise)}},{key:"getArea",value:function(){var e=0;return this.rooms.forEach((function(t){e+=t.updateArea(!0).area})),e}},{key:"getLayerMetadata",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this,n=t.layerIndex-100,r={index:n,label:"Layer ".concat(n>=0?n:"B"+Math.abs(n)),height:t.height,distanceFromGround:t.offset,floorThickness:t.floorThickness,area:t.getArea(),isUndergroundLayer:t.layerIndex<100,hasExposedCeiling:!1,hasExposedFloor:!1},i=[];t.getRooms().forEach((function(e){var n={label:e.name,area:e.updateArea().area},r=[];e.corners.forEach((function(e){r.push({position:{x:e.x,y:t.offset,z:e.y},uuid:e.id})})),i.push({metadata:n,corners:r})}));var o=[];return t.getWalls().forEach((function(n){var r=n.start,i=n.end,a=n.thickness,s=n.thicknessDirection,l=n.isOutsideWall,c={height:t.height,start:{x:r.x,y:t.offset,z:r.y,uuid:r.id},end:{x:i.x,y:t.offset,z:i.y,uuid:i.id},thickness:a,thicknessDirection:s,isOutsideWall:l,isExposedWall:n.checkIsOutsideWall(),isUndergroundWall:t.layerIndex<100},u=[];n.items.forEach((function(t){var n=t.halfSize,r=t.rotation,i=t.position,o=-r.y/Math.PI*180-180-e;o<0&&(o+=360),u.push({type:t.metadata.name,size:{width:2*n.x,height:2*n.y},rotation:r.y,position:{x:i.x,y:i.z,z:i.y},direction:o})})),o.push({metadata:c,windows:u})})),{metadata:r,rooms:i,walls:o}}}]),e}(),I=n(24),W=n.n(I),N=function(){function e(t,n){Object(h.a)(this,e),this.locked=!1,this.moved_callbacks=[],this.deleted_callbacks=[],this.action_callbacks=[],this.start=t,this.end=n,this.id=this.getUuid(),this.start.attachStart(this),this.end.attachEnd(this)}return Object(d.a)(e,[{key:"getUuid",value:function(){return[this.start.id,this.end.id].join()}},{key:"resetFrontBack",value:function(){}},{key:"snapToAxis",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:w.a.Configuration.getNumericValue(w.a.configSnapTolernance);this.start.snapToAxis(e),this.end.snapToAxis(e)}},{key:"fireOnMove",value:function(e){this.moved_callbacks.push(e)}},{key:"fireOnDelete",value:function(e){this.deleted_callbacks.push(e)}},{key:"dontFireOnDelete",value:function(e){var t=this.deleted_callbacks.indexOf(e);this.deleted_callbacks.splice(t,1)}},{key:"fireOnAction",value:function(e){this.action_callbacks.push(e)}},{key:"fireAction",value:function(e){this.action_callbacks.forEach((function(t){return"function"===typeof t&&t(e)}))}},{key:"relativeMove",value:function(e,t){if(!(this.locked||this.start.locked||this.end.locked)){this.start.move(this.getStartX()+e,this.getStartY()+t,!1),this.end.move(this.getEndX()+e,this.getEndY()+t,!1);var n={prev:{start:{x:this.getStartX(),y:this.getStartY()},end:{x:this.getEndX(),y:this.getEndY()}}};this.snapToAxis(),n.current={start:{x:this.getStartX(),y:this.getStartY()},end:{x:this.getEndX(),y:this.getEndY()}}}}},{key:"fireMoved",value:function(){this.moved_callbacks.forEach((function(e){return"function"===typeof e&&e()}))}},{key:"fireRedraw",value:function(){}},{key:"getStart",value:function(){return this.start}},{key:"getEnd",value:function(){return this.end}},{key:"getStartX",value:function(){return this.start.getX()}},{key:"getEndX",value:function(){return this.end.getX()}},{key:"getStartY",value:function(){return this.start.getY()}},{key:"getEndY",value:function(){return this.end.getY()}},{key:"remove",value:function(){var e=this;this.start.detachEdge(this),this.end.detachEdge(this),this.deleted_callbacks.forEach((function(t){return"function"===typeof t&&t(e)}))}},{key:"setStart",value:function(e){this.start.detachEdge(this),e.attachStart(this),this.start=e,this.fireMoved()}},{key:"setEnd",value:function(e){this.end.detachEdge(this),e.attachEnd(this),this.end=e,this.fireMoved()}},{key:"distanceFrom",value:function(e,t,n){var r=new m.Ob(e,t,n),i=new m.Ob(this.start.x,this.start.y,this.start.z),o=new m.Ob(this.end.x,this.end.y,this.end.z);return new m.G(i,o).closestPointToPoint(r).distanceTo(r)}},{key:"oppositeVertex",value:function(e){return this.start===e?this.end:this.end===e?this.start:void console.log("edge does not connect to vertex")}},{key:"setLocked",value:function(e){this.locked=e,this.start.setLocked(e),this.end.setLocked(e)}},{key:"getEdgeCenter",value:function(){var e=this.start.x,t=this.start.y,n=this.start.z;return{x:(e+this.end.x)/2,y:(t+this.end.y)/2,z:(n+this.end.z)/2}}},{key:"getEdgeLength",value:function(){var e=this.start.x,t=this.start.y,n=this.start.z,r=this.end.x,i=this.end.y,o=this.end.z;return Math.sqrt(Math.pow(e-r,2)+Math.pow(t-i,2)+Math.pow(n-o,2))}}]),e}(),z=w.a.Configuration.getNumericValue(w.a.configSnapTolernance),V=function(){function e(t,n,r,i,o){var a=this;Object(h.a)(this,e),this.edgeStarts=[],this.edgeEnds=[],this.moved_callbacks=[],this.deleted_callbacks=[],this.action_callbacks=[],this.locked=!1,this.selected=!1,this.setLocked=function(e){return a.locked=e},this.setPosition=function(e,t){switch(e.toLowerCase()){case"x":a.x=t;break;case"z":a.y=t-a.parent.offset;break;case"y":a.z=t}a.moved_callbacks.forEach((function(e){return e()}))},this.parent=t,this.x=n,this.y=r,this.z=i,this.id=o||w.a.Utils.guid()}return Object(d.a)(e,[{key:"toVec3",value:function(){return new m.Ob(this.x,this.y,this.z)}},{key:"fireOnMove",value:function(e){this.moved_callbacks.push(e)}},{key:"fireOnDelete",value:function(e){this.deleted_callbacks.push(e)}},{key:"fireOnAction",value:function(e){this.action_callbacks.push(e)}},{key:"getX",value:function(){return this.x}},{key:"getY",value:function(){return this.y}},{key:"getZ",value:function(){return this.z}},{key:"snapToAxis",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:w.a.Configuration.getNumericValue(w.a.configSnapTolernance),t={x:!1,y:!1,z:!1},n=this;return this.adjacentVertices().forEach((function(r){Math.abs(r.x-n.x)<e&&(n.x=r.x,t.x=!0),Math.abs(r.y-n.y)<e&&(n.y=r.y,t.y=!0),Math.abs(r.z-n.z)<e&&(n.z=r.z,t.z=!0)})),t}},{key:"relativeMove",value:function(e,t,n){this.locked||this.move(this.x+e,this.y+t,this.z+n)}},{key:"fireAction",value:function(e){this.action_callbacks.forEach((function(t){return t(e)}))}},{key:"remove",value:function(){var e=this;this.deleted_callbacks.forEach((function(t){return t(e)}))}},{key:"removeAll",value:function(){[].concat(Object(v.a)(this.edgeStarts),Object(v.a)(this.edgeEnds)).forEach((function(e){return e.remove()})),this.remove()}},{key:"move",value:function(e,t,n){var r=this,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!this.locked){var o=this.x,a=this.y,s=this.z;this.x=e,this.y=t,this.z=n,this.mergeWithIntersected(),i&&this.snapToAxis(),this.moved_callbacks.forEach((function(e){return e(r.x,r.y,r.z,o,a,s)}))}}},{key:"adjacentVertices",value:function(){for(var e=[],t=0;t<this.edgeStarts.length;t++)e.push(this.edgeStarts[t].getEnd());for(t=0;t<this.edgeEnds.length;t++)e.push(this.edgeEnds[t].getStart());return e}},{key:"isEdgeConnected",value:function(e){for(var t=0;t<this.edgeStarts.length;t++)if(this.edgeStarts[t]===e)return!0;for(t=0;t<this.edgeEnds.length;t++)if(this.edgeEnds[t]===e)return!0;return!1}},{key:"distanceFrom",value:function(e,t,n){return new m.Ob(e,t,n).distanceTo(new m.Ob(this.x,this.y,this.z))}},{key:"distanceFromEdge",value:function(e){return e.distanceFrom(this.x,this.y,this.z)}},{key:"distanceFromVertex",value:function(e){return this.distanceFrom(e.x,e.y,e.z)}},{key:"detachEdge",value:function(e){w.a.Utils.removeValue(this.edgeStarts,e),w.a.Utils.removeValue(this.edgeEnds,e),0===this.edgeStarts.length&&0===this.edgeEnds.length&&this.remove()}},{key:"attachStart",value:function(e){this.edgeStarts.push(e)}},{key:"attachEnd",value:function(e){this.edgeEnds.push(e)}},{key:"edgeTo",value:function(e){for(var t=0;t<this.edgeStarts.length;t++)if(this.edgeStarts[t].getEnd()===e)return this.edgeStarts[t];return null}},{key:"edgeFrom",value:function(e){for(var t=0;t<this.edgeEnds.length;t++)if(this.edgeEnds[t].getStart()===e)return this.edgeEnds[t];return null}},{key:"edgeToOrFrom",value:function(e){return this.edgeTo(e)||this.edgeFrom(e)}},{key:"combineWithVertex",value:function(e){this.x=e.x,this.y=e.y,this.z=e.z;for(var t=e.edgeStarts.length-1;t>=0;t--)e.edgeStarts[t].setStart(this);for(t=e.edgeEnds.length-1;t>=0;t--)e.edgeEnds[t].setEnd(this);e.removeAll(),this.removeDuplicateEdges(),this.parent.update()}},{key:"mergeWithIntersected",value:function(){for(var e=this.parent,t=e.vertices,n=e.edges,r=0;r<t.length;r++){var i=t[r];if(this.distanceFromVertex(i)<z&&i!==this)return this.combineWithVertex(i),!0}for(r=0;r<n.length;r++){var o=n[r];if(this.distanceFromEdge(o)<z&&!this.isEdgeConnected(o)){var a=w.a.Utils.closestPointOnLine(this.x,this.y,o.getStart().x,o.getStart().y,o.getEnd().x,o.getEnd().y);return this.x=a.x,this.y=a.y,this.parent.newEdge(this,o.getEnd()),o.setEnd(this),this.parent.update(),!0}}return!1}},{key:"removeDuplicateEdges",value:function(){for(var e={},t={},n=this.edgeStarts.length-1;n>=0;n--)this.edgeStarts[n].getEnd()===this||this.edgeStarts[n].getEnd().id in e?this.edgeStarts[n].remove():e[this.edgeStarts[n].getEnd().id]=!0;for(n=this.edgeEnds.length-1;n>=0;n--)this.edgeEnds[n].getStart()===this||this.edgeEnds[n].getStart().id in t?this.edgeEnds[n].remove():t[this.edgeEnds[n].getStart().id]=!0}}]),e}(),A=n(28),R=w.a.Configuration.getNumericValue(w.a.configSnapTolernance),U=function e(t){var n=this;Object(h.a)(this,e),this.vertices=[],this.edges=[],this.faces=[],this.offset=0,this.enabled=!1,this.getVertices=function(){return n.vertices.forEach((function(e){return e.enabled=n.enabled})),n.vertices},this.getEdges=function(){return n.edges.forEach((function(e){return e.enabled=n.enabled})),n.edges},this.reset=function(){n.vertices=[],n.edges=[],n.faces=[]},this.update=function(){n.floorplan.update(!1)},this.newVertex=function(e,t,r,i){var o=new V(n,e,t,r,i);return o.fireOnMove(n.update),o.fireOnDelete(n.removeVertex),n.vertices.push(o),o},this.removeVertex=function(e){w.a.Utils.removeValue(n.vertices,e)},this.autoSplitEdges=function(e,t){for(var r=!1,i=n.getEdges(),o=i.length,a=0;a<o;a++){var s=i[a],l=[e,t];if(!l.includes(s.start)&&!l.includes(s.end)){var c=w.a.Utils3D.findLineLineCrossPoint(e,t,s.start,s.end);if(c)if("continue"===function(){if(e.distanceFrom(c.x,c.y,c.z)<R||t.distanceFrom(c.x,c.y,c.z)<R)return"continue";r=!0;var i=n.newVertex(c.x,c.y,c.z);n.newEdge(i,s.end),s.setEnd(i),l.forEach((function(e){return n.newEdge(i,e)}))}())continue}}return r},this.checkEdgeIsExist=function(e,t){var r=!1;return n.getEdges().forEach((function(n){(e===n.start&&t===n.end||e===n.end&&t===n.start)&&(r=!0)})),r},this.newEdge=function(e,t){if(e&&t&&!n.checkEdgeIsExist(e,t)){var r=!1;if(!r){var i=new N(e,t);return i.fireOnMove(n.update),i.fireOnDelete(n.removeEdge),n.edges.push(i),i}}},this.removeEdge=function(e){w.a.Utils.removeValue(n.edges,e)},this.regenerate=function(e){if(n.reset(),Array.isArray(e)){for(var t=e.map((function(e){return[e.x,e.y]})),r=W()(t,1),i=0;i<r.length-1;i++){var o=r[i];n.newVertex(o[0],0,o[1])}for(var a=n.vertices.length,s=0;s<a;s++)n.newEdge(n.vertices[s],n.vertices[(s+1)%a])}},this.loadData=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{vertices:{},edges:[],faces:{}},t=e.offset,r=e.vertices,i=e.edges;n.offset=t;var o={};for(var a in r){var s=r[a],l=n.newVertex(s.x,s.y,s.z,s.id);o[a]=l}var c,u=Object(y.a)(i);try{for(u.s();!(c=u.n()).done;){var h=c.value;n.newEdge(o[h.start],o[h.end])}}catch(d){u.e(d)}finally{u.f()}n.calculateFaces(e.faces)},this.setFaceTexture=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";e||(n.faces.forEach((function(e){e.setColor(t)})),n.update())},this.getFaces=function(){return n.faces},this.calculateFaces=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=[],r=n.findFaces(n.vertices);r.forEach((function(r){var i=A.a.getUuidByCorners(r),o=new A.a(r);if(e[i])o.setColor(e[i].color);else{var a=n.faces.filter((function(e){return e.getUuid()===i}));a.length&&o.setColor(a[0].color)}t.push(o)})),n.faces=t},this.findFaces=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.vertices;function t(e,t,n){return w.a.Utils.angle2pi(e.x-t.x,e.z-t.z,n.x-t.x,n.z-t.z)}function r(e){var t=[];return e.forEach((function(e){return 3===e.length&&t.push(e)})),t}function i(e){for(var t=[],n={},r=0;r<e.length;r++){var i=!0,o=e[r].map((function(e){return e.id})).sort((function(e,t){return e.localeCompare(t)})).join("-");n.hasOwnProperty(o)&&(i=!1),i&&(t.push(e[r]),n[o]=!0)}return t}function o(e,n){var r=[],i={vertex:n,previousVertices:[e]},o={};o[e.id]=!0;for(var a=function(){var a=i.vertex;if(o[a.id]=!0,i.vertex===e&&a!==n)return{v:i.previousVertices};for(var s=[],l=i.vertex.adjacentVertices(),c=0;c<l.length;c++){var u=l[c];(!(u.id in o)||u===e&&a!==n)&&s.push(u)}var h=i.previousVertices.slice(0);if(h.push(a),s.length>1){var d=i.previousVertices[i.previousVertices.length-1];s.sort((function(e,n){return t(d,a,n)-t(d,a,e)}))}s.length>0&&s.forEach((function(e){r.push({vertex:e,previousVertices:h})})),i=r.pop()};i;){var s=a();if("object"===typeof s)return s.v}return[]}var a=[];e.forEach((function(e){e.adjacentVertices().forEach((function(t){a.push(o(e,t))}))}));var s=i(r(a));return s},this.floorplan=t},F=w.a.Configuration.getNumericValue(w.a.configSnapTolernance),B=function(){function e(){var t=this;Object(h.a)(this,e),this.scene=null,this.orientation=0,this.layers=[],this.activeLayer=null,this.activeLayerIndex=null,this.roof=new U(this),this.new_wall_callbacks=[],this.new_corner_callbacks=[],this.redraw_callbacks=[],this.updated_rooms=[],this.layerUpdatedCallbacks=[],this.activeLayerChangedCallbacks=[],this.roomLoadedCallbacks=[],this.fireOnLayersUpdated=function(e){return t.layerUpdatedCallbacks.push(e)},this.fireOnActiveLayerChanged=function(e){return t.activeLayerChangedCallbacks.push(e)},this.fireOnNewWall=function(e){return t.new_wall_callbacks.push(e)},this.fireOnNewCorner=function(e){return t.new_corner_callbacks.push(e)},this.fireOnRedraw=function(e){return t.redraw_callbacks.push(e)},this.fireOnUpdatedRooms=function(e){return t.updated_rooms.push(e)},this.cloneLayer=function(e,n,r,i){if(e){var o=e.getCorners(),a=e.getWalls(),s=t.newLayer(n,r,i),l=[],c=[];return o.forEach((function(e){return l.push(t.newCorner(e.x,e.y))})),a.forEach((function(e){var n=l[o.indexOf(e.start)],r=l[o.indexOf(e.end)],i=t.newWall(n,r,s.height);i.thickness=e.thickness,i.thicknessDirection=e.thicknessDirection,i.isOutsideWall=e.isOutsideWall,c.push(i)})),l.forEach((function(e){return s.addCorner(e)})),c.forEach((function(e){return s.addWall(e)})),s.updated_callbacks.push((function(){return t.update()})),s}},this.setActiveLayerIndex=function(e){Number.isInteger(e)&&(e=e-0+100),t.activeLayerIndex=e,t.activeLayer=t.getLayer(e),t.activeLayerChangedCallbacks.forEach((function(t){return t(e)}))},this.setLayerHeight=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;n-=0,Number.isInteger(e)&&(e=e-0+100);var r=t.getLayer(e);if(r){if(e>=100){for(var i=n-r.height,o=e+1;o<t.layers.length;o++){var a=t.layers[o];a&&a.setOffset(a.offset+i)}r.setHeight(n);var s=null;t.layers.length&&(s=t.layers[t.layers.length-1]),s&&(t.roof.offset=s.offset+s.height)}else{for(var l=n-r.height,c=0;c<=e;c++){var u=t.layers[c];u&&u.setOffset(u.offset-l)}r.setHeight(n)}t.update(!1)}},this.setLayerVisible=function(e,n){Number.isInteger(e)&&(e=e-0+100);var r=t.getLayer(e);r&&(r.setVisible(n),t.update(!1))},this.setLayerFloorThickness=function(e,n){Number.isInteger(e)&&(e=e-0+100);var r=t.getLayer(e);r&&(r.setFloorThickness(n),t.update(!1))},this.cloneAboveLayer=function(e){if(Number.isInteger(e)){e=e-0+100;var n=t.getLayer(e);if(n){if(e>=100){for(var r=e+1,i=e+1;i<t.layers.length;i++){var o=t.layers[i];o&&(o.setLayerIndex(o.layerIndex+1),o.setOffset(o.offset+n.height))}var a=t.cloneLayer(n,r,n.offset+n.height,n.height);return a&&(t.layers.splice(r,0,a),a.calculateRooms(),t.roof.offset+=a.height,t.update(!1)),r-100}for(var s=e,l=0;l<=e;l++){var c=t.layers[l];c&&(c.setLayerIndex(c.layerIndex-1),c.setOffset(c.offset-n.height))}var u=t.cloneLayer(n,s,n.offset+n.height,n.height);if(u){for(var h=0;h<s;h++)t.layers[h]=t.layers[h+1];t.layers[s]=u,u.calculateRooms(),t.update(!1)}return s-100}}},this.cloneBelowLayer=function(e){if(Number.isInteger(e)){e=e-0+100;var n=t.getLayer(e);if(n){if(e>100){for(var r=e,i=e;i<t.layers.length;i++){var o=t.layers[i];o&&(o.setLayerIndex(o.layerIndex+1),o.setOffset(o.offset+n.height))}var a=t.cloneLayer(n,r,n.offset-n.height,n.height);return a&&(t.layers.splice(e,0,a),a.calculateRooms(),t.update(!1)),r-100}for(var s=e-1,l=0;l<e;l++){var c=t.layers[l];c&&(c.setLayerIndex(c.layerIndex-1),c.setOffset(c.offset-n.height))}var u=t.cloneLayer(n,s,n.offset-n.height,n.height);if(u){for(var h=0;h<s;h++)t.layers[h]=t.layers[h+1];t.layers[s]=u,u.calculateRooms(),t.update(!1)}return s-100}}},this.swapLayers=function(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=t.getLayer(e),o=t.getLayer(n);return!(!i||!o)&&(o.setLayerIndex(e),i.setLayerIndex(n),1===r?(o.setOffset(i.offset),i.setOffset(o.offset+o.height-0)):-1===r&&(i.setOffset(o.offset),o.setOffset(i.offset+i.height-0)),t.layers[n]=i,t.layers[e]=o,!0)},this.moveAboveLayer=function(e){if(Number.isInteger(e)){var n=(e=e-0+100)+1;return e<100&&n>=100?null:t.swapLayers(e,n,1)?(t.update(!1),n-100):null}},this.moveBelowLayer=function(e){if(Number.isInteger(e)){var n=(e=e-0+100)-1;return n<100&&e>=100?null:t.swapLayers(e,n,-1)?(t.update(!1),n-100):null}},this.removeLayer=function(e){if(Number.isInteger(e)){e=e-0+100;var n=t.getLayer(e);if(n){if(e>=100){for(var r=e+1;r<t.layers.length;r++){var i=t.layers[r];i&&(i.setLayerIndex(r-1),i.setOffset(i.offset-n.height))}t.roof.offset-=n.height,w.a.Utils.removeValue(t.layers,n)}else for(var o=e;o>0;o--){t.layers[o]=t.layers[o-1];var a=t.layers[o];a&&(a.setLayerIndex(o),a.setOffset(a.offset+n.height))}n.remove(),t.update(!1)}}},this.regenerateRoof=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(e||!t.roof.vertices.length||!t.roof.edges.length){var n=[],r=null;t.layers.length&&(r=t.layers[t.layers.length-1])&&(n=r.corners),r&&n.length&&(t.roof.offset=r.offset+r.height,t.roof.regenerate(n),t.update(!1))}},this.getSameLayerWalls=function(e){return e.start.layer.getWalls()},this.getSameFaceWalls=function(e){var n=t.getAllWalls(),r=[];return n.forEach((function(t){var n=e.checkIsSameFace(t);console.log(n),n&&r.push(t)})),r},this.getAllWalls=function(){var e=[];return t.layers.forEach((function(t){return t&&e.push.apply(e,Object(v.a)(t.getWalls()))})),e},this.overlappedRoom=function(e,n){var r=[];t.getActiveLayer()&&(r=t.getActiveLayer().getRooms());for(var i=0;i<r.length;i++){var o=r[i];if(w.a.Utils.pointInPolygon(e,n,o.corners))return o}return null}}return Object(d.a)(e,[{key:"newLayer",value:function(e,t,n){var r=new L(e,t,n);return r.floorplan=this,r}},{key:"getLayer",value:function(e){try{return this.layers[e]}catch(t){return null}}},{key:"getActiveLayer",value:function(){return this.getLayer(this.activeLayerIndex)}},{key:"getLayers",value:function(){var e=[];for(var t in this.layers){var n=this.layers[t];n&&e.push({index:t-100,offset:n.offset,height:n.height,visible:n.visible,floorThickness:n.floorThickness})}return e}},{key:"newWall",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=new S(e,t,n);return this.new_wall_callbacks.forEach((function(e){return e(r)})),r}},{key:"newCorner",value:function(e,t,n){var r=new P(this,e,t,n);return this.new_corner_callbacks.forEach((function(e){return"function"===typeof e&&e(r)})),r}},{key:"roofFaces",value:function(){var e=this,t=[];return this.roof.getFaces().forEach((function(n){var r=e.roof.offset;n.vertices.forEach((function(e){e.offset=r})),t.push(n)})),t}},{key:"roofEdges",value:function(){var e=this,t=[];return this.roof.getEdges().forEach((function(n){n.offset=e.roof.offset,t.push(n)})),t}},{key:"roofVertices",value:function(){var e=this,t=[];return this.roof.getVertices().forEach((function(n){n.offset=e.roof.offset,t.push(n)})),t}},{key:"wallEdges",value:function(){var e=[];return this.layers.forEach((function(t){t&&t.getWalls().forEach((function(n){n.edge&&(n.edge.layerOffset=t.offset,e.push(n.edge))}))})),e}},{key:"wallEdgePlanes",value:function(){var e=[];return this.layers.forEach((function(t){t&&t.getWalls().forEach((function(t){if(t.edge){var n=t.edge.plane;e.push(n)}}))})),e}},{key:"getWalls",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(null!==e){var t=this.layers[e];return t?t.walls:[]}var n=[];return this.layers.forEach((function(e){e&&n.push.apply(n,Object(v.a)(e.walls))})),n}},{key:"getCorners",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(null!==e){var t=this.layers[e];return t?t.corners:[]}var n=[];return this.layers.forEach((function(e){e&&n.push.apply(n,Object(v.a)(e.corners))})),n}},{key:"getItems",value:function(){return this.scene.items}},{key:"getRooms",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(null!==e){var t=this.layers[e];return t?t.getRooms():[]}var n=[];return this.layers.forEach((function(e){e&&n.push.apply(n,Object(v.a)(e.getRooms()))})),n}},{key:"overlappedCorner",value:function(e,t,n,r){var i,o=this.getActiveLayer();if(o){i=o.getCorners(),n=n||F;var a,s=Object(y.a)(i);try{for(s.s();!(a=s.n()).done;){var l=a.value;if(l.distanceFrom(e,t)<n){if(r&&r.start!==l&&r.end!==l)continue;return l}}}catch(c){s.e(c)}finally{s.f()}return null}}},{key:"overlappedWall",value:function(e,t,n){var r=[];this.getActiveLayer()&&(r=this.getActiveLayer().getWalls()),n=n||F;for(var i=0;i<r.length;i++)if(r[i].distanceFrom(e,t)<n)return r[i];return null}},{key:"overlappedItem",value:function(e,t){var n,r=this.getItems(),i=null,o=Object(y.a)(r);try{for(o.s();!(n=o.n()).done;){var a,s=n.value,l=s.getSnapPoints(),c=!1,u=Object(y.a)(l);try{for(u.s();!(a=u.n()).done;){var h=a.value;if(w.a.Utils.pointInPolygon(e,t,h)){c=!0;break}}}catch(d){u.e(d)}finally{u.f()}if(c){i=s;break}}}catch(d){o.e(d)}finally{o.f()}return i}},{key:"calculateRulerData",value:function(){for(var e=Object(v.a)(this.getCorners(this.activeLayerIndex).map((function(e){return{x:e.x,y:e.y}}))),t=[],n=[],r=0;r<e.length;r++){var i,o=!1,a=Object(y.a)(t);try{for(a.s();!(i=a.n()).done;){if(i.value.x===e[r].x){o=!0;break}}}catch(u){a.e(u)}finally{a.f()}!o&&t.push(e[r]),o=!1;var s,l=Object(y.a)(n);try{for(l.s();!(s=l.n()).done;){if(s.value.y===e[r].y){o=!0;break}}}catch(u){l.e(u)}finally{l.f()}!o&&n.push(e[r])}t=t.sort((function(e,t){return e.x-t.x})),n=n.sort((function(e,t){return e.y-t.y}));var c={x:[],y:[]};for(r=0;r<t.length-1;r++)c.x.push({start:t[r],end:t[r+1],length:Math.abs(t[r].x-t[r+1].x)});for(r=0;r<n.length-1;r++)c.y.push({start:n[r],end:n[r+1],length:Math.abs(n[r].y-n[r+1].y)});return c}},{key:"saveFloorplan",value:function(){var e=this,t=[],n=[],r={offset:0,vertices:{},edges:[],faces:{}};r.offset=e.roof.offset,e.roof.vertices.forEach((function(e){r.vertices[e.id]={x:e.x,y:e.y,z:e.z,id:e.id}})),e.roof.edges.forEach((function(e){r.edges.push({start:e.start.id,end:e.end.id})})),e.roof.getFaces().forEach((function(e){r.faces[e.getUuid()]={color:e.color}}));var i,o=Object(y.a)(this.layers.entries());try{var a=function(){var e=Object(j.a)(i.value,2),r=e[0],o=e[1];if(!o)return"continue";var a=o.offset,s=o.height,l=o.floorThickness,c={corners:{},walls:[],rooms:{}};o.getCorners().forEach((function(e){c.corners[e.id]={x:e.x,y:e.y}})),o.getWalls().forEach((function(e){c.walls.push({corner1:e.getStart().id,corner2:e.getEnd().id,thickness:e.thickness,thicknessDirection:e.thicknessDirection,isOutsideWall:e.isOutsideWall,interiorTexture:e.interiorTexture,exteriorTexture:e.exteriorTexture})})),o.getRooms().forEach((function(e){c.rooms[e.getUuid()]={name:e.name,texture:e.texture}})),o.getWalls().forEach((function(e){e.items.forEach((function(e){n.push({uuid:e.uuid,item_name:e.metadata.itemName,item_type:e.metadata.itemType,model_url:e.metadata.modelUrl||e.metadata.threeModel,xpos:e.position.x,ypos:e.position.y,zpos:e.position.z,rotation:e.rotation.y,metadata:e.metadata,options:e.getOptions()})}))})),t[r]={offset:a,height:s,floorThickness:l,floorplan:c}};for(o.s();!(i=o.n()).done;)a()}catch(s){o.e(s)}finally{o.f()}return{layers:t,roof:r,items:n}}},{key:"loadFloorplan",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=this;this.reset();var o,a=e.layers,s=e.roof,l=Object(y.a)(a.entries());try{var c=function(){var e=Object(j.a)(o.value,2),n=e[0],r=e[1];if(n-=0,!r)return"continue";var a=r.floorplan,s=r.offset,l=r.height,c=r.floorThickness,u=t.newLayer(n,s,l);c&&u.setFloorThickness(c);var h={};if(null===a||!("corners"in a)||!("walls"in a))return{v:void 0};for(var d in a.corners){var f=a.corners[d];h[d]=t.newCorner(f.x,f.y,d),u.addCorner(h[d])}a.walls.forEach((function(e){var t=i.newWall(h[e.corner1],h[e.corner2]);e.hasOwnProperty("isOutsideWall")&&(t.isOutsideWall=e.isOutsideWall),e.hasOwnProperty("thickness")&&(t.thickness=e.thickness),e.hasOwnProperty("thicknessDirection")&&(t.thicknessDirection=e.thicknessDirection),t.interiorTexture=e.interiorTexture,t.exteriorTexture=e.exteriorTexture,u.addWall(t)})),u.calculateRooms(a.rooms),t.layers[n]=u};for(l.s();!(o=l.n()).done;){var u=c();if("continue"!==u&&"object"===typeof u)return u.v}}catch(h){l.e(h)}finally{l.f()}this.roof.loadData(s,r),this.update(n,r),this.roomLoadedCallbacks.forEach((function(e){return"function"===typeof e&&e()}))}},{key:"reset",value:function(){this.roof.reset(),this.layers=[]}},{key:"update",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this;r.getActiveLayer()&&r.getActiveLayer().calculateRooms(),this.roof.calculateFaces(),r.assignOrphanEdges(),n&&document.dispatchEvent(new CustomEvent(w.a.BP3D_EVENT_ADD_TO_UNDO_STACK)),r.updated_rooms.forEach((function(e){return e(t)})),r.layerUpdatedCallbacks.forEach((function(t){return t(e.getLayers())}))}},{key:"getCenter",value:function(){return this.getDimensions(!0)}},{key:"getSize",value:function(){return this.getDimensions(!1)}},{key:"getDimensions",value:function(e){e=e||!1;var t=1/0,n=-1/0,r=1/0,i=-1/0;return this.getCorners().forEach((function(e){e.x<t&&(t=e.x),e.x>n&&(n=e.x),e.y<r&&(r=e.y),e.y>i&&(i=e.y)})),t===1/0||n===-1/0||r===1/0||i===-1/0?new m.Ob:e?new m.Ob(.5*(t+n),0,.5*(r+i)):new m.Ob(n-t,0,i-r)}},{key:"assignOrphanEdges",value:function(){}}]),e}(),H=n(29),X=n(13),Y=function(e){Object(f.a)(n,e);var t=Object(p.a)(n);function n(e,r){var i;return Object(h.a)(this,n),(i=t.call(this)).scene=e.scene,i.item=r,i.frameMaterial=new m.W({color:14540253}),i.offsetCenter=new m.Ob,i.canvasDepth=document.createElement("canvas"),i.canvasWidth=document.createElement("canvas"),i.canvasHeight=document.createElement("canvas"),i.sizeOrigin=JSON.parse(JSON.stringify(r.halfSize)),i.configFrames(),i.configLabels(),i.drawLabels(i.item.halfSize),w.a.Configuration.getBooleanValue(w.a.configDimensionVisible)||(i.visible=!1),document.addEventListener(w.a.BP3D_EVENT_CONFIG_CHANGED,(function(e){var t=e.detail;t&&(t.dimUnit&&i.update(),t.hasOwnProperty(w.a.configDimensionVisible)&&(t[w.a.configDimensionVisible]?i.visible=!0:i.visible=!1))})),i}return Object(d.a)(n,[{key:"update",value:function(){var e=this.item.halfSize;this.drawLabels(e);var t=this.item.getBounding(),n=new m.Ob((t.max.x+t.min.x)/2,(t.max.y+t.min.y)/2,(t.max.z+t.min.z)/2);this.offsetCenter=n.sub(this.item.position);for(var r=0;r<this.children.length;r++){var i=this.children[r];r>=0&&r<4?(i.scale.z=e.z/this.sizeOrigin.z,r%4===0&&i.position.set(-e.x+this.offsetCenter.x,e.y+this.offsetCenter.y,this.offsetCenter.z),r%4===1&&i.position.set(e.x+this.offsetCenter.x,e.y+this.offsetCenter.y,this.offsetCenter.z),r%4===2&&i.position.set(e.x+this.offsetCenter.x,-e.y+this.offsetCenter.y,this.offsetCenter.z),r%4===3&&i.position.set(-e.x+this.offsetCenter.x,-e.y+this.offsetCenter.y,this.offsetCenter.z)):r>=4&&r<8?(i.scale.x=e.x/this.sizeOrigin.x,r%4===0&&i.position.set(this.offsetCenter.x,-e.y+this.offsetCenter.y,e.z+this.offsetCenter.z),r%4===1&&i.position.set(this.offsetCenter.x,e.y+this.offsetCenter.y,e.z+this.offsetCenter.z),r%4===2&&i.position.set(this.offsetCenter.x,e.y+this.offsetCenter.y,-e.z+this.offsetCenter.z),r%4===3&&i.position.set(this.offsetCenter.x,-e.y+this.offsetCenter.y,-e.z+this.offsetCenter.z)):r>=8&&r<12?(i.scale.y=e.y/this.sizeOrigin.y,r%4===0&&i.position.set(-e.x+this.offsetCenter.x,this.offsetCenter.y,e.z+this.offsetCenter.z),r%4===1&&i.position.set(e.x+this.offsetCenter.x,this.offsetCenter.y,e.z+this.offsetCenter.z),r%4===2&&i.position.set(e.x+this.offsetCenter.x,this.offsetCenter.y,-e.z+this.offsetCenter.z),r%4===3&&i.position.set(-e.x+this.offsetCenter.x,this.offsetCenter.y,-e.z+this.offsetCenter.z)):r>=12&&r<16?(i.material.map.needsUpdate=!0,r%4===0&&i.position.set(-e.x+this.offsetCenter.x,e.y+this.offsetCenter.y,this.offsetCenter.z),r%4===1&&i.position.set(e.x+this.offsetCenter.x,e.y+this.offsetCenter.y,this.offsetCenter.z),r%4===2&&i.position.set(e.x+this.offsetCenter.x,-e.y+this.offsetCenter.y,this.offsetCenter.z),r%4===3&&i.position.set(-e.x+this.offsetCenter.x,-e.y+this.offsetCenter.y,this.offsetCenter.z)):r>=16&&r<20?(i.material.map.needsUpdate=!0,r%4===0&&i.position.set(this.offsetCenter.x,e.y+this.offsetCenter.y,e.z+this.offsetCenter.z),r%4===1&&i.position.set(this.offsetCenter.x,-e.y+this.offsetCenter.y,e.z+this.offsetCenter.z),r%4===2&&i.position.set(this.offsetCenter.x,e.y+this.offsetCenter.y,-e.z+this.offsetCenter.z),r%4===3&&i.position.set(this.offsetCenter.x,-e.y+this.offsetCenter.y,-e.z+this.offsetCenter.z)):r>=20&&r<24&&(i.material.map.needsUpdate=!0,r%4===0&&i.position.set(-e.x+this.offsetCenter.x,this.offsetCenter.y,e.z+this.offsetCenter.z),r%4===1&&i.position.set(e.x+this.offsetCenter.x,this.offsetCenter.y,e.z+this.offsetCenter.z),r%4===2&&i.position.set(e.x+this.offsetCenter.x,this.offsetCenter.y,-e.z+this.offsetCenter.z),r%4===3&&i.position.set(-e.x+this.offsetCenter.x,this.offsetCenter.y,-e.z+this.offsetCenter.z))}}},{key:"configFrames",value:function(){var e=this.item.halfSize,t=.002,n=new m.g(t,t,2*e.z),r=new m.U(n,this.frameMaterial),i=(new m.U).copy(r),o=(new m.U).copy(r),a=(new m.U).copy(r);r.position.set(-e.x,e.y,0),i.position.set(e.x,e.y,0),o.position.set(e.x,-e.y,0),a.position.set(-e.x,-e.y,0),this.add(r),this.add(i),this.add(o),this.add(a);var s=new m.g(2*e.x,t,t),l=new m.U(s,this.frameMaterial),c=(new m.U).copy(l),u=(new m.U).copy(l),h=(new m.U).copy(l);l.position.set(0,-e.y,e.z),c.position.set(0,e.y,e.z),u.position.set(0,e.y,-e.z),h.position.set(0,-e.y,-e.z),this.add(l),this.add(c),this.add(u),this.add(h);var d=new m.g(t,2*e.y,t),f=new m.U(d,this.frameMaterial),p=(new m.U).copy(f),v=(new m.U).copy(f),g=(new m.U).copy(f);f.position.set(-e.x,0,e.z),p.position.set(e.x,0,e.z),v.position.set(e.x,0,-e.z),g.position.set(-e.x,0,-e.z),this.add(f),this.add(p),this.add(v),this.add(g)}},{key:"configLabels",value:function(){var e=this.item.halfSize,t=this.makeTextSprite(this.canvasDepth),n=(new m.Fb).copy(t),r=(new m.Fb).copy(t),i=(new m.Fb).copy(t);t.position.set(-e.x,e.y,0),n.position.set(e.x,e.y,0),r.position.set(e.x,-e.y,0),i.position.set(-e.x,-e.y,0),n.visible=r.visible=i.visible=!1,this.add(t),this.add(n),this.add(r),this.add(i);var o=this.makeTextSprite(this.canvasWidth),a=(new m.Fb).copy(o),s=(new m.Fb).copy(o),l=(new m.Fb).copy(o);o.position.set(0,e.y,e.z),a.position.set(0,-e.y,e.z),s.position.set(0,e.y,-e.z),l.position.set(0,-e.y,-e.z),a.visible=s.visible=l.visible=!1,this.add(o),this.add(a),this.add(s),this.add(l);var c=this.makeTextSprite(this.canvasHeight),u=(new m.Fb).copy(c),h=(new m.Fb).copy(c),d=(new m.Fb).copy(c);c.position.set(-e.x,0,e.z),u.position.set(e.x,0,e.z),h.position.set(e.x,0,-e.z),d.position.set(-e.x,0,-e.z),u.visible=h.visible=d.visible=!1,this.add(c),this.add(u),this.add(h),this.add(d)}},{key:"setSelected",value:function(){this.frameMaterial.color.setHex(16711680)}},{key:"setUnselected",value:function(){this.frameMaterial.color.setHex(14540253)}},{key:"drawLabels",value:function(e){this.drawCanvas(this.canvasDepth,w.a.Dimensioning.cmToMeasure(2*e.z*100),{fontsize:24,color:{r:0,g:0,b:255,a:1}}),this.drawCanvas(this.canvasWidth,w.a.Dimensioning.cmToMeasure(2*e.x*100),{fontsize:24,color:{r:255,g:0,b:0,a:1}}),this.drawCanvas(this.canvasHeight,w.a.Dimensioning.cmToMeasure(2*e.y*100),{fontsize:24,color:{r:0,g:255,b:0,a:1}})}},{key:"drawCanvas",value:function(e,t,n){void 0===n&&(n={});var r=n.hasOwnProperty("fontface")?n.fontface:"Arial",i=n.hasOwnProperty("fontsize")?n.fontsize:18,o=n.hasOwnProperty("color")?n.color:{r:0,g:0,b:0,a:1},a=e.getContext("2d");a.clearRect(0,0,e.width,e.height),a.font="Bold ".concat(i,"px ").concat(r),a.textBaseline="middle",a.textAlign="center",a.fillStyle="rgba(".concat(o.r,",").concat(o.g,",").concat(o.b,",").concat(o.a,")"),a.fillText(t,e.width/2,e.height/2),a.strokeStyle="#ffffff",a.lineWidth=.1,a.strokeText(t,e.width/2,e.height/2)}},{key:"makeTextSprite",value:function(e){var t=new m.Ib(e);t.needsUpdate=!0;var n=new m.Gb({map:t,depthTest:!1}),r=new m.Fb(n);return r.scale.set(1,.75,1),r}},{key:"setPosition",value:function(e){this.position.copy(e)}},{key:"setRotation",value:function(e){this.rotation.y=e}}]),n}(m.x),G=n(30),J=n.n(G),q="-ver-arr-ext-",Z="-hor-arr-ext-",K=["grommet","glide","handle","Box001"],Q=["legs","glass",q,Z],$={black:1184274,silver:15658734,nickel:15658598},ee=function(e,t,n){var r=/\(min(\d+)\)/g.exec(e.name);if(r&&r[1]){var i=parseInt(r[1]);n=(5+295*n-i)/(300-i)}return n},te=function(e,t){var n,r=0,i=Object(y.a)(e);try{for(i.s();!(n=i.n()).done;){var o,a=n.value,s=Object(y.a)(t);try{for(s.s();!(o=s.n()).done;){var l=o.value;ne(a,l)&&r++}}catch(c){s.e(c)}finally{s.f()}}}catch(c){i.e(c)}finally{i.f()}return r>0},ne=function(e,t){return e.distanceTo(t)<=.001},re=function(e){for(var t=[];e.length;){var n=[];n.push(e[0]),e.splice(0,1);var r=-1;do{r=-1;for(var i=0;i<e.length;i++){for(var o=e[i],a=0;a<n.length;a++){var s=n[a];if(te(s,o)){r=i;break}}if(r>=0)break}r>=0&&(n.push(e[r]),e.splice(r,1))}while(r>=0);t.push(n)}return t},ie=function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=e.position,s=[],l=Object(y.a)(t);try{var c=function(){var t=n.value,l=!1,c=[];if(c.push.apply(c,K),o&&c.push.apply(c,Q),c.forEach((function(e){t.name.toLowerCase().includes(e)&&(l=!0)})),l)return"continue";var h=[];t.geometry.attributes.position.array.forEach((function(e){return h.push(e)}));try{if(Array.isArray(t.morphTargetInfluences)){var d=t.morphTargetInfluences.length;for(u=0;u<d;u++)for(var f=t.geometry.morphAttributes.position[u].array,p=0;p<h.length;p++)h[p]=h[p]+f[p]*t.morphTargetInfluences[u]}}catch(w){}var v=[];for(u=0;u<h.length;u+=3){var g=new m.Ob(h[u],h[u+1],h[u+2]),b=new m.T;Math.abs(t.rotation.z)===Math.PI&&(g.x*=-1),!i&&b.makeRotationY(e.rotation.y),g.applyMatrix4(b),g.add(a),v.push(g)}var x=[];for(u=0;u<v.length;u+=3)x.push([v[u],v[u+1],v[u+2]]);re(x).forEach((function(e){var t=[];e.forEach((function(e){return e.forEach((function(e){var n,i=!1,o=Object(y.a)(t);try{for(o.s();!(n=o.n()).done;){var a=n.value;if(ne(a,e)){i=!0;break}if(r&&ne(new m.Ob(a.x,0,a.z),new m.Ob(e.x,0,e.z))){i=!0;break}}}catch(s){o.e(s)}finally{o.f()}!i&&t.push(e)}))})),s.push(t)}))};for(l.s();!(n=l.n()).done;){var u;c()}}catch(h){l.e(h)}finally{l.f()}return s},oe=function(e){return J()(e)},ae=function(e){return W()(e,1)},se=function(e,t){var n=[];if(ie(e,e.children,!0,!1,!0).forEach((function(e){var t=(e.length<16?ae:oe)(e.map((function(e){return[e.x,e.z]})));n.push(t.map((function(e){return{x:e[0],y:e[1]}})))})),t){var r=[];return n.forEach((function(e){return r=[].concat(Object(v.a)(r),Object(v.a)(e))})),r}return n},le=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=1/0,r=1/0,i=1/0,o=-1/0,a=-1/0,s=-1/0;t=t.length?t:e.children;var l=ie(e,t,!1,!0);return l.forEach((function(e){e.forEach((function(e){n>e.x&&(n=e.x),r>e.y&&(r=e.y),i>e.z&&(i=e.z),o<e.x&&(o=e.x),a<e.y&&(a=e.y),s<e.z&&(s=e.z)}))})),{min:new m.Ob(n,r,i),max:new m.Ob(o,a,s)}},ce=function(e){Object(f.a)(n,e);var t=Object(p.a)(n);function n(e,r,i,o,a,s){var l;return Object(h.a)(this,n),(l=t.call(this)).cloneData={},l.errorGlow=new m.U,l.hover=!1,l.selected=!1,l.highlighted=!1,l.error=!1,l.resizable=!0,l.fixed=!1,l.stackable=!1,l.stackontop=!1,l.overlappable=!1,l.allowRotate=!0,l.obstructFloorMoves=!0,l.emissiveColor=2236962,l.errorColor=16711680,l.flippable=!1,l.flipped=!1,l.dragOffset=new m.Ob,l.childMeshes=[],l.morphAlign=0,l.hullPointsCollection=[],l.boundingGizmo=null,l.prevPosition={x:null,y:null,z:null},l.prevRotation=null,l.prevMorph={},l.initObject=function(e,t,n,r){this.halfSize=this.objectHalfSize(),this.prepareMeshes(e),this.configDimensionLabels(),t?(this.position.copy(t),this.position_set=!0):(this.position.set(0,0,0),this.position_set=!1),this.dimensionHelper.position.copy(this.position),n&&(this.rotation.y=n,this.dimensionHelper.rotation.y=n),this.castShadow=!0,this.receiveShadow=!0,this.moveChildMeshes(),this.rotateChildMeshes(),this.setOptions(r),this.placeInRoom()},l.getOptions=function(){return{morph:l.morph,textures:l.textures,styles:l.styles,fixed:l.fixed,stackable:l.stackable,stackontop:l.stackontop,overlappable:l.overlappable}},l.setOptions=function(e){if(e){if(e.hasOwnProperty("fixed")&&(l.fixed=e.fixed),e.hasOwnProperty("stackable")&&(l.stackable=e.stackable),e.hasOwnProperty("stackontop")&&(l.stackontop=e.stackontop),e.hasOwnProperty("overlappable")&&(l.overlappable=e.overlappable),e.morph)for(var t in e.morph)l.setMorph(t,e.morph[t]);if(e.textures)for(t in e.textures)l.updateMaterial(t,e.textures[t].material,e.textures[t].size);if(e.styles)for(t in e.styles)l.updateStyle(t,e.styles[t])}},l.getCollidableMeshList=function(){var e,t=[],n=Object(y.a)(l.children);try{for(n.s();!(e=n.n()).done;){var r=e.value,i=!1;K.forEach((function(e){r.name.toLowerCase().includes(e)&&(i=!0)})),i||t.push(r)}}catch(o){n.e(o)}finally{n.f()}return t},l.setStackable=function(e){return l.stackable=e},l.setOverlappable=function(e){return l.overlappable=e},l.setMorphAlign=function(e){return l.morphAlign=e},l.flipHorizontal=function(){},l.changed=function(){l.calculateHullPointsCollection()},l.getHeight=function(){return 2*l.halfSize.y},l.getWidth=function(){return 2*l.halfSize.x},l.getDepth=function(){return 2*l.halfSize.z},l.setRotationY=function(e){l.rotateByAngle(e),l.changed()},l.setPosition=function(e){var t=(new m.Ob).copy(l.position);l.position.copy(e),l.dimensionHelper.position.copy(e);e.sub(t);l.moveChildMeshes(),l.changed()},l.getSnapPoints=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(e){var t=[];return l.hullPointsCollection.forEach((function(e){return t=[].concat(Object(v.a)(t),Object(v.a)(e))})),t}return l.hullPointsCollection},l.updateMaterial=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{w:.5,h:.5},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;l.textures[e]={material:t,size:n},l.traverse((function(i){if(i.name.toLowerCase().includes(e.toLowerCase())){var o=i.material.clone();if(o.color.setHex(t.color?t.color:16777215),o.map=null,t.texture){var a=(new m.Jb).load(t.texture);a.wrapS=m.ub,a.wrapT=m.ub,a.repeat.set(1/n.w,1/n.h),o.map=a,"function"===typeof r&&r()}i.material=o}}))},l.updateStyle=function(e,t,n){l.styles[e]=t,l.traverse((function(n){if("lock"!==e||!n.name.includes("block"))try{e.split(",").forEach((function(e){e.length&&n.name.toLowerCase().includes(e.toLowerCase())&&(n.visible=!1)})),t.split(",").forEach((function(e){e.length&&n.name.toLowerCase().includes(e.toLowerCase())&&(n.visible=!0)}))}catch(r){console.log(r)}})),"function"===typeof n&&n()},l.updateBlocksByHeight=function(e){for(var t=null,n=null,r="(block)",i=l.children.length-1;i>=0;i--){var o=l.children[i];o.name.includes(r)&&(o.visible=!0),o.name.includes(q)&&(l.scene.remove(o),l.children.splice(i,1)),o.name.includes(r)&&!o.name.includes(q)&&(t=o),o.name.includes("(block-top)")&&(n=o)}if(t){var a=0;if(n){var s=le(Object(X.a)(l),[n]);a=s.max.y-s.min.y}var c=[];c.push(t);var u=le(Object(X.a)(l),[t]),h=u.max.y-u.min.y,d=t.position.y,f=Math.floor((e-a-d)/h)-1;for(i=0;i<f;i++){var p=(new m.U).copy(t);p.geometryBackup=t.geometryBackup,p.name+="".concat(q).concat(i),p.position.y=d+h,l.add(p),d=p.position.y,c.push(p)}var v=c[c.length-1];v.position.y>e-a-2*h&&(v.visible=!1)}},l.updateBlocksByWidth=function(e){for(var t="(block-hor)",n=null,r=l.children.length-1;r>=0;r--){var i=l.children[r];i.name.includes(t)&&(i.visible=!0),i.name.includes(Z)&&(l.scene.remove(i),l.children.splice(r,1)),i.name.includes(t)&&!i.name.includes(Z)&&(n=i)}if(n){var o=0,a=0,s=1,c=0,u=0,h=/\(s(\d+\,?\d+)\)/g.exec(n.name);h&&h[1]&&(o=parseFloat(h[1].replace(",",".")),o*=.0254,a=c=e/(s=Math.floor(e/o)));(h=/\(ml(\d+)\,mr(\d+)\)/g.exec(n.name))&&h[1]&&h[2]&&(c=2.54*parseFloat(h[1])/100,u=2.54*parseFloat(h[2])/100);if((h=/\(a((?:\d+,)*\d+)\)/g.exec(n.name))&&h[1]){!1;var d=h[1].split(",");for(var r in d){r=parseInt(r);var f=2.54*parseFloat(d[r])/100;if(e<f&&0==r){s=0;break}if(e>=f&&r==d.length-1){s=d.length;break}if(e>=f&&e<2.54*parseFloat(d[r-0+1])/100){s=r+1;break}}o=a=(e-c-u)/s,s+=2}if(0===o||s<2)n.visible=!1;else for(n.visible=!0,r=0;r<s-1;r++){var p=void 0;0===r?p=n:((p=(new m.U).copy(n)).geometryBackup=n.geometryBackup,p.name+="".concat(Z).concat(r),l.add(p)),p.position.x=-e/2+c+r*a}}},l.model=e,l.scene=l.model.scene,l.metadata=r,l.cloneData={metadata:r,meshList:i,position:o,rotation:a,options:s},Array.isArray(i)&&i.forEach((function(e){l.add(e)})),l.centerOffset=new m.Ob,l.morph={},l.textures={},l.styles={},l.blockCount=1,l.errorColor=16711680,l.resizable=r.resizable,l.castShadow=!0,l.receiveShadow=!1,l}return Object(d.a)(n,[{key:"prepareMeshes",value:function(e){if(Array.isArray(e)){var t,n=Object(y.a)(e);try{var r=function(){var e=t.value;try{e.castShadow=!0,e.receiveShadow=!0;var n=e.material;e.material=new m.W,m.Y.prototype.copy.call(e.material,n);var r=(new m.i).copy(e.geometry);e.geometryBackup=r,function(){var t=/\(opacity(\d+)\)/g.exec(e.name);if(t&&t[1]){var n=parseInt(t[1]);e.material.transparent=!0,e.material.opacity=n/100}}(),function(){if(e.name.includes("handle"))for(var t in $)if(e.name.includes(t)){var n=e.material.clone();e.material=n,e.material.color.setHex($[t])}}(),function(){if(e.name.includes("lock")&&!e.name.includes("block")){var t=e.material.clone();e.material=t,e.material.color.setHex(1184274)}}()}catch(i){console.log(i)}};for(n.s();!(t=n.n()).done;)r()}catch(i){n.e(i)}finally{n.f()}}}},{key:"configDimensionLabels",value:function(){this.dimensionHelper=new Y(this.model,this),this.scene.add(this.dimensionHelper)}},{key:"showDimensionHelper",value:function(){this.dimensionHelper.visible=!0}},{key:"hideDimensionHelper",value:function(){this.dimensionHelper.visible=!1}},{key:"getBounding",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];try{var r={x:t.position.x,y:t.position.y,z:t.position.z},i=t.rotation.y,o=JSON.parse(JSON.stringify(this.morph));return(e||JSON.stringify(r)!==JSON.stringify(this.prevPosition)||JSON.stringify(o)!==JSON.stringify(this.morph)||i!==this.prevRotation)&&(this.boundingGizmo=le(t,n),this.prevPosition=r,this.prevRotation=i,this.prevMorph=o),this.boundingGizmo}catch(a){return null}}},{key:"remove",value:function(){var e,t=Object(y.a)(this.childMeshes);try{for(t.s();!(e=t.n()).done;){var n=e.value;this.scene.remove(n)}}catch(r){t.e(r)}finally{t.f()}this.scene.remove(this.dimensionHelper),this.scene.removeItem(this)}},{key:"resize",value:function(e,t,n){}},{key:"getMorph",value:function(e){return this.morph[e]?this.morph[e]:0}},{key:"setMorph",value:function(e,t){this.morph[e]=t;try{var n=le(this);n=n.max.sub(n.min);var r,i=Object(y.a)(this.children);try{for(i.s();!(r=i.n()).done;){var o=r.value;try{Array.isArray(o.morphTargetInfluences)&&o.morphTargetInfluences.length>e&&(o.morphTargetInfluences[e]=ee(o,0,t))}catch(d){console.log(d)}}}catch(f){i.e(f)}finally{i.f()}var a,s=Object(y.a)(this.childMeshes);try{for(s.s();!(a=s.n()).done;){var l=a.value;try{Array.isArray(l.morphTargetInfluences)&&l.morphTargetInfluences.length>e&&(l.morphTargetInfluences[e]=ee(l,0,t))}catch(d){console.log(d)}}}catch(f){s.e(f)}finally{s.f()}this.updateUV(),this.halfSize=this.objectHalfSize(),this.dimensionHelper.update();var c=le(this),u=new m.Ob((c.min.x+c.max.x)/2,0,(c.min.z+c.max.z)/2);this.centerOffset=u.sub(this.position),this.centerOffset.y=0,parseInt(e,10)===parseInt(this.metadata.blockMorphIndex,10)&&this.updateBlocksByHeight(2.54*(5+295*t)/100),parseInt(e,10)===parseInt(this.metadata.horizontalBlockMorphIndex,10)&&this.updateBlocksByWidth(2.54*(5+295*t)/100);var h=le(this);h=h.max.sub(h.min),this.morphAlignModel(e,n,h,this.morphAlign),this.resized(),this.changed()}catch(d){console.log(d)}}},{key:"morphAlignModel",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.morphAlign,i=(new m.Ob).copy(n).sub(t),o=(new m.Ob).copy(this.position),a=new m.Ob;if(0!=e){1==e&&0!=i.x?5===r||4===r||6===r?a.x=i.x/2:1!==r&&2!==r&&8!==r||(a.x=-i.x/2):2==e&&0!=i.z&&(3===r||4===r||2===r?a.z=i.z/2:7!==r&&6!==r&&8!==r||(a.z=-i.z/2));var s=new m.T;s.makeRotationY(this.rotation.y),a.applyMatrix4(s),o=o.add(a),this.position.copy(o),this.dimensionHelper.position.copy(o),this.moveChildMeshes()}}},{key:"updateUV",value:function(){try{var e=this.metadata.morphUVs;if(!Array.isArray(this.metadata.morphUVs))return;!function(e,t,n){var r,i=Object(y.a)(t);try{for(i.s();!(r=i.n()).done;){var o=r.value;o.geometry.attributes.uv.needsUpdate=!0;for(var a=o.geometry.attributes.uv.array,s=o.geometryBackup.attributes.uv.array,l=0;l<s.length;l++)a[l]=s[l];for(var c in e)if(n[c]){var u=o.name;if(u.includes(q)&&(u=u.split(q)[0]),u.includes(Z)&&(u=u.split(Z)[0]),Array.isArray(n[c][u])&&n[c][u].length===a.length){var h=ee(o,0,e[c]),d=n[c][u];for(l in a)a[l]+=(d[l]-s[l])*h}}}}catch(f){i.e(f)}finally{i.f()}}(this.morph,this.children,e)}catch(t){console.log("failed updating uv",t)}}},{key:"setScale",value:function(e,t,n){}},{key:"setFixed",value:function(e){this.fixed=e}},{key:"resized",value:function(){}},{key:"placeInRoom",value:function(){this.position_set}},{key:"removed",value:function(){}},{key:"updateHighlight",value:function(){var e=this.hover||this.selected,t=[],n=[];n.push.apply(n,Object(v.a)(this.childMeshes)),n.forEach((function(e){var n=!1;K.forEach((function(t){e.name.toLowerCase().includes(t)&&(n=!0)})),n||t.push(e)})),e?document.dispatchEvent(new CustomEvent(w.a.BP3D_EVENT_HIGHLIGHT_CHANGED,{detail:{objects:t}})):document.dispatchEvent(new CustomEvent(w.a.BP3D_EVENT_HIGHLIGHT_CHANGED,{detail:{objects:[]}}))}},{key:"mouseOver",value:function(){this.hover=!0,this.updateHighlight()}},{key:"mouseOff",value:function(){this.hover=!1,this.updateHighlight()}},{key:"setSelected",value:function(){this.selected=!0,this.updateHighlight()}},{key:"setUnselected",value:function(){this.selected=!1,this.updateHighlight()}},{key:"clickPressed",value:function(e){this.dragOffset.copy(e.point).sub(this.position)}},{key:"clickDragged",value:function(e){e&&this.moveToPosition(e.point,e)}},{key:"rotateChildMeshes",value:function(){for(var e in this.childMeshes)this.childMeshes[e].rotation.y=this.rotation.y}},{key:"rotate",value:function(e,t){if(e){var n=this.position,r=this.rotation.y;isNaN(t)&&(t=w.a.Utils.angle(0,1,e.point.x-n.x,e.point.z-n.z));for(var i=Math.PI/16,o=-4;o<=4;o++)if(Math.abs(t-o*(Math.PI/2))<i){t=o*(Math.PI/2);break}var a=t-r;this.rotation.y=t,this.dimensionHelper.setRotation(t);var s=new m.T;s.makeRotationY(a);var l=(new m.Ob).copy(this.position).sub(n),c=(new m.Ob).copy(l);l.applyMatrix4(s),c=l.sub(c),this.relativeMove(c.x,c.z),this.rotateChildMeshes(),this.changed(),this.groupParent&&this.groupParent.isSet&&this.groupParent.update()}}},{key:"rotateByAngle",value:function(e){this.rotation.y=e,this.rotateChildMeshes(),this.dimensionHelper.setRotation(e)}},{key:"moveChildMeshes",value:function(){for(var e in this.childMeshes){var t=new m.Ob;this.children[e].getWorldPosition(t),this.childMeshes[e].position.copy(t)}}},{key:"moveToPosition",value:function(e,t){isNaN(e.x)||isNaN(e.y)||isNaN(e.z)?console.log("nan detected"):(this.setPosition(e),this.changed())}},{key:"relativeMove",value:function(e,t){if(!this.fixed){var n=(new m.Ob).copy(this.position);n.x+=e,n.z+=t,this.position.copy(n),this.moveChildMeshes(),this.dimensionHelper.position.copy(n)}}},{key:"clickReleased",value:function(){this.error&&this.hideError()}},{key:"customIntersectionPlanes",value:function(){return[]}},{key:"getCorners",value:function(e,t,n){n=n||this.position;var r=this.halfSize.clone(),i=new m.Ob(-r.x,0,-r.z),o=new m.Ob(r.x,0,-r.z),a=new m.Ob(r.x,0,r.z),s=new m.Ob(-r.x,0,r.z),l=new m.T;l.makeRotationY(this.rotation.y),i.applyMatrix4(l),o.applyMatrix4(l),a.applyMatrix4(l),s.applyMatrix4(l),i.add(n),o.add(n),a.add(n),s.add(n);var c=this.centerOffset.clone();return c.applyMatrix4(l),i.add(c),o.add(c),a.add(c),s.add(c),[{x:i.x,y:i.z},{x:o.x,y:o.z},{x:a.x,y:a.z},{x:s.x,y:s.z}]}},{key:"calculateHullPointsCollection",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.hullPointsCollection=se(e,t)}},{key:"isValidPosition",value:function(e){}},{key:"showError",value:function(e){e=e||this.position,this.error||(this.error=!0,this.errorGlow=this.createGlow(this.errorColor,.8,!0),this.scene.add(this.errorGlow)),this.errorGlow.position.copy(e)}},{key:"hideError",value:function(){this.error&&(this.error=!1,this.scene.remove(this.errorGlow))}},{key:"objectHalfSize",value:function(){var e=this.getBounding(!0);return e.max.clone().sub(e.min).divideScalar(2)}},{key:"createGlow",value:function(e,t,n){var r=this;n=n||!1,t=t||.2;var i,o=new m.V({color:e,blending:m.a,opacity:.2,transparent:!0,depthTest:!n}),a=new m.U,s=Object(y.a)(this.children);try{for(s.s();!(i=s.n()).done;){var l=i.value,c=(new m.U).copy(l);c.geometry=(new m.i).copy(l.geometry),c.material=(new m.V).copy(o),a.add(c)}}catch(u){s.e(u)}finally{s.f()}return a.children.forEach((function(e){e.geometry.attributes.position.needsUpdate=!0;var t=e.geometry.attributes.position.array;try{if(r.morph)for(var n in r.morph)if(e.geometry.morphAttributes&&e.geometry.morphAttributes.position&&e.geometry.morphAttributes.position.length>n)for(var i=e.geometry.morphAttributes.position[n].array,o=ee(e,0,r.morph[n]),a=0;a<t.length;a++)t[a]+=i[a]*o}catch(s){console.log(s)}})),a.material=o,a.position.copy(this.position),a.rotation.copy(this.rotation),a.scale.copy(this.scale),a}}]),n}(m.U),ue=-1,he=0,de=1,fe=.2,pe=function(e){Object(f.a)(n,e);var t=Object(p.a)(n);function n(){var e;Object(h.a)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).getBottomObjectsForStack=function(){var t=[];return e.model.scene.items.forEach((function(e){e.stackontop&&t.push(t)})),t},e.getStackingPosition=function(t){var n,r=0,i=e.getCorners("x","z",t),o=e.model.scene.items,a=Object(y.a)(o);try{for(a.s();!(n=a.n()).done;){var s=n.value;if(s!==Object(X.a)(e)&&s.obstructFloorMoves&&(s.stackontop&&(!w.a.Utils.polygonOutsidePolygon(i,s.getCorners("x","z"))||w.a.Utils.polygonPolygonIntersect(i,s.getCorners("x","z"))))){var l=s.getBounding().max.y;l>r&&(r=l)}}}catch(c){a.e(c)}finally{a.f()}return r+0},e.getSnapPosition=function(t){for(var n=e.getCorners("x","z",t),r=1/0,i=1/0,o=n[0].x,a=n[1].x,s=n[0].y,l=n[2].y,c=e.model.scene.items,u=0;u<c.length;u++)if(c[u]!==Object(X.a)(e)&&c[u].obstructFloorMoves){var h,d=c[u].getSnapPoints(!0),f=Object(y.a)(d);try{for(f.s();!(h=f.n()).done;){var p=h.value;Math.abs(o-p.x)<fe&&Math.abs(o-p.x)<Math.abs(r)&&(r=p.x-o,r-=r/Math.abs(r)*0),Math.abs(a-p.x)<fe&&Math.abs(a-p.x)<Math.abs(r)&&(r=p.x-a,r-=r/Math.abs(r)*0),Math.abs(s-p.y)<fe&&Math.abs(s-p.y)<Math.abs(i)&&(i=p.y-s,i-=i/Math.abs(i)*0),Math.abs(l-p.y)<fe&&Math.abs(l-p.y)<Math.abs(i)&&(i=p.y-l,i-=i/Math.abs(i)*0)}}catch(v){f.e(v)}finally{f.f()}}r!==1/0&&(t.x+=r),i!==1/0&&(t.z+=i)},e.isOverlapped=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.getCorners("x","z"),r=e.getBounding(),i=0;i<t.length;i++)if(t[i]!==Object(X.a)(e)&&t[i].obstructFloorMoves&&!0!==t[i].isSet){var o=t[i].getBounding();if(!(o.min.y>=r.max.y)&&!(r.min.y>=o.max.y)){var a=t[i].getCorners("x","z");if(w.a.Utils.polygonPolygonIntersect(n,a))return de}}return he},e.isValidPosition=function(t){for(var n=e.getCorners("x","z",t),r=e.model.scene.items,i=e.model.floorplan.getRooms(),o=!1,a=0;a<i.length;a++)w.a.Utils.pointInPolygon(t.x,t.z,i[a].interiorCorners)&&!w.a.Utils.polygonPolygonIntersect(n,i[a].interiorCorners)&&(o=!0);return o?(w.a.Configuration.getBooleanValue(w.a.configSnapMode)&&e.getSnapPosition(t),e.overlappable?he:e.isOverlapped(r,n)):ue},e}return Object(d.a)(n,[{key:"placeInRoom",value:function(){}},{key:"resized",value:function(){}},{key:"moveToPosition",value:function(e,t){if(!(isNaN(e.x)||isNaN(e.y)||isNaN(e.z))){var n=this.isValidPosition(e);if(n===he||n===de){this.hideError();var r=(new m.Ob).copy(e),i=0;if(this.stackable){if(0===this.getBottomObjectsForStack().length)return console.log("no bottom objects"),void this.showError();var o=this.getStackingPosition(r);if(0===o)return void this.showError();i=o}var a=(new m.Ob).copy(this.position);if(r.y=i,n===de&&!this.overlappable)return void this.showError(e);if(isNaN(r.x)||isNaN(r.y)||isNaN(r.z))return;this.position.copy(r),this.dimensionHelper.position.copy(r);(new m.Ob).copy(this.position).sub(a);this.moveChildMeshes(),this.changed(),this.groupParent&&this.groupParent.isSet&&this.groupParent.update()}else this.showError(e)}}}]),n}(ce),ve=function(e){Object(f.a)(n,e);var t=Object(p.a)(n);function n(e,r,i,o,a,s){var l;return Object(h.a)(this,n),(l=t.call(this,e,r,i,o,a,s)).currentWallEdge=null,l.refVec=new m.Nb(0,1),l.wallOffsetScalar=0,l.sizeX=0,l.sizeY=0,l.addToWall=!1,l.boundToFloor=!1,l.frontVisible=!1,l.backVisible=!1,l.setPosition=function(e){var t=l.closestWallEdge(e);l.changeWallEdge(t);var n=(new m.Ob).copy(e);l.boundMove(n),l.position.copy(n),l.redrawWall(),l.moveChildMeshes(),l.rotateChildMeshes(),l.changed()},l.allowRotate=!1,l.morphAlign=3,l}return Object(d.a)(n,[{key:"closestWallEdge",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.position,t=this.model.floorplan.wallEdges(),n=null,r=1/0,i=e.x,o=e.y,a=e.z;return t.forEach((function(e){var t=e.distanceTo(i,a),s=Math.sqrt(Math.pow(t,2)+Math.pow(o-e.layerOffset,2));s<r&&(r=s,n=e)})),n}},{key:"removed",value:function(){null!=this.currentWallEdge&&this.addToWall&&(w.a.Utils.removeValue(this.currentWallEdge.wall.items,this),this.redrawWall())}},{key:"redrawWall",value:function(){this.addToWall&&this.currentWallEdge&&this.currentWallEdge.wall&&this.currentWallEdge.wall.fireRedraw()}},{key:"updateEdgeVisibility",value:function(e,t){t?this.frontVisible=e:this.backVisible=e,this.visible=this.frontVisible||this.backVisible}},{key:"updateSize",value:function(){var e=this.getBounding();this.wallOffsetScalar=(e.max.z-e.min.z)*this.scale.z/2,this.sizeX=(e.max.x-e.min.x)*this.scale.x,this.sizeY=(e.max.y-e.min.y)*this.scale.y}},{key:"resized",value:function(){this.boundToFloor,this.updateSize(),this.redrawWall()}},{key:"placeInRoom",value:function(){var e=this.closestWallEdge();if(this.changeWallEdge(e),this.updateSize(),!this.position_set){var t=e.interiorCenter(),n=new m.Ob(t.x,e.wall.height/2,t.y);this.boundMove(n),this.position.copy(n),this.redrawWall()}this.moveChildMeshes(),this.rotateChildMeshes(),this.changed()}},{key:"moveToPosition",value:function(e,t){if(isNaN(e.x)||isNaN(e.y)||isNaN(e.z))console.log("nan detected");else{this.changeWallEdge(t.object.edge),this.boundMove(e),this.position.copy(e);var n=(new m.Ob).copy(e),r=this.getBounding();n.y=(r.max.y+r.min.y)/2,this.dimensionHelper.position.copy(n),this.moveChildMeshes(),this.redrawWall(),this.changed()}}},{key:"getWallOffset",value:function(){return this.wallOffsetScalar}},{key:"changeWallEdge",value:function(e){null!=this.currentWallEdge&&(this.addToWall?(w.a.Utils.removeValue(this.currentWallEdge.wall.items,this),this.redrawWall()):w.a.Utils.removeValue(this.currentWallEdge.wall.onItems,this)),null!=this.currentWallEdge&&this.currentWallEdge.wall.dontFireOnDelete(this.remove.bind(this)),e.wall.fireOnDelete(this.remove.bind(this));var t=new m.Nb,n=e.plane.geometry.faces[0].normal;t.x=n.x,t.y=n.z;var r=w.a.Utils.angle(this.refVec.x,this.refVec.y,t.x,t.y);this.flipped&&(r=(r+Math.PI)%(2*Math.PI)),this.rotation.y=r,this.dimensionHelper.rotation.y=r,this.rotateChildMeshes(),this.currentWallEdge=e,this.addToWall?(e.wall.items.push(this),this.redrawWall()):e.wall.onItems.push(this)}},{key:"customIntersectionPlanes",value:function(){return this.model.floorplan.wallEdgePlanes()}},{key:"boundMove",value:function(e){var t=this.currentWallEdge,n=.02,r=t.layerOffset;e.applyMatrix4(t.interiorTransform),e.x<this.sizeX/2+n?e.x=this.sizeX/2+n:e.x>t.interiorDistance()-this.sizeX/2-n&&(e.x=t.interiorDistance()-this.sizeX/2-n),this.boundToFloor?e.y=0*this.scale.y+.01+r:e.y<n+r?e.y=n+r:e.y>t.height-this.sizeY-n+r&&(e.y=t.height-this.sizeY-n+r),e.z=this.getWallOffset(),e.applyMatrix4(t.invInteriorTransform)}}]),n}(ce),ge=function(e){Object(f.a)(n,e);var t=Object(p.a)(n);function n(e,r,i,o,a,s){var l;return Object(h.a)(this,n),(l=t.call(this,e,r,i,o,a,s)).flipHorizontal=function(){l.flipped=!l.flipped,l.rotation.y=(l.rotation.y+Math.PI)%(2*Math.PI)},l.addToWall=!0,l.morphAlign=0,l.flippable=!0,l.flipped=!1,l}return Object(d.a)(n,[{key:"getWallOffset",value:function(){return this.currentWallEdge.offset+.05}}]),n}(ve),ye={1:pe,2:ve,3:ge,7:function(e){Object(f.a)(n,e);var t=Object(p.a)(n);function n(e,r,i,o,a,s){var l;return Object(h.a)(this,n),(l=t.call(this,e,r,i,o,a,s)).boundToFloor=!0,l}return n}(ge),8:function(e){Object(f.a)(n,e);var t=Object(p.a)(n);function n(e,r,i,o,a,s){var l;return Object(h.a)(this,n),(l=t.call(this,e,r,i,o,a,s)).obstructFloorMoves=!1,l.receiveShadow=!0,l}return n}(pe),9:function(e){Object(f.a)(n,e);var t=Object(p.a)(n);function n(e,r,i,o,a,s){var l;return Object(h.a)(this,n),(l=t.call(this,e,r,i,o,a,s)).boundToFloor=!0,l}return n}(ve)},me=function(){function e(){Object(h.a)(this,e)}return Object(d.a)(e,null,[{key:"getClass",value:function(e){return ye[e]}}]),e}(),be=r,xe=function(){function e(t,n){Object(h.a)(this,e),this.items=[],this.roofEdges=[],this.roofVertices=[],this.needsUpdate=!1,this.itemLoadingCallbacks=[],this.itemLoadedCallbacks=[],this.itemRemovedCallbacks=[],this.groundMirrorCamera=null,this.collectOptionsFromItem=function(e){var t={},n={},r={};for(var i in e.builderOptions){var o=e.builderOptions[i];"select"===o.propertyType&&o.options.length&&(t[o.nameInModel]=o.options[0].nameInModel)}return Array.isArray(e.optionGroups)&&e.optionGroups.forEach((function(e){"hide"===e.mode&&e.options.length&&(t[e.nameInModel]=e.options[0].nameInModel),"texture"===e.mode&&e.options.length&&(r[e.nameInModel]={material:{texture:e.options[0].image},size:{w:e.options[0].textureWidth/100,h:e.options[0].textureHeight/100}})})),function(){var t=e.builderOptions&&e.builderOptions.height&&e.builderOptions.height.minValue,r=e.builderOptions&&e.builderOptions.width&&e.builderOptions.width.minValue,i=e.builderOptions&&e.builderOptions.depth&&e.builderOptions.depth.minValue;for(var o in t&&(n[0]=e.builderOptions.height.minValue,e.modelDescription&&e.modelDescription.height&&(n[0]=e.modelDescription.height)),r&&(n[1]=e.builderOptions.width.minValue,e.modelDescription&&e.modelDescription.width&&(n[1]=e.modelDescription.width)),i&&(n[2]=e.builderOptions.depth.minValue,e.modelDescription&&e.modelDescription.depth&&(n[2]=e.modelDescription.depth)),n)n[o]=(n[o]-5)/295}(),{morph:n,styles:t,textures:r}},this.model=t,this.textureDir=n,this.scene=new m.vb,this.GLTFLoader=new H.a,this.GLTFLoader.crossOrigin=""}return Object(d.a)(e,[{key:"add",value:function(e){this.scene.add(e)}},{key:"remove",value:function(e){this.scene.remove(e),w.a.Utils.removeValue(this.items,e)}},{key:"getScene",value:function(){return this.scene}},{key:"getItems",value:function(){return this.items}},{key:"itemCount",value:function(){return this.items.length}},{key:"clearItems",value:function(){var e=this;this.items.forEach((function(t){t.dimensionHelper&&e.remove(t.dimensionHelper),e.removeItem(t,!0)})),this.items=[]}},{key:"removeItem",value:function(e,t){t=t||!1,this.itemRemovedCallbacks.forEach((function(t){return"function"===typeof t&&t(e)})),e.removed(),this.scene.remove(e),t||w.a.Utils.removeValue(this.items,e)}},{key:"cloneItem",value:function(e){var t=this,n=e.cloneData;if(!n)return null;var r=n.metadata,i=n.options,o=n.meshList,a=n.position,s=n.rotation,l=r.itemType,c=[];o.forEach((function(e){var t=e.clone(),n=(new m.i).copy(e.geometry);t.geometryBackup=n,c.push(t)}));var u=new(be.Factory.getClass(l))(t.model,r,c,a,s,i);return u.initObject(o,a,s,i),t.items.push(u),t.add(u),u}},{key:"addItem",value:function(){var e=Object(u.a)(c.a.mark((function e(t,n,r,i,o,a){var s,l=this,u=arguments;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=!(u.length>6&&void 0!==u[6])||u[6],e.abrupt("return",new Promise((function(e){t=t||1;var c=l;l.itemLoadingCallbacks.forEach((function(e){return"function"===typeof e&&e()})),l.GLTFLoader.load(n,(function(n){var l=[],u={},h={},d={};n.scene.traverse((function(e){if(e.isMesh)if(e.name.includes("morph-")||l.push(e),e.name.includes("morph-height")){var t=e.name.replace("-morph-height",""),n=[];e.geometry.attributes.uv.array.forEach((function(e){return n.push(e)})),u[t]=n}else if(e.name.includes("morph-width")){var r=e.name.replace("-morph-width",""),i=[];e.geometry.attributes.uv.array.forEach((function(e){return i.push(e)})),h[r]=i}else if(e.name.includes("morph-depth")){var o=e.name.replace("-morph-depth",""),a=[];e.geometry.attributes.uv.array.forEach((function(e){return a.push(e)})),d[o]=a}}));var f=[u,h,d],p=new(be.Factory.getClass(t))(c.model,Object(g.a)(Object(g.a)({},r),{},{morphUVs:f}),l,i,o,a);p.initObject(l,i,o,a),c.items.push(p),c.add(p),s&&c.itemLoadedCallbacks.forEach((function(e){return"function"===typeof e&&e(p)})),e(p)}),void 0,(function(){e(null)}))})));case 2:case"end":return e.stop()}}),e)})));return function(t,n,r,i,o,a){return e.apply(this,arguments)}}()}]),e}(),we=window.UndoRedoStack||function(){},ke=function e(t){var n=this;Object(h.a)(this,e),this.undoHistory=null,this.roomLoadingCallbacks=[],this.roomLoadedCallbacks=[],this.roomSavedCallbacks=[],this.roomDeletedCallbacks=[],this.loadSerialized=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];n.roomLoadingCallbacks.forEach((function(e){return"function"===typeof e&&e()}));var i=JSON.parse(e);n.initializeFloorPlans(i,t,r),n.roomLoadedCallbacks.forEach((function(e){return"function"===typeof e&&e()}))},this.exportSerialized=function(){return JSON.stringify(n.floorplan.saveFloorplan())},this.collectMetadata=function(){var e=n.floorplan,t=e.orientation,r={layers:[]};return function(){for(var n=e.layers.length-1;n>=0;n--){var i=e.layers[n];if(i){var o=i.getLayerMetadata(t);e.layers[n-1]||(o.metadata.hasExposedFloor=!0),e.layers[n+1]||(o.metadata.hasExposedCeiling=!0),r.layers.push(o)}}}(),r},this.undo=function(){if(n.undoHistory){n.undoHistory.undo();var e=n.undoHistory.latest();e&&n.loadSerialized(e,!1,!1)}},this.redo=function(){if(n.undoHistory){n.undoHistory.redo();var e=n.undoHistory.latest();e&&n.loadSerialized(e,!1,!1)}},this.addToUndoStack=function(){if(n.undoHistory){var e=n.exportSerialized(),t=n.undoHistory.latest();0!==e.localeCompare(t)&&(n.undoHistory.push(e),console.log("undo history",n.undoHistory.getValues().undo.length))}},this.initializeFloorPlans=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];n.scene.clearItems(),n.floorplan.loadFloorplan(e,t,r),e.items.forEach((function(e){var t=new m.Ob(e.xpos,e.ypos,e.zpos),r=e.metadata;n.scene.addItem(e.item_type,e.model_url,r,t,e.rotation,e.options)}))},this.floorplan=new B,this.scene=new xe(this,t),this.floorplan.scene=this.scene,this.undoHistory=we(),document.addEventListener("keypress",(function(e){26===e.keyCode&&e.ctrlKey&&n.undo()})),document.addEventListener(w.a.BP3D_EVENT_ADD_TO_UNDO_STACK,(function(e){e.detail;n.addToUndoStack()}))};function Oe(e){var t=["varying vec3 vWorldPosition;","void main() {","  vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","  vWorldPosition = worldPosition.xyz;","  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),n=["uniform vec3 topColor;","uniform vec3 bottomColor;","uniform float offset;","varying vec3 vWorldPosition;","void main() {","  float h = normalize( vWorldPosition + offset ).y;","  gl_FragColor = vec4( mix( bottomColor, topColor, (h + 1.0) / 2.0), 1.0 );","}"].join("\n");!function(){var r={topColor:{type:"c",value:new m.l(16777215)},bottomColor:{type:"c",value:new m.l(1131741)},offset:{type:"f",value:500}},i=new m.Db(400,32,15),o=new m.wb({vertexShader:t,fragmentShader:n,uniforms:r,side:m.c}),a=new m.U(i,o);e.add(a)}()}var je=function(e,t){this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new m.Ob,this.center=this.target,this.noZoom=!1,this.zoomSpeed=1,this.minDistance=0,this.maxDistance=500,this.noRotate=!1,this.rotateSpeed=1,this.noPan=!1,this.keyPanSpeed=40,this.autoRotate=!1,this.autoRotateSpeed=2,this.minPolarAngle=0,this.maxPolarAngle=Math.PI/2,this.noKeys=!1,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.cameraMovedCallbacks=[],this.needsUpdate=!0;var n=this,r=1e-6,i=new m.Nb,o=new m.Nb,a=new m.Nb,s=new m.Nb,l=new m.Nb,c=new m.Nb,u=new m.Nb,h=new m.Nb,d=new m.Nb,f=0,p=0,v=1,g=new m.Ob,y=-1,b=0,x=1,w=2,k=3,O=4,j=5,C=y;function E(){return 2*Math.PI/60/60*n.autoRotateSpeed}function S(){return Math.pow(.95,n.zoomSpeed)}function M(e){if(!1!==n.enabled){e.preventDefault();var t=n.domElement===document?n.domElement.body:n.domElement;if(C===b){if(!0===n.noRotate)return;o.set(e.clientX,e.clientY),a.subVectors(o,i),n.rotateLeft(2*Math.PI*a.x/t.clientWidth*n.rotateSpeed),n.rotateUp(2*Math.PI*a.y/t.clientHeight*n.rotateSpeed),i.copy(o)}else if(C===x){if(!0===n.noZoom)return;h.set(e.clientX,e.clientY),d.subVectors(h,u),d.y>0?n.dollyIn():n.dollyOut(),u.copy(h)}else if(C===w){if(!0===n.noPan)return;l.set(e.clientX,e.clientY),c.subVectors(l,s),n.pan(c),s.copy(l)}n.update()}}function P(){!1!==n.enabled&&(n.domElement.removeEventListener("mousemove",M,!1),n.domElement.removeEventListener("mouseup",P,!1),C=y)}function T(e){if(!1!==n.enabled&&!0!==n.noZoom){var t=0;e.wheelDelta?t=e.wheelDelta:e.detail&&(t=-e.detail),t>0?n.dollyOut():n.dollyIn(),n.update()}}this.controlsActive=function(){return C===y},this.setPan=function(e){g=e},this.panTo=function(e){var t=new m.Ob(e.x,n.target.y,e.z),r=n.target.clone().sub(t);g.sub(r),n.update()},this.rotateLeft=function(e){void 0===e&&(e=E()),p-=e},this.rotateUp=function(e){void 0===e&&(e=E()),f-=e},this.panLeft=function(e){var t=new m.Ob,n=this.object.matrix.elements;t.set(n[0],0,n[2]),t.normalize(),t.multiplyScalar(-e),g.add(t)},this.panUp=function(e){var t=new m.Ob,n=this.object.matrix.elements;t.set(n[4],0,n[6]),t.normalize(),t.multiplyScalar(e),g.add(t)},this.pan=function(e){var t=n.domElement===document?n.domElement.body:n.domElement;if(void 0!==n.object.fov){var r=n.object.position.clone().sub(n.target).length();r*=Math.tan(n.object.fov/2*Math.PI/180),n.panLeft(2*e.x*r/t.clientHeight),n.panUp(2*e.y*r/t.clientHeight)}else void 0!==n.object.top?(n.panLeft(e.x*(n.object.right-n.object.left)/t.clientWidth),n.panUp(e.y*(n.object.top-n.object.bottom)/t.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.");n.update()},this.panXY=function(e,t){n.pan(new m.Nb(e,t))},this.dollyIn=function(e){void 0===e&&(e=S()),v/=e,this.update()},this.dollyOut=function(e){void 0===e&&(e=S()),v*=e,this.update()},this.update=function(){var e=this.object.position,t=e.clone().sub(this.target),n=Math.atan2(t.x,t.z),i=Math.atan2(Math.sqrt(t.x*t.x+t.z*t.z),t.y);this.autoRotate&&this.rotateLeft(E()),n+=p,i+=f,i=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,i)),i=Math.max(r,Math.min(Math.PI-r,i));var o=t.length()*v;o=Math.max(this.minDistance,Math.min(this.maxDistance,o)),this.target.add(g),t.x=o*Math.sin(i)*Math.sin(n),t.y=o*Math.cos(i),t.z=o*Math.sin(i)*Math.cos(n),e.copy(this.target).add(t),this.object.lookAt(this.target),p=0,f=0,v=1,g.set(0,0,0),this.cameraMovedCallbacks.forEach((function(e){return"function"===typeof e&&e()})),this.needsUpdate=!0},this.domElement.addEventListener("contextmenu",(function(e){e.preventDefault()}),!1),this.domElement.addEventListener("mousedown",(function(e){if(!1!==n.enabled){if(e.preventDefault(),2===e.button){if(!0===n.noRotate)return;C=b,i.set(e.clientX,e.clientY)}else if(1===e.button){if(!0===n.noZoom)return;C=x,u.set(e.clientX,e.clientY)}else if(0===e.button){if(!0===n.noPan)return;C=w,s.set(e.clientX,e.clientY)}n.domElement.addEventListener("mousemove",M,!1),n.domElement.addEventListener("mouseup",P,!1)}}),!1),this.domElement.addEventListener("mousewheel",T,!1),this.domElement.addEventListener("DOMMouseScroll",T,!1),this.domElement.addEventListener("touchstart",(function(e){if(!1!==n.enabled)switch(e.touches.length){case 3:if(!0===n.noRotate)return;C=k,i.set(e.touches[0].pageX,e.touches[0].pageY);break;case 2:if(!0===n.noZoom)return;C=O;var t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY,o=Math.sqrt(t*t+r*r);u.set(0,o);break;case 1:if(!0===n.noPan)return;C=j,s.set(e.touches[0].pageX,e.touches[0].pageY);break;default:C=y}}),!1),this.domElement.addEventListener("touchend",(function(){!1!==n.enabled&&(C=y)}),!1),this.domElement.addEventListener("touchmove",(function(e){if(!1!==n.enabled){e.preventDefault(),e.stopPropagation();var t=n.domElement===document?n.domElement.body:n.domElement;switch(e.touches.length){case 1:if(!0===n.noRotate)return;if(C!==k)return;o.set(e.touches[0].pageX,e.touches[0].pageY),a.subVectors(o,i),n.rotateLeft(2*Math.PI*a.x/t.clientWidth*n.rotateSpeed),n.rotateUp(2*Math.PI*a.y/t.clientHeight*n.rotateSpeed),i.copy(o);break;case 2:if(!0===n.noZoom)return;if(C!==O)return;var r=e.touches[0].pageX-e.touches[1].pageX,f=e.touches[0].pageY-e.touches[1].pageY,p=Math.sqrt(r*r+f*f);h.set(0,p),d.subVectors(h,u),d.y>0?n.dollyOut():n.dollyIn(),u.copy(h);break;case 3:if(!0===n.noPan)return;if(C!==j)return;l.set(e.touches[0].pageX,e.touches[0].pageY),c.subVectors(l,s),n.pan(c),s.copy(l);break;default:C=y}}}),!1),window.addEventListener("keydown",(function(e){if(!1!==n.enabled&&!0!==n.noKeys&&!0!==n.noPan)switch(e.keyCode){case n.keys.UP:n.pan(new m.Nb(0,n.keyPanSpeed));break;case n.keys.BOTTOM:n.pan(new m.Nb(0,-n.keyPanSpeed));break;case n.keys.LEFT:n.pan(new m.Nb(n.keyPanSpeed,0));break;case n.keys.RIGHT:n.pan(new m.Nb(-n.keyPanSpeed,0))}}),!1)},Ce=function(e){var t=this,n=e.scene,r=null,i=!1,o=!1,a=null;function s(){r=null,a&&(n.remove(a),a=null)}function l(e){e?r!==e&&(s(),e.allowRotate&&!e.fixed&&(a=function(e){var n=new m.x,r=new m.F(function(e){var t=new m.w;return t.vertices.push(new m.Ob(0,0,0),h(e)),t}(e),(t.rotating,new m.H({color:u(),linewidth:3,depthTest:!1})),m.J),i=function(e){var t=new m.o(.05,0,.1),n=new m.V({color:u()}),r=new m.U(t,n);return r.position.copy(h(e)),r.rotation.x=-Math.PI/2,r}(e),o=function(e){var t=new m.Db(.04,16,16),n=new m.V({color:u(),depthTest:!1});return new m.U(t,n)}();return n.add(r),n.add(i),n.add(o),n.rotation.y=e.rotation.y,n.position.x=e.position.x,n.position.z=e.position.z,n.position.y=.05,n}(r=e),n.add(a))):s()}function c(){a&&a.children.forEach((function(e){e.material.color.set(u())})),e.needsUpdate()}function u(){return o||i?"#f1c40f":"#ffffff"}function h(e){return new m.Ob(0,0,Math.max(e.halfSize.x,e.halfSize.z)+.2)}this.getScene=function(){return n},this.getObject=function(){return a},this.setRotating=function(e){i=e,c()},this.setMouseover=function(e){o=e,c()},this.update=function(){if(a){a.rotation.y=r.rotation.y;var e=r.position;a.position.x=e.x,a.position.z=e.z}},e.itemSelectedCallbacks.push(l)},Ee=n(31),Se=0,Me=1,Pe=2,Te=3,_e=function(){function e(t,n){Object(h.a)(this,e),this.mode=Se,this.enabled=!1,this.three=null,this.floorplan=null,this.roofModel=null,this.three=t,this.floorplan=n,this.roofModel=n.roof}return Object(d.a)(e,[{key:"setEnabled",value:function(e){this.enabled=e,this.roofModel.enabled=e,this.roofModel.update()}},{key:"setMode",value:function(e){this.mode=e,this.three.roofEditorModeChangedCallbacks.forEach((function(t){return t(e)}))}},{key:"addVertex",value:function(e,t,n,r){if(t-=this.roofModel.offset,r){var i=r.start,o=r.end,a=i.distanceFrom(e,t,n),s=i.distanceFrom(o.x,o.y,o.z);e=i.x+(o.x-i.x)*a/s,t=i.y+(o.y-i.y)*a/s,n=i.z+(o.z-i.z)*a/s}var l=this.roofModel.newVertex(e,t,n);r&&(this.roofModel.newEdge(l,r.getEnd()),r.setEnd(l)),this.roofModel.update()}},{key:"addEdge",value:function(e,t){e.roofVertex&&t.roofVertex&&(this.roofModel.newEdge(e.roofVertex,t.roofVertex,!0),this.roofModel.update())}}]),e}(),De=0,Le=1,Ie=2,We=3,Ne=4,ze=function(e,t,n,r,i,o,a){var s=this;this.enabled=!0;var l,c,u,h,d,f=t.scene,p=t.floorplan,g=!1,y=!1,b=!1,x=!1,k=new Ee.a(n,r);this.transformControl=k,k.addEventListener("dragging-changed",(function(e){return i.enabled=!e.value})),k.addEventListener("change",(function(e){if(k.showX?k.axis="X":k.showY?k.axis="Y":k.showZ&&(k.axis="Z"),x&&!k.dragging&&k.object){var t=k.object;s.resetTransformControl(),t.moved_callback()}x=k.dragging})),f.add(k);var O=De;function j(t){if(!t.position_set){s.setSelectedObject(t),_(Ie);var n=t.position.clone();n.y=0,C(e.projectVector(n)),t.dimensionHelper&&t.dimensionHelper.position.copy(t.position)}t.position_set=!0}function C(e){e=e||l;var t=s.itemIntersection(l,d);t&&d.clickPressed(t)}function E(e){e===d&&(d&&d.setUnselected(),d.mouseOff(),s.setSelectedObject(null))}function S(t){if(1===t.buttons&&O===De&&!h){var n=[],r=[];e.floorplan.floors.forEach((function(e){e.setHighlight(!1),n.push(e.getPlane())})),e.floorplan.edges.forEach((function(e){e.setHighlight(!1),r.push.apply(r,Object(v.a)(e.getPlanes()))}));var i=s.getIntersections(l,[].concat(r,n),!1);if(i.length>0){var o=i[0].object,a=o.room,c=o.edge;if(a)return o.threeFloor.setHighlight(!0),void e.floorClicked.forEach((function(e){return e(a)}));if(c){o.threeEdge.setHighlight(!0);var u=o.isInterior,d=o.isExterior;return c.isInterior=u,c.isExterior=d,void e.wallClicked.forEach((function(e){return e(c)}))}}e.nothingClicked.forEach((function(e){return"function"===typeof e&&e()}))}}function M(n){if(!w.a.Configuration.getBooleanValue(w.a.configSceneLocked)&&s.enabled)switch(n.preventDefault(),y=!0,l.x=n.offsetX,l.y=n.offsetY,g||function(){if(a.enabled){var n=t.scene.roofEdges.map((function(e){return e.mesh})),r=t.scene.roofVertices.map((function(e){return e.mesh})),i=e.floorplan.floors.map((function(e){return e.ceilingPlane})).sort((function(e,t){return t.position.y-e.position.y})),h=[].concat(Object(v.a)(n),Object(v.a)(r));i.length&&h.push(i[0]);var d=s.getIntersections(l,h,!1,!1);d.length>0?(c=d[0].object,u=d[0]):(c=null,u=d[0])}else{var f=o.getObject();if(null!=f)if(s.getIntersections(l,f,!1,!1,!0).length>0)return b=!0,o.setMouseover(!0),void(c=null);b=!1,o.setMouseover(!1)}}(),O){case De:case Le:L();break;case Ie:case We:case Ne:!function(e){e=e||l;var t=s.itemIntersection(l,d);t&&(s.isRotating()?!Boolean(d.fixed)&&d.rotate(t):d.clickDragged(t))}(),o.update(),s.needsUpdate=!0}}function P(t){if(!w.a.Configuration.getBooleanValue(w.a.configSceneLocked)&&s.enabled){if(t.preventDefault(),y=!1,g=!0,a.enabled)return void function(t){if(1===t.buttons){if(a.mode===Me){if(u&&c){var n=null;c.isLine&&(n=c.roofEdge),s.resetTransformControl();var r=u.point,i=r.x,o=r.y,l=r.z;a.addVertex(i,o-.005,l,n),p.update(!1),e.roof.setMode(Se)}}else if(a.mode===Pe){if(d&&c&&d!==c){s.resetTransformControl();var h=d;s.setSelectedObject(c),a.addEdge(h,d),p.update(!1)}}else a.mode===Se?c&&c.forRoof&&c.isMesh&&k.attach(c):a.mode===Te&&c&&c.forRoof&&(s.resetTransformControl(),c.roofVertex&&c.roofVertex.removeAll(),c.roofEdge&&c.roofEdge.remove(),c=null,p.update(!1));s.setSelectedObject(c)}}(t);switch(O){case Le:b?_(We):null!=c?(s.setSelectedObject(c),c.fixed||_(Ie)):null!==c||y||(_(De),S(t));break;case De:null!=c&&(s.setSelectedObject(c),c.fixed||_(Ie)),y||S(t);break;case Ie:case We:break;case Ne:_(Le)}}}function T(e){if(!w.a.Configuration.getBooleanValue(w.a.configSceneLocked)&&s.enabled)switch(g=!1,O){case Ie:d.clickReleased(),_(Le);break;case We:_(y?Le:Ne)}}function _(t){t!==O&&(function(t){switch(t){case De:case Le:break;case Ie:h?e.setCursorStyle("pointer"):e.setCursorStyle("auto")}}(O),function(t){switch(t){case De:s.setSelectedObject(null);break;case Le:i.enabled=!0;break;case We:case Ne:i.enabled=!1;break;case Ie:e.setCursorStyle("move"),C(),i.enabled=!1}}(t)),O=t,o.setRotating(s.isRotating())}function D(e){var t=function(e){var t=new m.Nb,n=r.getBoundingClientRect();return t.x=e.x/n.width*2-1,t.y=-e.y/n.height*2+1,t}(e),i=new m.Ob(t.x,t.y,.5);return i.unproject(n),i}function L(){null!=c?null!=h?h!==c&&("function"===typeof h.mouseOff&&h.mouseOff(),"function"===typeof(h=c).mouseOver&&h.mouseOver(),s.needsUpdate=!0):("function"===typeof(h=c).mouseOver&&h.mouseOver(),e.setCursorStyle("pointer"),s.needsUpdate=!0):null!=h&&("function"===typeof h.mouseOff&&h.mouseOff(),e.setCursorStyle("auto"),h=null,s.needsUpdate=!0)}this.needsUpdate=!0,this.resetTransformControl=function(){k.object&&k.detach(k.object)},this.selectedObject=function(){return d},this.isRotating=function(){return O===We||O===Ne},this.itemIntersection=function(e,t){var n="function"===typeof t.customIntersectionPlanes?t.customIntersectionPlanes():null,r=null;return(r=n&&n.length>0?this.getIntersections(e,n,!0):this.getIntersections(e,undefined)).length>0?r[0]:null},this.getIntersections=function(e,t,r,i,o,a){i=i||!1,r=r||!1,o=o||!1,a=a||.1;var s,l=D(e).sub(n.position).normalize(),c=new m.tb(n.position,l);if(c.params.Line.threshold=a,Array.isArray(t)){var u=[];t.forEach((function(e){return e.traverse((function(e){(e.isMesh||e.isLine)&&u.push(e)}))})),(s=c.intersectObjects(u,o)).forEach((function(e){if(e.object.isMesh&&e.object.parent){if(e.object.parent instanceof m.vb)return;e.object.parent&&(e.object=e.object.parent)}}))}else s=c.intersectObject(t,o);return i&&(s=w.a.Utils.removeIf(s,(function(e){return!e.object.visible}))),r&&(s=w.a.Utils.removeIf(s,(function(e){return e.face.normal.dot(l)>0}))),s},this.setSelectedObject=function(n){if(O===De&&_(Le),null!=n){if(n===d)return;d&&"function"===typeof d.setUnselected&&d.setUnselected(),t.scene.roofVertices.map((function(e){return e.mesh})).forEach((function(e){return e.setUnselected()})),(d=n)&&"function"===typeof d.setSelected&&d.setSelected(),n.forRoof?n.roofVertex&&e.roofVertexSelectedCallbacks.forEach((function(e){return e(n.roofVertex)})):e.itemSelectedCallbacks.forEach((function(e){return e(n)}))}else d&&"function"===typeof d.setUnselected&&d.setUnselected(),d=null,e.itemSelectedCallbacks.forEach((function(e){return e()})),e.roofVertexSelectedCallbacks.forEach((function(e){return e()}));this.needsUpdate=!0},r.addEventListener("mousedown",P),r.addEventListener("mouseup",T),r.addEventListener("mousemove",M),l=new m.Nb,f.itemRemovedCallbacks.push(E),f.itemLoadedCallbacks.push(j)};function Ve(e,t){var n;function r(){var e=t.getCenter(),r=new m.Ob(e.x,50,e.z);n.position.copy(r)}this.getDirLight=function(){},function(){var i=new m.y(16777215,8947848,1.1);i.position.set(4,50,0),e.add(i),(n=new m.mb(16777215,1,100,2)).position.set(0,50,0),n.castShadow=!0,n.shadow.mapSize.width=1024,n.shadow.mapSize.height=1024,n.shadow.radius=2,n.shadow.bias=1e-4,e.add(n),t.fireOnUpdatedRooms(r)}()}var Ae=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0,i=this;this.room=t,r=r||w.a.Configuration.getNumericValue(w.a.configWallHeight),this.isHighlight=!1,this.ceilingPlane=null;var o=null,a=null,s=[],l=16777215,c=16768477;function u(){i.room.fireOnFloorChange(d),o=f(),a=p(),h()}function h(){a.visible=w.a.Configuration.getBooleanValue(w.a.configShellMode)}function d(){i.removeFromScene(),o=f(),a=p(),h(),i.addToScene()}function f(){var e=i.room.getTexture(),r=(new m.Jb).load(e.url);r.wrapS=m.ub,r.wrapT=m.ub;var o=e.width||1,a=e.height||1;r.repeat.set(1/o,1/a);var c=new m.W({map:r,side:m.q,color:l,specular:657930}),u=[];i.room.interiorCorners.forEach((function(e){u.push(new m.Nb(e.x,e.y))}));var h=new m.xb(u),d=new m.yb(h),f=new m.U(d,c);f.rotation.set(Math.PI/2,0,0),f.position.y=n+.01+t.floorThickness,f.receiveShadow=!0,f.castShadow=!1,f.room=t,f.threeFloor=i,s=[];for(var p=t.floorThickness?t.floorThickness:0,v=function(e){var t=u[e],r=u[(e+1)%u.length],i=[new m.Ob(t.x,0,t.y),new m.Ob(r.x,0,r.y),new m.Ob(r.x,p,r.y),new m.Ob(t.x,p,t.y)],o=new m.w;i.forEach((function(e){o.vertices.push(e)})),o.faces.push(new m.s(0,1,2)),o.faces.push(new m.s(0,2,3));var a=new m.V({color:16777215,side:m.q});o.computeVertexNormals();var l=new m.U(o,a);l.position.y=n+.01,s.push(l)},g=0;g<u.length;g++)v(g);return f}function p(){var e=new m.Y({side:m.q,color:16777215}),t=[];i.room.interiorCorners.forEach((function(e){t.push(new m.Nb(e.x,e.y))}));var o=new m.xb(t),a=new m.yb(o),s=new m.U(a,e);return s.rotation.set(Math.PI/2,0,0),s.position.y=r+n,s.threeFloor=i,i.ceilingPlane=s,s}u(),document.addEventListener(w.a.BP3D_EVENT_CONFIG_CHANGED,(function(e){var t=e.detail;t&&t.hasOwnProperty(w.a.configShellMode)&&h()})),this.getPlane=function(){return o},this.setHighlight=function(e){i.isHighlight=e,o.material.color.setHex(e?c:l)},this.addToScene=function(){e.add(o),e.add(a),s.forEach((function(t){return e.add(t)}))},this.removeFromScene=function(){e.remove(o),e.remove(a),s.forEach((function(t){return e.remove(t)})),s=[]}},Re=function(e,t,n,r){var i=this;this.isHighlight=!1;var o=t.wall,a=t.front,s=[],l=[],c=[],u=null,h=null,d=null,f=null,p=16777215,v=16768477;function g(){y(),j(),C(),E(),b(),O(),i.setHighlight(i.isHighlight)}function y(){s.forEach((function(t){return e.remove(t)})),l.forEach((function(t){return e.remove(t)})),c.forEach((function(t){return e.remove(t)})),s=[],l=[],c=[]}function b(){s.forEach((function(t){return e.add(t)})),l.forEach((function(t){return e.add(t)})),c.forEach((function(t){return e.add(t)})),x()}function x(){var e=t.wall,r=n.object.position.clone(),o=e.getWallCenter(),a=new m.Ob(o.x,0,o.y);if(w.a.Configuration.getBooleanValue(w.a.configShellMode))i.visible=!0;else if(e.checkIsOutsideWall()){var l=e.findInsideRoomPoint();if(l&&r){var c=r.distanceTo(a),u=r.distanceTo(new m.Ob(l.x,0,l.y));i.visible=!(c<u)}else i.visible=!0}else i.visible=!0;s.forEach((function(e){e.visible=i.visible})),k()}function k(){o.items.forEach((function(e){e.updateEdgeVisibility(i.visible,a)})),o.onItems.forEach((function(e){e.updateEdgeVisibility(i.visible,a)}))}function O(){var e=w.a.Configuration.getBooleanValue(w.a.configDimensionVisible);c.forEach((function(t){return t.visible=e}))}function j(n){n=n||function(){e.needsUpdate=!0},function(){var e=t.getTexture(!0),n=e.url,r=e.width,i=e.height;(u=(new m.Jb).load(n)).wrapS=m.ub,u.wrapT=m.ub;var o=r||1,a=i||1;u.repeat.set(1/o,1/a)}(),function(){var e=t.getTexture(!1),n=e.url,r=e.width,i=e.height;(h=(new m.Jb).load(n)).wrapS=m.ub,h.wrapT=m.ub;var o=r||1,a=i||1;h.repeat.set(1/o,1/a)}()}function C(){d=new m.W({color:p,side:m.c,transparent:!0,opacity:w.a.Configuration.getBooleanValue(w.a.configXRayMode)?.3:1}),(f=d.clone()).side=m.v;var e=P(t.exteriorStart(),t.exteriorEnd(),t.exteriorTransform,t.invExteriorTransform,f);e.isInterior=!1,e.isExterior=!0,e.material.map=h;var n=P(t.interiorStart(),t.interiorEnd(),t.interiorTransform,t.invInteriorTransform,d);n.isInterior=!0,n.isExterior=!1,n.material.map=u,s.push(e,n),l.push(T(t,0,m.c,p)),s.push(T(t,o.height,m.q,p)),[[t.interiorStart(),t.midStart()],[t.midStart(),t.exteriorStart()],[t.interiorEnd(),t.midEnd()],[t.midEnd(),t.exteriorEnd()]].forEach((function(e){return s.push(function(e,t,n,i){var o=[D(e),D(t),D(t,n),D(e,n)],a=new m.w;o.forEach((function(e){a.vertices.push(e)})),a.faces.push(new m.s(0,1,2)),a.faces.push(new m.s(0,2,3));var s=new m.V({color:i,side:m.q}),l=new m.U(a,s);return l.position.y=r,l}(e[0],e[1],o.height,p))}))}function E(){var e=[],t=[],n=o.start,r=o.end,i=o.layer,a=o.height;e.push([new m.Ob(n.x,i.offset,n.y),new m.Ob(r.x,i.offset,r.y)]),e.push([new m.Ob(n.x,i.offset+a,n.y),new m.Ob(r.x,i.offset+a,r.y)]),e.push([new m.Ob(n.x,i.offset,n.y),new m.Ob(n.x,i.offset+a,n.y)]),e.push([new m.Ob(r.x,i.offset,r.y),new m.Ob(r.x,i.offset+a,r.y)]);for(var s=0,l=e;s<l.length;s++){var u=l[s],h=new m.H({color:16711680,depthTest:!1,transparent:!0}),d=(new m.i).setFromPoints(u),f=new m.F(d,h);f.renderOrder=1,t.push(f)}[new m.Ob(n.x,i.offset,n.y),new m.Ob(r.x,i.offset,r.y),new m.Ob(n.x,i.offset+a,n.y),new m.Ob(r.x,i.offset+a,r.y)].forEach((function(e){var n=function(e){var t=e.clone();t.y+=.2;var n=document.createElement("canvas"),r=new m.Ib(n);r.needsUpdate=!0;var i=new m.Gb({map:r,depthTest:!1,transparent:!0}),o=new m.Fb(i);return o.scale.set(2,1.5,2),o.position.copy(t),o.renderOrder=1,o.vertex=e,o.canvas=n,o}(e);M(n,S(e)),t.push(n)})),c=t}function S(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new m.Ob,t="x: "+w.a.Dimensioning.cmToMeasure(100*e.x)+", \n";return t+="y: "+w.a.Dimensioning.cmToMeasure(100*e.z)+", \n",t+="z: "+w.a.Dimensioning.cmToMeasure(100*e.y)}function M(e,t){var n=e.canvas,r=n.getContext("2d");r.clearRect(0,0,n.width,n.height),r.font="Bold 16px Arial",r.textBaseline="middle",r.textAlign="center",r.fillStyle="rgba(0, 0, 255, 1)",r.fillText(t,n.width/2,n.height/2),r.strokeStyle="#ffffff",r.lineWidth=.1,r.strokeText(t,n.width/2,n.height/2),e.material.map.needsUpdate=!0}function P(e,n,a,s,l){var c=D(e),u=D(n),h=u.clone();h.y=o.height;var d=c.clone();d.y=o.height;var f=[c.clone(),u.clone(),h.clone(),d.clone()];f.forEach((function(e){e.applyMatrix4(a)}));var p=new m.xb([new m.Nb(f[0].x,f[0].y),new m.Nb(f[1].x,f[1].y),new m.Nb(f[2].x,f[2].y),new m.Nb(f[3].x,f[3].y)]);o.items.forEach((function(e){var t=e.getBounding(),n=new m.Ob((t.max.x+t.min.x)/2,(t.max.y+t.min.y)/2,(t.max.z+t.min.z)/2);n.applyMatrix4(a);var i=e.halfSize,o=i.clone().multiplyScalar(-1),s=i.clone();o.add(n),s.add(n);var l=[new m.Nb(o.x,o.y-r),new m.Nb(s.x,o.y-r),new m.Nb(s.x,s.y-r),new m.Nb(o.x,s.y-r)];p.holes.push(new m.ib(l))}));var v=new m.yb(p);function g(e){var t=w.a.Utils.distance(c.x,c.z,e.x,e.z),n=e.y;return new m.Nb(t,n)}v.vertices.forEach((function(e){e.applyMatrix4(s)})),v.faceVertexUvs[0]=[],v.faces.forEach((function(e){var t=v.vertices[e.a],n=v.vertices[e.b],r=v.vertices[e.c];v.faceVertexUvs[0].push([g(t),g(n),g(r)])})),v.faceVertexUvs[1]=v.faceVertexUvs[0],v.computeFaceNormals(),v.computeVertexNormals();var y=new m.U(v,l);return y.position.y=r,y.castShadow=!0,y.receiveShadow=!0,y.edge=t,y.threeEdge=i,y}function T(e,t,n,i){var o=[_(e.exteriorStart()),_(e.exteriorEnd()),_(e.midEnd()),_(e.interiorEnd()),_(e.interiorStart()),_(e.midStart())],a=new m.W({color:i,side:n}),s=new m.xb(o),l=new m.yb(s),c=new m.U(l,a);return c.rotation.set(Math.PI/2,0,0),c.position.y=t+r,c}function _(e){return new m.Nb(e.x,e.y)}function D(e,t){return t=t||0,new m.Ob(e.x,t,e.y)}this.visible=!1,document.addEventListener(w.a.BP3D_EVENT_CONFIG_CHANGED,(function(e){var t=e.detail;if(t){if(t.dimUnit&&c.forEach((function(e){e instanceof m.Fb&&M(e,S(e.vertex))})),t.hasOwnProperty(w.a.configDimensionVisible)&&O(),t.hasOwnProperty(w.a.configXRayMode)&&d&&f){var n=1;t[w.a.configXRayMode]&&(n=.3),d.opacity=n,f.opacity=n}t.hasOwnProperty(w.a.configShellMode)&&x()}})),this.setHighlight=function(e){i.isHighlight=e,d.color.setHex(e?v:p),f.color.setHex(e?v:p)},this.remove=function(){var e=null;e=t.redrawCallbacks.indexOf(g),t.redrawCallbacks.splice(e,1),e=n.cameraMovedCallbacks.indexOf(x),n.cameraMovedCallbacks.splice(e,1),y()},this.getPlanes=function(){var e=[];return s[0].visible&&e.push(s[0]),s[1].visible&&e.push(s[1]),e},t.redrawCallbacks.push(g),n.cameraMovedCallbacks.push(x),j(),C(),E(),b(),O()},Ue=.005,Fe=function(e,t,n){var r=this;this.mesh=null;var i=null;function o(){r.mesh&&e.remove(r.mesh)}this.remove=function(){o()};var a=function(){},s=function(){},l=function(){},c=function(){},u=function(){},h=function(){},d=function(){},f=function(){};o(),r.mesh=function(){var e=t.start,r=t.end,o=new m.Ob(e.x,e.y-0+n+Ue,e.z),p=new m.Ob(r.x,r.y-0+n+Ue,r.z);i=new m.H({color:16711680});var v=(new m.i).setFromPoints([o,p]),g=new m.F(v,i);return g.forRoof=!0,g.mouseOver=a,g.mouseOff=s,g.setSelected=l,g.setUnselected=c,g.customIntersectionPlanes=u,g.clickPressed=h,g.clickReleased=d,g.clickDragged=f,g.roofEdge=t,t.enabled||(g.visible=!1),g}(),e.add(r.mesh)},Be=.005,He=function(e,t,n){var r=this,i=this,o=null,a=.3;function s(){i.mesh&&e.remove(i.mesh),i.helper&&e.remove(i.helper)}i.mesh=null,i.helper=null,document.addEventListener(w.a.BP3D_EVENT_CONFIG_CHANGED,(function(e){var t=e.detail;if(t){if(t.dimUnit){var n=i.helper;if(n instanceof m.Fb)k(n,x(n.vertex))}t.hasOwnProperty(w.a.configDimensionVisible)&&l()}})),this.remove=function(){s()};var l=function(){var e=w.a.Configuration.getBooleanValue(w.a.configDimensionVisible);i.helper&&(i.helper.visible=e)},c=function(e){o&&(o.opacity=e?1:.5)},u=function(){c(!0)},h=function(){c(!1)},d=function(){r.mesh.roofVertex.selected=!0,o.color.setHex(16776960)},f=function(){r.mesh.roofVertex.selected=!1,o.color.setHex(255)},p=function(){},v=function(){},g=function(){},y=function(){},b=function(){var e=i.mesh.position,n=e.x,r=e.y,o=e.z;t.move(n,r-t.offset-Be,o)};function x(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new m.Ob,t="x: "+w.a.Dimensioning.cmToMeasure(100*e.x)+", \n";return t+="y: "+w.a.Dimensioning.cmToMeasure(100*e.z)+", \n",t+="z: "+w.a.Dimensioning.cmToMeasure(100*e.y)}function k(e,t){var n=e.canvas,r=n.getContext("2d");r.clearRect(0,0,n.width,n.height),r.font="Bold 16px Arial",r.textBaseline="middle",r.textAlign="center",r.fillStyle="rgba(0, 0, 255, 1)",r.fillText(t,n.width/2,n.height/2),r.strokeStyle="#ffffff",r.lineWidth=.1,r.strokeText(t,n.width/2,n.height/2),e.material.map.needsUpdate=!0}s(),i.mesh=function(){var e=t.x,r=t.y,s=t.z;o=new m.W({color:255,transparent:!0,opacity:.5});var l=new m.g(a,a,a),c=new m.U(l,o),w=new m.Ob(e,r+n+Be-0,s);c.position.copy(w),c.forRoof=!0,c.roofVertex=t,c.mouseOver=u,c.mouseOff=h,c.setSelected=d,c.setUnselected=f,c.customIntersectionPlanes=p,c.clickPressed=v,c.clickReleased=g,c.clickDragged=y,c.moved_callback=b,t.enabled||(c.visible=!1);var O=function(e){var t=e.clone();t.y+=.2;var n=document.createElement("canvas"),r=new m.Ib(n);r.needsUpdate=!0;var i=new m.Gb({map:r,depthTest:!1,transparent:!0}),o=new m.Fb(i);return o.scale.set(2,1.5,2),o.position.copy(t),o.renderOrder=1,o.vertex=e,o.canvas=n,o}(w),j=x(w);return k(O,j),i.helper=O,c}(),e.add(i.mesh),e.add(i.helper),l(),t.selected&&d()},Xe=function(e,t){var n=t.vertices,r=this,i=null,o=t.color||4164045;function a(){r.mesh&&e.remove(r.mesh)}r.mesh=null,this.remove=function(){a()},a(),r.mesh=function(){if(Array.isArray(n)){i=new m.W({color:o,side:m.q});var e=[];n.forEach((function(t){e.push(new m.Ob(t.x,t.y+t.offset+.005-0,t.z))}));var t=(new m.i).setFromPoints(e);t.computeVertexNormals();var r=new m.U(t,i);return r.forRoof=!0,r}}(),e.add(r.mesh)},Ye=function(e,t,n){var r=this;function i(e){r.floors.forEach((function(t){var n=!1;t.layer.layerIndex===e&&(n=!0),t.setHighlight(n)})),r.edges.forEach((function(t){var n=!1;t.layer.layerIndex===e&&(n=!0),t.setHighlight(n)}))}function o(){r.controller&&r.controller.resetTransformControl(),r.floors.forEach((function(e){e.removeFromScene()})),r.edges.forEach((function(e){e.remove()})),r.roofEdges.forEach((function(e){return e.remove()})),r.roofVertices.forEach((function(e){return e.remove()})),r.roofFaces.forEach((function(e){return e.remove()})),r.floors=[],r.edges=[],r.roofEdges=[],r.roofVertices=[],r.roofFaces=[],r.floorplan.getRooms().forEach((function(t){if(t.layer.visible){var n=new Ae(e,t,t.offset,t.height);n.layer=t.layer,r.floors.push(n),n.addToScene()}})),r.floorplan.wallEdges().forEach((function(t){var n=t.wall.layer;if(n.visible){var i=new Re(e,t,r.controls,t.layerOffset);i.layer=n,r.edges.push(i)}})),r.floorplan.roofEdges().forEach((function(t){var n=new Fe(e,t,t.offset);r.roofEdges.push(n)})),e.roofEdges=r.roofEdges,r.floorplan.roofVertices().forEach((function(t){var n=new He(e,t,t.offset);r.roofVertices.push(n)})),e.roofVertices=r.roofVertices,r.floorplan.roofFaces().forEach((function(t){var n=new Xe(e,t);r.roofFaces.push(n)})),i(t.activeLayerIndex)}this.ground=null,this.compass=null,this.scene=e,this.floorplan=t,this.controls=n,this.floors=[],this.edges=[],this.roofEdges=[],this.roofVertices=[],this.roofFaces=[],t.fireOnUpdatedRooms(o),t.fireOnActiveLayerChanged(i)},Ge=function(e,t,n,r){var i=this,o=this,a={resize:!0,pushHref:!1,spin:!0,spinSpeed:2e-5,clickPan:!0,canMoveFixedItems:!1};for(var s in a)a.hasOwnProperty(s)&&r.hasOwnProperty(s)&&(a[s]=r[s]);var l,c,u,h,d,f=e.scene;this.scene=f,this.element=t,this.ground=null,this.compass=null,this.controls=null,this.floorplan=null;var p,v;Date.now();function g(){var t=e.floorplan.orientation,n=w.a.Configuration.getBooleanValue(w.a.configCompassVisible),r=-t/180*Math.PI;o.compass.rotation.y=r,o.compass.visible=n}this.roof,this.heightMargin=0,this.widthMargin=0,this.elementHeight=0,this.elementWidth=0,this.itemSelectedCallbacks=[],this.roofVertexSelectedCallbacks=[],this.roofEditorModeChangedCallbacks=[],this.wallClicked=[],this.floorClicked=[],this.nothingClicked=[],this.outlineManager=null;function y(){requestAnimationFrame(y),u.clear(),u.render(f.scene,c),Date.now()}this.dataUrl=function(){return u.domElement.toDataURL("image/png")},this.stopSpin=function(){return!0},this.options=function(){return a},this.getModel=function(){return e},this.getScene=function(){return f},this.getController=function(){return h},this.getCamera=function(){return c},this.needsUpdate=function(){},this.rotatePressed=function(){h.rotatePressed()},this.rotateReleased=function(){h.rotateReleased()},this.setCursorStyle=function(e){l.style.cursor=e},this.updateWindowSize=function(){var e=o.element.getBoundingClientRect();o.heightMargin=e.top,o.widthMargin=e.left,o.elementWidth=e.width,o.elementHeight=e.height,c.aspect=o.elementWidth/o.elementHeight,c.updateProjectionMatrix(),u.setSize(o.elementWidth,o.elementHeight)},this.centerCamera=function(t){var n=e.floorplan.getCenter();n.y=1.5,o.controls.target=n;var r=2*e.floorplan.getSize().z,i=n.clone().add(new m.Ob(0,r/3,r));t&&c.position.copy(i),o.controls.update()},this.projectVector=function(e,t){t=t||!1;var n=o.elementWidth/2,r=o.elementHeight/2,i=new m.Ob;i.copy(e),i.project(c);var a=new m.Nb;return a.x=i.x*n+n,a.y=-i.y*r+r,t||(a.x+=o.widthMargin,a.y+=o.heightMargin),a},this.setRoofEditorMode=function(e){return v.setMode(e)},this.setRoofEditorEnabled=function(e){return v.setEnabled(e)},this.setTransformControlAxis=function(e){var t=h.transformControl;switch(e){case"X":t.showX=!0,t.showY=!1,t.showZ=!1;break;case"Z":t.showX=!1,t.showY=!0,t.showZ=!1;break;case"Y":t.showX=!1,t.showY=!1,t.showZ=!0}},l=o.element,c=new m.jb(45,1,1,1e4),(u=new m.Qb({antialias:!0,preserveDrawingBuffer:!0})).autoClear=!1,u.shadowMap.enabled=!0,u.shadowMapSoft=!0,u.shadowMap.type=m.hb,new Oe(f),o.controls=new je(c,l),function(){var e=new m.lb(1e3,1e3),t=new m.V({color:4222027,side:m.q,transparent:!0,opacity:.4}),n=new m.U(e,t);n.position.y=-.01,n.rotation.x=Math.PI/2,o.ground=n,o.scene.add(o.ground)}(),function(){var e=new m.x,t=new m.U(new m.m(.5,5),new m.W({depthTest:!1,transparent:!0,color:16711680}));t.position.z=-2.5,t.rotation.x=-Math.PI/2,t.renderOrder=1,e.add(t);var n=new m.U(new m.m(.5,5),new m.W({depthTest:!1,transparent:!0,color:255}));n.position.z=2.5,n.rotation.x=Math.PI/2,n.renderOrder=1,e.add(n),e.position.y=-.25,e.scale.y=.1,o.compass=e,o.scene.add(e)}(),g(),p=new Ce(o),v=new _e(o,e.floorplan),i.roof=v,h=new ze(o,e,c,u.domElement,o.controls,p,v),l.appendChild(u.domElement),o.updateWindowSize(),a.resize&&window.addEventListener("resize",o.updateWindowSize),o.centerCamera(),e.floorplan.fireOnUpdatedRooms(o.centerCamera),e.floorplan.fireOnUpdatedRooms(g),new Ve(f,e.floorplan),(d=new Ye(f,e.floorplan,o.controls)).controller=h,o.floorplan=d,y(),o.element.addEventListener("mouseenter",(function(){!0})),o.element.addEventListener("mouseleave",(function(){!1})),o.element.addEventListener("click",(function(){!0})),document.addEventListener(w.a.BP3D_EVENT_HIGHLIGHT_CHANGED,(function(e){var t=e.detail;t&&t.objects&&i.updateOutline(t.objects)})),document.addEventListener(w.a.BP3D_EVENT_CONFIG_CHANGED,(function(e){var t=e.detail;t&&t.hasOwnProperty(w.a.configCompassVisible)&&g()}))},Je=0,qe=1,Ze=2,Ke="#f1f1f1",Qe="#ff0000",$e="#00ff00",et="#000",tt=function(){function e(t,n,r){var i=this;Object(h.a)(this,e),this.handleWindowResize=function(){var e=i.canvas,t=e.parentNode;e.height=t.clientHeight,e.width=t.clientWidth,i.canvasElement.height=t.clientHeight,i.canvasElement.width=t.clientWidth,i.draw()},this.draw=function(){i.context.clearRect(0,0,i.canvasElement.width,i.canvasElement.height),i.drawGrid(),i.drawGridSpacing();var e=i.floorplan.getRooms(i.floorplan.activeLayerIndex),t=i.floorplan.getWalls(i.floorplan.activeLayerIndex),n=i.floorplan.getCorners(i.floorplan.activeLayerIndex),r=[],o=[];e.forEach((function(e){return i.drawRoom(e)})),t.forEach((function(e){var t=i.drawWall(e);r.push.apply(r,Object(v.a)(t.corners)),o.push(t.line)})),n.forEach((function(e){return r.push.apply(r,Object(v.a)(i.drawCorner(e)))})),i.viewmodel.mode===qe&&i.drawTarget(i.viewmodel.targetX,i.viewmodel.targetY,i.viewmodel.lastNode),i.drawRulerData(),r.forEach((function(e){return i.drawCornerAngles(e)})),o.forEach((function(e){var t=e.start,n=e.end;i.drawLine(i.viewmodel.convertX(t.x,t.y),i.viewmodel.convertY(t.y,t.x),i.viewmodel.convertX(n.x,n.y),i.viewmodel.convertY(n.y,n.x),1,"#000")})),i.drawHints()},this.floorplan=t,this.viewmodel=n,this.canvas=r,this.canvasElement=r,this.context=this.canvasElement.getContext("2d");var o=this;window.addEventListener("resize",(function(){o.handleWindowResize()})),this.handleWindowResize(),document.addEventListener(w.a.BP3D_EVENT_CONFIG_CHANGED,(function(e){var t=e.detail;t&&t.hasOwnProperty(w.a.configDimensionVisible)&&i.draw()}))}return Object(d.a)(e,[{key:"drawGridSpacing",value:function(){var e=this.viewmodel.calculateGridSpacing()*this.viewmodel.pixelsPerCm*100;this.viewmodel.gridSpacingChangedCallbacks.forEach((function(t){return t(null,e)}))}},{key:"drawRulerData",value:function(){var e=this;if(w.a.Configuration.getBooleanValue(w.a.configDimensionVisible)){var t=this.floorplan.calculateRulerData();t.x.forEach((function(t){e.drawRuler(t.start,t.end,t.length,"x",30)})),t.y.forEach((function(t){e.drawRuler(t.start,t.end,t.length,"y",30)}))}}},{key:"drawRuler",value:function(e,t,n,r,i){var o=this;if(!(n<.01)){e={x:this.viewmodel.convertX(e.x,e.y),y:this.viewmodel.convertY(e.y,e.x)},t={x:this.viewmodel.convertX(t.x,t.y),y:this.viewmodel.convertY(t.y,t.x)};var a=Object(g.a)({},e),s=Object(g.a)({},t);"x"===r?(a.y=i,s.y=i):"y"===r&&(a.x=i,s.x=i),[{p:[a,s],dashed:!1},{p:[a,e],dashed:!0},{p:[t,s],dashed:!0}].forEach((function(e){var t="x"===r?"#ff000088":"#0000ff88";o.drawLine(e.p[0].x,e.p[0].y,e.p[1].x,e.p[1].y,1,t,e.dashed)})),function(){var e=15,t="x"===r?"#f00":"#00f",n=[];n.push(a),n.push({x:"x"===r?a.x+e:a.x-3.75,y:"x"===r?a.y-3.75:a.y+e}),n.push({x:"x"===r?a.x+e:a.x+3.75,y:"x"===r?a.y+3.75:a.y+e});var i=[];i.push(s),i.push({x:"x"===r?s.x-e:s.x-3.75,y:"x"===r?s.y-3.75:s.y-e}),i.push({x:"x"===r?s.x-e:s.x+3.75,y:"x"===r?s.y+3.75:s.y-e}),[n,i].forEach((function(e){var n=e.map((function(e){return e.x})),r=e.map((function(e){return e.y}));o.drawPolygon(n,r,!0,t,!0,t,1)}))}(),this.drawTextLabel({x:(a.x+s.x)/2+("y"===r?-10:0),y:(a.y+s.y)/2+("x"===r?-10:0)},w.a.Dimensioning.cmToMeasure(100*n),16,"y"===r?-Math.PI/2:0,!0)}}},{key:"drawItem",value:function(e){var t=this;e.getSnapPoints().forEach((function(n){!function(n){var r=[],i=[];n.forEach((function(e){r.push(t.viewmodel.convertX(e.x,e.y)),i.push(t.viewmodel.convertY(e.y,e.x))})),t.drawPolygon(r,i,!0,e===t.viewmodel.activeItem?"#0000ff22":"#33333311",!0,"#444",1)}(n)}))}},{key:"drawTextLabel",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:12,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.context.textBaseline="middle",this.context.textAlign="center",this.context.lineWidth=1;var o=e.needConvert?this.viewmodel.convertX(e.x,e.y):e.x,a=e.needConvert?this.viewmodel.convertY(e.y,e.x):e.y;r?(this.context.save(),this.context.translate(o,a),this.context.rotate(r),i&&(this.context.font="700 ".concat(n,"px Arial"),this.context.fillStyle="#fff",this.context.fillText(t,0,0)),this.context.font="normal ".concat(n,"px Arial"),this.context.fillStyle=et,this.context.fillText(t,0,0),this.context.restore()):(i&&(this.context.font="700 ".concat(n,"px Arial"),this.context.fillStyle="#fff",this.context.fillText(t,o,a)),this.context.font="normal ".concat(n,"px Arial"),this.context.fillStyle=et,this.context.fillText(t,o,a))}},{key:"drawWallLabels",value:function(e){var t=e.start.x,n=e.start.y,r=e.end.x,i=e.end.y,o={x:(t+r)/2,y:(n+i)/2},a=Math.sqrt(Math.pow(t-r,2)+Math.pow(n-i,2));this.drawEdgeLabel(o,a)}},{key:"drawWall",value:function(e){var t=e===this.viewmodel.activeWall||e===this.viewmodel.selectedWall;e.edge&&this.drawEdge(e.edge,t,e.isOutsideWall);var n=e.start,r=e.end,i=[];if(e===this.viewmodel.activeWall)try{e.start.updateAngles(),e.end.updateAngles(),i.push(e.start,e.end)}catch(o){}return this.drawWallLabels(e),{corners:i,line:{start:n,end:r}}}},{key:"drawWallItem",value:function(e,t){var n=this,r=e.getCorners(),i=[],o=[];r.forEach((function(e){i.push(n.viewmodel.convertX(e.x,e.y)),o.push(n.viewmodel.convertY(e.y,e.x))})),this.drawPolygon(i,o,!0,"#fff",!0,"#888",1)}},{key:"drawEdgeLabel",value:function(e,t){(t*=100)<60||(this.context.font="normal 12px Arial",this.context.fillStyle="#000000",this.context.textBaseline="middle",this.context.textAlign="center",this.context.strokeStyle="#ffffff",this.context.lineWidth=4,this.context.strokeText(w.a.Dimensioning.cmToMeasure(t),this.viewmodel.convertX(e.x,e.y),this.viewmodel.convertY(e.y,e.x)),this.context.fillText(w.a.Dimensioning.cmToMeasure(t),this.viewmodel.convertX(e.x,e.y),this.viewmodel.convertY(e.y,e.x)))}},{key:"drawEdge",value:function(e,t,n){var r=n?"#ba8c00":"#888888";t&&this.viewmodel.mode===Ze?r=Qe:t&&(r=n?"#ffff00":"#008cba");var i=e.corners(),o=this;this.drawPolygon(w.a.Utils.map(i,(function(e){return o.viewmodel.convertX(e.x,e.y)})),w.a.Utils.map(i,(function(e){return o.viewmodel.convertY(e.y,e.x)})),!0,r,!0,r,1)}},{key:"drawRoom",value:function(e){var t=this,n=e===this.viewmodel.activeRoom?"#ffe1e1":"#f9f9f9";this.drawPolygon(w.a.Utils.map(e.corners,(function(e){return t.viewmodel.convertX(e.x,e.y)})),w.a.Utils.map(e.corners,(function(e){return t.viewmodel.convertY(e.y,e.x)})),!0,n),e.updateArea();var r=e.areaCenter,i={x:this.viewmodel.convertX(r.x,r.y),y:this.viewmodel.convertY(r.y,r.x)},o=JSON.parse(JSON.stringify(i));o.y-=10;var a=JSON.parse(JSON.stringify(i));a.y+=10,o.needConvert=a.needConvert=!1;var s=w.a.Dimensioning.cmToMeasure(1e4*e.area,2)+String.fromCharCode(178);this.drawTextLabel(o,e.name,18),this.drawTextLabel(a,s,18)}},{key:"drawCorner",value:function(e){var t=e===this.viewmodel.activeCorner||e===this.viewmodel.selectedCorner,n=e===this.viewmodel.lastNode&&this.viewmodel.mode===qe,r="#cccccc";t&&this.viewmodel.mode===Ze?r=Qe:t&&(r=$e),this.drawCircle(this.viewmodel.convertX(e.x,e.y),this.viewmodel.convertY(e.y,e.x),t?7:0,r);var i=[];return t?(this.drawTextLabel({x:e.x,y:e.y+.5,needConvert:!0},"".concat(w.a.Dimensioning.cmToMeasure(100*e.x),", ").concat(w.a.Dimensioning.cmToMeasure(100*-e.y))),e.updateAngles(),i.push(e),e.adjacentCorners().forEach((function(e){return i.push(e)}))):n&&(e.updateAngles({x:this.viewmodel.targetX,y:this.viewmodel.targetY}),i.push(e)),i}},{key:"drawCornerAngles",value:function(e){for(var t=this.viewmodel.convertX(e.x,e.y),n=this.viewmodel.convertY(e.y,e.x),r=0;r<e.angles.length;r++){var i=e.angleDirections[r],o=i.clone().multiplyScalar(3).add(e.getLocation()),a=e.startAngles[r]*Math.PI/180,s=e.endAngles[r]*Math.PI/180,l=e.angles[r],c=2*i.length()*50;if(0!=l){var u=Math.abs(e.startAngles[r]-e.endAngles[r])>180;if(this.context.strokeStyle="#000000",this.context.lineWidth=4,this.context.beginPath(),90==l){var h=i.clone().multiplyScalar(2).add(e.getLocation()),d={x:this.viewmodel.convertX(h.x,h.y),y:this.viewmodel.convertY(h.y,h.x)},f=e.getLocation().clone(),p=f.clone().rotateAround(h,Math.PI/4);p=p.sub(p.clone().sub(h).multiplyScalar(1-1/Math.sqrt(2)));var v={x:this.viewmodel.convertX(p.x,p.y),y:this.viewmodel.convertY(p.y,p.x)},g=f.clone().rotateAround(h,-Math.PI/4);g=g.sub(g.clone().sub(h).multiplyScalar(1-1/Math.sqrt(2)));var y={x:this.viewmodel.convertX(g.x,g.y),y:this.viewmodel.convertY(g.y,g.x)};this.drawLine(v.x,v.y,d.x,d.y,this.context.strokeWidth,"#333"),this.drawLine(d.x,d.y,y.x,y.y,this.context.strokeWidth,"#333")}else{var m=Math.min(a,s)+0,b=Math.max(a,s+0);this.context.arc(t,n,c,m,b,u)}this.context.stroke(),o.needConvert=!0,this.drawTextLabel(o,"".concat(l,"\xb0"))}}}},{key:"drawTarget",value:function(e,t,n){this.drawCircle(this.viewmodel.convertX(e,t),this.viewmodel.convertY(t,e),7,$e),this.drawTextLabel({x:e,y:t+.5,needConvert:!0},"".concat(w.a.Dimensioning.cmToMeasure(100*e),", ").concat(w.a.Dimensioning.cmToMeasure(100*-t))),this.viewmodel.lastNode&&this.drawLine(this.viewmodel.convertX(n.x,n.y),this.viewmodel.convertY(n.y,n.x),this.viewmodel.convertX(e,t),this.viewmodel.convertY(t,e),7,"#008cba")}},{key:"drawLine",value:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"#000",a=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this.context.beginPath(),this.context.setLineDash([]),a&&this.context.setLineDash([3,6]),this.context.moveTo(e,t),this.context.lineTo(n,r),this.context.lineWidth=i,this.context.strokeStyle=o,this.context.stroke()}},{key:"drawPolygon",value:function(e,t,n,r,i,o,a){n=n||!1,i=i||!1,this.context.beginPath(),this.context.moveTo(e[0],t[0]);for(var s=1;s<e.length;s++)this.context.lineTo(e[s],t[s]);this.context.closePath(),n&&(this.context.fillStyle=r,this.context.fill()),i&&(this.context.lineWidth=a,this.context.strokeStyle=o,this.context.stroke())}},{key:"drawCircle",value:function(e,t,n,r){this.context.beginPath(),this.context.arc(e,t,n,0,2*Math.PI,!1),this.context.fillStyle=r,this.context.fill()}},{key:"drawGrid",value:function(){for(var e=this.viewmodel,t=e.gridX,n=e.gridY,r=this.canvasElement,i=r.width,o=(r.height,0);o<t.length;o++){var a=t[o],s=a.start,l=a.end,c=o===Math.floor(t.length/2);c&&this.drawTextLabel({x:this.viewmodel.convertX(s.x,s.y)+20,y:20},"Y",20),this.drawLine(this.viewmodel.convertX(s.x,s.y),this.viewmodel.convertY(s.y,s.x),this.viewmodel.convertX(l.x,l.y),this.viewmodel.convertY(l.y,l.x),c?3:1,Ke)}for(var u=0;u<n.length;u++){var h=n[u],d=h.start,f=h.end,p=u===Math.floor(n.length/2);p&&this.drawTextLabel({x:i-20,y:this.viewmodel.convertY(d.y,d.x)+20},"X",20),this.drawLine(this.viewmodel.convertX(d.x,d.y),this.viewmodel.convertY(d.y,d.x),this.viewmodel.convertX(f.x,f.y),this.viewmodel.convertY(f.y,f.x),p?3:1,Ke)}}},{key:"drawHints",value:function(){var e=this.canvasElement.height,t=this.viewmodel,n=t.activeCorner,r=t.activeWall,i=t.activeRoom;this.context.textBaseline="middle",this.context.textAlign="left",this.context.lineWidth=1,this.context.font="normal 16px Arial",this.context.fillStyle="#333";var o="";n?o="Hint: You can click corner and edit position directly.":r?o="Hint: You can click wall and edit properties directly.":i&&(o="Hint: You can click room and edit name directly."),this.context.fillText(o,30,e-30)}}]),e}(),nt=w.a.Configuration.getNumericValue(w.a.configSnapTolernance),rt=30.48,it=function(){function e(t,n,r){var i=this;Object(h.a)(this,e),this.parent=null,this.mode=0,this.activeWall=null,this.selectedWall=null,this.wallMoveDirection={x:0,y:0},this.activeCorner=null,this.selectedCorner=null,this.activeRoom=null,this.selectedRoom=null,this.originX=0,this.originY=0,this.orientation=0,this.targetX=0,this.targetY=0,this.lastNode=null,this.modeResetCallbacks=[],this.orientationChangedCallbacks=[],this.mouseDown=!1,this.mouseMoved=!1,this.mouseButton=0,this.mouseX=0,this.mouseY=0,this.rawMouseX=0,this.rawMouseY=0,this.lastX=0,this.lastY=0,this.isDragging=!1,this.itemSelectedCallbacks=[],this.wallSelectedCallbacks=[],this.roomSelectedCallbacks=[],this.cornerSelectedCallbacks=[],this.nothingSelectedCallbacks=[],this.gridSpacingChangedCallbacks=[],this.gridX=[],this.gridY=[],this.staticGridSpacing=null,this.getSnapByWalls=function(e){var t=e?e.x:i.mouseX,n=e?e.y:i.mouseY,r=null;try{r=(r=i.floorplan.getWalls(i.floorplan.activeLayerIndex).map((function(e){return e.closestPoint(t,n)})).sort((function(e,t){return e.distance-t.distance}))[0]).distance>=1*nt?null:r.point}catch(o){r=null}return r},this.getSnapByGrids=function(e){var t=null,n=e?e.x:i.mouseX,r=e?e.y:i.mouseY;try{var o=i.gridX.map((function(e){return e.start.x})).sort((function(e,t){return Math.abs(e-n)-Math.abs(t-n)}))[0],a=i.gridY.map((function(e){return e.start.y})).sort((function(e,t){return Math.abs(e-r)-Math.abs(t-r)}))[0];Math.abs(Math.pow(o-n,2)+Math.pow(a-r,2))<nt&&(t={x:o,y:a})}catch(s){t=null}return t},this.getSnapPoint=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0;if(w.a.Configuration.getBooleanValue(w.a.configSnapMode)){n=n||{x:i.mouseX,y:i.mouseY};var r=e?i.getSnapByWalls(n):null,o=t?i.getSnapByGrids(n):null,a=[];r&&a.push(r),o&&a.push(o);var s=a.sort((function(e,t){return Math.sqrt(Math.pow(n.x-e.x,2)+Math.pow(n.y-e.y,2))-Math.sqrt(Math.pow(n.x-t.x,2)+Math.pow(n.y-t.y,2))}));return s.length?s[0]:null}},this.getCornerSnapPoint=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=i.getSnapPoint(!1,!0,{x:t,y:n}),a=e.getSnapByAxis(nt,r,{x:t,y:n}),s=e.getSnapByAngles(2,t,n),l=[];o&&l.push(o),a&&l.push(a),s&&l.push(s);var c=l.sort((function(e,r){return Math.sqrt(Math.pow(e.x-t,2)+Math.pow(e.y-n,2))-Math.sqrt(Math.pow(r.x-t,2)+Math.pow(r.y-n,2))}));return c.length?c[0]:null},this.parent=r,this.zoomLevel=100,this.scale=50,this.floorplan=n,this.canvasElement=t,this.view=new tt(this.floorplan,this,t);this.cmPerPixel=2.032,this.pixelsPerCm=1/this.cmPerPixel,this.wallWidth=10*this.pixelsPerCm,this.setMode(Je);var o=this;this.updateGrid(),this.canvasElement.addEventListener("wheel",(function(e){return o.mouseWheel(e)})),this.canvasElement.addEventListener("mousedown",(function(e){o.mousedown(e)})),this.canvasElement.addEventListener("mousemove",(function(e){o.mousemove(e)})),this.canvasElement.addEventListener("mouseup",(function(e){o.mouseup(e)})),this.canvasElement.addEventListener("mouseleave",(function(){o.mouseleave()})),document.addEventListener(w.a.BP3D_EVENT_CONFIG_CHANGED,(function(e){var t=e.detail;t&&t.dimUnit&&i.view.draw()})),document.addEventListener("keyup",(function(e){"Escape"===e.key&&o.cancelDraw()})),n.roomLoadedCallbacks.push((function(){o.reset()}))}return Object(d.a)(e,[{key:"calculateGridSpacing",value:function(){if(this.staticGridSpacing)return this.staticGridSpacing;var e=100,t=this.pixelsPerCm;return t<.15?e=400:t<.3?e=200:t<.5?e=100:t<1?e=50:t<2?e=25:t<4&&(e=12.5),this.gridSpacingChangedCallbacks.forEach((function(t){return t(e/100)})),e/100}},{key:"setGridSpacing",value:function(e){this.staticGridSpacing=e,e&&this.gridSpacingChangedCallbacks.forEach((function(t){return t(e)})),this.updateGrid(),this.view.draw()}},{key:"updateGrid",value:function(){this.gridX=[],this.gridY=[];for(var e=this.calculateGridSpacing(),t=100,n=-100;n<=t;n++){var r={x:e*n,y:-100*e},i={x:e*n,y:t*e};this.gridX.push({start:r,end:i})}for(var o=-100;o<=t;o++){var a={x:-100*e,y:e*o},s={x:t*e,y:e*o};this.gridY.push({start:a,end:s})}}},{key:"cancelDraw",value:function(){var e=this.floorplan.getActiveLayer();this.lastNode=null,e&&e.reduceWalls()}},{key:"updateTarget",value:function(){if(this.mode===qe&&this.lastNode){var e=this.getSnapPoint();Math.sqrt(Math.pow(this.mouseX-this.lastNode.x,2)+Math.pow(this.mouseY-this.lastNode.y,2))<nt?(this.targetX=this.lastNode.x,this.targetY=this.lastNode.y):(this.targetX=e?e.x:this.mouseX,this.targetY=e?e.y:this.mouseY)}else{var t=this.getSnapPoint();this.targetX=t?t.x:this.mouseX,this.targetY=t?t.y:this.mouseY}this.view.draw()}},{key:"zoomIn",value:function(){var e=this.scale;e+=2,this.scale=Math.min(1e3,e);var t=30*this.scale/100;this.cmPerPixel=rt/t,this.pixelsPerCm=1/this.cmPerPixel,this.updateGrid(),this.view.draw()}},{key:"zoomOut",value:function(){var e=this.scale;e-=2,this.scale=Math.max(10,e);var t=30*this.scale/100;this.cmPerPixel=rt/t,this.pixelsPerCm=1/this.cmPerPixel,this.updateGrid(),this.view.draw()}},{key:"resetZoom",value:function(){this.scale=50;var e=30*this.scale/100;this.cmPerPixel=rt/e,this.pixelsPerCm=1/this.cmPerPixel,this.updateGrid(),this.view.draw()}},{key:"mouseWheel",value:function(e){var t=this.scale;e.deltaY>0?(t-=2,this.scale=Math.max(10,t)):(t+=2,this.scale=Math.min(1e3,t));var n=30*this.scale/100;this.cmPerPixel=rt/n,this.pixelsPerCm=1/this.cmPerPixel,this.updateGrid(),this.view.draw()}},{key:"mousedown",value:function(e){this.mouseDown=!0,this.mouseMoved=!1,this.lastX=this.rawMouseX,this.lastY=this.rawMouseY,this.mouseButton=e.buttons,this.view.draw()}},{key:"mousemove",value:function(e){this.mouseMoved=!0,this.rawMouseX=e.clientX,this.rawMouseY=e.clientY,this.mouseX=(e.clientX-this.canvasElement.getBoundingClientRect().left)*this.cmPerPixel+this.originX*this.cmPerPixel,this.mouseY=(e.clientY-this.canvasElement.getBoundingClientRect().top)*this.cmPerPixel+this.originY*this.cmPerPixel,this.mouseX/=this.zoomLevel,this.mouseY/=this.zoomLevel;var t=new m.Nb(this.mouseX,this.mouseY);if(t.rotateAround(new m.Nb,0),this.mouseX=t.x,this.mouseY=t.y,(this.mode===qe||this.mode===Je&&this.mouseDown)&&this.updateTarget(),this.mode!==qe&&!this.mouseDown){var n=this.floorplan.overlappedCorner(this.mouseX,this.mouseY,0,this.selectedWall),r=this.floorplan.overlappedWall(this.mouseX,this.mouseY),i=this.floorplan.overlappedRoom(this.mouseX,this.mouseY),o=!1;n!==this.activeCorner&&(this.activeCorner=n,o=!0),r!==this.activeWall&&(this.activeWall=r,o=!0),i!==this.activeRoom&&(this.activeRoom=i,o=!0),o&&this.view.draw()}if(this.mouseDown&&!this.activeCorner&&!this.activeWall){if(e.ctrlKey){var a=this.orientation+Math.round(this.lastX-this.rawMouseX);a<0&&(a+=360),a%=360,this.setOrientation(a)}else this.originX+=this.lastX-this.rawMouseX,this.originY+=this.lastY-this.rawMouseY;this.lastX=this.rawMouseX,this.lastY=this.rawMouseY,this.view.draw()}if(this.mode===Je&&this.mouseDown){if(this.activeCorner){if(this.selectedWall){var s=[].concat(Object(v.a)(this.activeCorner.wallStarts),Object(v.a)(this.activeCorner.wallEnds));s.length>1&&s.includes(this.selectedWall)&&(this.activeCorner=this.selectedWall.detachCorner(this.activeCorner))}var l=this.getCornerSnapPoint(this.activeCorner,this.mouseX,this.mouseY);this.activeCorner.move(l?l.x:this.mouseX,l?l.y:this.mouseY,w.a.Configuration.getBooleanValue(w.a.configSnapMode),!1),this.isDragging=!0}else if(this.activeWall){var c=(this.rawMouseX-this.lastX)*this.cmPerPixel/this.zoomLevel,u=(this.rawMouseY-this.lastY)*this.cmPerPixel/this.zoomLevel;0===this.wallMoveDirection.x&&0===this.wallMoveDirection.y&&(Math.abs(c)>Math.abs(u)?this.wallMoveDirection.x=1:this.wallMoveDirection.y=1),c*=this.wallMoveDirection.x,u*=this.wallMoveDirection.y,this.activeWall.relativeMove(c,u,!0,!1),this.isDragging=!0}this.view.draw()}this.lastX=this.rawMouseX,this.lastY=this.rawMouseY}},{key:"mouseup",value:function(e){var t=this;this.mouseDown=!1;var n=this.floorplan.getActiveLayer();if(n){if(this.mode===qe&&!this.mouseMoved){if(1===this.mouseButton){var r=this.floorplan.newCorner(this.targetX,this.targetY);if(n&&n.addCorner(r),null!=this.lastNode){var i=this.floorplan.newWall(this.lastNode,r,n?n.height:0);n.addWall(i)}r.mergeWithIntersected()&&this.lastNode,this.lastNode=r}else this.cancelDraw();this.floorplan.update(!1)}this.isDragging&&(this.activeCorner&&(console.log("corner"),this.activeCorner.mergeWithIntersected(),n.reduceWalls()),this.floorplan.update(!1),this.isDragging=!1),this.mode===Ze&&(this.activeCorner?this.activeCorner.removeAll():this.activeWall&&this.activeWall.remove(),n.reduceWalls(),this.floorplan.update(!1)),this.mouseMoved||(this.selectedCorner=this.activeCorner,this.selectedWall=this.activeWall,this.selectedRoom=this.activeRoom,this.selectedCorner?this.cornerSelectedCallbacks.forEach((function(e){return e(t.selectedCorner)})):this.selectedWall?this.wallSelectedCallbacks.forEach((function(e){return e(t.selectedWall)})):this.selectedRoom?this.roomSelectedCallbacks.forEach((function(e){return e(t.selectedRoom)})):this.nothingSelectedCallbacks.forEach((function(e){return e()}))),this.wallMoveDirection={x:0,y:0},this.view.draw()}}},{key:"mouseleave",value:function(){this.mouseDown=!1}},{key:"reset",value:function(){this.resizeView(),this.setMode(Je),this.resetOrigin(),this.view.draw()}},{key:"resizeView",value:function(){this.view.handleWindowResize()}},{key:"setMode",value:function(e){this.lastNode=null,this.mode=e,this.modeResetCallbacks.forEach((function(t){return"function"===typeof t&&t(e)})),this.selectedCorner=null,this.selectedWall=null,this.selectedRoom=null,this.updateTarget()}},{key:"setOrientation",value:function(e){var t=this;this.orientation=e,this.floorplan.orientation=e,this.floorplan.update(),this.view.draw(),this.orientationChangedCallbacks.forEach((function(e){return e(t.orientation)}))}},{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e&&this.floorplan.update(!1),this.view.draw()}},{key:"resetOrigin",value:function(){var e=this.canvasElement.parentNode,t=e.clientHeight,n=e.clientWidth/2,r=t/2,i=this.floorplan.getCenter();this.originX=i.x*this.zoomLevel*this.pixelsPerCm-n,this.originY=i.z*this.zoomLevel*this.pixelsPerCm-r}},{key:"convertX",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0,r=new m.Nb(e,t);r.rotateAround(new m.Nb,n);var i=(r.x*this.zoomLevel-this.originX*this.cmPerPixel)*this.pixelsPerCm;return i}},{key:"convertY",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0,r=new m.Nb(t,e);r.rotateAround(new m.Nb,n);var i=(r.y*this.zoomLevel-this.originY*this.cmPerPixel)*this.pixelsPerCm;return i}}]),e}(),ot=function e(t){Object(h.a)(this,e),this.changeUnit=function(e){switch(e){case"cm":w.a.Configuration.setValue("dimUnit",C.dimCentiMeter);break;case"in":w.a.Configuration.setValue("dimUnit",C.dimInch);break;case"ft":w.a.Configuration.setValue("dimUnit",C.dimFeet);break;case"m":w.a.Configuration.setValue("dimUnit",C.dimMeter)}},this.setShellMode=function(e){return w.a.Configuration.setValue(w.a.configShellMode,e)},this.setSceneLocked=function(e){return w.a.Configuration.setValue(w.a.configSceneLocked,e)},this.setSnap=function(e){return w.a.Configuration.setValue(w.a.configSnapMode,e)},this.setDimensionVisible=function(e){return w.a.Configuration.setValue(w.a.configDimensionVisible,e)},this.setCompassVisible=function(e){return w.a.Configuration.setValue(w.a.configCompassVisible,e)},this.toggleXRayMode=function(){var e=w.a.Configuration.getBooleanValue(w.a.configXRayMode);w.a.Configuration.setValue(w.a.configXRayMode,!e)},this.model=new ke(t.textureDir),this.three=new Ge(this.model,t.threeElement,t.threeCanvasElement,{}),this.floorplanner=new it(t.floorplannerElement,this.model.floorplan,this)},at={layers:[],roof:{vertices:[],edges:[],faces:[]},items:[]};at.layers[99]={offset:-2.5,height:2.5,floorplan:{corners:{"f978a5e3-9e0e-eba7-173d-eb0b071e838e":{x:-9,y:6},"da786c08-d76a-a944-8e7b-096b752da9ed":{x:9,y:6},"4e7865cb-54c0-0681-28bf-bddcc7bdb571":{x:9,y:-6},"7178f128-ae80-3d58-9bd2-711c6ce6cdf2":{x:-9,y:-6}},walls:[{corner1:"7178f128-ae80-3d58-9bd2-711c6ce6cdf2",corner2:"f978a5e3-9e0e-eba7-173d-eb0b071e838e",thicknessDirection:1,interiorTexture:{url:"Blueprint3D-assets/rooms/textures/blank.png",stretch:!0,scale:0},exteriorTexture:{url:"Blueprint3D-assets/rooms/textures/blank.png",stretch:!0,scale:0}},{corner1:"f978a5e3-9e0e-eba7-173d-eb0b071e838e",corner2:"da786c08-d76a-a944-8e7b-096b752da9ed",thicknessDirection:1,interiorTexture:{url:"Blueprint3D-assets/rooms/textures/blank.png",stretch:!0,scale:0},exteriorTexture:{url:"Blueprint3D-assets/rooms/textures/blank.png",stretch:!0,scale:0}},{corner1:"da786c08-d76a-a944-8e7b-096b752da9ed",corner2:"4e7865cb-54c0-0681-28bf-bddcc7bdb571",thicknessDirection:1,interiorTexture:{url:"Blueprint3D-assets/rooms/textures/blank.png",stretch:!0,scale:0},exteriorTexture:{url:"Blueprint3D-assets/rooms/textures/blank.png",stretch:!0,scale:0}},{corner1:"4e7865cb-54c0-0681-28bf-bddcc7bdb571",corner2:"7178f128-ae80-3d58-9bd2-711c6ce6cdf2",thicknessDirection:1,interiorTexture:{url:"Blueprint3D-assets/rooms/textures/blank.png",stretch:!0,scale:0},exteriorTexture:{url:"Blueprint3D-assets/rooms/textures/blank.png",stretch:!0,scale:0}}],wallTextures:[],floorTextures:{},newFloorTextures:{}},items:[]},at.layers[100]={offset:0,height:2.5,floorplan:{corners:{"f90da5e3-9e0e-eba7-173d-eb0b071e838e":{x:-9,y:6},"da026c08-d76a-a944-8e7b-096b752da9ed":{x:9,y:6},"4e3d65cb-54c0-0681-28bf-bddcc7bdb571":{x:9,y:-6},"71d4f128-ae80-3d58-9bd2-711c6ce6cdf2":{x:-9,y:-6}},walls:[{corner1:"71d4f128-ae80-3d58-9bd2-711c6ce6cdf2",corner2:"f90da5e3-9e0e-eba7-173d-eb0b071e838e",thicknessDirection:1,interiorTexture:{url:"Blueprint3D-assets/rooms/textures/blank.png",stretch:!0,scale:0},exteriorTexture:{url:"Blueprint3D-assets/rooms/textures/blank.png",stretch:!0,scale:0}},{corner1:"f90da5e3-9e0e-eba7-173d-eb0b071e838e",corner2:"da026c08-d76a-a944-8e7b-096b752da9ed",thicknessDirection:1,interiorTexture:{url:"Blueprint3D-assets/rooms/textures/blank.png",stretch:!0,scale:0},exteriorTexture:{url:"Blueprint3D-assets/rooms/textures/blank.png",stretch:!0,scale:0}},{corner1:"da026c08-d76a-a944-8e7b-096b752da9ed",corner2:"4e3d65cb-54c0-0681-28bf-bddcc7bdb571",thicknessDirection:1,interiorTexture:{url:"Blueprint3D-assets/rooms/textures/blank.png",stretch:!0,scale:0},exteriorTexture:{url:"Blueprint3D-assets/rooms/textures/blank.png",stretch:!0,scale:0}},{corner1:"4e3d65cb-54c0-0681-28bf-bddcc7bdb571",corner2:"71d4f128-ae80-3d58-9bd2-711c6ce6cdf2",thicknessDirection:1,interiorTexture:{url:"Blueprint3D-assets/rooms/textures/blank.png",stretch:!0,scale:0},exteriorTexture:{url:"Blueprint3D-assets/rooms/textures/blank.png",stretch:!0,scale:0}}],wallTextures:[],floorTextures:{},newFloorTextures:{}},items:[]},at.layers[101]={offset:2.5,height:2.5,floorplan:{corners:{"a90da5e3-9e0e-eba7-173d-eb0b071e838e":{x:-9,y:6},"aa026c08-d76a-a944-8e7b-096b752da9ed":{x:9,y:6},"ae3d65cb-54c0-0681-28bf-bddcc7bdb571":{x:9,y:-6},"a1d4f128-ae80-3d58-9bd2-711c6ce6cdf2":{x:-9,y:-6}},walls:[{corner1:"a1d4f128-ae80-3d58-9bd2-711c6ce6cdf2",corner2:"a90da5e3-9e0e-eba7-173d-eb0b071e838e",thicknessDirection:1,interiorTexture:{url:"Blueprint3D-assets/rooms/textures/blank.png",stretch:!0,scale:0},exteriorTexture:{url:"Blueprint3D-assets/rooms/textures/blank.png",stretch:!0,scale:0}},{corner1:"a90da5e3-9e0e-eba7-173d-eb0b071e838e",corner2:"aa026c08-d76a-a944-8e7b-096b752da9ed",thicknessDirection:1,interiorTexture:{url:"Blueprint3D-assets/rooms/textures/blank.png",stretch:!0,scale:0},exteriorTexture:{url:"Blueprint3D-assets/rooms/textures/blank.png",stretch:!0,scale:0}},{corner1:"aa026c08-d76a-a944-8e7b-096b752da9ed",corner2:"ae3d65cb-54c0-0681-28bf-bddcc7bdb571",thicknessDirection:1,interiorTexture:{url:"Blueprint3D-assets/rooms/textures/blank.png",stretch:!0,scale:0},exteriorTexture:{url:"Blueprint3D-assets/rooms/textures/blank.png",stretch:!0,scale:0}},{corner1:"ae3d65cb-54c0-0681-28bf-bddcc7bdb571",corner2:"a1d4f128-ae80-3d58-9bd2-711c6ce6cdf2",thicknessDirection:1,interiorTexture:{url:"Blueprint3D-assets/rooms/textures/blank.png",stretch:!0,scale:0},exteriorTexture:{url:"Blueprint3D-assets/rooms/textures/blank.png",stretch:!0,scale:0}}],wallTextures:[],floorTextures:{},newFloorTextures:{}},items:[]};n(48);var st=function(e){Object(f.a)(n,e);var t=Object(p.a)(n);function n(e){var r;return Object(h.a)(this,n),(r=t.call(this,e)).initializeBP3D=function(){var e={floorplannerElement:r.elFloorPlannerElement,threeElement:r.elThreeElemContainer,textureDir:"models/textures/",widget:!1},t=new ot(e);t.model.floorplan.layerUpdatedCallbacks.push(r.handlelayersUpdated),t.three.itemSelectedCallbacks.push(r.handleItemSelected),t.three.roofVertexSelectedCallbacks.push(r.handleRoofVertexSelected),t.three.roofEditorModeChangedCallbacks.push(r.props.roofEditorModeChanged),t.three.wallClicked.push(r.handleWallClicked),t.three.floorClicked.push(r.handleFloorClicked),t.three.nothingClicked.push(r.props.onNothingClicked),t.floorplanner.modeResetCallbacks.push(r.props.floorPlannerModeChanged),t.floorplanner.orientationChangedCallbacks.push(r.handleFloorPlannerOrientationChanged),t.floorplanner.gridSpacingChangedCallbacks.push((function(e,t){e&&r.setState({gridSpacing:e}),t&&r.setState({gridSpacingInCanvas:t})})),t.floorplanner.wallSelectedCallbacks.push(r.props.onWall2DClicked),t.floorplanner.roomSelectedCallbacks.push(r.props.onRoom2DClicked),t.floorplanner.cornerSelectedCallbacks.push(r.props.onCorner2DClicked),t.floorplanner.nothingSelectedCallbacks.push((function(){r.props.onWall2DClicked(null),r.props.onRoom2DClicked(null),r.props.onCorner2DClicked(null)})),t.model.loadSerialized(r.props.defaultJson?r.props.defaultJson:JSON.stringify(at)),r.bp3d=t},r.componentDidMount=function(){r.initializeBP3D()},r.UNSAFE_componentWillReceiveProps=function(e){e.measureUnit!==r.props.measureUnit&&r.bp3d.changeUnit(e.measureUnit),e.viewMode!==r.props.viewMode&&setTimeout((function(){r.bp3d.model.floorplan.update(),window.dispatchEvent(new Event("resize"))}),10)},r.setJSON=function(e){return r.bp3d.model.loadSerialized(e)},r.getJSON=function(){return r.bp3d.model.exportSerialized()},r.collectMetadata=function(){return r.bp3d.model.collectMetadata()},r.undo=function(){return r.bp3d.model.undo()},r.redo=function(){return r.bp3d.model.redo()},r.takeSnapshot=function(){return r.bp3d.three.dataUrl()},r.regenerateRoof=function(e){return r.bp3d.model.floorplan.regenerateRoof(e)},r.handlelayersUpdated=function(e){return r.props.onLayersUpdated(e)},r.handleItemSelected=function(e){r.setState({selectedItem:e}),r.props.onItemSelected(e)},r.handleWallClicked=function(e){r.props.onWallClicked(e)},r.handleFloorClicked=function(e){r.props.onFloorClicked(e)},r.handleRoofFaceClicked=function(e){r.props.onRoofFaceClicked(e)},r.handleRoofVertexSelected=function(e){return r.props.onRoofVertexSelected(e)},r.handleFloorPlannerOrientationChanged=function(e){return r.setState({plannerOrientation:e})},r.update=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];try{e&&r.bp3d.model.floorplan.update(!1),r.bp3d.floorplanner.update(t)}catch(n){}},r.getDefaultData=function(e){var t={};if(Array.isArray(e.morph)){var n,r=Object(y.a)(e.morph);try{for(r.s();!(n=r.n()).done;){var i=n.value;t[i.index]=(i.min-5)/295}}catch(c){r.e(c)}finally{r.f()}}var o={};if(Array.isArray(e.styles)){var a,s=Object(y.a)(e.styles);try{for(s.s();!(a=s.n()).done;){var l=a.value;o[l.name_in_model]=l.types[0].name_in_model}}catch(c){s.e(c)}finally{s.f()}}return{defaultMorph:t,defaultStyles:o,metadata:Object(g.a)(Object(g.a)({},e),{},{itemName:e.name,modelUrl:e.model,itemType:e.type})}},r.addItem=function(){var e=Object(u.a)(c.a.mark((function e(t){var n,i,o,a,s,l,u=arguments;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=!(u.length>1&&void 0!==u[1])||u[1],e.prev=1,i=r.getDefaultData(t),o=i.defaultMorph,a=i.defaultStyles,s=i.metadata,e.next=5,r.bp3d.model.scene.addItem(t.type,t.model,s,null,null,{styles:a,morph:o,stackable:t.stackable,stackontop:t.stackontop,overlappable:t.overlappable},n);case 5:return l=e.sent,e.abrupt("return",l);case 9:return e.prev=9,e.t0=e.catch(1),e.abrupt("return",null);case 12:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t){return e.apply(this,arguments)}}(),r.setEdgeTexture=function(e,t,n){var i=[],o=e.wall,a=e.isInterior,s=e.isExterior;switch(n){case 0:i.push(o);break;case 1:i=r.bp3d.model.floorplan.getSameLayerWalls(o).map((function(e){return e.edge.isInterior=a,e.edge.isExterior=s,e.edge}));break;case 2:i=r.bp3d.model.floorplan.getSameFaceWalls(o).map((function(e){return e.edge.isInterior=a,e.edge.isExterior=s,e.edge}));break;case 3:i=r.bp3d.model.floorplan.getAllWalls(o).map((function(e){return e.edge.isInterior=a,e.edge.isExterior=s,e.edge}))}i.forEach((function(e){return e.setTexture(t)}))},r.addWindows=function(){var e=Object(u.a)(c.a.mark((function e(t,n,i,o,a,s){var l,u,h,d,f,p,g,b,x,w,k,O,j,C,E,S,M,P,T,_,D,L,I,W,N,z,V,A,R,U,F,B,H,X,Y,G,J,q,Z;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l=i.width,u=i.height,h=o.horizontal,d={state:0,msg:""},n&&i&&o){e.next=7;break}return d.state=1,d.msg="Incorrect Input Data",e.abrupt("return",d);case 7:if(f=[],p=[],g=0,b=0,s){e.next=52;break}if(!Number.isInteger(t)){e.next=25;break}if(!(t<0)){e.next=17;break}return d.state=1,d.msg="Underground layer is invalid",e.abrupt("return",d);case 17:if(x=r.bp3d.model.floorplan.getLayer(t-0+100)){e.next=22;break}return d.state=1,d.msg="No Floor Found",e.abrupt("return",d);case 22:f.push(x),e.next=26;break;case 25:f.push.apply(f,Object(v.a)(r.bp3d.model.floorplan.layers));case 26:w=Object(y.a)(f),e.prev=27,w.s();case 29:if((k=w.n()).done){e.next=42;break}if(j=k.value){e.next=33;break}return e.abrupt("continue",40);case 33:if((C=j.walls.filter((function(e){return e.checkIsOutsideWall()})))&&C.length){e.next=38;break}return d.state=1,d.msg="No Wall Detected",e.abrupt("return",d);case 38:r.removeWindows(j.layerIndex-100),(O=p).push.apply(O,Object(v.a)(C));case 40:e.next=29;break;case 42:e.next=47;break;case 44:e.prev=44,e.t0=e.catch(27),w.e(e.t0);case 47:return e.prev=47,w.f(),e.finish(47);case 50:e.next=66;break;case 52:E=s.wall,S=s.wallMode,e.t1=S,e.next=0===e.t1?56:1===e.t1?58:2===e.t1?60:3===e.t1?62:64;break;case 56:return p.push(E),e.abrupt("break",65);case 58:return p=r.bp3d.model.floorplan.getSameLayerWalls(E).filter((function(e){return e.checkIsOutsideWall()})),e.abrupt("break",65);case 60:return p=r.bp3d.model.floorplan.getSameFaceWalls(E).filter((function(e){return e.checkIsOutsideWall()})),e.abrupt("break",65);case 62:return p=r.bp3d.model.floorplan.getAllWalls(E).filter((function(e){return e.checkIsOutsideWall()})),e.abrupt("break",65);case 64:return e.abrupt("break",65);case 65:p.forEach((function(e){return r.removeWindowByWall(e)}));case 66:if(0!==p.length){e.next=70;break}return d.state=1,d.msg="No wall valid",e.abrupt("return",d);case 70:return e.next=72,r.addItem(n,!1);case 72:M=e.sent,P=0;case 74:if(!(P<p.length)){e.next=99;break}if(T=p[P],!((_=T.layer).layerIndex<100)){e.next=79;break}return e.abrupt("continue",96);case 79:for(D=T.height,L=T.getWallLength()-.05,g+=I=D*L,W=l*u,N=Math.floor(I*a/W),z=Math.floor(L/(l+2*h)),V=Math.min(N,z),A=l,D<=(R=u*(I/(l*u*V))*a)&&(R=D,A=L*a/V),b+=A*R*V,U=_.offset+(D-R)/2,F=T.start,B=T.end,H=100*(A-.005)/2.54,X=100*(R-.03)/2.54,Y=0;Y<V;Y++)G=(Y+.5)/V,J=Math.round(100*(F.x+(B.x-F.x)*G))/100,q=Math.round(100*(F.y+(B.y-F.y)*G))/100,(Z=r.bp3d.model.scene.cloneItem(M))&&(Z.setPosition(new m.Ob(J,U,q)),Z.setMorph(0,(X-5)/295),Z.setMorph(1,(H-5)/295));case 96:P++,e.next=74;break;case 99:return M.remove(),d.state=0,d.msg="".concat(Math.round(b/g*1e4)/100,"% covered."),r.bp3d.model.floorplan.update(!1),r.props.onNothingClicked(),e.abrupt("return",d);case 105:case"end":return e.stop()}}),e,null,[[27,44,47,50]])})));return function(t,n,r,i,o,a){return e.apply(this,arguments)}}(),r.removeWindowByWall=function(e){if(e){var t=[];if(e.items.forEach((function(e){return t.push(e)})),t.length)for(var n=t.length-1;n>=0;n--)t[n].remove();r.bp3d.model.floorplan.update(!1),r.props.onNothingClicked()}},r.removeWindows=function(e,t){var n={};if(t){var i=t.wall,o=[];switch(t.wallMode){case 0:o.push(i);break;case 1:o=r.bp3d.model.floorplan.getSameLayerWalls(i).filter((function(e){return e.checkIsOutsideWall()}));break;case 2:o=r.bp3d.model.floorplan.getSameFaceWalls(i).filter((function(e){return e.checkIsOutsideWall()}));break;case 3:o=r.bp3d.model.floorplan.getAllWalls(i).filter((function(e){return e.checkIsOutsideWall()}))}o.forEach((function(e){return r.removeWindowByWall(e)}))}else{var a=[];if(Number.isInteger(e)){var s=r.bp3d.model.floorplan.getLayer(e-0+100);if(!s)return n.state=1,n.msg="No Floor Found",n;a.push(s)}else a.push.apply(a,Object(v.a)(r.bp3d.model.floorplan.layers));for(var l=[],c=0,u=a;c<u.length;c++){var h=u[c];h&&l.push.apply(l,Object(v.a)(h.getWalls()))}l.forEach((function(e){return r.removeWindowByWall(e)}))}r.bp3d.model.floorplan.update(!1),r.props.onNothingClicked()},r.updateMaterial=function(e,t,n){r.state.selectedItem&&r.state.selectedItem.updateMaterial(e,t,n,(function(){return setTimeout(r.update,100)}))},r.updateStyle=function(e,t){r.state.selectedItem&&r.state.selectedItem.updateStyle(e,t,(function(){return setTimeout(r.update,100)}))},r.setActiveLayerIndex=function(e){r.bp3d.model.floorplan.setActiveLayerIndex(e),r.bp3d.floorplanner.update()},r.setLayerVisible=function(e,t){return r.bp3d.model.floorplan.setLayerVisible(e,t)},r.setLayerHeight=function(e,t){return r.bp3d.model.floorplan.setLayerHeight(e,t)},r.setLayerFloorThickness=function(e,t){return r.bp3d.model.floorplan.setLayerFloorThickness(e,t)},r.cloneAboveLayer=function(e){return r.bp3d.model.floorplan.cloneAboveLayer(e)},r.cloneBelowLayer=function(e){return r.bp3d.model.floorplan.cloneBelowLayer(e)},r.moveAboveLayer=function(e){return r.bp3d.model.floorplan.moveAboveLayer(e)},r.moveBelowLayer=function(e){return r.bp3d.model.floorplan.moveBelowLayer(e)},r.removeLayer=function(e){return r.bp3d.model.floorplan.removeLayer(e)},r.setFloorplanMode=function(e){return r.bp3d.floorplanner.setMode(e)},r.setRoofEditorEnabled=function(e){return r.bp3d.three.setRoofEditorEnabled(e)},r.setRoofEditorMode=function(e){return r.bp3d.three.setRoofEditorMode(e)},r.setRoofEditorTransformControlAxis=function(e){return r.bp3d.three.setTransformControlAxis(e)},r.setRoofFaceTexture=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return r.bp3d.model.floorplan.roof.setFaceTexture(e,t)},r.setMorph=function(e,t){return r.state.selectedItem.setMorph(e,t)},r.setLocked=function(e){return r.bp3d.setSceneLocked(e)},r.setShellMode=function(e){return r.bp3d.setShellMode(e)},r.setToggleXRay=function(){return r.bp3d.toggleXRayMode()},r.setSnap=function(e){return r.bp3d.setSnap(e)},r.setDimensionVisible=function(e){return r.bp3d.setDimensionVisible(e)},r.setCompassVisible=function(e){return r.bp3d.setCompassVisible(e)},r.zoomInFloorPlanner=function(){return r.bp3d.floorplanner.zoomIn()},r.zoomOutFloorPlanner=function(){return r.bp3d.floorplanner.zoomOut()},r.resetZoomFloorPlanner=function(){return r.bp3d.floorplanner.resetZoom()},r.zoomInScene=function(){return r.bp3d.three.controls.dollyIn(1.1)},r.zoomOutScene=function(){return r.bp3d.three.controls.dollyOut(1.1)},r.resetZoomScene=function(){return r.bp3d.three.centerCamera(!0)},r.state={selectedItem:null,showSwapDialog:!1,newProduct:null,plannerOrientation:0,gridSpacing:1,gridSpacingInCanvas:0},r}return Object(d.a)(n,[{key:"render",value:function(){var e=this,t=this.props.viewMode,n=this.state,r=n.plannerOrientation,i=n.gridSpacing,o=n.gridSpacingInCanvas;return Object(b.jsxs)("div",{style:{height:"100%"},onContextMenu:function(e){return e.preventDefault(),e.stopPropagation(),!1},children:[Object(b.jsx)(x,{hidden:"3d"!==t,onDomLoaded:function(t){return e.elThreeElemContainer=t}}),Object(b.jsx)(O,{hidden:"3d"===t,onDomLoaded:function(t){return e.elFloorPlannerElement=t},orientation:r,gridSpacing:i,gridSpacingInCanvas:o,onOrientationChanged:function(t){return e.bp3d.floorplanner.setOrientation(t)},onGridSpacingChanged:function(t){return e.bp3d.floorplanner.setGridSpacing(t)},onResetGridSpacing:function(){return e.bp3d.floorplanner.setGridSpacing(null)}})]})}}]),n}(o.a.Component);function lt(e){var t=e.title,n=e.onClose;return Object(b.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[Object(b.jsx)("h4",{style:{flex:1,margin:0},children:t}),Object(b.jsx)("div",{onClick:n,children:Object(b.jsx)("i",{className:"fa fa-close"})})]})}o.a.Component;var ct=function(e){Object(f.a)(n,e);var t=Object(p.a)(n);function n(e){var r;return Object(h.a)(this,n),(r=t.call(this,e)).state={opened:!1},r}return Object(d.a)(n,[{key:"render",value:function(){var e=this,t=this.state.opened,n=this.props,r=n.label,i=n.title,o=n.children;return Object(b.jsxs)("div",{className:"custom-accordion",children:[Object(b.jsx)("div",{className:"title",onClick:function(){return e.setState({opened:!t})},children:r||i}),t&&o]})}}]),n}(o.a.Component),ut=n(16),ht=n(20),dt=(n(27),function(e){Object(f.a)(n,e);var t=Object(p.a)(n);function n(e){var r;return Object(h.a)(this,n),(r=t.call(this,e)).getButtons=function(){var e=r.props.info;return[{font:"far fa-trash-alt",tooltip:"Delete",callback:function(){e?r.props.onDeleteActiveProduct():ht.b.error("Product not selected")}}]},r.state={unit:"In",locked:!1,showDimension:!0,snap:!0,xRay:!1},r}return Object(d.a)(n,[{key:"render",value:function(){var e=this.getButtons();return Object(b.jsxs)("div",{className:"float-toolbar",children:[e.map((function(e,t){return e?Object(b.jsx)("div",{className:"float-toolbar-button ".concat(e.toggled?"toggled":""),"data-tip":e.tooltip,onClick:function(){"function"===typeof e.callback&&e.callback()},children:Object(b.jsx)("span",{className:e.font,style:e.fontStyle,children:e.label})},t):Object(b.jsx)("div",{className:"hr"},t)})),Object(b.jsx)(ht.a,{position:"bottom-center",autoClose:3e3,hideProgressBar:!1,newestOnTop:!1,closeOnClick:!0,rtl:!1,pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!0}),Object(b.jsx)(ut.a,{})]})}}]),n}(o.a.Component)),ft=["m","cm","in"],pt=function(e){Object(f.a)(n,e);var t=Object(p.a)(n);function n(e){var r;return Object(h.a)(this,n),(r=t.call(this,e)).handleUnitChanged=function(){var e=r.state.unit,t=ft.indexOf(e);t=(t+1)%ft.length;var n=ft[t];r.setState({unit:n}),r.props.onUnitChanged(n)},r.handleToggleLock=function(){r.props.onLockSceneToggled(!r.state.locked),r.setState({locked:!r.state.locked})},r.handleToggleDimensions=function(){r.props.onShowDimensionsToggled(!r.state.showDimension),r.setState({showDimension:!r.state.showDimension})},r.handleToggleSnap=function(){r.props.onSnapToggled(!r.state.snap),r.setState({snap:!r.state.snap})},r.handleToggleXRay=function(){r.props.onXRayToggled(!r.state.xRay),r.setState({xRay:!r.state.xRay})},r.getButtons=function(){var e=r.state,t=e.showDimension,n=e.snap,i=r.props,o=i.viewMode,a=i.showLayers,s=i.showRoofEditor,l=i.showWindowEditor,c=i.shellMode,u=i.showSettings;return[{font:"fa fa-solar-panel",toggled:"2d"===o,tooltip:"2D View",callback:r.props.onShow2DPlanner},{font:"fa fa-cube",tooltip:"3D x-ray",toggled:"3d"===o&&!c&&!s&&!l,callback:r.props.onShow3DViewClicked},{font:"fa fa-building",toggled:"3d"===o&&c&&!s&&!l,tooltip:"3D Shell",callback:r.props.onShellModePressed},{font:"fa fa-campground",toggled:s,tooltip:"Roof Editor",callback:r.props.onRoofPressed},{font:"fa fa-border-all",toggled:l,tooltip:"Window Editor",callback:r.props.onWindowPressed},null,{font:"fa fa-layer-group",toggled:a,tooltip:"Show Layers",callback:r.props.onLayerPressed},{toggled:t,font:"fa fa-ruler-combined",tooltip:"".concat(t?"Show":"Hide"," Dimensions"),callback:r.handleToggleDimensions},{toggled:n,font:"fas fa-magnet",tooltip:"Snap Objects",callback:r.handleToggleSnap},null,{font:"fa fa-undo",tooltip:"Undo",callback:r.props.onUndo},{font:"fa fa-redo",tooltip:"Redo",callback:r.props.onRedo},{font:"fa fa-save",tooltip:"Save",callback:r.props.onSaveClicked},{font:"fas fa-upload",tooltip:"Load",callback:r.props.onLoadClicked},{font:"fa fa-file-export",tooltip:"Collect metadata",callback:r.props.onCollectMetadataClicked},null,{font:"fa fa-gear",toggled:u,tooltip:"Settings",callback:r.props.onSettingsClicked}]},r.state={unit:"m",showDimension:!1,snap:!0,xRay:!1},r}return Object(d.a)(n,[{key:"render",value:function(){var e=this.getButtons();return Object(b.jsxs)("div",{className:"left-toolbar",children:[e.map((function(e,t){return e?Object(b.jsx)("div",{className:"left-toolbar-button ".concat(e.toggled?"toggled":""),"data-tip":e.tooltip,onClick:e.callback,children:Object(b.jsx)("span",{className:e.font,style:e.fontStyle,children:e.label})},t):Object(b.jsx)("div",{className:"hr"},t)})),Object(b.jsx)(ht.a,{position:"bottom-center",autoClose:3e3,hideProgressBar:!1,newestOnTop:!1,closeOnClick:!0,rtl:!1,pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!0}),Object(b.jsx)(ut.a,{})]})}}]),n}(o.a.Component),vt=function(e){Object(f.a)(n,e);var t=Object(p.a)(n);function n(){var e;Object(h.a)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).handleMaterialChange=function(t,n){e.props.onMaterialChange(t,n)},e.handleStyleChange=function(t,n){e.props.onStyleChange(t,n)},e.renderMaterialSection=function(){var t=e.props.info.metadata.materials;if(Array.isArray(t))return Object(b.jsx)("div",{children:t.map((function(t,n){return Object(b.jsx)("div",{children:Object(b.jsx)(ct,{label:t.label,children:Object(b.jsx)("div",{className:"textures-container",children:t.types.map((function(n,r){return Object(b.jsxs)("div",{className:"texture-item",onClick:function(){var r=t.name_in_model,i=n;e.handleMaterialChange(r,i)},children:[Object(b.jsx)("img",{alt:n.label,src:n.texture,className:"thumbnail"}),Object(b.jsx)("div",{className:"label",children:n.label})]},r)}))})})},n)}))})},e.renderStyleSection=function(){var t=e.props.info.metadata.styles;if(Array.isArray(t))return Object(b.jsx)("div",{style:{paddingTop:10},children:t.map((function(t,n){return Object(b.jsx)("div",{children:Object(b.jsx)(ct,{label:t.label,children:Object(b.jsx)("div",{className:"styles-container",children:t.types.map((function(n,r){return Object(b.jsxs)("div",{className:"style-item",onClick:function(){var r=t.name_in_model,i=n.name_in_model;e.handleStyleChange(r,i)},children:[n.thumbnail&&Object(b.jsx)("img",{alt:n.label,src:n.thumbnail,className:"thumbnail"}),Object(b.jsx)("div",{className:"label",children:n.label})]},r)}))})})},n)}))})},e}return Object(d.a)(n,[{key:"render",value:function(){var e=this.props.info;return Object(b.jsxs)("div",{className:"option-section",children:[!e&&Object(b.jsx)("p",{children:"No item selected"}),e&&this.renderMaterialSection(),e&&this.renderStyleSection()]})}}]),n}(o.a.Component),gt=function(e){Object(f.a)(n,e);var t=Object(p.a)(n);function n(){var e;Object(h.a)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return(e=t.call.apply(t,[this].concat(i))).parseLayerData=function(){var t=e.props.layers;if(!Array.isArray(t))return[];var n=[{label:"Select Floor To Edit",value:"",disabled:!0}],r=JSON.parse(JSON.stringify(t));return r.sort((function(e,t){return t.index-e.index})),r.forEach((function(e){n.push({label:"Floor ".concat(e.index),value:e.index})})),n},e._renderDrawTools=function(){var t=e.props,n=t.selectedLayerIndex,r=t.mode;if(Number.isInteger(n)){var i=[{label:"Edit",active:r===Je,callback:e.props.onModeChanged,value:Je},{label:"Draw",active:r===qe,callback:e.props.onModeChanged,value:qe},{label:"Delete",active:r===Ze,callback:e.props.onModeChanged,value:Ze}];return Object(b.jsx)("div",{style:{padding:"0 10px"},children:i.map((function(e,t){return Object(b.jsx)("div",{className:"button inline auto-width ".concat(e.active?"active":""),onClick:function(){return e.callback(e.value)},children:e.label},t)}))})}},e._renderZoomButtons=function(){var t=e.props,n=(t.autoMerge,t.autoSplit,[{font:"fa fa-search-minus",tooltip:"Zoom Out",callback:e.props.onZoomOut},{font:"fa fa-home",tooltip:"Reset Zoom",callback:e.props.onResetZoom},{font:"fa fa-search-plus",tooltip:"Zoom In",callback:e.props.onZoomIn}]);return Object(b.jsx)("div",{style:{padding:"0 10px"},children:n.map((function(e,t){return e?Object(b.jsx)("div",{className:"button inline auto-width ".concat(e.toggled?"active":""),"data-tip":e.tooltip,onClick:function(){"function"===typeof e.callback&&e.callback()},children:Object(b.jsx)("span",{className:e.font,style:e.fontStyle,children:e.label})},t):Object(b.jsx)("div",{className:"hr"},t)}))})},e._renderLayers=function(){var t=e.props.selectedLayerIndex,n=e.parseLayerData(),r=Number.isInteger(t)?t:"";return Object(b.jsx)("div",{children:Object(b.jsx)("select",{style:{margin:"0 20px",padding:5,fontSize:16},value:r,onChange:function(t){var n=null;Number.isInteger(parseInt(t.target.value))&&(n=parseInt(t.target.value)),e.props.onLayerSelected({value:n})},children:n.map((function(e,t){return Object(b.jsx)("option",{value:e.value,disabled:e.disabled,children:e.label},t)}))})})},e._renderGraphicLayerIndicators=function(){var t=e.props.selectedLayerIndex;return e.parseLayerData().map((function(e,n){return e.disabled?null:0===e.value?Object(b.jsxs)(o.a.Fragment,{children:[Object(b.jsx)("div",{className:"item ".concat(t===e.value?"active":"")}),Object(b.jsx)("div",{className:"ground-line"})]},n):Object(b.jsx)("div",{className:"item ".concat(t===e.value?"active":"")},n)}))},e}return Object(d.a)(n,[{key:"render",value:function(){return Object(b.jsxs)("div",{className:"floorplan-tool-section",children:[Object(b.jsxs)("div",{children:[this._renderZoomButtons(),this._renderLayers(),this._renderDrawTools()]}),Object(b.jsx)("div",{className:"graphic-layer-indicator",children:this._renderGraphicLayerIndicators()}),Object(b.jsx)(ut.a,{})]})}}]),n}(o.a.Component),yt=function(e){Object(f.a)(n,e);var t=Object(p.a)(n);function n(){var e;Object(h.a)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).renderButtons=function(){var t=[{font:"fa fa-search-minus",tooltip:"Zoom Out",callback:e.props.onZoomOut},{font:"fa fa-home",tooltip:"Reset Zoom",callback:e.props.onResetZoom},{font:"fa fa-search-plus",tooltip:"Zoom In",callback:e.props.onZoomIn}];return Object(b.jsx)("div",{style:{padding:"0 10px"},children:t.map((function(e,t){return e?Object(b.jsx)("div",{className:"button inline auto-width ".concat(e.toggled?"active":""),"data-tip":e.tooltip,onClick:function(){"function"===typeof e.callback&&e.callback()},children:Object(b.jsx)("span",{className:e.font,style:e.fontStyle,children:e.label})},t):Object(b.jsx)("div",{className:"hr"},t)}))})},e}return Object(d.a)(n,[{key:"render",value:function(){return Object(b.jsxs)("div",{className:"floorplan-tool-section",children:[this.renderButtons(),Object(b.jsx)(ut.a,{})]})}}]),n}(o.a.Component),mt=(o.a.Component,function(e){Object(f.a)(n,e);var t=Object(p.a)(n);function n(){var e;Object(h.a)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).handleChanged=function(t){var n=parseFloat(t.target.value);e.props.onChange(w.a.Dimensioning.measureToCm(n)/100)},e}return Object(d.a)(n,[{key:"render",value:function(){var e=this.props,t=e.rawValue,n=e.min,r=e.max,i=e.step,o=e.style,a=w.a.Dimensioning.cmToMeasureWithoutUnit(100*t),s=w.a.Dimensioning.getUnit();return Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)("input",{style:o||{},type:"number",min:n||w.a.Dimensioning.cmToMeasureWithoutUnit(-1e4),max:r||w.a.Dimensioning.cmToMeasureWithoutUnit(1e4),step:i,value:a,lang:"en",onChange:this.handleChanged,name:"heightInput"}),Object(b.jsxs)("label",{htmlFor:"heightInput",children:[" ",s]})]})}}]),n}(o.a.Component)),bt=.0254;function xt(e){var t,n=e.item,r=e.info,i=e.onChange,o=n.index,a=parseInt(n.min||0,10),s=parseInt(n.max||100,10);a*=bt,s*=bt;var l=r.getMorph(o);t=Math.round(5+295*l);var c=function(e){var t=e.target.value;t<a||t>s||"function"===typeof i&&i(o,(t/bt-5)/295)};return Object(b.jsxs)("div",{className:"input-container",children:[Object(b.jsx)("label",{children:n.label}),Object(b.jsxs)("div",{className:"input",children:[Object(b.jsx)("input",{type:"range",className:"input-slider",min:a,max:s,value:t*bt,step:.01,onChange:c}),Object(b.jsx)("div",{children:Object(b.jsx)(mt,{rawValue:t*bt,style:{width:50},step:.1,onChange:function(e){return c({target:{value:e}})}})})]})]})}var wt=function(e){Object(f.a)(n,e);var t=Object(p.a)(n);function n(){var e;Object(h.a)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).renderMorphingSection=function(){var t=e.props.info;if(t&&t.metadata&&Array.isArray(t.metadata.morph))return t.metadata.morph.map((function(n,r){return Object(b.jsx)(xt,{item:n,info:t,onChange:e.props.onMorphChanged},r)}))},e._renderGroupInfo=function(t){return Object(b.jsx)(b.Fragment,{children:t.hasOwnProperty("opened")?Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)("hr",{}),Object(b.jsxs)("div",{className:"input-container",children:[Object(b.jsx)("label",{children:"Group Opened"}),Object(b.jsx)("input",{type:"checkbox",checked:t.opened,onChange:function(){return"function"===typeof e.props.onOpenedChanged&&e.props.onOpenedChanged(!t.opened)}})]}),Object(b.jsx)("hr",{})]}):t.groupParent&&t.groupParent.hasOwnProperty("opened")?Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)("hr",{}),Object(b.jsxs)("div",{className:"input-container",children:[Object(b.jsx)("label",{children:"Group Opened"}),Object(b.jsx)("input",{type:"checkbox",checked:t.groupParent.opened,onChange:function(){return"function"===typeof e.props.onOpenedChanged&&e.props.onOpenedChanged(!t.groupParent.opened)}})]}),Object(b.jsx)("hr",{})]}):null})},e._renderInfo=function(t){return Object(b.jsxs)("div",{children:[Object(b.jsx)("h3",{children:t&&t.metadata?t.metadata.itemName:""}),e._renderGroupInfo(t),e.renderMorphingSection()]})},e}return Object(d.a)(n,[{key:"render",value:function(){var e=this.props.info;return Object(b.jsxs)("div",{className:"property-section",children:[e&&this._renderInfo(e),!e&&Object(b.jsx)("p",{children:"No item selected"})]})}}]),n}(o.a.Component),kt=function(e){Object(f.a)(n,e);var t=Object(p.a)(n);function n(){var e;Object(h.a)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).handleHeightChanged=function(t,n){var r=parseFloat(n.target.value);e.props.onHeightChanged(t,w.a.Dimensioning.measureToCm(r)/100)},e.handleCloneAbovePressed=function(t){var n=e.props.onCloneAboveLayer(t);e.props.onLayerSelected({value:n})},e.handleCloneBelowPressed=function(t){var n=e.props.onCloneBelowLayer(t);e.props.onLayerSelected({value:n})},e.handleMoveAbovePressed=function(t){var n=e.props.onMoveAboveLayer(t);e.props.onLayerSelected({value:n})},e.handleMoveBelowPressed=function(t){var n=e.props.onMoveBelowLayer(t);e.props.onLayerSelected({value:n})},e.handleRemovePressed=function(t){e.props.onRemoveLayer(t),e.props.onLayerSelected({value:null})},e._renderHeightInput=function(t,n){var r=w.a.Dimensioning.cmToMeasure(100*t.height);return n?Object(b.jsx)("td",{style:{textAlign:"right"},children:Object(b.jsx)(mt,{rawValue:t.height,style:{width:60,fontSize:16},min:0,step:.1,onChange:function(n){e.props.onHeightChanged(t.value,n)}})}):Object(b.jsx)("td",{style:{textAlign:"right"},children:r})},e._renderLayersTable=function(t){if(Array.isArray(t)){var n=e.props.activeIndex;return Object(b.jsx)(b.Fragment,{children:Object(b.jsxs)("table",{className:"table",children:[Object(b.jsx)("thead",{children:Object(b.jsxs)("tr",{children:[Object(b.jsx)("th",{children:"Label"}),Object(b.jsx)("th",{children:"Below"}),Object(b.jsx)("th",{children:"Height"}),Object(b.jsx)("th",{})]})}),Object(b.jsx)("tbody",{children:t.map((function(t,r){return Object(b.jsxs)("tr",{className:n===t.value?"active":"",children:[Object(b.jsx)("td",{className:"label",onClick:function(){return e.props.onLayerSelected(t)},children:"".concat(t.label)}),Object(b.jsx)("td",{children:null!==t.value&&Object(b.jsx)("input",{type:"checkbox",checked:t.value<0,onChange:function(){}})}),e._renderHeightInput(t,t.isValid&&n===t.value),Object(b.jsx)("td",{children:null!==t.value&&Object(b.jsx)("span",{className:"fa fa-eye".concat(t.isVisible?"":"-slash"),onClick:function(){return e.props.onSetLayerVisible(t.value,!t.isVisible)}})})]},r)}))})]})})}},e._renderButtons=function(t){if(t){var n=t.value,r=[{hidden:t.isTopLayer,label:"Move Above",callback:function(){return e.handleMoveAbovePressed(n)}},{hidden:t.isBottomLayer,label:"Move Below",callback:function(){return e.handleMoveBelowPressed(n)}},{label:"Clone Above",callback:function(){return e.handleCloneAbovePressed(n)}},{label:"Clone Below",callback:function(){return e.handleCloneBelowPressed(n)}},{hidden:t.isNotRemovable,label:"Remove Layer",callback:function(){return e.handleRemovePressed(n)}}];return Object(b.jsxs)("div",{children:[Object(b.jsxs)("div",{className:"input-container",children:[Object(b.jsx)("label",{children:"Floor Thickness"}),Object(b.jsx)("div",{children:Object(b.jsx)(mt,{step:.1,min:0,rawValue:t.floorThickness,onChange:function(t){return e.props.onFloorThicknessChanged(n,t)}})})]}),r.map((function(e,t){return Object(b.jsx)("div",{hidden:e.hidden,className:"button ".concat(e.active?"active":""),onClick:function(){return e.callback(e.value)},children:e.label},t)}))]})}},e.getLayerData=function(){var t=e.props,n=t.layers,r=t.activeIndex,i=[{label:"All Layers",isValid:!1,value:null,height:0}],o=null;if(Array.isArray(n)){var a=JSON.parse(JSON.stringify(n));a.sort((function(e,t){return t.index-e.index}));for(var s=0;s<a.length;s++){var l=a[s];i[0].height+=l.height-0;var c={isValid:!0,isTopLayer:0===s||-1===l.index,isBottomLayer:s===a.length-1||0===l.index,isNotRemovable:a.length<=1,isVisible:l.visible,label:"Floor ".concat(l.index>=0?l.index:"B"+Math.abs(l.index)),value:l.index,offset:l.offset,height:l.height,floorThickness:l.floorThickness};c.value===r&&(o=c),i.push(c)}}return{data:i,selectedLayer:o}},e}return Object(d.a)(n,[{key:"render",value:function(){var e=this.getLayerData(),t=e.data,n=e.selectedLayer;return Object(b.jsxs)("div",{className:"property-section",children:[Object(b.jsx)(lt,{title:"Layers",onClose:this.props.onClose}),Object(b.jsx)("div",{style:{padding:10},children:this._renderLayersTable(t)}),this._renderButtons(n),Object(b.jsx)(ut.a,{})]})}}]),n}(o.a.Component),Ot=["#3f89cd","#ff0000","#00ff00","#0000ff","#3f8900","#893fcd","#89cd3f","#cd3f89","#cd893f","#123456"],jt=function(e){Object(f.a)(n,e);var t=Object(p.a)(n);function n(e){var r;return Object(h.a)(this,n),(r=t.call(this,e)).componentDidMount=function(){r.props.isFirst&&r.props.onRegenerateClicked(!1),r.props.onTransformControlAxisChanged(r.state.transformControlAxis)},r._renderModeButtons=function(){var e=r.props.mode,t=[{label:"Move",active:e===Se,callback:r.props.onModeChanged,value:Se},{label:"Add Vertex",active:e===Me,callback:r.props.onModeChanged,value:Me},{label:"Connect Vertices",active:e===Pe,callback:r.props.onModeChanged,value:Pe},{label:"Delete",active:e===Te,callback:r.props.onModeChanged,value:Te}];return Object(b.jsxs)("div",{children:[Object(b.jsx)("div",{children:Object(b.jsx)("h4",{children:"Mode"})}),t.map((function(e,t){return Object(b.jsx)("div",{className:"button ".concat(e.active?"active":""),onClick:function(){return e.callback(e.value)},children:e.label},t)}))]})},r._renderAxisManagementPanel=function(){var e=r.state.transformControlAxis;return Object(b.jsxs)("div",{children:[Object(b.jsx)("h4",{children:"Select axis of transform control"}),["X","Y","Z"].map((function(t,n){return Object(b.jsxs)("span",{onClick:function(){r.setState({transformControlAxis:t}),r.props.onTransformControlAxisChanged(t)},children:[Object(b.jsx)("input",{type:"radio",checked:t===e,onChange:function(){}}),Object(b.jsx)("label",{children:t})]},n)}))]})},r._renderVertexEditPanel=function(){var e=r.props.roofVertex;if(e){var t=[{label:"x",value:e.x,callback:function(t){return e.setPosition("x",t)}},{label:"y",value:e.z,callback:function(t){return e.setPosition("y",t)}},{label:"z (height)",value:e.y+e.parent.offset,callback:function(t){return e.setPosition("z",t)}}];return Object(b.jsxs)("div",{children:[Object(b.jsx)("h4",{children:"Edit Vertex Position"}),t.map((function(e,t){return Object(b.jsxs)("div",{className:"input-container",children:[Object(b.jsxs)("label",{children:[e.label," "]}),Object(b.jsx)("div",{children:Object(b.jsx)(mt,{rawValue:e.value,step:.1,style:{width:60,fontSize:16,textAlign:"right"},onChange:e.callback})})]},t)}))]})}},r._renderTextureEditPanel=function(){var e={display:"inline-block",width:50,height:50,borderRadius:25,margin:10,cursor:"pointer"};return Object(b.jsxs)("div",{children:[Object(b.jsx)("h4",{children:"Entire Color"}),Object(b.jsx)("div",{children:Ot.map((function(t,n){return Object(b.jsx)("div",{style:Object(g.a)(Object(g.a)({},e),{},{background:t}),onClick:function(){return r.props.onEntireTextureChanged(t)}},n)}))})]})},r.state={transformControlAxis:"X"},r}return Object(d.a)(n,[{key:"render",value:function(){return Object(b.jsxs)("div",{className:"property-section",children:[Object(b.jsx)(lt,{title:"Roof Editor",onClose:this.props.onClose}),Object(b.jsx)("div",{onClick:this.props.onRegenerateClicked,className:"button",children:"Reset Roof"}),this._renderModeButtons(),this._renderAxisManagementPanel(),this._renderVertexEditPanel(),this._renderTextureEditPanel()]})}}]),n}(o.a.Component),Ct={category:"Window",styles:[{name:"Window Type 1",image:"/blueprint3D-assets/models/thumbnails/window-01.jpg",model:"/blueprint3D-assets/models/glb/window-01.glb",type:"3",morph:[{label:"Height",index:0,min:10,max:100},{label:"Width",index:1,min:10,max:300}]},{name:"Window Type 2",image:"/blueprint3D-assets/models/thumbnails/window-02.jpg",model:"/blueprint3D-assets/models/glb/window-02.glb",type:"3",morph:[{label:"Height",index:0,min:10,max:100},{label:"Width",index:1,min:10,max:300}]},{name:"Window Type 3",image:"/blueprint3D-assets/models/thumbnails/window-03.jpg",model:"/blueprint3D-assets/models/glb/window-03.glb",type:"3",morph:[{label:"Height",index:0,min:10,max:100},{label:"Width",index:1,min:10,max:300}]}]},Et=[Ct],St=function(e){Object(f.a)(n,e);var t=Object(p.a)(n);function n(e){var r;return Object(h.a)(this,n),(r=t.call(this,e))._getWall=function(){var e=r.props.selectedEdge,t=r.state,n=t.addJustWall,i=t.wallMode,o=e?e.wall:null;return n||(o=null),o?{wall:o,wallMode:i}:null},r.handleAddWindows=Object(u.a)(c.a.mark((function e(){var t,n,i,o,a,s,l,u,h,d;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.state,n=t.avgWidth,i=t.avgHeight,o=t.marginHorizon,a=t.marginVertical,s=t.coverRate,l=t.selectedWindowType,u=Et[0].styles[l],r.setState({isAdding:!0}),e.next=5,r.props.onAddWindows(r.props.selectedLayerIndex<0?null:r.props.selectedLayerIndex,u,{width:n,height:i},{horizontal:o,vertical:a},s/100,r._getWall());case 5:h=e.sent,r.setState({isAdding:!1}),console.log(h),h&&(d={position:"bottom-center",autoClose:2e3,hideProgressBar:!0,closeOnClick:!0,pauseOnHover:!1,draggable:!1,progress:void 0},ht.b[1===h.state?"error":"info"](h.msg,d));case 9:case"end":return e.stop()}}),e)}))),r.handleRemoveWindows=function(){var e=r.props.selectedLayerIndex;r.props.onRemoveWindows(e,r._getWall())},r._renderLayers=function(){var e=r.props,t=e.layers,n=e.selectedLayerIndex;if(Array.isArray(t)){var i=[{label:"All Layers",value:""}],o=JSON.parse(JSON.stringify(t));o.sort((function(e,t){return t.index-e.index})),o.forEach((function(e){e.index<0||i.push({label:"Floor ".concat(e.index),value:e.index})}));var a=Number.isInteger(n)?n:"";return Object(b.jsxs)("div",{className:"input-container",children:[Object(b.jsx)("label",{children:"Select Floor "}),Object(b.jsx)("select",{style:{padding:5,fontSize:16},value:a,onChange:function(e){var t=null;Number.isInteger(parseInt(e.target.value))&&(t=parseInt(e.target.value)),r.props.onLayerSelected({value:t})},children:i.map((function(e,t){return Object(b.jsx)("option",{value:e.value,disabled:e.disabled,children:e.label},t)}))})]})}},r._renderWindowTypes=function(){var e=r.state.selectedWindowType,t=Et[0],n={width:80,height:80,margin:10,cursor:"pointer"};return Object(b.jsxs)("div",{children:[Object(b.jsx)("p",{children:"Select Window"}),t.styles.map((function(t,i){return Object(b.jsx)("img",{alt:"",src:t.image,style:Object(g.a)(Object(g.a)({},n),{},{border:"3px solid ".concat(e===i?"gray":"transparent")}),onClick:function(){return r.setState({selectedWindowType:i})}},i)}))]})},r._renderDimensioning=function(){var e=r.state,t=e.avgWidth,n=e.avgHeight,i=e.marginHorizon,o=e.marginVertical,a=e.coverRate,s=[{label:"Avg.Width:",value:t,step:.01,callback:function(e){return r.setState({avgWidth:e})}},{label:"Avg.Height:",value:n,step:.01,callback:function(e){return r.setState({avgHeight:e})}},{label:"Min Margin Horizontal:",value:i,min:.05,step:.01,callback:function(e){return r.setState({marginHorizon:e})}},{label:"Min Margin Vertical:",value:o,min:.05,step:.01,callback:function(e){return r.setState({marginVertical:e})}}];return Object(b.jsxs)("div",{children:[s.map((function(e,t){return Object(b.jsxs)("div",{className:"input-container",children:[Object(b.jsx)("label",{children:e.label}),Object(b.jsx)("div",{children:Object(b.jsx)(mt,{rawValue:e.value,min:e.min||0,step:e.step||.1,style:{width:50},onChange:e.callback})})]},t)})),Object(b.jsxs)("div",{className:"input-container",children:[Object(b.jsx)("label",{children:"Expected Cover Rate:"}),Object(b.jsxs)("div",{children:[Object(b.jsx)("input",{type:"number",value:a,min:0,max:100,style:{width:50},onChange:function(e){var t=parseFloat(e.target.value);t<0&&(t=0),t>100&&(t=100),r.setState({coverRate:t})}}),Object(b.jsx)("label",{children:" %"})]})]})]})},r._renderButtons=function(){var e=r.state.isAdding,t=[{label:"Add Windows",callback:r.handleAddWindows},{label:"Remove Windows",callback:r.handleRemoveWindows}];return Object(b.jsxs)("div",{children:[t.map((function(t,n){return Object(b.jsx)("div",{className:"button ".concat(e?"disabled":""),onClick:function(){return!e&&t.callback()},children:t.label},n)})),e&&Object(b.jsx)("p",{children:"Performing, please wait..."})]})},r._renderWallManagementPanel=function(){var e=r.props.selectedEdge,t=r.state,n=t.addJustWall,i=t.wallMode;if(e){return Object(b.jsxs)("div",{style:{padding:"20px 0"},children:[Object(b.jsx)("input",{type:"checkbox",checked:n,onChange:function(){return r.setState({addJustWall:!n})}}),Object(b.jsx)("label",{children:"Affect to just Selected Wall?"}),Object(b.jsx)("div",{children:n&&["1. Apply only to selected wall","2. Apply to all walls on same floor","3. Apply to all walls facing the same direction","4. Apply to all walls of the building"].map((function(e,t){return Object(b.jsxs)("div",{onClick:function(){return r.setState({wallMode:t})},children:[Object(b.jsx)("input",{type:"radio",checked:t===i,onChange:function(){}}),Object(b.jsx)("label",{children:e})]},t)}))})]})}},r.state={addJustWall:!0,wallMode:0,avgWidth:1.5,marginHorizon:.1,avgHeight:1,marginVertical:.1,coverRate:50,selectedWindowType:0,isAdding:!1},r}return Object(d.a)(n,[{key:"render",value:function(){return Object(b.jsxs)("div",{className:"property-section",children:[Object(b.jsx)(lt,{title:"Window Editor",onClose:this.props.onClose}),this._renderLayers(),this._renderWindowTypes(),this._renderDimensioning(),this._renderWallManagementPanel(),this._renderButtons(),Object(b.jsx)(ht.a,{})]})}}]),n}(o.a.Component),Mt=["/Blueprint3D-assets/rooms/textures/marbletiles.jpg","/Blueprint3D-assets/rooms/textures/tile-01.jpg","/Blueprint3D-assets/rooms/textures/tile-02.jpg"],Pt=["/Blueprint3D-assets/rooms/textures/light_brick.jpg"],Tt=["/Blueprint3D-assets/rooms/textures/hardwood.png","/Blueprint3D-assets/rooms/textures/light_fine_wood.jpg"],_t=function(e){Object(f.a)(n,e);var t=Object(p.a)(n);function n(e){var r;return Object(h.a)(this,n),(r=t.call(this,e)).handleFloorTextureClicked=function(e,t){e.setTexture(t)},r.handleEdgeTextureClicked=function(e,t){var n=r.state.wallMode;r.props.onEdgeTextureChanged(e,t,n)},r._renderFloorTexturePanel=function(){var e=r.props,t=e.mode,n=e.floor;if("floor"===t&&n){var i={display:"inline-block",width:50,height:50,margin:10,cursor:"pointer"};return Object(b.jsxs)("div",{children:[Object(b.jsx)("h4",{children:"Select Floor Texture"}),Object(b.jsx)("div",{children:Mt.map((function(e,t){return Object(b.jsx)("div",{style:Object(g.a)({},i),onClick:function(){return r.handleFloorTextureClicked(n,e)},children:Object(b.jsx)("img",{src:e,alt:"texture",style:{width:"100%",height:"100%"}})},t)}))})]})}},r._renderEdgeTexturePanel=function(){var e=r.props,t=e.mode,n=e.edge;if("wall"===t&&n){var i=r.state.wallMode,o=!!(n&&n.wall&&n.wall.isOutsideWall),a={display:"inline-block",width:50,height:50,margin:10,cursor:"pointer"};return Object(b.jsxs)("div",{children:[Object(b.jsx)("h4",{children:"Select ".concat(o?"Outside":"Inside"," Wall Texture")}),Object(b.jsx)("div",{children:(o?Pt:Tt).map((function(e,t){return Object(b.jsx)("div",{style:Object(g.a)({},a),onClick:function(){return r.handleEdgeTextureClicked(n,e)},children:Object(b.jsx)("img",{src:e,alt:"texture",style:{width:"100%",height:"100%"}})},t)}))}),Object(b.jsx)("div",{children:["1. Apply only to selected wall","2. Apply to all walls on same floor","3. Apply to all walls facing the same direction","4. Apply to all walls of the building"].map((function(e,t){return Object(b.jsxs)("div",{onClick:function(){return r.setState({wallMode:t})},children:[Object(b.jsx)("input",{type:"radio",checked:t===i,onChange:function(){}}),Object(b.jsx)("label",{children:e})]},t)}))})]})}},r.state={wallMode:0},r}return Object(d.a)(n,[{key:"render",value:function(){return Object(b.jsxs)("div",{className:"property-section",children:[Object(b.jsx)(lt,{title:"Texture Editor",onClose:this.props.onClose}),this._renderFloorTexturePanel(),this._renderEdgeTexturePanel()]})}}]),n}(o.a.Component),Dt=function(e){Object(f.a)(n,e);var t=Object(p.a)(n);function n(e){var r;return Object(h.a)(this,n),(r=t.call(this,e)).update=function(){r.props.onUpdate(),r.forceUpdate()},r.handleLengthChange=function(e){var t=r.props.wall,n=r.state.stretchDirection;if(e>0){var i=e/t.getWallLength(),o={x:0,y:0};if(0===n)o=t.getWallCenter();else if(-1===n)o={x:t.getStartX(),y:t.getStartY()};else{if(1!==n)return;o={x:t.getEndX(),y:t.getEndY()}}var a=0,s=0;a=o.x+(t.getStartX()-o.x)*i,s=o.y+(t.getStartY()-o.y)*i,t.start.move(a,s,!1),a=o.x+(t.getEndX()-o.x)*i,s=o.y+(t.getEndY()-o.y)*i,t.end.move(a,s,!1),r.update()}},r._renderDimensions=function(){var e=r.props.wall,t=e?e.getWallLength():0,n=[];return e&&n.push({label:"Length",value:t,callback:r.handleLengthChange}),n.push({label:"Thickness",value:e?e.thickness:w.a.Configuration.getNumericValue(w.a.configWallThickness),callback:function(t){e?e.thickness=t:w.a.Configuration.setValue(w.a.configWallThickness,t),r.update()}}),Object(b.jsx)("div",{children:n.map((function(e,t){return Object(b.jsxs)("div",{className:"input-container",children:[Object(b.jsx)("label",{children:e.label}),Object(b.jsx)("div",{children:Object(b.jsx)(mt,{rawValue:e.value,min:.1,step:.1,onChange:e.callback})})]},t)}))})},r._renderStretchDirections=function(){var e=r.state.stretchDirection,t=r.props.wall;if(t){var n=t.start,i=t.end,o=[{label:"Start Corner",value:-1},{label:"Both Sides",value:0},{label:"End Corner",value:1}];if(Math.abs(n.x-i.x)>Math.abs(n.y-i.y))if(n.x>i.x)o[0].label="Left Side",o[2].label="Right Side";else{o[0].label="Right Side",o[2].label="Left Side";var a=o[0];o[0]=o[2],o[2]=a}else if(n.y>i.y)o[0].label="Upper Side",o[2].label="Below Side";else{o[0].label="Below Side",o[2].label="Upper Side";var s=o[0];o[0]=o[2],o[2]=s}return Object(b.jsxs)("div",{children:[Object(b.jsx)("p",{children:"Stretch Direction"}),o.map((function(t,n){return Object(b.jsxs)("div",{children:[Object(b.jsx)("input",{type:"radio",checked:t.value===e,onChange:function(){return r.setState({stretchDirection:t.value})}}),Object(b.jsx)("label",{children:t.label})]},n)}))]})}},r._renderRadioButtons=function(){var e=r.props.wall,t=e?e.start:null,n=e?e.end:null,i=e?e.thicknessDirection:w.a.Configuration.getNumericValue(w.a.configWallThicknessDirection),o=e?e.isOutsideWall:w.a.Configuration.getBooleanValue(w.a.configWallIsOutside),a=[{label:"Inside",value:-1},{label:"Both Sides",value:0},{label:"Outside",value:1}];if(t&&n)if(Math.abs(t.x-n.x)>Math.abs(t.y-n.y))if(t.x>n.x){a[0].label="Below Side",a[2].label="Upper Side";var s=a[0];a[0]=a[2],a[2]=s}else a[0].label="Upper Side",a[2].label="Below Side";else if(t.y>n.y)a[0].label="Left Side",a[2].label="Right Side";else{a[0].label="Right Side",a[2].label="Left Side";var l=a[0];a[0]=a[2],a[2]=l}return Object(b.jsxs)("div",{children:[Object(b.jsx)("p",{children:"Inside/Outside Wall"}),[{label:"Inside",value:!1},{label:"Outside",value:!0}].map((function(t,n){return Object(b.jsxs)("div",{children:[Object(b.jsx)("input",{type:"radio",checked:t.value===o,onChange:function(){e?e.isOutsideWall=t.value:w.a.Configuration.setValue(w.a.configWallIsOutside,t.value),r.update()}}),Object(b.jsx)("label",{children:t.label})]},n)})),Object(b.jsx)("p",{children:"Thickness Direction"}),a.map((function(t,n){return Object(b.jsxs)("div",{children:[Object(b.jsx)("input",{type:"radio",checked:t.value===i,onChange:function(){e?e.thicknessDirection=t.value:w.a.Configuration.setValue(w.a.configWallThicknessDirection,t.value),r.update()}}),Object(b.jsx)("label",{children:t.label})]},n)}))]})},r.state={stretchDirection:0},r}return Object(d.a)(n,[{key:"render",value:function(){return Object(b.jsxs)("div",{className:"property-section",children:[Object(b.jsx)(lt,{title:"Edit Wall Properties",onClose:this.props.onClose}),this._renderDimensions(),this._renderStretchDirections(),this._renderRadioButtons()]})}}]),n}(o.a.Component),Lt=function(e){Object(f.a)(n,e);var t=Object(p.a)(n);function n(e){var r;return Object(h.a)(this,n),(r=t.call(this,e)).componentDidMount=function(){var e=r.props.room;if(e){var t=e.name;r.setState({name:t})}},r.UNSAFE_componentWillReceiveProps=function(e){var t=r.props.room,n=e.room;t&&n&&t.name!==n.name&&r.setState({name:n.name})},r.handleNameChanged=function(){var e=r.state.name,t=r.props.room;console.log(e,t),t&&(t.name=e,r.props.onUpdate(!1,!1))},r.state={name:""},r}return Object(d.a)(n,[{key:"render",value:function(){var e=this;return Object(b.jsxs)("div",{className:"property-section",children:[Object(b.jsx)(lt,{title:"Edit Room Properties",onClose:this.props.onClose}),Object(b.jsxs)("div",{className:"input-container",children:[Object(b.jsx)("label",{children:"Name"}),Object(b.jsx)("input",{value:this.state.name,onChange:function(t){return e.setState({name:t.target.value})},onKeyDown:function(t){13===t.keyCode&&e.handleNameChanged()}})]})]})}}]),n}(o.a.Component),It=function(e){Object(f.a)(n,e);var t=Object(p.a)(n);function n(){var e;Object(h.a)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).update=function(){e.forceUpdate(),e.props.onUpdate()},e._renderDimensions=function(){var t=e.props.corner,n=[{label:"Position X",value:t.x,callback:function(n){t.x=n,e.update()}},{label:"Position Y",value:-t.y,callback:function(n){t.y=-n,e.update()}}];return Object(b.jsx)("div",{children:n.map((function(e,t){return Object(b.jsxs)("div",{className:"input-container",children:[Object(b.jsx)("label",{children:e.label}),Object(b.jsx)("div",{children:Object(b.jsx)(mt,{rawValue:e.value,step:.1,onChange:e.callback})})]},t)}))})},e}return Object(d.a)(n,[{key:"render",value:function(){return Object(b.jsxs)("div",{className:"property-section",children:[Object(b.jsx)(lt,{title:"Edit Corner Properties",onClose:this.props.onClose}),this._renderDimensions()]})}}]),n}(o.a.Component),Wt=function(e){Object(f.a)(n,e);var t=Object(p.a)(n);function n(e){var r;return Object(h.a)(this,n),(r=t.call(this,e))._renderTableHeader=function(e){return Object(b.jsx)("thead",{children:Object(b.jsx)("tr",{children:e.map((function(e,t){return Object(b.jsx)("th",{children:e},t)}))})})},r._renderTableRow=function(e){return e.map((function(e,t){return"string"===typeof e?Object(b.jsx)("td",{children:e},t):"boolean"===typeof e?Object(b.jsx)("td",{children:Object(b.jsx)("input",{type:"checkbox",checked:e,onChange:function(){}})},t):Object(b.jsx)("td",{children:e},t)}))},r._renderLayerMetadata=function(e){var t=e.metadata,n=e.walls,i=e.rooms;if(t){var o=t.height,a=t.distanceFromGround,s=t.floorThickness,l=t.area,c=t.isUndergroundLayer,u=t.hasExposedCeiling,h=t.hasExposedFloor,d=["".concat(a.toFixed(2),"m"),"".concat(o.toFixed(2),"m"),"".concat(s.toFixed(2),"m"),"".concat(l.toFixed(2),"m").concat(String.fromCharCode(178)),c,u,h,i.length,n.length];return Object(b.jsx)("div",{className:"metadata-container",style:{paddingLeft:20},children:Object(b.jsxs)("table",{className:"table",children:[r._renderTableHeader(["Distance from ground","Height","Floor Thickness","Area","Underground","Lowest Layer(Attached to ground)","Highest Layer(Attached to Roof)","Rooms","Walls"]),Object(b.jsx)("tbody",{children:Object(b.jsx)("tr",{children:r._renderTableRow(d)})})]})})}},r._renderWallMetadata=function(e){var t=e.index,n=e.height,i=e.start,o=e.end,a=e.thickness,s=e.isOutsideWall,l=e.isExposedWall,c=e.isUndergroundWall,u=e.windows,h=[t+1,"".concat(n.toFixed(2),"m"),"(".concat(i.x.toFixed(2),"m, ").concat(i.y.toFixed(2),"m, ").concat(i.z.toFixed(2),"m)"),"(".concat(o.x.toFixed(2),"m, ").concat(o.y.toFixed(2),"m, ").concat(o.z.toFixed(2),"m)"),"".concat(a.toFixed(2),"m"),l,s,c,u];return r._renderTableRow(h)},r._renderWindowMetadata=function(e){var t=e.index,n=e.wallIndex,i=e.type,o=e.size,a=e.direction,s=e.position,l=[t+1,n,i,a,"".concat(o.width.toFixed(2),"m"),"".concat(o.height.toFixed(2),"m"),"(".concat(s.x.toFixed(2),"m, ").concat(s.y.toFixed(2),"m, ").concat(s.z.toFixed(2),"m)")];return r._renderTableRow(l)},r._renderRoomMetadata=function(e){var t=e.index,n=e.label,i=e.area,o=e.corners,a=[t+1,n,"".concat(i.toFixed(2),"m").concat(String.fromCharCode(178)),o.map((function(e){return"(".concat(e.position.x.toFixed(2),"m, ").concat(e.position.y.toFixed(2),"m, ").concat(e.position.z.toFixed(2),"m)")})).join("-")];return r._renderTableRow(a)},r._renderLayerData=function(e){var t,n=e.metadata,i=e.walls,o=e.rooms,a=i.map((function(e){return Object(g.a)(Object(g.a)({},e.metadata),{},{windows:e.windows.length})})),s=[],l=Object(y.a)(i.entries());try{var c=function(){var e=Object(j.a)(t.value,2),n=e[0];e[1].windows.forEach((function(e){s.push(Object(g.a)({wallIndex:n+1},e))}))};for(l.s();!(t=l.n()).done;)c()}catch(u){l.e(u)}finally{l.f()}return Object(b.jsx)(ct,{title:n.label,children:Object(b.jsxs)("div",{style:{paddingBottom:20},children:[r._renderLayerMetadata(e),Object(b.jsxs)("div",{style:{paddingLeft:20},children:[Object(b.jsx)(ct,{title:"Rooms",children:Object(b.jsx)("div",{style:{paddingLeft:20,paddingBottom:10},children:Object(b.jsxs)("table",{className:"table",children:[r._renderTableHeader(["No","Name","Area","Corners"]),Object(b.jsx)("tbody",{children:o.map((function(e,t){return Object(b.jsx)("tr",{children:r._renderRoomMetadata(Object(g.a)(Object(g.a)({index:t},e.metadata),{},{corners:e.corners}))},t)}))})]})})}),Object(b.jsx)(ct,{title:"Walls",children:Object(b.jsx)("div",{style:{paddingLeft:20},children:Object(b.jsxs)("table",{className:"table",children:[r._renderTableHeader(["No","Height","Start","End","Thickness","Exposed to outside","Outside","Underground","Windows"]),Object(b.jsx)("tbody",{children:a.map((function(e,t){return Object(b.jsx)("tr",{children:r._renderWallMetadata(Object(g.a)(Object(g.a)({},e),{},{index:t}))},t)}))})]})})}),Object(b.jsx)("div",{style:{paddingLeft:20,paddingTop:10},children:Object(b.jsx)(ct,{title:"Windows",children:Object(b.jsx)("div",{style:{paddingLeft:20},children:Object(b.jsxs)("table",{className:"table",children:[r._renderTableHeader(["No","Wall Index","Type","Orientation","Width","Height","Position"]),Object(b.jsx)("tbody",{children:s.map((function(e,t){return Object(b.jsx)("tr",{children:r._renderWindowMetadata(Object(g.a)(Object(g.a)({},e),{},{index:t}))},t)}))})]})})})})]})]})})},r._renderParsedData=function(){if(0===r.state.tabIndex){var e=r.props.parsed;if(e)return Object(b.jsxs)("div",{style:{height:"calc(100% - 90px)",overflow:"auto"},children:[Object(b.jsx)("h5",{children:"Layers"}),e.layers.map((function(e,t){return Object(b.jsx)("div",{children:r._renderLayerData(e)},t)})),Object(b.jsx)("h5",{children:"Roof"})]})}},r._renderRawData=function(){var e=r.state.tabIndex,t=r.props.parsed;if(1===e)return Object(b.jsx)("div",{style:{height:"calc(100% - 90px)"},children:Object(b.jsx)("textarea",{style:{width:"100%",height:"-webkit-fill-available",resize:"none"},defaultValue:JSON.stringify(t)})})},r.state={tabIndex:0},r}return Object(d.a)(n,[{key:"render",value:function(){var e=this,t=this.state.tabIndex,n=this.props.style;return Object(b.jsx)("div",{className:"modal-container",children:Object(b.jsxs)("div",{className:"modal-dialog",style:Object(g.a)({},n),children:[Object(b.jsx)(lt,{title:"Floorplan Data",onClose:this.props.onClose}),Object(b.jsx)("div",{style:{padding:"25px 0"},children:["Parsed","Raw"].map((function(n,r){return Object(b.jsx)("span",{style:{border:"1px solid gray",cursor:"pointer",padding:10,margin:"10px 0",background:t===r?"#ddd":"transparent"},onClick:function(){return e.setState({tabIndex:r})},children:n},r)}))}),this._renderParsedData(),this._renderRawData()]})})}}]),n}(o.a.Component),Nt=[{label:"Meter",value:"m"},{label:"Centimeter",value:"cm"},{label:"Inch",value:"in"}],zt=function(e){Object(f.a)(n,e);var t=Object(p.a)(n);function n(){var e;Object(h.a)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).handleUnitChanged=function(t){var n=t.target.value;e.props.onUnitChanged(n)},e}return Object(d.a)(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.unit,r=t.showCompass;return Object(b.jsxs)("div",{className:"property-section",children:[Object(b.jsx)(lt,{title:"Settings",onClose:this.props.onClose}),Object(b.jsxs)("div",{children:[Object(b.jsxs)("div",{className:"input-container",children:[Object(b.jsx)("label",{children:"Unit"}),Object(b.jsx)("select",{value:n,onChange:this.handleUnitChanged,children:Nt.map((function(e,t){return Object(b.jsx)("option",{value:e.value,children:e.label},t)}))})]}),Object(b.jsxs)("div",{className:"input-container",children:[Object(b.jsx)("label",{children:"Show Compass"}),Object(b.jsx)("input",{type:"checkbox",checked:r,onChange:function(){return e.props.onChangeCompassVisibility(!r)}})]})]})]})}}]),n}(o.a.Component),Vt=(n(52),function(e){Object(f.a)(n,e);var t=Object(p.a)(n);function n(e){var r;return Object(h.a)(this,n),(r=t.call(this,e)).setPropertyPanelTool=function(e){r.refBp3d.setRoofEditorEnabled(!1),r.setState({propertyPanelTool:e}),"roof"===e&&r.refBp3d.setRoofEditorEnabled(!0)},r.handleShow2DPlannerClicked=function(){var e=r.state.layers;if(r.setPropertyPanelTool(null),r.setState({viewMode:"2d",subTool:"floorplan"}),e&&e.length){var t=Number.isInteger(r.state.selectedLayerIndex)?r.state.selectedLayerIndex:e[0].index;r.handleLayerSelected({value:t})}},r.handleShow3DViewClicked=function(){r.setState({viewMode:"3d",subTool:null,shellMode:!1}),r.setPropertyPanelTool(null),r.refBp3d.setShellMode(!1)},r.handleShowShellModeClicked=function(){r.refBp3d.setShellMode(!0),r.setState({viewMode:"3d",shellMode:!0,subTool:null}),r.setPropertyPanelTool(null)},r.handleShowRoofEditorClicked=function(){var e="roof"===r.state.propertyPanelTool;r.refBp3d.setRoofEditorEnabled(!e),r.setPropertyPanelTool(e?null:"roof"),r.setState({viewMode:"3d"})},r.handleShowWindowEditorClicked=function(){var e="window"===r.state.propertyPanelTool;r.handleShowShellModeClicked(),r.setState({viewMode:"3d",selectedEdge:null,propertyPanelTool:e?null:"window"})},r.handleShowLayerEditorClicked=function(){var e="layer"===r.state.propertyPanelTool;r.setState({propertyPanelTool:e?null:"layer"})},r.handleSettingsClicked=function(){var e="settings"===r.state.propertyPanelTool;r.setState({propertyPanelTool:e?null:"settings"})},r.handleLayerUpdated=function(e){r.setState({layers:e})},r.handleLayerSelected=function(e){var t=e?e.value:null;r.setState({selectedLayerIndex:t,selectedEdge:null}),r.refBp3d.setActiveLayerIndex(t)},r.handleItemSelected=function(e){},r.handleWallClicked=function(e){var t=r.state.propertyPanelTool;if(r.setState({selectedEdge:e,selectedFloor:null,propertyPanelTool:"window"===t?"window":"texture"}),e)try{var n=e.wall.layer.layerIndex-100;r.setState({selectedLayerIndex:n})}catch(i){}},r.handleFloorClicked=function(e){var t=r.state.propertyPanelTool;r.setState({selectedEdge:null,selectedFloor:e,propertyPanelTool:"window"===t?"window":"texture"})},r.handleRoofFaceClicked=function(e){console.log("roof face clicked",e)},r.handleRoofVertexSelected=function(e){r.setState({selectedRoofVertex:e})},r.handleNothingClicked=function(){var e="window"===r.state.propertyPanelTool?"window":null;r.setState({selectedItem:null,selectedEdge:null,selectedFloor:null,propertyPanelTool:e})},r.handleProductClicked=function(){var e=Object(u.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.setState({showLoadingScreen:!0}),e.next=3,r.refBp3d.addItem(t);case 3:r.setState({showLoadingScreen:!1});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.handleDuplicateProduct=function(){r.state.selectedItem&&r.refBp3d.duplicateItem()},r.handleUndo=function(){r.refBp3d.undo(),r.setState({selectedItem:null,selectedRoofVertex:null,selectedEdge:null,selectedFloor:null})},r.handleRedo=function(){return r.refBp3d.redo()},r.handleSaveJson=function(){console.log("save");var e=r.refBp3d.getJSON();window.localStorage.setItem("bp3dJson",e),console.log(JSON.parse(e))},r.handleLoadJson=function(){console.log("load");var e=window.localStorage.getItem("bp3dJson");if(e&&e.length){var t=e;r.refBp3d.setJSON(t)}},r.handleSnapshot=function(){var e=r.refBp3d.takeSnapshot();console.log(e)},r._renderRightContainer=function(){return Object(b.jsxs)(b.Fragment,{children:[r._renderProductInfoPanel(),r._renderLayerInfoPanel(),r._renderRoofEditorPanel(),r._renderWindowEditorPanel(),r._renderTextureEditorPanel(),r._render2DWallEditorPanel(),r._render2DRoomEditorPanel(),r._render2DCornerEditorPanel(),r._render2DWallPropertyPanel(),r._renderSettingsPanel()]})},r._renderSettingsPanel=function(){var e=r.state,t=e.propertyPanelTool,n=e.measureUnit,i=e.showCompass;if("settings"===t)return Object(b.jsx)("div",{className:"right-container opened",children:Object(b.jsx)("div",{className:"product-info-container",children:Object(b.jsx)(zt,{unit:n,showCompass:i,onUnitChanged:function(e){return r.setState({measureUnit:e})},onChangeCompassVisibility:function(e){r.setState({showCompass:e}),r.refBp3d.setCompassVisible(e)},onClose:function(){r.setPropertyPanelTool(null),r.setState({selectedEdge:null,selectedFloor:null,propertyPanelTool:null})}})})})},r._renderTextureEditorPanel=function(){var e=r.state,t=e.viewMode,n=e.selectedEdge,i=e.selectedFloor,o=e.propertyPanelTool;if("3d"===t&&"texture"===o&&(n||i)){var a="";return n?a="wall":i&&(a="floor"),Object(b.jsx)("div",{className:"right-container opened",children:Object(b.jsx)("div",{className:"product-info-container",children:Object(b.jsx)(_t,{mode:a,edge:n,floor:i,onEdgeTextureChanged:r.refBp3d.setEdgeTexture,onClose:function(){r.setPropertyPanelTool(null),r.setState({selectedEdge:null,selectedFloor:null,propertyPanelTool:null})}})})})}},r._renderProductInfoPanel=function(){var e=r.state,t=e.propertyPanelTool,n=e.selectedItem;if("product"===t&&n)return Object(b.jsxs)("div",{className:"right-container opened",children:[Object(b.jsxs)("div",{className:"product-info-container",children:[Object(b.jsx)(wt,{info:n,onMorphChanged:function(e,t){r.refBp3d.setMorph(e,t),r.refBp3d.update(),r.forceUpdate()}}),Object(b.jsx)(vt,{info:n,onMaterialChange:function(e,t){r.refBp3d&&"function"===typeof r.refBp3d.updateMaterial&&r.refBp3d.updateMaterial(e,t)},onStyleChange:function(e,t){r.refBp3d&&"function"===typeof r.refBp3d.updateMaterial&&r.refBp3d.updateStyle(e,t)}})]}),Object(b.jsx)(dt,{info:n,onDuplicateProduct:r.handleDuplicateProduct,onDeleteActiveProduct:function(){n&&n.remove(),r.setState({selectedItem:null})}})]})},r._renderRoofEditorPanel=function(){var e=r.state,t=e.viewMode,n=e.propertyPanelTool,i=e.roofEditorMode,o=e.selectedRoofVertex,a=e.firstRoofEditMode;if("3d"===t&&"roof"===n)return Object(b.jsx)("div",{className:"right-container opened",children:Object(b.jsx)("div",{className:"product-info-container",children:Object(b.jsx)(jt,{isFirst:a,mode:i,roofVertex:o,onRegenerateClicked:function(e){r.refBp3d.regenerateRoof(e),r.setState({firstRoofEditMode:!1})},onModeChanged:function(e){return r.refBp3d.setRoofEditorMode(e)},onTransformControlAxisChanged:function(e){return r.refBp3d.setRoofEditorTransformControlAxis(e)},onEntireTextureChanged:function(e){return r.refBp3d.setRoofFaceTexture(null,e)},onClose:function(){r.setPropertyPanelTool(null),r.refBp3d.setRoofEditorEnabled(!1)}})})})},r._renderWindowEditorPanel=function(){var e=r.state,t=e.viewMode,n=e.propertyPanelTool,i=e.selectedLayerIndex,o=e.layers,a=e.selectedEdge;if("3d"===t&&"window"===n)return Object(b.jsx)("div",{className:"right-container opened",children:Object(b.jsx)("div",{className:"product-info-container",children:Object(b.jsx)(St,{layers:o,selectedLayerIndex:i,selectedEdge:a,onLayerSelected:r.handleLayerSelected,onClose:function(){r.setPropertyPanelTool(null),r.refBp3d.setRoofEditorEnabled(!1)},onAddWindows:r.refBp3d.addWindows,onRemoveWindows:r.refBp3d.removeWindows})})})},r._renderLayerInfoPanel=function(){var e=r.state,t=e.propertyPanelTool,n=e.layers,i=e.selectedLayerIndex;if("layer"===t)return Object(b.jsx)("div",{className:"right-container opened",children:Object(b.jsx)(kt,{activeIndex:i,layers:n,onClose:function(){return r.setPropertyPanelTool(null)},onLayerSelected:r.handleLayerSelected,onSetLayerVisible:r.refBp3d.setLayerVisible,onFloorThicknessChanged:r.refBp3d.setLayerFloorThickness,onHeightChanged:r.refBp3d.setLayerHeight,onCloneAboveLayer:r.refBp3d.cloneAboveLayer,onCloneBelowLayer:r.refBp3d.cloneBelowLayer,onMoveAboveLayer:r.refBp3d.moveAboveLayer,onMoveBelowLayer:r.refBp3d.moveBelowLayer,onRemoveLayer:r.refBp3d.removeLayer})})},r._render2DWallEditorPanel=function(){var e=r.state,t=e.viewMode,n=e.propertyPanelTool,i=e.selectedWall2D;if("2d"===t&&"floorplanner-2d"===n&&i)return Object(b.jsx)("div",{className:"right-container opened",children:Object(b.jsx)("div",{className:"product-info-container",children:Object(b.jsx)(Dt,{wall:i,onUpdate:r.refBp3d.update,onClose:function(){r.setPropertyPanelTool(null)}})})})},r._render2DWallPropertyPanel=function(){var e=r.state,t=e.viewMode,n=e.propertyPanelTool;if("2d"===t&&"floorplanner-wall-property"===n)return Object(b.jsx)("div",{className:"right-container opened",children:Object(b.jsx)("div",{className:"product-info-container",children:Object(b.jsx)(Dt,{onUpdate:r.refBp3d.update,onClose:function(){r.setPropertyPanelTool(null)}})})})},r._render2DRoomEditorPanel=function(){var e=r.state,t=e.viewMode,n=e.propertyPanelTool,i=e.selectedRoom2D;if("2d"===t&&"floorplanner-2d"===n&&i)return Object(b.jsx)("div",{className:"right-container opened",children:Object(b.jsx)("div",{className:"product-info-container",children:Object(b.jsx)(Lt,{room:i,onUpdate:r.refBp3d.update,onClose:function(){r.setPropertyPanelTool(null)}})})})},r._render2DCornerEditorPanel=function(){var e=r.state,t=e.viewMode,n=e.propertyPanelTool,i=e.selectedCorner2D;if("2d"===t&&"floorplanner-2d"===n&&i)return Object(b.jsx)("div",{className:"right-container opened",children:Object(b.jsx)("div",{className:"product-info-container",children:Object(b.jsx)(It,{corner:i,onUpdate:r.refBp3d.update,onClose:function(){r.setPropertyPanelTool(null)}})})})},r._renderSubTools=function(){var e=r.state,t=e.viewMode,n=e.subTool,i=e.selectedLayerIndex,o=e.floorPlannerMode,a=e.layers,s=e.autoMergeVertices,l=e.autoSplitVertices;return"2d"===t&&"floorplan"===n?Object(b.jsx)("div",{className:"sub-tools-section top transparent",children:Object(b.jsx)(gt,{mode:o,layers:a,autoMerge:s,autoSplit:l,selectedLayerIndex:i,onLayerSelected:r.handleLayerSelected,onModeChanged:function(e){r.refBp3d.setFloorplanMode(e),r.setState({selectedCorner2D:null,selectedWall2D:null,selectedRoom2D:null,propertyPanelTool:null}),e===qe&&r.setState({propertyPanelTool:"floorplanner-wall-property"})},onZoomIn:function(){return r.refBp3d.zoomInFloorPlanner()},onZoomOut:function(){return r.refBp3d.zoomOutFloorPlanner()},onResetZoom:function(){return r.refBp3d.resetZoomFloorPlanner()}})}):"3d"!==t||n?void 0:Object(b.jsx)("div",{className:"sub-tools-section top transparent",children:Object(b.jsx)(yt,{onZoomIn:function(){return r.refBp3d.zoomInScene()},onZoomOut:function(){return r.refBp3d.zoomOutScene()},onResetZoom:function(){return r.refBp3d.resetZoomScene()}})})},r._renderFloorplanDataTable=function(){var e=r.state,t=e.showMetadataTable,n=e.parsedPlanData;if(t)return Object(b.jsx)(Wt,{parsed:n,style:{width:"80%",height:"80%"},onClose:function(){return r.setState({showMetadataTable:!1})}})},r.state={viewMode:"3d",layers:[],shellMode:!1,showCompass:!1,activeCategory:0,subTool:null,propertyPanelTool:null,selectedLayerIndex:null,selectedItem:null,firstRoofEditMode:!0,selectedRoofVertex:null,selectWall:null,selectedFloor:null,selectedWall2D:null,selectedRoom2D:null,selectedCorner2D:null,measureUnit:"m",showLoadingScreen:!1,floorPlannerMode:0,autoMergeVertices:!1,autoSplitVertices:!1,roofEditorMode:0},r}return Object(d.a)(n,[{key:"render",value:function(){var e=this,t=this.state,n=t.viewMode,r=t.shellMode,i=t.propertyPanelTool,o=t.selectedItem,a=t.showLoadingScreen;return Object(b.jsx)("div",{className:"App",children:Object(b.jsx)("div",{className:"bp3d",children:Object(b.jsxs)("div",{className:"container",children:[Object(b.jsx)("div",{className:"left-container",children:Object(b.jsx)(pt,{viewMode:n,shellMode:r,showLayers:"layer"===i,showRoofEditor:"roof"===i,showWindowEditor:"window"===i,showSettings:"settings"===i,onShow3DViewClicked:this.handleShow3DViewClicked,onShow2DPlanner:this.handleShow2DPlannerClicked,onShellModePressed:this.handleShowShellModeClicked,onRoofPressed:this.handleShowRoofEditorClicked,onWindowPressed:this.handleShowWindowEditorClicked,onLayerPressed:this.handleShowLayerEditorClicked,onShowDimensionsToggled:function(t){e.refBp3d.setDimensionVisible(t)},onLockSceneToggled:function(t){e.refBp3d.setLocked(t)},onSnapToggled:function(t){e.refBp3d.setSnap(t)},onXRayToggled:function(t){e.refBp3d.setToggleXRay(t)},onCollectMetadataClicked:function(){e.setState({parsedPlanData:e.refBp3d.collectMetadata(),showMetadataTable:!0})},onUndo:this.handleUndo,onRedo:this.handleRedo,onSaveClicked:this.handleSaveJson,onLoadClicked:this.handleLoadJson,onSnapshotClicked:this.handleSnapshot,onSettingsClicked:this.handleSettingsClicked})}),Object(b.jsxs)("div",{className:"main-container ".concat(o?"":"wide"),children:[Object(b.jsx)("div",{className:"scenes-container",children:Object(b.jsx)(st,{ref:function(t){return e.refBp3d=t},viewMode:n,measureUnit:this.state.measureUnit,onLayersUpdated:this.handleLayerUpdated,onItemSelected:this.handleItemSelected,onWallClicked:this.handleWallClicked,onFloorClicked:this.handleFloorClicked,onRoofFaceClicked:this.handleRoofFaceClicked,onRoofVertexSelected:this.handleRoofVertexSelected,onNothingClicked:this.handleNothingClicked,onWall2DClicked:function(t){e.setState({selectedWall2D:t,propertyPanelTool:"floorplanner-2d"})},onRoom2DClicked:function(t){e.setState({selectedRoom2D:t,propertyPanelTool:"floorplanner-2d"})},onCorner2DClicked:function(t){e.setState({selectedCorner2D:t,propertyPanelTool:"floorplanner-2d"})},roofEditorModeChanged:function(t){return e.setState({roofEditorMode:t})},floorPlannerModeChanged:function(t){e.setState({floorPlannerMode:t})}})}),this._renderSubTools(),Object(b.jsx)("div",{className:"loading-container",style:{display:a?"flex":"none"},children:Object(b.jsx)("span",{children:"loading..."})})]}),this._renderRightContainer(),this._renderFloorplanDataTable()]})})})}}]),n}(o.a.Component)),At=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,56)).then((function(t){var n=t.getCLS,r=t.getFID,i=t.getFCP,o=t.getLCP,a=t.getTTFB;n(e),r(e),i(e),o(e),a(e)}))};s.a.render(Object(b.jsx)(o.a.StrictMode,{children:Object(b.jsx)(Vt,{})}),document.getElementById("root")),At()}},[[53,1,2]]]);