(this["webpackJsonpthreejs-building-configurator"]=this["webpackJsonpthreejs-building-configurator"]||[]).push([[0],{128:function(e,t,n){},129:function(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"dimInch",(function(){return T})),n.d(r,"dimFeet",(function(){return W})),n.d(r,"dimMeter",(function(){return P})),n.d(r,"dimCentiMeter",(function(){return I})),n.d(r,"dimMilliMeter",(function(){return L})),n.d(r,"unitScale",(function(){return D})),n.d(r,"Dimensioning",(function(){return R}));var o={};n.r(o),n.d(o,"configDimUnit",(function(){return z})),n.d(o,"configDefaultPathPrefix",(function(){return V})),n.d(o,"configWallHeight",(function(){return A})),n.d(o,"configWallThickness",(function(){return F})),n.d(o,"configWallThicknessDirection",(function(){return N})),n.d(o,"configWallIsOutside",(function(){return B})),n.d(o,"configFloorThickness",(function(){return _})),n.d(o,"configSceneLocked",(function(){return U})),n.d(o,"configXRayMode",(function(){return H})),n.d(o,"configSnapMode",(function(){return X})),n.d(o,"configDimensionVisible",(function(){return Y})),n.d(o,"configDimensionLabelVisible",(function(){return G})),n.d(o,"configShellMode",(function(){return J})),n.d(o,"configSnapTolernance",(function(){return q})),n.d(o,"configCompassVisible",(function(){return Z})),n.d(o,"configObstacleVisible",(function(){return K})),n.d(o,"Configuration",(function(){return $}));var i={};n.r(i),n.d(i,"ELogContext",(function(){return ee})),n.d(i,"ELogLevel",(function(){return te})),n.d(i,"logContext",(function(){return ne})),n.d(i,"isLogging",(function(){return re})),n.d(i,"log",(function(){return oe}));var a={};n.r(a),n.d(a,"Utils",(function(){return le})),n.d(a,"Utils3D",(function(){return ce}));var s={};n.r(s),n.d(s,"Version",(function(){return ue}));var l={};n.r(l),n.d(l,"BP3D_EVENT_CONFIG_CHANGED",(function(){return de})),n.d(l,"BP3D_EVENT_HIGHLIGHT_CHANGED",(function(){return he})),n.d(l,"BP3D_EVENT_ADD_TO_UNDO_STACK",(function(){return fe})),n.d(l,"BP3D_REQUEST_REDRAW_ROOF",(function(){return pe}));var c={};n.r(c),n.d(c,"Factory",(function(){return xt}));var u=n(5),d=n.n(u),h=n(26),f=n.n(h),p=n(2),v=n(3),g=n(6),y=n(7),m=n(15),b=n.n(m),x=n(18),w=n(12),j=n(10),k=n(0),O=n(55),C=n.n(O),E=n(1),S=function(e){Object(g.a)(n,e);var t=Object(y.a)(n);function n(){return Object(p.a)(this,n),t.apply(this,arguments)}return Object(v.a)(n,[{key:"render",value:function(){var e=this,t=this.props.hidden;return Object(E.jsx)("div",{style:{display:t?"none":"inherit",width:"100%",height:"100%"},children:Object(E.jsx)("div",{style:{width:"100%",height:"100%"},ref:function(t){return"function"===typeof e.props.onDomLoaded&&e.props.onDomLoaded(t)}})})}}]),n}(d.a.Component),M=n(14),T="inch",W="ft",P="m",I="cm",L="mm",D=1,R=function(){function e(){Object(p.a)(this,e)}return Object(v.a)(e,null,[{key:"getUnit",value:function(){switch(ve.Configuration.getStringValue(ve.configDimUnit)){case T:return"in";case L:return"mm";case I:return"cm";case P:default:return"m"}}},{key:"cmToMeasure",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;switch(ve.Configuration.getStringValue(ve.configDimUnit)){case T:return"".concat(Math.round(e/Math.pow(2.54,t))," in");case L:return"".concat(Math.round(e*Math.pow(10,t))," mm");case I:return"".concat(Math.round(10*e)/10," cm");case P:default:return"".concat(Math.round(e/Math.pow(100,t)*100)/100," m")}}},{key:"cmToMeasureWithoutUnit",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;switch(ve.Configuration.getStringValue(ve.configDimUnit)){case T:return Math.round(e/Math.pow(2.54,t));case L:return Math.round(e*Math.pow(10,t));case I:return Math.round(10*e)/10;case P:default:return Math.round(e/Math.pow(100,t)*100)/100}}},{key:"measureToCm",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;switch(ve.Configuration.getStringValue(ve.configDimUnit)){case T:return e*Math.pow(2.54,t);case L:return e/Math.pow(10,t);case I:return e;case P:default:return e*Math.pow(100,t)}}}]),e}(),z="dimUnit",V="defaultPathPrefix",A="wallHeight",F="wallThickness",N="wallThicknessDirection",B="wallIsOutside",_="floorThickness",U="scene-locked",H="xRay",X="snap",Y="dimensionVisible",G="dimensionLabelVisible",J="shellMode",q="snapTolerance",Z="compassVisible",K="obstacleVisible",Q=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_BLUEPRINT_ASSETS_PREFIX||"",$=function(){function e(){Object(p.a)(this,e)}return Object(v.a)(e,null,[{key:"setValue",value:function(e,t){this.data[e]=t,document.dispatchEvent(new CustomEvent(ve.BP3D_EVENT_CONFIG_CHANGED,{detail:Object(M.a)({},e,t)}))}},{key:"getStringValue",value:function(e){switch(e){case z:case V:return this.data[e];default:throw new Error("Invalid string configuration parameter: "+e)}}},{key:"getBooleanValue",value:function(e){switch(e){case U:case H:case X:case Y:case G:case J:case B:case Z:case K:return this.data[e];default:throw new Error("Invalid boolean configuration parameter: "+e)}}},{key:"getNumericValue",value:function(e){switch(e){case A:case F:case N:case _:case q:return this.data[e];default:throw new Error("Invalid numeric configuration parameter: "+e)}}}]),e}();$.data={defaultPathPrefix:"".concat(Q,"Blueprint3D-assets/"),dimUnit:P,wallHeight:2.5,wallThickness:.2,wallThicknessDirection:0,wallIsOutside:!0,floorThickness:.1,sceneLocked:!1,xRay:!1,snap:!0,snapTolerance:.2,dimensionVisible:!1,dimensionLabelVisible:!0,shellMode:!1,autoMergeVertices:!0,compassVisible:!0,obstacleVisible:!0};var ee={None:"None",All:"All",Interaction2d:"Interaction2d",Item:"Item",Wall:"Wall",Room:"Room"},te={Information:"Information",Warning:"Warning",Error:"Error",Fatal:"Fatal",Debug:"Debug"},ne=ee.None;function re(e,t){return ne===ee.All||ne===e||t===te.Warning||t===te.Error||t===te.Fatal}function oe(e,t,n){if(!1!==re(e,t)){var r="";switch(t){case te.Information:r="[INFO_] ";break;case te.Warning:r="[WARING] ";break;case te.Error:r="[ERROR] ";break;case te.Fatal:r="[FATAL] ";break;case te.Debug:r="[DEBUG] "}return r}}var ie=n(24),ae=n(56),se=n.n(ae),le=function(){function e(){Object(p.a)(this,e)}return Object(v.a)(e,null,[{key:"absoluteAngle",value:function(e,t){if(0===e&&0===t)return 0;var n=Math.atan(t/e);return 0===n?e<0&&(n=Math.PI):n===Math.PI||(n===-Math.PI/2?n=3*Math.PI/2:n>0?e<0&&t<0&&(n=Math.PI+n):e<0&&t>0?n=Math.PI+n:e>0&&t<0&&(n=2*Math.PI+n)),n}},{key:"projectionPointToLine",value:function(e,t,n,r,o,i){try{var a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[{x:0,y:0},{x:100,y:0}],n=JSON.parse(JSON.stringify(e)),r=JSON.parse(JSON.stringify(t));n[1].x-=n[0].x,n[1].y-=n[0].y,n[0]={x:0,y:0},r[1].x-=r[0].x,r[1].y-=r[0].y,r[0]={x:0,y:0};try{var o=(n[1].x*r[1].x+n[1].y*r[1].y)/(Math.sqrt(Math.pow(n[1].x,2)+Math.pow(n[1].y,2))*Math.sqrt(Math.pow(r[1].x,2)+Math.pow(r[1].y,2)));return o>1?o=1:o<-1&&(o=-1),Math.acos(o)}catch(i){return 0}}([{x:n,y:r},{x:e,y:t}],[{x:n,y:r},{x:o,y:i}]),s=Math.sqrt(Math.pow(n-o,2)+Math.pow(r-i,2)),l=Math.sqrt(Math.pow(n-e,2)+Math.pow(r-t,2))*Math.cos(a);return{x:n+(o-n)*l/s,y:r+(i-r)*l/s}}catch(c){return{x:0,y:0}}}},{key:"pointDistanceFromLine",value:function(t,n,r,o,i,a){var s=e.closestPointOnLine(t,n,r,o,i,a),l=t-s.x,c=n-s.y;return Math.sqrt(l*l+c*c)}},{key:"closestPointOnLine",value:function(e,t,n,r,o,i){var a,s,l=o-n,c=i-r,u=((e-n)*l+(t-r)*c)/(l*l+c*c);return u<0||n===o&&r===i?(a=n,s=r):u>1?(a=o,s=i):(a=n+u*l,s=r+u*c),{x:a,y:s}}},{key:"distance",value:function(e,t,n,r){return Math.sqrt(Math.pow(n-e,2)+Math.pow(r-t,2))}},{key:"angle",value:function(e,t,n,r){var o=e*n+t*r,i=e*r-t*n;return-Math.atan2(i,o)}},{key:"angle2pi",value:function(t,n,r,o){var i=e.angle(t,n,r,o);return i<0&&(i+=2*Math.PI),i}},{key:"isClockwise",value:function(t){for(var n=Math.min(0,Math.min.apply(null,e.map(t,(function(e){return e.x})))),r=Math.min(0,Math.min.apply(null,e.map(t,(function(e){return e.x})))),o=e.map(t,(function(e){return{x:e.x-n,y:e.y-r}})),i=0,a=0;a<o.length;a++){var s,l=o[a];i+=((s=a===o.length-1?o[0]:o[a+1]).x-l.x)*(s.y+l.y)}return i>=0}},{key:"guid",value:function(){var e=function(){return Math.floor(65536*(1+Math.random())).toString(16).slice(1)};return"".concat(e()+e(),"-").concat(e(),"-").concat(e(),"-").concat(e(),"-").concat(e()).concat(e()).concat(e())}},{key:"polygonPolygonIntersect",value:function(t,n){for(var r=0;r<t.length;r++){var o,i=t[r];if(o=r===t.length-1?t[0]:t[r+1],e.linePolygonIntersect(i.x,i.y,o.x,o.y,n))return!0}return!1}},{key:"linePolygonIntersect",value:function(t,n,r,o,i){for(var a=0;a<i.length;a++){var s,l=i[a];if(s=a===i.length-1?i[0]:i[a+1],e.lineLineIntersect(t,n,r,o,l.x,l.y,s.x,s.y))return!0}return!1}},{key:"findLineLineCrossPoint",value:function(e,t,n,r,o,i,a,s){var l=arguments.length>8&&void 0!==arguments[8]&&arguments[8];if(e===n&&t===r||o===a&&i===s)return!1;var c=(s-i)*(n-e)-(a-o)*(r-t);if(0===c)return!1;var u=((a-o)*(t-i)-(s-i)*(e-o))/c,d=((n-e)*(t-i)-(r-t)*(e-o))/c;if(l&&(u<0||u>1||d<0||d>1))return!1;var h=e+u*(n-e),f=t+u*(r-t);return{x:h,y:f}}},{key:"lineLineIntersect",value:function(e,t,n,r,o,i,a,s){function l(e,t,n){var r=e.x,o=e.y,i=t.x,a=t.y,s=n.x;return(n.y-o)*(i-r)>(a-o)*(s-r)}var c={x:e,y:t},u={x:n,y:r},d={x:o,y:i},h={x:a,y:s};return l(c,d,h)!==l(u,d,h)&&l(c,u,d)!==l(c,u,h)}},{key:"pointInPolygon",value:function(t,n,r,o,i){var a=0,s=0;if(void 0===o||void 0===i){for(var l=0;l<r.length;l++)a=Math.min(a,r[l].x),s=Math.min(a,r[l].y);o=a-10,i=s-10}var c=0;for(l=0;l<r.length;l++){var u,d=r[l];u=l===r.length-1?r[0]:r[l+1],e.lineLineIntersect(o,i,t,n,d.x,d.y,u.x,u.y)&&c++}return c%2===1}},{key:"polygonInsidePolygon",value:function(t,n,r,o){r=r||0,o=o||0;var i,a=Object(j.a)(t);try{for(a.s();!(i=a.n()).done;){var s=i.value;if(!e.pointInPolygon(s.x,s.y,n,r,o))return!1}}catch(l){a.e(l)}finally{a.f()}return!0}},{key:"polygonOutsidePolygon",value:function(t,n,r,o){r=r||0,o=o||0;var i,a=Object(j.a)(t);try{for(a.s();!(i=a.n()).done;){var s=i.value;if(e.pointInPolygon(s.x,s.y,n,r,o))return!1}}catch(l){a.e(l)}finally{a.f()}return!0}},{key:"forEach",value:function(e,t){var n,r=Object(j.a)(e);try{for(r.s();!(n=r.n()).done;){t(n.value)}}catch(o){r.e(o)}finally{r.f()}}},{key:"forEachIndexed",value:function(e,t){var n,r=Object(j.a)(e.entries());try{for(r.s();!(n=r.n()).done;){var o=Object(ie.a)(n.value,2);t(o[0],o[1])}}catch(i){r.e(i)}finally{r.f()}}},{key:"map",value:function(e,t){var n=[];return e.forEach((function(e){n.push(t(e))})),n}},{key:"removeIf",value:function(e,t){var n=[];return e.forEach((function(e){t(e)||n.push(e)})),n}},{key:"cycle",value:function(e,t){for(var n=e.slice(0),r=0;r<t;r++){var o=n.shift();n.push(o)}return n}},{key:"unique",value:function(e,t){var n,r=[],o={},i=Object(j.a)(e);try{for(i.s();!(n=i.n()).done;){var a=n.value;o.hasOwnProperty(a)||(r.push(a),o[t(a)]=!0)}}catch(s){i.e(s)}finally{i.f()}return r}},{key:"removeValue",value:function(e,t){for(var n=e.length-1;n>=0;n--)e[n]===t&&e.splice(n,1)}},{key:"subtract",value:function(t,n){return e.removeIf(t,(function(t){return e.hasValue(n,t)}))}},{key:"area",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!Array.isArray(e)||0===e.length)return 0;var t,n,r,o,i=e.length,a=0;for(t=0,n=i-1;t<i;n=t,t+=1)r=e[t],o=e[n],a+=r.x*o.y,a-=r.y*o.x;return a*=.5,Math.abs(a)}},{key:"centroid",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];try{var t=se()([e.map((function(e){return[e.x,e.y]}))]);return{x:t[0],y:t[1]}}catch(n){return{x:0,y:0}}}},{key:"argsort",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=Array.from(new Array(e.length),(function(e,t){return t}));return n.map((function(t,n){return[e[n],t]})).sort((function(e,n){return(Object(ie.a)(e,1)[0]-Object(ie.a)(n,1)[0])*t})).map((function(e){return Object(ie.a)(e,2)[1]}))}},{key:"getCyclicOrder",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;n||(n=new k.Sb(0,0));for(var r=[],o=0;o<t.length;o++){var i=t[o],a=i.clone().sub(n),s=Math.atan2(a.y,a.x),l=k.S.radToDeg(s);l=l>0?l:(l+360)%360,r.push(l)}var c=e.argsort(r),u=[],d=[];for(o=0;o<c.length;o++)u.push(r[c[o]]),d.push(t[c[o]]);return{indices:c,angles:u,points:d}}}]),e}();le.hasValue=function(e,t){var n,r=Object(j.a)(e);try{for(r.s();!(n=r.n()).done;){if(n.value===t)return!0}}catch(o){r.e(o)}finally{r.f()}return!1};var ce=function(){function e(){Object(p.a)(this,e)}return Object(v.a)(e,null,[{key:"checkIf4PointsOnSamePlane",value:function(e,t,n,r){var o=new k.Tb(t.x-e.x,t.y-e.y,t.z-e.z),i=new k.Tb(n.x-e.x,n.y-e.y,n.z-e.z),a=new k.Tb(r.x-e.x,r.y-e.y,r.z-e.z),s=o.clone().cross(i).normalize(),l=s.clone().negate(),c=i.clone().cross(a).normalize(),u=s.distanceTo(c),d=l.distanceTo(c);return u<1e-12||d<1e-12}},{key:"findLineLineCrossPoint",value:function(e,t,n,r){if(!this.checkIf4PointsOnSamePlane(e,t,n,r))return null;var o=le.findLineLineCrossPoint(e.x,e.z,t.x,t.z,n.x,n.z,r.x,r.z,!0);if(!o)return null;var i=new k.Tb(o.x,0,o.y),a=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.z-e.z,2)),s=Math.sqrt(Math.pow(i.x-e.x,2)+Math.pow(i.z-e.z,2));return i.y=e.y+(t.y-e.y)*s/a,i}},{key:"findLargestInscribedRectOfWallCorners",value:function(e){if(e.length<3)return null;for(var t=e[0].distanceTo(e[1]),n=e.map((function(t){return new k.Sb(Math.sqrt(Math.pow(t.x-e[0].x,2)+Math.pow(t.z-e[0].z,2)),t.y)})),r=2;r<n.length;r++)n[r].x>n[1].x&&(n[r].x=n[1].x),n[r].x<n[0].x&&(n[r].x=n[0].x);var o,i=0,a=1/0,s=-1/0,l=Object(j.a)(n);try{for(l.s();!(o=l.n()).done;){var c=o.value;c.y>i&&(i=c.y),c.x<a&&(a=c.x),c.x>s&&(s=c.x)}}catch(L){l.e(L)}finally{l.f()}for(var u=a-=1,d=s+=1,h=0,f=null,p=0,v=0,g=i-.01;g>0;g-=.01){for(var y=[],m=0;m<n.length;m++){var b=n[m],x=n[(m+1)%n.length],w=le.findLineLineCrossPoint(u,g,d,g,b.x,b.y,x.x,x.y,!0);w&&y.push(w)}if(2===y.length){var O=Math.abs(y[0].x-y[1].x),C=O*g;C>h&&(h=C,f=y,v=g,p=O)}}if(!f||2!==f.length)return null;for(var E={area:h,length:p,height:v,corners:[]},S=0,M=[{x:f[0].x,y:0},{x:f[1].x,y:0},{x:f[1].x,y:v},{x:f[0].x,y:v}];S<M.length;S++){var T=M[S],W=T.y,P=(e[1].x-e[0].x)*T.x/t+e[0].x,I=(e[1].z-e[0].z)*T.x/t+e[0].z;E.corners.push(new k.Tb(P,W,I))}return E}},{key:"drawVertexSpriteLabel",value:function(e,t){if(ve.Configuration.getBooleanValue(ve.configDimensionLabelVisible)){var n=e.canvas,r=n.getContext("2d");r.clearRect(0,0,n.width,n.height),r.font="Bold 16px Arial",r.textBaseline="middle",r.textAlign="center",r.fillStyle="rgba(0, 0, 255, 1)",r.fillText(t,n.width/2,n.height/2),r.strokeStyle="#ffffff",r.lineWidth=.1,r.strokeText(t,n.width/2,n.height/2)}}},{key:"makeVertexDimensionHelper",value:function(e){var t=e.clone();t.y+=.2;var n=document.createElement("canvas"),r=new k.Lb(n);r.needsUpdate=!0;var o=new k.Jb({map:r,depthTest:!1,transparent:!0}),i=new k.Ib(o);return i.scale.set(2,1.5,2),i.position.copy(t),i.renderOrder=100,i.vertex=e,i.canvas=n,i}},{key:"checkIsSamePlane",value:function(e,t){if(!e||!t)return!1;var n=e.normal,r=t.normal,o=e.constant,i=t.constant;return n.distanceTo(r)<.01&&Math.abs(o-i)<.01}}]),e}(),ue=function(){function e(){Object(p.a)(this,e)}return Object(v.a)(e,null,[{key:"getInformalVersion",value:function(){return"1.1"}},{key:"getTechnicalVersion",value:function(){return"1.1.0.0"}}]),e}();console.log("Blueprint3D ".concat(ue.getInformalVersion()," (").concat(ue.getTechnicalVersion(),")"));var de="bp3dEvent.config_changed",he="bp3dEvent.highlight_changed",fe="bp3dEvent.addToUndoStack",pe="bp3dEvent.request_redraw_roof",ve=Object(w.a)(Object(w.a)(Object(w.a)(Object(w.a)(Object(w.a)(Object(w.a)({},o),r),i),a),s),l),ge=[0,90,180,270,360],ye=function(e){Object(g.a)(n,e);var t=Object(y.a)(n);function n(e){var r;return Object(p.a)(this,n),(r=t.call(this,e)).handleCompassClicked=function(){var e=r.props.orientation,t=0;if(ge.includes(e)){var n=ge.indexOf(e);t=ge[(n+1)%ge.length]}else t=[].concat(ge).sort((function(t,n){return Math.abs(t-e)-Math.abs(n-e)}))[0],console.log(t);t%=360,r.props.onOrientationChanged(t)},r.handleGridSpacingChanged=function(e){var t=parseFloat(e.target.value,10),n=ve.Dimensioning.measureToCm(t)/100;r.props.onGridSpacingChanged(n)},r._renderCompass=function(){var e=r.props.orientation;return Object(E.jsxs)("div",{style:{position:"absolute",top:0,right:0},children:[Object(E.jsx)("div",{style:{display:"flex",width:150,height:150,alignItems:"center",justifyContent:"center"},children:Object(E.jsx)("img",{onClick:r.handleCompassClicked,style:{width:"70%",height:"70%",transform:"rotate(".concat(e||0,"deg)"),cursor:"pointer"},src:"/Blueprint3D-assets/textures/compass.png",alt:"compass"})}),Object(E.jsxs)("div",{style:{textAlign:"center"},children:[Object(E.jsx)("input",{type:"number",style:{textAlign:"right",width:50},step:1,min:0,max:360,value:e,onChange:function(e){var t=parseInt(e.target.value,10);e.target.value||(t=0),t<0&&(t=0),t>360&&(t=0),r.props.onOrientationChanged(t)}}),Object(E.jsx)("label",{children:" \xb0"})]})]})},r._renderGridSpacing=function(){var e=r.props,t=e.gridSpacing,n=(e.gridSpacingInCanvas,ve.Dimensioning.getUnit()),o=ve.Dimensioning.cmToMeasureWithoutUnit(100*t);return Object(E.jsxs)("div",{style:{position:"absolute",bottom:20,right:20,cursor:"pointer",display:"flex",flexDirection:"column",textAlign:"center"},children:[Object(E.jsx)("div",{children:"Grid Size"}),Object(E.jsxs)("div",{className:"grid-size-indicator",style:{width:50,height:50},children:[Object(E.jsx)("div",{className:"main-line"}),Object(E.jsx)("div",{className:"arrow-top"}),Object(E.jsx)("div",{className:"arrow-bottom"})]}),Object(E.jsxs)("div",{children:[Object(E.jsx)("input",{type:"number",style:{width:60},step:.1,value:o,onChange:r.handleGridSpacingChanged}),Object(E.jsx)("label",{children:n})]})]})},r.state={editGrid:!1},r}return Object(v.a)(n,[{key:"render",value:function(){var e=this,t=this.props.hidden;return Object(E.jsxs)("div",{style:{width:"100%",height:"100%",display:"block",position:"absolute",top:0,left:0,opacity:t?0:100,pointerEvents:t?"none":"inherit"},children:[Object(E.jsx)("canvas",{className:"canvas-floor-plan",ref:function(t){return"function"===typeof e.props.onDomLoaded&&e.props.onDomLoaded(t)},children:"Floor plan viewer"}),this._renderCompass(),this._renderGridSpacing()]})}}]),n}(d.a.Component),me=n(9),be=ve.Configuration.getNumericValue(ve.configSnapTolernance),xe=function(){function e(t,n,r,o){Object(p.a)(this,e),this.layer=null,this.wallStarts=[],this.wallEnds=[],this.moved_callbacks=[],this.deleted_callbacks=[],this.action_callbacks=[],this.locked=!1,this.angles=[],this.angleDirections=[],this.startAngles=[],this.endAngles=[],this.cyclicNeighbors=[],this.floorplan=t,this.x=n,this.y=r,this.id=o||ve.Utils.guid()}return Object(v.a)(e,[{key:"clone",value:function(){var e=this.x,t=this.y;return this.layer.newCorner(e,t)}},{key:"fireOnMove",value:function(e){this.moved_callbacks.push(e)}},{key:"fireOnDelete",value:function(e){this.deleted_callbacks.push(e)}},{key:"fireOnAction",value:function(e){this.action_callbacks.push(e)}},{key:"getX",value:function(){return this.x}},{key:"getY",value:function(){return this.y}},{key:"getLocation",value:function(){return new k.Sb(this.x,this.y)}},{key:"snap",value:function(){var e=this,t=this.getSnapByAxis(),n=this.getSnapByAngles(),r=[];t&&r.push(t),n&&r.push(n);var o=r.sort((function(t,n){return e.distanceFrom(t.x,t.y)-e.distanceFrom(n.x,n.y)}));o.length&&(this.x=o[0].x,this.y=o[0].y)}},{key:"getSnapByAxis",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:be,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;if(ve.Configuration.getBooleanValue(ve.configSnapMode)){n=n||{x:this.x,y:this.y};var r=!1;t=t||this.adjacentCorners();var o,i=Object(j.a)(t);try{for(i.s();!(o=i.n()).done;){var a=o.value;Math.abs(a.x-this.x)<e&&(n.x=a.x,r=!0),Math.abs(a.y-this.y)<e&&(n.y=a.y,r=!0)}}catch(s){i.e(s)}finally{i.f()}return r?n:null}}},{key:"getSnapByAngles",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;if(ve.Configuration.getBooleanValue(ve.configSnapMode)){var r=[30,45,60,90,120,135,150,210,225,240,270,300,315,330],o=this.adjacentCorners();if(!(o.length<2)){t=t||this.x,n=n||this.y;for(var i=new k.Sb(t,n),a=[],s=0;s<o.length;s++)a.push(new k.Sb(o[s].x,o[s].y));var l=ve.Utils.getCyclicOrder(a,i),c=l.indices,u=l.angles,d=c.length<3?1:c.length,h=function(){var t=(s+1)%c.length,n=c[s],o=c[t],l=a[n].clone(),d=a[o].clone(),h=Math.abs(u[t]-u[s]),f=[].concat(r).sort((function(e,t){return Math.abs(e-h)-Math.abs(t-h)}))[0];if(Math.abs(f-h)>e)return"continue";var p=f-h,v=d.clone().rotateAround(i.clone(),p*Math.PI/180),g=i.clone().add(d.clone().sub(v)),y=ve.Utils.findLineLineCrossPoint(l.x,l.y,i.x,i.y,d.x,d.y,g.x,g.y);return y?(180===f&&console.log(y),{v:{x:y.x,y:y.y}}):void 0};for(s=0;s<d;s++){var f=h();if("continue"!==f&&"object"===typeof f)return f.v}return null}}}},{key:"relativeMove",value:function(e,t){this.locked||this.move(this.x+e,this.y+t)}},{key:"fireAction",value:function(e){this.action_callbacks.forEach((function(t){return"function"===typeof t&&t(e)}))}},{key:"remove",value:function(){var e=this;this.deleted_callbacks.forEach((function(t){return"function"===typeof t&&t(e)}))}},{key:"removeAll",value:function(){[].concat(Object(me.a)(this.wallStarts),Object(me.a)(this.wallEnds)).forEach((function(e){return e.remove()})),this.remove()}},{key:"move",value:function(e,t){var n=this,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!this.locked){var o=this.x,i=this.y;this.x=e,this.y=t,r&&this.mergeWithIntersected(),this.moved_callbacks.forEach((function(e){return"function"===typeof e&&e(n.x,n.y,o,i)})),this.wallStarts.forEach((function(e){e.fireMoved()})),this.wallEnds.forEach((function(e){e.fireMoved()}))}}},{key:"adjacentCorners",value:function(){for(var e=[],t=0;t<this.wallStarts.length;t++)e.push(this.wallStarts[t].getEnd());for(t=0;t<this.wallEnds.length;t++)e.push(this.wallEnds[t].getStart());return e}},{key:"isWallConnected",value:function(e){for(var t=0;t<this.wallStarts.length;t++)if(this.wallStarts[t]===e)return!0;for(t=0;t<this.wallEnds.length;t++)if(this.wallEnds[t]===e)return!0;return!1}},{key:"distanceFrom",value:function(e,t){return ve.Utils.distance(e,t,this.x,this.y)}},{key:"distanceFromWall",value:function(e){return e.distanceFrom(this.x,this.y)}},{key:"distanceFromCorner",value:function(e){return this.distanceFrom(e.x,e.y)}},{key:"detachWall",value:function(e){ve.Utils.removeValue(this.wallStarts,e),ve.Utils.removeValue(this.wallEnds,e),0===this.wallStarts.length&&0===this.wallEnds.length&&this.remove()}},{key:"attachStart",value:function(e){this.wallStarts.push(e)}},{key:"attachEnd",value:function(e){this.wallEnds.push(e)}},{key:"wallTo",value:function(e){for(var t=0;t<this.wallStarts.length;t++)if(this.wallStarts[t].getEnd()===e)return this.wallStarts[t];return null}},{key:"wallFrom",value:function(e){for(var t=0;t<this.wallEnds.length;t++)if(this.wallEnds[t].getStart()===e)return this.wallEnds[t];return null}},{key:"wallToOrFrom",value:function(e){return this.wallTo(e)||this.wallFrom(e)}},{key:"combineWithCorner",value:function(e){this.x=e.x,this.y=e.y;for(var t=e.wallStarts.length-1;t>=0;t--)e.wallStarts[t].setStart(this);for(t=e.wallEnds.length-1;t>=0;t--)e.wallEnds[t].setEnd(this);e.removeAll(),this.removeDuplicateWalls()}},{key:"mergeWithIntersected",value:function(){var e=this,t=this.layer;if(t){for(var n=t.getCorners(),r=0;r<n.length;r++){var o=n[r];if(this.distanceFromCorner(o)<be&&o!==this)return this.combineWithCorner(o),!0}var i=t.getWalls(),a=t.getRooms();for(r=0;r<i.length;r++){var s=i[r];if(this.distanceFromWall(s)<be&&!this.isWallConnected(s)){var l=function(){var n=ve.Utils.closestPointOnLine(e.x,e.y,s.getStart().x,s.getStart().y,s.getEnd().x,s.getEnd().y);e.x=n.x,e.y=n.y,s.removeItems();var r=t.height,o=t.newWall(e,s.getEnd(),r,!0);try{o.thickness=s.thickness,o.thicknessDirection=s.thicknessDirection,o.isOutsideWall=s.isOutsideWall,o.interiorTexture=s.interiorTexture,o.exteriorTexture=s.exteriorTexture}catch(c){console.log(c)}var i=s.start,l=s.end;return a.forEach((function(t){var n=t.corners;n.includes(i)&&n.includes(l)&&t.corners.push(e)})),s.setEnd(e),{v:!0}}();if("object"===typeof l)return l.v}}return!1}}},{key:"removeDuplicateWalls",value:function(){for(var e={},t={},n=this.wallStarts.length-1;n>=0;n--)this.wallStarts[n].getEnd()===this||this.wallStarts[n].getEnd().id in e?this.wallStarts[n].remove():e[this.wallStarts[n].getEnd().id]=!0;for(n=this.wallEnds.length-1;n>=0;n--)this.wallEnds[n].getStart()===this||this.wallEnds[n].getStart().id in t?this.wallEnds[n].remove():t[this.wallEnds[n].getStart().id]=!0}},{key:"setLocked",value:function(e){this.locked=e}},{key:"updateAngles",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=this.adjacentCorners();if(e&&t.push(e),this.angles=[],this.angleDirections=[],this.startAngles=[],this.endAngles=[],this.cyclicNeighbors=[],!(t.length<2)){for(var n=new k.Sb(this.x,this.y),r=[],o=0;o<t.length;o++)r.push(new k.Sb(t[o].x,t[o].y));var i=ve.Utils.getCyclicOrder(r,n),a=i.indices,s=i.angles,l=a.length<3?1:a.length;for(o=0;o<l;o++){var c=(o+1)%a.length,u=a[o],d=a[c],h=r[u].clone().sub(n).normalize(),f=r[d].clone().sub(n).normalize(),p=h.add(f).normalize().multiplyScalar(.4),v=Math.abs(s[c]-s[o]);v=v>180?360-v:v,v=Math.round(10*v)/10,this.startAngles.push(s[o]),this.endAngles.push(s[c]),this.angles.push(v),this.angleDirections.push(p),this.cyclicNeighbors.push(t[a[o]])}}}}]),e}(),we=function(){function e(t,n,r){var o=this;Object(p.a)(this,e),this.layerOffset=0,this.plane=null,this.interiorWallPoints=[],this.validInteriorWallPoints=[],this.exteriorWallPoints=[],this.validExteriorWallPoints=[],this.interiorTransform=new k.V,this.invInteriorTransform=new k.V,this.exteriorTransform=new k.V,this.invExteriorTransform=new k.V,this.redrawCallbacks=[],this.getPolygon=function(e){var t=[];if(Array.isArray(e)&&e.length>2){var n,r=e[0],o=Object(j.a)(e);try{for(o.s();!(n=o.n()).done;){var i=n.value,a=Math.sqrt(Math.pow(i.x-r.x,2)+Math.pow(i.z-r.z,2)),s=i.y;t.push({x:a,y:s})}}catch(l){o.e(l)}finally{o.f()}}return t},this.adjustWallItems=function(e){var t=o.getPolygon(e);if(t.length>2){var n=e[0],r=o.wall.layer.offset;o.wall.items.forEach((function(e){var i=e.halfSize,a=e.calculatedPosition||e.position,s=a.x,l=a.y,c=a.z,u=2*i.x-.05,d=2*i.y-.05,h=Math.sqrt(Math.pow(s-n.x,2)+Math.pow(c-n.z,2)),f=[{x:h-u/2,y:l-r},{x:h+u/2,y:l-r},{x:h+u/2,y:l-r+d},{x:h-u/2,y:l-r+d}];ve.Utils.polygonInsidePolygon(f,t)||o.wall.removeItem(e)}))}},this.setInteriorWallPoints=function(e){var t,n=[],r=Object(j.a)(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;i.x=Math.round(100*i.x)/100,i.y=Math.round(100*i.y)/100,i.z=Math.round(100*i.z)/100,n.push(i)}}catch(a){r.e(a)}finally{r.f()}o.interiorWallPoints=n.map((function(e){return e.clone()})),o.validInteriorWallPoints=n.map((function(e){return e.clone()}))},this.setExteriorWallPoints=function(e){var t,n=[],r=Object(j.a)(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;i.x=Math.round(100*i.x)/100,i.y=Math.round(100*i.y)/100,i.z=Math.round(100*i.z)/100,n.push(i)}}catch(a){r.e(a)}finally{r.f()}o.exteriorWallPoints=n.map((function(e){return e.clone()})),o.validExteriorWallPoints=n.map((function(e){return e.clone()}))},this.adjustWallPoints=function(){var e,t=3*o.wall.thickness,n=Object(j.a)(o.validExteriorWallPoints);try{for(n.s();!(e=n.n()).done;){var r=e.value;if(r.y>0){var i,a=null,s=1/0,l=Object(j.a)(o.validInteriorWallPoints);try{for(l.s();!(i=l.n()).done;){var c=i.value;c.y>0&&r.distanceTo(c)<s&&(a=c,s=r.distanceTo(c))}}catch(m){l.e(m)}finally{l.f()}if(!a)continue;s<t&&r.y>a.y&&(r.y=a.y)}}}catch(m){n.e(m)}finally{n.f()}var u,d=Object(j.a)(o.validInteriorWallPoints);try{for(d.s();!(u=d.n()).done;){var h=u.value;if(h.y>0){var f,p=null,v=1/0,g=Object(j.a)(o.validExteriorWallPoints);try{for(g.s();!(f=g.n()).done;){var y=f.value;y.y>0&&h.distanceTo(y)<v&&(p=y,v=h.distanceTo(y))}}catch(m){g.e(m)}finally{g.f()}if(!p)continue;v<t&&h.y>p.y&&(h.y=p.y)}}}catch(m){d.e(m)}finally{d.f()}o.adjustWallItems(o.validInteriorWallPoints),o.adjustWallItems(o.validExteriorWallPoints)},this.generatePlane=function(){var e=this;function t(t){return new k.Tb(t.x,e.layerOffset,t.y)}var n=t(this.interiorStart()),r=t(this.interiorEnd()),o=r.clone();o.y+=this.wall.height;var i=n.clone();i.y+=this.wall.height;var a=new k.w;a.vertices=[n,r,o,i],a.faces.push(new k.s(0,1,2)),a.faces.push(new k.s(0,2,3)),a.computeFaceNormals(),a.computeBoundingBox(),this.plane=new k.W(a,new k.X),this.plane.visible=!1,this.plane.edge=this,this.computeTransforms(this.interiorTransform,this.invInteriorTransform,this.interiorStart(),this.interiorEnd()),this.computeTransforms(this.exteriorTransform,this.invExteriorTransform,this.exteriorStart(),this.exteriorEnd())},this.layer=t,this.wall=n,this.offset=n.thickness/2,this.height=n.height,this.layerOffset=r,this.wall.edge=this}return Object(v.a)(e,[{key:"getTexture",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return e?this.wall.interiorTexture:this.wall.exteriorTexture}},{key:"setTexture",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n={url:e,stretch:1,scale:1,width:1,height:1},r=this.isInterior,o=this.isExterior;r&&this.wall.setInteriorTexture(n,t),o&&this.wall.setExteriorTexture(n,t)}},{key:"interiorArea",value:function(){var e=this.interiorWallPoints;if(0===e.length)return 0;var t=[];t.push({x:0,y:0});for(var n=1;n<e.length;n++){var r=Math.sqrt(Math.pow(e[n].x-e[0].x,2)+Math.pow(e[n].z-e[0].z,2)),o=e[n].y-e[0].y;t.push({x:r,y:o})}return ve.Utils.area(t)}},{key:"exteriorArea",value:function(){var e=this.exteriorWallPoints;if(0===e.length)return 0;var t=[];t.push({x:0,y:0});for(var n=1;n<e.length;n++){var r=Math.sqrt(Math.pow(e[n].x-e[0].x,2)+Math.pow(e[n].z-e[0].z,2)),o=e[n].y-e[0].y;t.push({x:r,y:o})}return ve.Utils.area(t)}},{key:"interiorDistance",value:function(){var e=this.interiorStart(),t=this.interiorEnd();return ve.Utils.distance(e.x,e.y,t.x,t.y)}},{key:"exteriorDistance",value:function(){var e=this.exteriorStart(),t=this.exteriorEnd();return ve.Utils.distance(e.x,e.y,t.x,t.y)}},{key:"computeTransforms",value:function(e,t,n,r){var o=n,i=r,a=ve.Utils.angle(1,0,i.x-o.x,i.y-o.y),s=new k.V;s.makeTranslation(-o.x,0,-o.y);var l=new k.V;l.makeRotationY(-a),e.multiplyMatrices(l,s),t.copy(e).invert()}},{key:"distanceTo",value:function(e,t){return ve.Utils.pointDistanceFromLine(e,t,this.interiorStart().x,this.interiorStart().y,this.interiorEnd().x,this.interiorEnd().y)}},{key:"getStart",value:function(){return this.wall.getStart()}},{key:"getEnd",value:function(){return this.wall.getEnd()}},{key:"interiorLine",value:function(){var e=this.wall,t=e.start,n=e.end,r=e.thickness,o=e.thicknessDirection,i=new k.Sb,a=e.getWallLength(),s=1;o>0?s=0:o<0&&(s=2),s*=.5;var l=e.toVec2().rotateAround(i,-Math.PI/2).multiplyScalar(r/a*s);return{start:{x:t.x+l.x,y:t.y+l.y},end:{x:n.x+l.x,y:n.y+l.y}}}},{key:"exteriorLine",value:function(){var e=this.wall,t=e.start,n=e.end,r=e.thickness,o=e.thicknessDirection,i=new k.Sb,a=e.getWallLength(),s=1;o>0?s=2:o<0&&(s=0),s*=.5;var l=e.toVec2().rotateAround(i,Math.PI/2).multiplyScalar(r/a*s);return{start:{x:t.x+l.x,y:t.y+l.y},end:{x:n.x+l.x,y:n.y+l.y}}}},{key:"getEdgeCrossPoints",value:function(e,t,n){var r=[],o=.1;return[t.interiorLine(),t.exteriorLine()].forEach((function(t){if(!(n>.9*Math.PI&&n<1.1*Math.PI||n<Math.PI*o||n>1.9*Math.PI)){var i=ve.Utils.findLineLineCrossPoint(e.start.x,e.start.y,e.end.x,e.end.y,t.start.x,t.start.y,t.end.x,t.end.y);i&&r.push(i)}})),r}},{key:"calculateAngle",value:function(e,t){var n=e.angleTo(t);return e.clone().cross(t).y<0&&(n=2*Math.PI-n),n}},{key:"sortWalls",value:function(e,t,n,r){var o=this;try{var i=this.wall.oppositeCorner(t),a=new k.Tb(i.x-t.x,0,i.y-t.y);return e.filter((function(e){return e!==o.wall})).sort((function(e,r){try{var i=e.oppositeCorner(t),s=r.oppositeCorner(t),l=new k.Tb(i.x-t.x,0,i.y-t.y),c=new k.Tb(s.x-t.x,0,s.y-t.y);return(o.calculateAngle(a,l)-o.calculateAngle(a,c))*n}catch(u){return 0}}))}catch(s){return e}}},{key:"findBestCandidate",value:function(e,t,n,r,o,i){var a=e[0],s=new k.Tb(r.x-o.x,0,r.y-o.y);try{var l=a.oppositeCorner(i),c=new k.Tb(l.x-i.x,0,l.y-i.y),u=this.calculateAngle(s,c);n<0&&(u=2*Math.PI-u),t.sort((function(e,t){var n=Math.sqrt(Math.pow(e.x-r.x,2)+Math.pow(e.y-r.y,2));return(Math.sqrt(Math.pow(t.x-r.x,2)+Math.pow(t.y-r.y,2))-n)*(u>Math.PI?1:-1)}))}catch(d){}return t[0]}},{key:"interiorEnd",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=this.wall.thicknessDirection;if(t&&n>0)return this.midEnd();var r=this.interiorLine(),o=this.wall.end,i=[],a=[],s=this.sortWalls([].concat(Object(me.a)(o.wallStarts),Object(me.a)(o.wallEnds)),o,-1);s.length&&a.push(s[0]);var l=new k.Tb(r.start.x-r.end.x,0,r.start.y-r.end.y);return a.forEach((function(t){try{var n=t.oppositeCorner(o),a=new k.Tb(n.x-o.x,0,n.y-o.y),s=e.calculateAngle(l,a,-1),c=t.edge;c&&i.push.apply(i,Object(me.a)(e.getEdgeCrossPoints(r,c,s)))}catch(u){}})),0===i.length?r.end:this.findBestCandidate(a,i,-1,r.start,r.end,o)}},{key:"interiorStart",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=this.wall.thicknessDirection;if(t&&n>0)return this.midStart();var r=this.interiorLine(),o=this.wall.start,i=[],a=[],s=this.sortWalls([].concat(Object(me.a)(o.wallStarts),Object(me.a)(o.wallEnds)),o,1);s.length&&a.push(s[0]);var l=new k.Tb(r.end.x-r.start.x,0,r.end.y-r.start.y);return a.forEach((function(t){try{var n=t.oppositeCorner(o),a=new k.Tb(n.x-o.x,0,n.y-o.y),s=e.calculateAngle(l,a,1),c=t.edge;c&&i.push.apply(i,Object(me.a)(e.getEdgeCrossPoints(r,c,s)))}catch(u){}})),0===i.length?r.start:this.findBestCandidate(a,i,1,r.end,r.start,o)}},{key:"interiorCenter",value:function(){return{x:(this.interiorStart().x+this.interiorEnd().x)/2,y:(this.interiorStart().y+this.interiorEnd().y)/2}}},{key:"exteriorEnd",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=this.wall.thicknessDirection;if(t&&n<0)return this.midEnd();var r=this.exteriorLine(),o=this.wall.end,i=[],a=[],s=this.sortWalls([].concat(Object(me.a)(o.wallStarts),Object(me.a)(o.wallEnds)),o,1);s.length&&a.push(s[0]);var l=new k.Tb(r.start.x-r.end.x,0,r.start.y-r.end.y);return a.forEach((function(t){try{var n=t.oppositeCorner(o),a=new k.Tb(n.x-o.x,0,n.y-o.y),s=e.calculateAngle(l,a,1),c=t.edge;c&&i.push.apply(i,Object(me.a)(e.getEdgeCrossPoints(r,c,s)))}catch(u){}})),0===i.length?r.end:this.findBestCandidate(a,i,1,r.start,r.end,o)}},{key:"exteriorStart",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=this.wall.thicknessDirection;if(t&&n<0)return this.midStart();var r=this.exteriorLine(),o=this.wall.start,i=[],a=[],s=this.sortWalls([].concat(Object(me.a)(o.wallStarts),Object(me.a)(o.wallEnds)),o,-1);s.length&&a.push(s[0]);var l=new k.Tb(r.end.x-r.start.x,0,r.end.y-r.start.y);return a.forEach((function(t){try{var n=t.oppositeCorner(o),a=new k.Tb(n.x-o.x,0,n.y-o.y),s=e.calculateAngle(l,a,-1),c=t.edge;c&&i.push.apply(i,Object(me.a)(e.getEdgeCrossPoints(r,c,s)))}catch(u){}})),0===i.length?r.start:this.findBestCandidate(a,i,-1,r.end,r.start,o)}},{key:"midStart",value:function(){var e=this.wall.start;return{x:e.x,y:e.y}}},{key:"midEnd",value:function(){var e=this.wall.end;return{x:e.x,y:e.y}}},{key:"corners",value:function(){var e=this.wall.start,t=-9===e.x&&6===e.y;return[this.midStart(t),this.interiorStart(t),this.interiorEnd(t),this.midEnd(t),this.exteriorEnd(t),this.exteriorStart(t)]}}]),e}(),je=n(16),ke=function(e){Object(g.a)(n,e);var t=Object(y.a)(n);function n(e,r){var o;return Object(p.a)(this,n),(o=t.call(this)).scene=e.scene,o.item=r,o.frameMaterial=new k.Y({color:14540253}),o.offsetCenter=new k.Tb,o.canvasDepth=document.createElement("canvas"),o.canvasWidth=document.createElement("canvas"),o.canvasHeight=document.createElement("canvas"),o.sizeOrigin=JSON.parse(JSON.stringify(r.halfSize)),o.configFrames(),o.configLabels(),o.drawLabels(o.item.halfSize),ve.Configuration.getBooleanValue(ve.configDimensionVisible)||(o.visible=!1),document.addEventListener(ve.BP3D_EVENT_CONFIG_CHANGED,(function(e){var t=e.detail;t&&(t.dimUnit&&o.update(),t.hasOwnProperty(ve.configDimensionVisible)&&(t[ve.configDimensionVisible]?o.visible=!0:o.visible=!1))})),o}return Object(v.a)(n,[{key:"update",value:function(){var e=this.item.halfSize;this.drawLabels(e);var t=this.item.getBounding(),n=new k.Tb((t.max.x+t.min.x)/2,(t.max.y+t.min.y)/2,(t.max.z+t.min.z)/2);this.offsetCenter=n.sub(this.item.position);for(var r=0;r<this.children.length;r++){var o=this.children[r];r>=0&&r<4?(o.scale.z=e.z/this.sizeOrigin.z,r%4===0&&o.position.set(-e.x+this.offsetCenter.x,e.y+this.offsetCenter.y,this.offsetCenter.z),r%4===1&&o.position.set(e.x+this.offsetCenter.x,e.y+this.offsetCenter.y,this.offsetCenter.z),r%4===2&&o.position.set(e.x+this.offsetCenter.x,-e.y+this.offsetCenter.y,this.offsetCenter.z),r%4===3&&o.position.set(-e.x+this.offsetCenter.x,-e.y+this.offsetCenter.y,this.offsetCenter.z)):r>=4&&r<8?(o.scale.x=e.x/this.sizeOrigin.x,r%4===0&&o.position.set(this.offsetCenter.x,-e.y+this.offsetCenter.y,e.z+this.offsetCenter.z),r%4===1&&o.position.set(this.offsetCenter.x,e.y+this.offsetCenter.y,e.z+this.offsetCenter.z),r%4===2&&o.position.set(this.offsetCenter.x,e.y+this.offsetCenter.y,-e.z+this.offsetCenter.z),r%4===3&&o.position.set(this.offsetCenter.x,-e.y+this.offsetCenter.y,-e.z+this.offsetCenter.z)):r>=8&&r<12?(o.scale.y=e.y/this.sizeOrigin.y,r%4===0&&o.position.set(-e.x+this.offsetCenter.x,this.offsetCenter.y,e.z+this.offsetCenter.z),r%4===1&&o.position.set(e.x+this.offsetCenter.x,this.offsetCenter.y,e.z+this.offsetCenter.z),r%4===2&&o.position.set(e.x+this.offsetCenter.x,this.offsetCenter.y,-e.z+this.offsetCenter.z),r%4===3&&o.position.set(-e.x+this.offsetCenter.x,this.offsetCenter.y,-e.z+this.offsetCenter.z)):r>=12&&r<16?(o.material.map.needsUpdate=!0,r%4===0&&o.position.set(-e.x+this.offsetCenter.x,e.y+this.offsetCenter.y,this.offsetCenter.z),r%4===1&&o.position.set(e.x+this.offsetCenter.x,e.y+this.offsetCenter.y,this.offsetCenter.z),r%4===2&&o.position.set(e.x+this.offsetCenter.x,-e.y+this.offsetCenter.y,this.offsetCenter.z),r%4===3&&o.position.set(-e.x+this.offsetCenter.x,-e.y+this.offsetCenter.y,this.offsetCenter.z)):r>=16&&r<20?(o.material.map.needsUpdate=!0,r%4===0&&o.position.set(this.offsetCenter.x,e.y+this.offsetCenter.y,e.z+this.offsetCenter.z),r%4===1&&o.position.set(this.offsetCenter.x,-e.y+this.offsetCenter.y,e.z+this.offsetCenter.z),r%4===2&&o.position.set(this.offsetCenter.x,e.y+this.offsetCenter.y,-e.z+this.offsetCenter.z),r%4===3&&o.position.set(this.offsetCenter.x,-e.y+this.offsetCenter.y,-e.z+this.offsetCenter.z)):r>=20&&r<24&&(o.material.map.needsUpdate=!0,r%4===0&&o.position.set(-e.x+this.offsetCenter.x,this.offsetCenter.y,e.z+this.offsetCenter.z),r%4===1&&o.position.set(e.x+this.offsetCenter.x,this.offsetCenter.y,e.z+this.offsetCenter.z),r%4===2&&o.position.set(e.x+this.offsetCenter.x,this.offsetCenter.y,-e.z+this.offsetCenter.z),r%4===3&&o.position.set(-e.x+this.offsetCenter.x,this.offsetCenter.y,-e.z+this.offsetCenter.z))}}},{key:"configFrames",value:function(){var e=this.item.halfSize,t=.002,n=new k.h(t,t,2*e.z),r=new k.W(n,this.frameMaterial),o=(new k.W).copy(r),i=(new k.W).copy(r),a=(new k.W).copy(r);r.position.set(-e.x,e.y,0),o.position.set(e.x,e.y,0),i.position.set(e.x,-e.y,0),a.position.set(-e.x,-e.y,0),r.name="top-left",o.name="top-right",i.name="bottom-right",a.name="bottom-left",this.add(r),this.add(o),this.add(i),this.add(a);var s=new k.h(2*e.x,t,t),l=new k.W(s,this.frameMaterial),c=(new k.W).copy(l),u=(new k.W).copy(l),d=(new k.W).copy(l);l.position.set(0,-e.y,e.z),c.position.set(0,e.y,e.z),u.position.set(0,e.y,-e.z),d.position.set(0,-e.y,-e.z),this.add(l),this.add(c),this.add(u),this.add(d);var h=new k.h(t,2*e.y,t),f=new k.W(h,this.frameMaterial),p=(new k.W).copy(f),v=(new k.W).copy(f),g=(new k.W).copy(f);f.position.set(-e.x,0,e.z),p.position.set(e.x,0,e.z),v.position.set(e.x,0,-e.z),g.position.set(-e.x,0,-e.z),this.add(f),this.add(p),this.add(v),this.add(g)}},{key:"configLabels",value:function(){var e=this.item.halfSize,t=this.makeTextSprite(this.canvasDepth),n=(new k.Ib).copy(t),r=(new k.Ib).copy(t),o=(new k.Ib).copy(t);t.position.set(-e.x,e.y,0),n.position.set(e.x,e.y,0),r.position.set(e.x,-e.y,0),o.position.set(-e.x,-e.y,0),n.visible=r.visible=o.visible=!1,this.add(t),this.add(n),this.add(r),this.add(o);var i=this.makeTextSprite(this.canvasWidth),a=(new k.Ib).copy(i),s=(new k.Ib).copy(i),l=(new k.Ib).copy(i);i.position.set(0,e.y,e.z),a.position.set(0,-e.y,e.z),s.position.set(0,e.y,-e.z),l.position.set(0,-e.y,-e.z),a.visible=s.visible=l.visible=!1,this.add(i),this.add(a),this.add(s),this.add(l);var c=this.makeTextSprite(this.canvasHeight),u=(new k.Ib).copy(c),d=(new k.Ib).copy(c),h=(new k.Ib).copy(c);c.position.set(-e.x,0,e.z),u.position.set(e.x,0,e.z),d.position.set(e.x,0,-e.z),h.position.set(-e.x,0,-e.z),u.visible=d.visible=h.visible=!1,this.add(c),this.add(u),this.add(d),this.add(h)}},{key:"setSelected",value:function(){this.frameMaterial.color.setHex(16711680)}},{key:"setUnselected",value:function(){this.frameMaterial.color.setHex(14540253)}},{key:"drawLabels",value:function(e){this.drawCanvas(this.canvasDepth,ve.Dimensioning.cmToMeasure(2*e.z*100),{fontsize:24,color:{r:0,g:0,b:255,a:1}}),this.drawCanvas(this.canvasWidth,ve.Dimensioning.cmToMeasure(2*e.x*100),{fontsize:24,color:{r:255,g:0,b:0,a:1}}),this.drawCanvas(this.canvasHeight,ve.Dimensioning.cmToMeasure(2*e.y*100),{fontsize:24,color:{r:0,g:255,b:0,a:1}})}},{key:"drawCanvas",value:function(e,t,n){void 0===n&&(n={});var r=n.hasOwnProperty("fontface")?n.fontface:"Arial",o=n.hasOwnProperty("fontsize")?n.fontsize:18,i=n.hasOwnProperty("color")?n.color:{r:0,g:0,b:0,a:1},a=e.getContext("2d");a.clearRect(0,0,e.width,e.height),a.font="Bold ".concat(o,"px ").concat(r),a.textBaseline="middle",a.textAlign="center",a.fillStyle="rgba(".concat(i.r,",").concat(i.g,",").concat(i.b,",").concat(i.a,")"),a.fillText(t,e.width/2,e.height/2),a.strokeStyle="#ffffff",a.lineWidth=.1,a.strokeText(t,e.width/2,e.height/2)}},{key:"makeTextSprite",value:function(e){var t=new k.Lb(e);t.needsUpdate=!0;var n=new k.Jb({map:t,depthTest:!1}),r=new k.Ib(n);return r.scale.set(1,.75,1),r}},{key:"setPosition",value:function(e){this.position.copy(e)}},{key:"setRotation",value:function(e){this.rotation.y=e}}]),n}(k.x),Oe=n(27),Ce=n.n(Oe),Ee=n(57),Se=n.n(Ee),Me="-ver-arr-ext-",Te="-hor-arr-ext-",We=["grommet","glide","handle","Box001"],Pe=["legs","glass",Me,Te],Ie={black:1184274,silver:15658734,nickel:15658598},Le=function(e,t,n){var r=/\(min(\d+)\)/g.exec(e.name);if(r&&r[1]){var o=parseInt(r[1]);n=(5+295*n-o)/(300-o)}return n},De=function(e,t){var n,r=0,o=Object(j.a)(e);try{for(o.s();!(n=o.n()).done;){var i,a=n.value,s=Object(j.a)(t);try{for(s.s();!(i=s.n()).done;){var l=i.value;Re(a,l)&&r++}}catch(c){s.e(c)}finally{s.f()}}}catch(c){o.e(c)}finally{o.f()}return r>0},Re=function(e,t){return e.distanceTo(t)<=.001},ze=function(e){for(var t=[];e.length;){var n=[];n.push(e[0]),e.splice(0,1);var r=-1;do{r=-1;for(var o=0;o<e.length;o++){for(var i=e[o],a=0;a<n.length;a++){var s=n[a];if(De(s,i)){r=o;break}}if(r>=0)break}r>=0&&(n.push(e[r]),e.splice(r,1))}while(r>=0);t.push(n)}return t},Ve=function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=e.position,s=[],l=Object(j.a)(t);try{var c=function(){var t=n.value,l=!1,c=[];if(c.push.apply(c,We),i&&c.push.apply(c,Pe),c.forEach((function(e){t.name.toLowerCase().includes(e)&&(l=!0)})),l)return"continue";var d=[];t.geometry.attributes.position.array.forEach((function(e){return d.push(e)}));try{if(Array.isArray(t.morphTargetInfluences)){var h=t.morphTargetInfluences.length;for(u=0;u<h;u++)for(var f=t.geometry.morphAttributes.position[u].array,p=0;p<d.length;p++)d[p]=d[p]+f[p]*t.morphTargetInfluences[u]}}catch(b){}var v=[];for(u=0;u<d.length;u+=3){var g=new k.Tb(d[u],d[u+1],d[u+2]),y=new k.V;Math.abs(t.rotation.z)===Math.PI&&(g.x*=-1),!o&&y.makeRotationY(e.rotation.y),g.applyMatrix4(y),g.add(a),v.push(g)}var m=[];for(u=0;u<v.length;u+=3)m.push([v[u],v[u+1],v[u+2]]);ze(m).forEach((function(e){var t=[];e.forEach((function(e){return e.forEach((function(e){var n,o=!1,i=Object(j.a)(t);try{for(i.s();!(n=i.n()).done;){var a=n.value;if(Re(a,e)){o=!0;break}if(r&&Re(new k.Tb(a.x,0,a.z),new k.Tb(e.x,0,e.z))){o=!0;break}}}catch(s){i.e(s)}finally{i.f()}!o&&t.push(e)}))})),s.push(t)}))};for(l.s();!(n=l.n()).done;){var u;c()}}catch(d){l.e(d)}finally{l.f()}return s},Ae=function(e){return Se()(e)},Fe=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return Ce()(e,t)},Ne=function(e,t){var n=[];if(Ve(e,e.children,!0,!1,!0).forEach((function(e){var t=(e.length<16?Fe:Ae)(e.map((function(e){return[e.x,e.z]})));n.push(t.map((function(e){return{x:e[0],y:e[1]}})))})),t){var r=[];return n.forEach((function(e){return r=[].concat(Object(me.a)(r),Object(me.a)(e))})),r}return n},Be=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=1/0,r=1/0,o=1/0,i=-1/0,a=-1/0,s=-1/0;t=t.length?t:e.children;var l=Ve(e,t,!1,!0);return l.forEach((function(e){e.forEach((function(e){n>e.x&&(n=e.x),r>e.y&&(r=e.y),o>e.z&&(o=e.z),i<e.x&&(i=e.x),a<e.y&&(a=e.y),s<e.z&&(s=e.z)}))})),{min:new k.Tb(n,r,o),max:new k.Tb(i,a,s)}},_e=function(e){Object(g.a)(n,e);var t=Object(y.a)(n);function n(e,r,o,i,a,s){var l;return Object(p.a)(this,n),(l=t.call(this)).cloneData={},l.errorGlow=new k.W,l.hover=!1,l.selected=!1,l.highlighted=!1,l.error=!1,l.resizable=!0,l.fixed=!1,l.stackable=!1,l.stackontop=!1,l.overlappable=!1,l.allowRotate=!0,l.obstructFloorMoves=!0,l.emissiveColor=2236962,l.errorColor=16711680,l.flippable=!1,l.flipped=!1,l.dragOffset=new k.Tb,l.childMeshes=[],l.morphAlign=0,l.hullPointsCollection=[],l.boundingGizmo=null,l.prevPosition={x:null,y:null,z:null},l.prevRotation=null,l.prevMorph={},l.initObject=function(e,t,n,r){this.halfSize=this.objectHalfSize(),this.prepareMeshes(e),this.configDimensionLabels(),t?(this.setPosition(t),this.position_set=!0):(this.position.set(0,0,0),this.position_set=!1),this.dimensionHelper.position.copy(this.position),n&&(this.rotation.y=n,this.dimensionHelper.rotation.y=n),this.castShadow=!0,this.receiveShadow=!0,this.setOptions(r),this.placeInRoom()},l.getOptions=function(){return{morph:l.morph,textures:l.textures,styles:l.styles,fixed:l.fixed,stackable:l.stackable,stackontop:l.stackontop,overlappable:l.overlappable,calculatedPosition:{x:l.calculatedPosition.x,y:l.calculatedPosition.y,z:l.calculatedPosition.z}}},l.setOptions=function(e){if(e){if(e.hasOwnProperty("fixed")&&(l.fixed=e.fixed),e.hasOwnProperty("stackable")&&(l.stackable=e.stackable),e.hasOwnProperty("stackontop")&&(l.stackontop=e.stackontop),e.hasOwnProperty("overlappable")&&(l.overlappable=e.overlappable),e.morph)for(var t in e.morph)l.setMorph(t,e.morph[t]);if(e.textures)for(t in e.textures)l.updateMaterial(t,e.textures[t].material,e.textures[t].size);if(e.styles)for(t in e.styles)l.updateStyle(t,e.styles[t]);if(e.calculatedPosition)for(var n in e.calculatedPosition)l.calculatedPosition[n]=e.calculatedPosition[n]}},l.getCollidableMeshList=function(){var e,t=[],n=Object(j.a)(l.children);try{for(n.s();!(e=n.n()).done;){var r,o=e.value,i=!1,a=Object(j.a)(We);try{for(a.s();!(r=a.n()).done;){var s=r.value;o.name.toLowerCase().includes(s)&&(i=!0)}}catch(c){a.e(c)}finally{a.f()}i||t.push(o)}}catch(c){n.e(c)}finally{n.f()}return t},l.setStackable=function(e){return l.stackable=e},l.setOverlappable=function(e){return l.overlappable=e},l.setMorphAlign=function(e){return l.morphAlign=e},l.flipHorizontal=function(){},l.changed=function(){l.calculateHullPointsCollection()},l.getHeight=function(){return 2*l.halfSize.y},l.getWidth=function(){return 2*l.halfSize.x},l.getDepth=function(){return 2*l.halfSize.z},l.setRotationY=function(e){l.rotateByAngle(e),l.changed()},l.setPosition=function(e){l.position.copy(e),l.dimensionHelper.position.copy(e),l.changed()},l.getSnapPoints=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(e){var t=[];return l.hullPointsCollection.forEach((function(e){return t=[].concat(Object(me.a)(t),Object(me.a)(e))})),t}return l.hullPointsCollection},l.updateMaterial=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{w:.5,h:.5},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;l.textures[e]={material:t,size:n},l.traverse((function(o){if(o.name.toLowerCase().includes(e.toLowerCase())){var i=o.material.clone();if(i.color.setHex(t.color?t.color:16777215),i.map=null,t.texture){var a=(new k.Mb).load(t.texture);a.wrapS=k.xb,a.wrapT=k.xb,a.repeat.set(1/n.w,1/n.h),i.map=a,"function"===typeof r&&r()}o.material=i}}))},l.updateStyle=function(e,t,n){l.styles[e]=t,l.traverse((function(n){if("lock"!==e||!n.name.includes("block"))try{e.split(",").forEach((function(e){e.length&&n.name.toLowerCase().includes(e.toLowerCase())&&(n.visible=!1)})),t.split(",").forEach((function(e){e.length&&n.name.toLowerCase().includes(e.toLowerCase())&&(n.visible=!0)}))}catch(r){console.log(r)}})),"function"===typeof n&&n()},l.updateBlocksByHeight=function(e){for(var t=null,n=null,r="(block)",o=l.children.length-1;o>=0;o--){var i=l.children[o];i.name.includes(r)&&(i.visible=!0),i.name.includes(Me)&&(l.scene.remove(i),l.children.splice(o,1)),i.name.includes(r)&&!i.name.includes(Me)&&(t=i),i.name.includes("(block-top)")&&(n=i)}if(t){var a=0;if(n){var s=Be(Object(je.a)(l),[n]);a=s.max.y-s.min.y}var c=[];c.push(t);var u=Be(Object(je.a)(l),[t]),d=u.max.y-u.min.y,h=t.position.y,f=Math.floor((e-a-h)/d)-1;for(o=0;o<f;o++){var p=(new k.W).copy(t);p.geometryBackup=t.geometryBackup,p.name+="".concat(Me).concat(o),p.position.y=h+d,l.add(p),h=p.position.y,c.push(p)}var v=c[c.length-1];v.position.y>e-a-2*d&&(v.visible=!1)}},l.updateBlocksByWidth=function(e){for(var t="(block-hor)",n=null,r=l.children.length-1;r>=0;r--){var o=l.children[r];o.name.includes(t)&&(o.visible=!0),o.name.includes(Te)&&(l.scene.remove(o),l.children.splice(r,1)),o.name.includes(t)&&!o.name.includes(Te)&&(n=o)}if(n){var i=0,a=0,s=1,c=0,u=0,d=/\(s(\d+,?\d+)\)/g.exec(n.name);d&&d[1]&&(i=parseFloat(d[1].replace(",",".")),i*=.0254,a=c=e/(s=Math.floor(e/i)));(d=/\(ml(\d+),mr(\d+)\)/g.exec(n.name))&&d[1]&&d[2]&&(c=2.54*parseFloat(d[1])/100,u=2.54*parseFloat(d[2])/100);if((d=/\(a((?:\d+,)*\d+)\)/g.exec(n.name))&&d[1]){var h=d[1].split(",");for(r in h){r=parseInt(r);var f=2.54*parseFloat(h[r])/100;if(e<f&&0===r){s=0;break}if(e>=f&&r===h.length-1){s=h.length;break}if(e>=f&&e<2.54*parseFloat(h[r-0+1])/100){s=r+1;break}}i=a=(e-c-u)/s,s+=2}if(0===i||s<2)n.visible=!1;else for(n.visible=!0,r=0;r<s-1;r++){var p=void 0;0===r?p=n:((p=(new k.W).copy(n)).geometryBackup=n.geometryBackup,p.name+="".concat(Te).concat(r),l.add(p)),p.position.x=-e/2+c+r*a}}},l.model=e,l.scene=l.model.scene,l.metadata=r,l.cloneData={metadata:r,meshList:o,position:i,rotation:a,options:s},Array.isArray(o)&&o.forEach((function(e){l.add(e)})),l.centerOffset=new k.Tb,l.morph={},l.textures={},l.styles={},l.blockCount=1,l.errorColor=16711680,l.resizable=r.resizable,l.castShadow=!0,l.receiveShadow=!1,l.calculatedPosition=new k.Tb,l}return Object(v.a)(n,[{key:"prepareMeshes",value:function(e){if(Array.isArray(e)){var t,n=Object(j.a)(e);try{var r=function(){var e=t.value;try{e.castShadow=!0,e.receiveShadow=!0;var n=e.material;e.material=new k.Y,k.ab.prototype.copy.call(e.material,n);var r=(new k.j).copy(e.geometry);e.geometryBackup=r,function(){var t=/\(opacity(\d+)\)/g.exec(e.name);if(t&&t[1]){var n=parseInt(t[1]);e.material.transparent=!0,e.material.opacity=n/100}}(),function(){if(e.name.includes("handle"))for(var t in Ie)if(e.name.includes(t)){var n=e.material.clone();e.material=n,e.material.color.setHex(Ie[t])}}(),function(){if(e.name.includes("lock")&&!e.name.includes("block")){var t=e.material.clone();e.material=t,e.material.color.setHex(1184274)}}()}catch(o){console.log(o)}};for(n.s();!(t=n.n()).done;)r()}catch(o){n.e(o)}finally{n.f()}}}},{key:"configDimensionLabels",value:function(){this.dimensionHelper=new ke(this.model,this),this.scene.add(this.dimensionHelper)}},{key:"showDimensionHelper",value:function(){this.dimensionHelper.visible=!0}},{key:"hideDimensionHelper",value:function(){this.dimensionHelper.visible=!1}},{key:"getBounding",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];try{var r={x:t.position.x,y:t.position.y,z:t.position.z},o=t.rotation.y,i=JSON.parse(JSON.stringify(this.morph));return(e||JSON.stringify(r)!==JSON.stringify(this.prevPosition)||JSON.stringify(i)!==JSON.stringify(this.morph)||o!==this.prevRotation)&&(this.boundingGizmo=Be(t,n),this.prevPosition=r,this.prevRotation=o,this.prevMorph=i),this.boundingGizmo}catch(a){return null}}},{key:"remove",value:function(){var e,t=Object(j.a)(this.childMeshes);try{for(t.s();!(e=t.n()).done;){var n=e.value;this.scene.remove(n)}}catch(r){t.e(r)}finally{t.f()}this.scene.remove(this.dimensionHelper),this.scene.removeItem(this)}},{key:"resize",value:function(e,t,n){}},{key:"getMorph",value:function(e){return this.morph[e]?this.morph[e]:0}},{key:"setMorph",value:function(e,t){this.morph[e]=t;try{var n=Be(this);n=n.max.sub(n.min);var r,o=Object(j.a)(this.children);try{for(o.s();!(r=o.n()).done;){var i=r.value;try{Array.isArray(i.morphTargetInfluences)&&i.morphTargetInfluences.length>e&&(i.morphTargetInfluences[e]=Le(i,0,t))}catch(h){console.log(h)}}}catch(f){o.e(f)}finally{o.f()}var a,s=Object(j.a)(this.childMeshes);try{for(s.s();!(a=s.n()).done;){var l=a.value;try{Array.isArray(l.morphTargetInfluences)&&l.morphTargetInfluences.length>e&&(l.morphTargetInfluences[e]=Le(l,0,t))}catch(h){console.log(h)}}}catch(f){s.e(f)}finally{s.f()}this.updateUV(),this.halfSize=this.objectHalfSize(),this.dimensionHelper.update();var c=Be(this),u=new k.Tb((c.min.x+c.max.x)/2,0,(c.min.z+c.max.z)/2);this.centerOffset=u.sub(this.position),this.centerOffset.y=0,parseInt(e,10)===parseInt(this.metadata.blockMorphIndex,10)&&this.updateBlocksByHeight(2.54*(5+295*t)/100),parseInt(e,10)===parseInt(this.metadata.horizontalBlockMorphIndex,10)&&this.updateBlocksByWidth(2.54*(5+295*t)/100);var d=Be(this);d=d.max.sub(d.min),this.morphAlignModel(e,n,d,this.morphAlign),this.resized(),this.changed()}catch(h){console.log(h)}}},{key:"morphAlignModel",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.morphAlign,o=(new k.Tb).copy(n).sub(t),i=(new k.Tb).copy(this.position),a=new k.Tb;if(0!==(e=parseInt(e,10))){1===e&&0!==o.x?5===r||4===r||6===r?a.x=o.x/2:1!==r&&2!==r&&8!==r||(a.x=-o.x/2):2===e&&0!==o.z&&(3===r||4===r||2===r?a.z=o.z/2:7!==r&&6!==r&&8!==r||(a.z=-o.z/2));var s=new k.V;s.makeRotationY(this.rotation.y),a.applyMatrix4(s),i=i.add(a),this.position.copy(i),this.dimensionHelper.position.copy(i),this.moveChildMeshes()}}},{key:"updateUV",value:function(){try{var e=this.metadata.morphUVs;if(!Array.isArray(this.metadata.morphUVs))return;!function(e,t,n){var r,o=Object(j.a)(t);try{for(o.s();!(r=o.n()).done;){var i=r.value;i.geometry.attributes.uv.needsUpdate=!0;for(var a=i.geometry.attributes.uv.array,s=i.geometryBackup.attributes.uv.array,l=0;l<s.length;l++)a[l]=s[l];for(var c in e)if(n[c]){var u=i.name;if(u.includes(Me)&&(u=u.split(Me)[0]),u.includes(Te)&&(u=u.split(Te)[0]),Array.isArray(n[c][u])&&n[c][u].length===a.length){var d=Le(i,0,e[c]),h=n[c][u];for(l in a)a[l]+=(h[l]-s[l])*d}}}}catch(f){o.e(f)}finally{o.f()}}(this.morph,this.children,e)}catch(t){console.log("failed updating uv",t)}}},{key:"setScale",value:function(e,t,n){}},{key:"setFixed",value:function(e){this.fixed=e}},{key:"resized",value:function(){}},{key:"placeInRoom",value:function(){this.position_set}},{key:"removed",value:function(){}},{key:"updateHighlight",value:function(){var e=this.hover||this.selected,t=[],n=[];n.push.apply(n,Object(me.a)(this.childMeshes)),n.forEach((function(e){var n=!1;We.forEach((function(t){e.name.toLowerCase().includes(t)&&(n=!0)})),n||t.push(e)})),e?document.dispatchEvent(new CustomEvent(ve.BP3D_EVENT_HIGHLIGHT_CHANGED,{detail:{objects:t}})):document.dispatchEvent(new CustomEvent(ve.BP3D_EVENT_HIGHLIGHT_CHANGED,{detail:{objects:[]}}))}},{key:"mouseOver",value:function(){this.hover=!0,this.updateHighlight()}},{key:"mouseOff",value:function(){this.hover=!1,this.updateHighlight()}},{key:"setSelected",value:function(){this.selected=!0,this.updateHighlight()}},{key:"setUnselected",value:function(){this.selected=!1,this.updateHighlight()}},{key:"clickPressed",value:function(e){this.dragOffset.copy(e.point).sub(this.position)}},{key:"clickDragged",value:function(e){e&&this.moveToPosition(e.point,e)}},{key:"rotateChildMeshes",value:function(){for(var e in this.childMeshes)this.childMeshes[e].rotation.y=this.rotation.y}},{key:"rotate",value:function(e,t){if(e){var n=this.position,r=this.rotation.y;isNaN(t)&&(t=ve.Utils.angle(0,1,e.point.x-n.x,e.point.z-n.z));for(var o=Math.PI/16,i=-4;i<=4;i++)if(Math.abs(t-i*(Math.PI/2))<o){t=i*(Math.PI/2);break}var a=t-r;this.rotation.y=t,this.dimensionHelper.setRotation(t);var s=new k.V;s.makeRotationY(a);var l=(new k.Tb).copy(this.position).sub(n),c=(new k.Tb).copy(l);l.applyMatrix4(s),c=l.sub(c),this.relativeMove(c.x,c.z),this.changed(),this.groupParent&&this.groupParent.isSet&&this.groupParent.update()}}},{key:"rotateByAngle",value:function(e){this.rotation.y=e,this.dimensionHelper.setRotation(e)}},{key:"moveChildMeshes",value:function(){for(var e in this.childMeshes){var t=new k.Tb;this.children[e].getWorldPosition(t),this.childMeshes[e].position.copy(t)}}},{key:"moveToPosition",value:function(e,t){isNaN(e.x)||isNaN(e.y)||isNaN(e.z)?console.log("nan detected"):(this.setPosition(e),this.changed())}},{key:"relativeMove",value:function(e,t){if(!this.fixed){var n=(new k.Tb).copy(this.position);n.x+=e,n.z+=t,this.position.copy(n),this.dimensionHelper.position.copy(n)}}},{key:"clickReleased",value:function(){this.error&&this.hideError()}},{key:"customIntersectionPlanes",value:function(){return[]}},{key:"getCorners",value:function(e,t,n){n=n||this.position;var r=this.halfSize.clone(),o=new k.Tb(-r.x,0,-r.z),i=new k.Tb(r.x,0,-r.z),a=new k.Tb(r.x,0,r.z),s=new k.Tb(-r.x,0,r.z),l=new k.V;l.makeRotationY(this.rotation.y),o.applyMatrix4(l),i.applyMatrix4(l),a.applyMatrix4(l),s.applyMatrix4(l),o.add(n),i.add(n),a.add(n),s.add(n);var c=this.centerOffset.clone();return c.applyMatrix4(l),o.add(c),i.add(c),a.add(c),s.add(c),[{x:o.x,y:o.z},{x:i.x,y:i.z},{x:a.x,y:a.z},{x:s.x,y:s.z}]}},{key:"calculateHullPointsCollection",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.hullPointsCollection=Ne(e,t)}},{key:"isValidPosition",value:function(e){}},{key:"showError",value:function(e){e=e||this.position,this.error||(this.error=!0,this.errorGlow=this.createGlow(this.errorColor,.8,!0),this.scene.add(this.errorGlow)),this.errorGlow.position.copy(e)}},{key:"hideError",value:function(){this.error&&(this.error=!1,this.scene.remove(this.errorGlow))}},{key:"objectHalfSize",value:function(){var e=this.getBounding(!0);return e.max.clone().sub(e.min).divideScalar(2)}},{key:"createGlow",value:function(e,t,n){var r=this;n=n||!1,t=t||.2;var o,i=new k.X({color:e,blending:k.a,opacity:.2,transparent:!0,depthTest:!n}),a=new k.W,s=Object(j.a)(this.children);try{for(s.s();!(o=s.n()).done;){var l=o.value,c=(new k.W).copy(l);c.geometry=(new k.j).copy(l.geometry),c.material=(new k.X).copy(i),a.add(c)}}catch(u){s.e(u)}finally{s.f()}return a.children.forEach((function(e){e.geometry.attributes.position.needsUpdate=!0;var t=e.geometry.attributes.position.array;try{if(r.morph)for(var n in r.morph)if(e.geometry.morphAttributes&&e.geometry.morphAttributes.position&&e.geometry.morphAttributes.position.length>n)for(var o=e.geometry.morphAttributes.position[n].array,i=Le(e,0,r.morph[n]),a=0;a<t.length;a++)t[a]+=o[a]*i}catch(s){console.log(s)}})),a.material=i,a.position.copy(this.position),a.rotation.copy(this.rotation),a.scale.copy(this.scale),a}}]),n}(k.W),Ue=-1,He=0,Xe=1,Ye=-1,Ge=0,Je=function(e){Object(g.a)(n,e);var t=Object(y.a)(n);function n(e,r,o,i,a,s){var l;return Object(p.a)(this,n),(l=t.call(this,e,r,o,i,a,s)).currentRoofFace=null,l.currentInclinedWall=null,l.refVec=new k.Sb(0,1),l.sizeX=0,l.sizeY=0,l.forceVisible=!0,l.roof=null,l.isRoofItem=!0,l.changeRoofFace=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l.position;if(e){null!=l.currentRoofFace&&ve.Utils.removeValue(l.currentRoofFace.face.items,Object(je.a)(l)),e.face.items.push(Object(je.a)(l));var n=[];[].concat(Object(me.a)(l.model.floorplan.getRooms()),Object(me.a)(l.model.floorplan.roofLayer.rooms)).forEach((function(e){return n.push.apply(n,Object(me.a)(e.inclinedWalls))}));for(var r=null,o=0,i=n;o<i.length;o++){var a=i[o];if(ve.Utils3D.checkIsSamePlane(a.plane,e.plane)){var s,c=a.corners,u=[],d=Object(j.a)(c);try{for(d.s();!(s=d.n()).done;){var h=s.value;u.push({x:h.x,y:h.z})}}catch(f){d.e(f)}finally{d.f()}if(ve.Utils.pointInPolygon(t.x,t.z,u)){r=a;break}}}l.currentRoofFace=e,l.currentInclinedWall=r}},l.redrawRoof=function(){return document.dispatchEvent(new CustomEvent(ve.BP3D_REQUEST_REDRAW_ROOF))},l.closestRoofFace=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l.position,n=l.model.three.floorplan.roofFaces,r=n.map((function(e){return e.mesh})),o=.001,i=Object(j.a)(r);try{for(i.s();!(e=i.n()).done;){var a=e.value,s=Math.abs(a.plane.distanceToPoint(t));if(s<o)return a}}catch(c){i.e(c)}finally{i.f()}return null},l.setPosition=function(e){var t=(new k.Tb).copy(e),n=l.closestRoofFace(e);l.boundMove(t,{object:n}),l.position.copy(t),l.dimensionHelper.position.copy(t),l.changed(),setTimeout(l.redrawRoof,10)},l.projectionBounding=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l.position,t=[],n=e.clone().sub(l.dimensionHelper.position),r=["top-left","top-right","bottom-right","bottom-left"];return l.dimensionHelper.traverse((function(e){if(r.includes(e.name)){var o=new k.Tb;e.getWorldPosition(o),o.add(n),t.push(o)}})),t},l.isValidPosition=function(e){if(!l.currentInclinedWall)return Ye;var t=l.projectionBounding(e);if(!t)return Ye;var n=[],r=[];if(function(){var e=l.currentInclinedWall.corners.map((function(e){return e.clone()})),o=t.map((function(e){return e.clone()}));e.forEach((function(e){n.push({x:e.x,y:e.z})})),o.forEach((function(e){r.push({x:e.x,y:e.z})}))}(),!ve.Utils.polygonInsidePolygon(r,n))return Ye;var o,i=l.currentInclinedWall.getItems(),a=Object(j.a)(i);try{for(a.s();!(o=a.n()).done;){var s=o.value;if(s!==Object(je.a)(l)){var c=s.projectionBounding().map((function(e){return{x:e.x,y:e.z}}));if(ve.Utils.polygonPolygonIntersect(r,c))return Xe}}}catch(u){a.e(u)}finally{a.f()}return Ge},l.allowRotate=!1,l.morphAlign=3,l.roof=l.model.floorplan.roof,l.roof.items.push(Object(je.a)(l)),l}return Object(v.a)(n,[{key:"removed",value:function(){ve.Utils.removeValue(this.roof.items,this)}},{key:"updateRoofVisibility",value:function(e,t){this.visible=e,this.dimensionHelper.visible=e}},{key:"updateSize",value:function(){}},{key:"resized",value:function(){this.updateSize()}},{key:"placeInRoom",value:function(){}},{key:"moveToPosition",value:function(e,t){if(isNaN(e.x)||isNaN(e.y)||isNaN(e.z))console.log("nan detected");else{this.boundMove(e,t);var n=this.isValidPosition(e);if(n===Ge){this.hideError(),this.position.copy(e);var r=(new k.Tb).copy(e);this.dimensionHelper.position.copy(r),this.changed(),this.redrawRoof()}else n!==Ye&&n!==Xe||this.showError(e)}}},{key:"customIntersectionPlanes",value:function(){try{return this.model.three.floorplan.roofFaces.map((function(e){return e.mesh}))}catch(e){return[]}}},{key:"boundMove",value:function(e,t){try{var n=t.object.vecV,r=this.position.clone().sub(n);this.lookAt(r),this.dimensionHelper.lookAt(r),this.changeRoofFace(t.object,e)}catch(o){}}}]),n}(_e),qe=function e(t,n,r){var o=this;Object(p.a)(this,e),this.room=null,this.corners=[],this.plane=null,this.conduction=0,this.getItems=function(){var e=o.room.layer.floorplan,t=o.corners,n=o.plane,r=t.map((function(e){return e.clone()})).map((function(e){return{x:e.x,y:e.z}}));return e.scene.items.filter((function(e){if(!(e instanceof Je))return!1;if(n.distanceToPoint(e.position)>.01)return!1;var t=e.position;return!!ve.Utils.pointInPolygon(t.x,t.z,r)}))},this.getMatrix=function(){var e=o.plane.normal,t=o.getCenter(),n=new k.c(e,t,e.length()),r=new k.V;r.makeTranslation(-t.x,-t.y,-t.z);var i=new k.V;return i.makeRotationFromEuler(n.rotation).invert(),(new k.V).multiplyMatrices(r,i)},this.getArea=function(){var e=o.corners;if(e.length<3)return 0;var t=e.map((function(e){return e.clone()})),n=o.getMatrix();return t.forEach((function(e){return e.applyMatrix4(n)})),ve.Utils.area(t.map((function(e){return{x:e.x,y:e.z}})))},this.exposedArea=function(){return o.getArea()},this.getDirection=function(e){var t=0;if(o.plane instanceof k.mb){var n=o.plane.normal,r=new k.Tb(-n.x,0,-n.z),i=new k.Tb(0,0,-1),a=r.angleTo(i);r.clone().cross(i).y<0&&(a*=-1),(t=a/Math.PI*180-e)<0&&(t+=360)}return t},this.checkIsOutsideWall=function(){return!0},this.getInclination=function(){if(o.plane instanceof k.mb){var e=o.plane.normal,t=e.clone();return t.y=0,t.angleTo(e)/Math.PI*180}return 90},this.getCenter=function(){var e=o.corners,t=new k.Tb;return e.forEach((function(e){return t.add(e)})),t.multiplyScalar(1/e.length),t},this.getWallCentroid=function(){var e=o.getCenter();return[e.x,e.z,e.y]},this.getConduction=function(){return o.conduction},this.getWindowShare=function(){var e=o.getItems(),t=o.getArea(),n=0;return e.forEach((function(e){var t=e.halfSize;n+=t.x*t.y*4})),n/t},this.getWindowHeight=function(){return 0},this.getWindowSillHeight=function(){return 0},this.room=t,this.corners=n,this.plane=r,this.conduction=r.conduction},Ze={url:"".concat(ve.Configuration.getStringValue("defaultPathPrefix"),"/rooms/textures/blank.png"),stretch:!0,scale:0},Ke=-1,Qe=0,$e=1,et=function(){function e(t,n){var r=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Object(p.a)(this,e),this.layer=null,this.edge=null,this.orphan=!1,this.locked=!1,this.hasRoofInteraction=!1,this.windowInfo=null,this.items=[],this.onItems=[],this.interiorTexture=Ze,this.exteriorTexture=Ze,this.interiorConduction=0,this.exteriorConduction=0,this.thickness=ve.Configuration.getNumericValue(ve.configWallThickness),this.thicknessDirection=ve.Configuration.getNumericValue(ve.configWallThicknessDirection),this.isObstacleWall=!1,this.isOutsideWall=ve.Configuration.getBooleanValue(ve.configWallIsOutside),this.keepOutsideWall=!1,this.offset=0,this.height=0,this.layer=null,this.moved_callbacks=[],this.deleted_callbacks=[],this.action_callbacks=[],this.isStart=function(e){return r.start===e},this.isEnd=function(e){return r.end===e},this.removeItem=function(e){e&&(ve.Utils.removeValue(r.items,e),e.remove())},this.removeItems=function(){r.windowInfo=null;var e=r.items;if(e.length)for(var t=e.length-1;t>=0;t--)e[t]&&e[t].remove();r.items=[]},this.handleStartMoved=function(e,t,n,o){var i={prev:{start:{x:n,y:o},end:{x:r.getEndX(),y:r.getEndY()}},current:{start:{x:e,y:t},end:{x:r.getEndX(),y:r.getEndY()}}};r.moveWallItems(i)},this.handleEndMoved=function(e,t,n,o){var i={prev:{start:{x:r.getStartX(),y:r.getStartY()},end:{x:n,y:o}},current:{start:{x:r.getStartX(),y:r.getStartY()},end:{x:e,y:t}}};r.moveWallItems(i)},this.exteriorDirectionVector=function(){var e=r.getWallCenter(),t=r.toVec2().normalize().multiplyScalar(.1),n=new k.Sb(e.x,e.y);return n.clone().add(t).rotateAround(n,Math.PI/2)},this.interiorDirectionVector=function(){var e=r.getWallCenter(),t=r.toVec2().normalize().multiplyScalar(.1),n=new k.Sb(e.x,e.y);return n.clone().add(t).rotateAround(n,-Math.PI/2)},this.getRoomInteractionSide=function(e){var t=r.exteriorDirectionVector(),n=r.interiorDirectionVector(),o=ve.Utils.pointInPolygon(t.x,t.y,e.corners),i=ve.Utils.pointInPolygon(n.x,n.y,e.corners);return o?$e:i?Ke:Qe},this.start=t,this.end=n,this.height=o||ve.Configuration.getNumericValue(ve.configWallHeight),this.thickness=ve.Configuration.getNumericValue(ve.configWallThickness),this.thicknessDirection=ve.Configuration.getNumericValue(ve.configWallThicknessDirection),this.isOutsideWall=ve.Configuration.getBooleanValue(ve.configWallIsOutside),this.id=this.getUuid(),this.start.attachStart(this),this.end.attachEnd(this)}return Object(v.a)(e,[{key:"exposedArea",value:function(){var e=this.edge;if(this.checkIsOutsideWall()){var t=this.getExposedSide();if(t===$e)return e.exteriorArea();if(t===Ke)return e.interiorArea()}return 0}},{key:"getConduction",value:function(){if(this.checkIsOutsideWall()){var e=this.getExposedSide();if(e===$e)return this.exteriorConduction||0;if(e===Ke)return this.interiorConduction||0}return Qe}},{key:"getDirection",value:function(e){var t=0;if(this.checkIsOutsideWall()){var n=this.getExposedSide(),r=null;if(n===$e?r=this.exteriorDirectionVector():n===Ke&&(r=this.interiorDirectionVector()),!r)return 0;var o=this.getWallCenter();r.x-=o.x,r.y-=o.y;var i=new k.Tb(r.x,0,r.y),a=new k.Tb(0,0,-1),s=i.clone().cross(a),l=i.angleTo(a);s.y<0&&(l*=-1),(t=l/Math.PI*180-e)<0&&(t+=360)}return t}},{key:"getInclination",value:function(){return 0}},{key:"getWallCentroid",value:function(){var e=this.layer,t=this.height,n=e.floorplan,r=this.getWallCenter(),o=e.offset+t/2+n.buildingOffset;return[r.x,r.y,o]}},{key:"getWindowShare",value:function(){return this.windowInfo?this.windowInfo.coverRate/100:0}},{key:"getWindowHeight",value:function(){return this.windowInfo?this.windowInfo.height:0}},{key:"getWindowSillHeight",value:function(){return this.windowInfo?this.windowInfo.sillHeight:0}},{key:"toVec2",value:function(){var e=this.start,t=this.end;return new k.Sb(t.x-e.x,t.y-e.y)}},{key:"getUuid",value:function(){return[this.start.id,this.end.id].join()}},{key:"resetFrontBack",value:function(){this.edge=null}},{key:"snapToAxis",value:function(){var e=this,t=(arguments.length>0&&void 0!==arguments[0]||ve.Configuration.getNumericValue(ve.configSnapTolernance),this.start.floorplan),n=t.getCorners(t.activeLayerIndex),r=[];n.forEach((function(t){t!==e.start&&t!==e.end&&r.push(t)}))}},{key:"fireOnMove",value:function(e){this.moved_callbacks.push(e)}},{key:"fireOnDelete",value:function(e){this.deleted_callbacks.push(e)}},{key:"dontFireOnDelete",value:function(e){var t=this.deleted_callbacks.indexOf(e);this.deleted_callbacks.splice(t,1)}},{key:"fireOnAction",value:function(e){this.action_callbacks.push(e)}},{key:"fireAction",value:function(e){this.action_callbacks.forEach((function(t){return"function"===typeof t&&t(e)}))}},{key:"move",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=this.getWallCenter();this.relativeMove(e-r.x,t-r.y,n)}},{key:"relativeMove",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!(this.locked||this.start.locked||this.end.locked)){var o=this.start,i=this.end,a=o.x,s=o.y,l=i.x,c=i.y,u=a+e,d=s+t,h=l+e,f=c+t,p=[].concat(Object(me.a)(o.wallStarts),Object(me.a)(o.wallEnds)),v=[].concat(Object(me.a)(i.wallStarts),Object(me.a)(i.wallEnds));ve.Utils.removeValue(p,this),ve.Utils.removeValue(v,this);var g=ve.Utils,y=g.projectionPointToLine,m=g.pointDistanceFromLine,b=new k.Tb(e,0,t),x=new k.Tb(a-l,0,s-c),w=b.angleTo(x);if(0!==w&&w!==Math.PI){if(1===p.length){var j=p[0],O=j.start===o?j.end:j.start,C=T(O,a,s);u=C.x,d=C.y}if(1===v.length){var E=v[0],S=E.start===i?E.end:E.start,M=T(S,l,c);h=M.x,f=M.y}}this.start.move(u,d,!1,r),this.end.move(h,f,!1,r),n&&this.snapToAxis()}function T(e,t,n){var r={x:t,y:n};try{var o=e.x,i=e.y,p=y(o,i,a,s,l,c),v=y(o,i,u,d,h,f),g=m(o,i,a,s,l,c),b=m(o,i,u,d,h,f),x={x:t-p.x,y:n-p.y};x.x*=b/g,x.y*=b/g,r.x=v.x+x.x,r.y=v.y+x.y}catch(w){r.x=t,r.y=n}return r}}},{key:"moveWallItems",value:function(e){var t=e.prev,n=e.current;this.items.length&&this.items.forEach((function(e){var r=e.position,o=Math.sqrt(Math.pow(t.start.x-t.end.x,2)+Math.pow(t.start.y-t.end.y,2)),i=Math.sqrt(Math.pow(t.start.x-r.x,2)+Math.pow(t.start.y-r.z,2))/o,a=n.start.x+(n.end.x-n.start.x)*i,s=(r.y,n.start.y+(n.end.y-n.start.y)*i),l=a-r.x,c=s-r.z;e.relativeMove(l,c);var u=new k.Tb(t.end.x-t.start.x,0,t.end.y-t.start.y),d=new k.Tb(n.end.x-n.start.x,0,n.end.y-n.start.y),h=(new k.Tb).copy(u).cross(d),f=u.angleTo(d);h.y<0&&(f=-f);var p=e.rotation.y;p+=f,e.rotation.y=p,e.dimensionHelper.rotation.y=p}))}},{key:"fireMoved",value:function(){this.moved_callbacks.forEach((function(e){return"function"===typeof e&&e()}))}},{key:"fireRedraw",value:function(){this.edge&&this.edge.redrawCallbacks.forEach((function(e){return"function"===typeof e&&e()}))}},{key:"getStart",value:function(){return this.start}},{key:"getEnd",value:function(){return this.end}},{key:"getStartX",value:function(){return this.start.getX()}},{key:"getEndX",value:function(){return this.end.getX()}},{key:"getStartY",value:function(){return this.start.getY()}},{key:"getEndY",value:function(){return this.end.getY()}},{key:"remove",value:function(){var e=this;this.start.detachWall(this),this.end.detachWall(this),this.deleted_callbacks.forEach((function(t){return"function"===typeof t&&t(e)}))}},{key:"setStart",value:function(e){this.start.detachWall(this),e.attachStart(this),this.start=e,this.fireMoved()}},{key:"setEnd",value:function(e){this.end.detachWall(this),e.attachEnd(this),this.end=e,this.fireMoved()}},{key:"distanceFrom",value:function(e,t){return ve.Utils.pointDistanceFromLine(e,t,this.getStartX(),this.getStartY(),this.getEndX(),this.getEndY())}},{key:"closestPoint",value:function(e,t){return{point:ve.Utils.closestPointOnLine(e,t,this.getStartX(),this.getStartY(),this.getEndX(),this.getEndY()),distance:this.distanceFrom(e,t)}}},{key:"oppositeCorner",value:function(e){return this.start===e?this.end:this.end===e?this.start:void console.log("Wall does not connect to corner")}},{key:"setLocked",value:function(e){this.locked=e,this.start.setLocked(e),this.end.setLocked(e)}},{key:"getWallCenter",value:function(){var e=this.start.x,t=this.start.y;return{x:(e+this.end.x)/2,y:(t+this.end.y)/2}}},{key:"getWallArea",value:function(){return this.getWallLength()*this.height}},{key:"getWallLength",value:function(){var e=this.start.x,t=this.start.y,n=this.end.x,r=this.end.y;return Math.sqrt(Math.pow(e-n,2)+Math.pow(t-r,2))}},{key:"setWallLength",value:function(e){if(e>0){var t=e/this.getWallLength(),n={x:0,y:0};if(this.start.locked||this.end.locked)if(this.start.locked&&!this.end.locked)n={x:this.getStartX(),y:this.getStartY()};else{if(this.start.locked||!this.end.locked)return;n={x:this.getEndX(),y:this.getEndY()}}else n=this.getWallCenter();var r=0,o=0;r=n.x+(this.start.x-n.x)*t,o=n.y+(this.start.y-n.y)*t,this.start.move(r,o,!1),r=n.x+(this.end.x-n.x)*t,o=n.y+(this.end.y-n.y)*t,this.end.move(r,o,!1)}}},{key:"setIsOutsideWall",value:function(e){this.isOutsideWall=e}},{key:"getExposedSide",value:function(){var e=this.layer.getRooms(),t=this.exteriorDirectionVector(),n=this.interiorDirectionVector(),r=Qe;return e.forEach((function(e){var o=ve.Utils.pointInPolygon(t.x,t.y,e.corners);o&&(r=Ke),(o=ve.Utils.pointInPolygon(n.x,n.y,e.corners))&&(r=$e)})),r}},{key:"checkIsOutsideWall",value:function(){var e=this.layer.getRooms(),t=this.exteriorDirectionVector(),n=this.interiorDirectionVector(),r=0,o=0;return e.forEach((function(e){var i=ve.Utils.pointInPolygon(t.x,t.y,e.corners);i&&r++,(i=ve.Utils.pointInPolygon(n.x,n.y,e.corners))&&o++})),0===r||0===o}},{key:"findInsideRoomPoint",value:function(){if(this.checkIsOutsideWall()){var e=this.layer.getRooms(),t=this.exteriorDirectionVector(),n=this.interiorDirectionVector(),r=null;return e.forEach((function(e){var o=ve.Utils.pointInPolygon(t.x,t.y,e.corners);o&&(r=t),(o=ve.Utils.pointInPolygon(n.x,n.y,e.corners))&&(r=n)})),r}return null}},{key:"checkIsSameFace",value:function(e){var t=.1;return this.start.distanceFromCorner(e.start)<t&&this.end.distanceFromCorner(e.end)<t||this.start.distanceFromCorner(e.end)<t&&this.end.distanceFromCorner(e.start)<t}},{key:"setTexture",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.interiorTexture=e,this.exteriorTexture=e,this.interiorConduction=this.exteriorConduction=t}},{key:"setInteriorTexture",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.interiorTexture=e,this.interiorConduction=t}},{key:"setExteriorTexture",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.exteriorTexture=e,this.exteriorConduction=t}},{key:"detachFromAdjacentWalls",value:function(){var e=this.start,t=this.end;e.detachWall(this),t.detachWall(this);var n=e.clone(),r=t.clone();this.start=n,this.end=r,this.id=this.getUuid(),this.start.attachStart(this),this.end.attachEnd(this),this.start.moved_callbacks.push(this.handleStartMoved),this.end.moved_callbacks.push(this.handleEndMoved)}},{key:"detachCorner",value:function(e){var t=this.start,n=this.end,r=null;if(e===t){t.detachWall(this);var o=t.clone();this.start=o,this.id=this.getUuid(),this.start.attachStart(this),this.start.moved_callbacks.push(this.handleStartMoved),r=o}else if(e===n){n.detachWall(this);var i=n.clone();this.end=i,this.id=this.getUuid(),this.end.attachEnd(this),this.end.moved_callbacks.push(this.handleEndMoved),r=i}return r}}]),e}(),tt={url:"".concat(ve.Configuration.getStringValue("defaultPathPrefix"),"/rooms/textures/marbletiles.jpg"),scale:4},nt=function(){function e(t,n,r,o){var i=this;Object(p.a)(this,e),this.interiorCorners=[],this.baseCorners=[],this.floorCorners=[],this.ceilingCorners=[],this.corners=[],this.walls=[],this.inclinedWalls=[],this.hull=[],this.tags=[],this.name="Room",this.nameChanged=!1,this.area=0,this.areaCenter={},this.visible=!0,this.edgePointer=null,this.floorPlane=null,this.customTexture=!1,this.floorChangeCallbacks=[],this.layer=null,this.texture=tt,this.conduction=0,this.offset=0,this.height=ve.Configuration.getNumericValue(ve.configWallHeight),this.setName=function(e){i.name=e,i.nameChanged=!0},this.clearInclinedWalls=function(){i.inclinedWalls=[]},this.getRoomVolume=function(){try{function e(e,t,n){return e.dot(t.cross(n))/6}return function(t){if(!t.isBufferGeometry)return console.log("'geometry' must be an indexed or non-indexed buffer geometry"),0;var n=null!==t.index,r=t.attributes.position,o=0,i=new k.Tb,a=new k.Tb,s=new k.Tb;if(n)for(var l=t.index,c=l.count/3,u=0;u<c;u++)i.fromBufferAttribute(r,l.array[3*u+0]),a.fromBufferAttribute(r,l.array[3*u+1]),s.fromBufferAttribute(r,l.array[3*u+2]),o+=e(i,a,s);else for(var d=r.count/3,h=0;h<d;h++)i.fromBufferAttribute(r,3*h+0),a.fromBufferAttribute(r,3*h+1),s.fromBufferAttribute(r,3*h+2),o+=e(i,a,s);return o}(i.hull)}catch(t){return 0}},this.addInclinedWall=function(e,t){i.inclinedWalls.push(new qe(i,e,t))},this.getRoomCentriod=function(){return ve.Utils.centroid(i.floorCorners)},this.getFloorArea=function(){return ve.Utils.area(i.floorCorners)},this.getCeilingArea=function(){return ve.Utils.area(i.ceilingCorners)},this.layer=t,this.corners=n,this.offset=r,this.height=o,this.updateWalls(),this.updateInteriorCorners(),this.updateBaseCorners(),this.updateArea()}return Object(v.a)(e,[{key:"getUuid",value:function(){return this.constructor.getUuidByCorners(this.corners)}},{key:"fireOnFloorChange",value:function(e){this.floorChangeCallbacks.push(e)}},{key:"getTexture",value:function(){return this.texture||tt}},{key:"updateArea",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.area=ve.Utils.area(this.corners),this.areaCenter=ve.Utils.centroid(this.corners);var n=0;return this.walls.forEach((function(t){var r=t.getRoomInteractionSide(e);if(r!==Qe){var o=t.edge;r===$e?n+=ve.Utils.area([o.midStart(),o.exteriorStart(),o.exteriorEnd(),o.midEnd()]):r===Ke&&(n+=ve.Utils.area([o.midStart(),o.interiorStart(),o.interiorEnd(),o.midEnd()]))}})),!t&&(this.area-=n),this}},{key:"setTexture",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;console.log(t),this.texture={url:e,scale:1,width:1,height:1},this.conduction=t,document.dispatchEvent(new CustomEvent(ve.BP3D_EVENT_ADD_TO_UNDO_STACK)),this.floorChangeCallbacks.forEach((function(e){return"function"===typeof e&&e()}))}},{key:"cycleIndex",value:function(e){return e<0?e+this.corners.length:e%this.corners.length}},{key:"updateInteriorCorners",value:function(){var e=this;if(0!==this.corners.length){var t={};this.interiorCorners=[];for(var n=this.corners[0],r=this.corners[0];;){t[r.id]=!0,this.interiorCorners.push({x:r.x,y:r.y});var o=[].concat(Object(me.a)(r.wallStarts),Object(me.a)(r.wallEnds)).filter((function(t){var n=0;return e.corners.includes(t.start)&&n++,e.corners.includes(t.end)&&n++,2===n}));if(0===o.length)break;var i,a=null,s=Object(j.a)(o);try{for(s.s();!(i=s.n()).done;){var l=i.value,c=l.oppositeCorner(r);if(!t[c.id]){l.edge&&l.edge.generatePlane(),a=c;break}}}catch(u){s.e(u)}finally{s.f()}if(!a)break;if((r=a)===n)break}}}},{key:"updateBaseCorners",value:function(){this.baseCorners=[];for(var e=this.interiorCorners,t=this.walls,n=0;n<e.length;n++){var r,o=e[n],i=e[(n+1)%e.length],a=null,s=Object(j.a)(t);try{for(s.s();!(r=s.n()).done;){var l=r.value,c=l.start,u=l.end,d=0===c.distanceFrom(o.x,o.y)||0===u.distanceFrom(o.x,o.y),h=0===c.distanceFrom(i.x,i.y)||0===u.distanceFrom(i.x,i.y);if(d&&h){a=l;break}}}catch(b){s.e(b)}finally{s.f()}if(a){var f=a.edge,p=a.getRoomInteractionSide(this);if(o.x===a.start.x&&o.y===a.start.y){var v=f.midStart(),g=f.midEnd();p===Ke?(v=f.exteriorStart(),g=f.exteriorEnd()):p===$e&&(v=f.interiorStart(),g=f.interiorEnd()),this.baseCorners.push(v,g)}else if(o.x===a.end.x&&o.y===a.end.y){var y=f.midStart(),m=f.midEnd();p===Ke?(y=f.exteriorStart(),m=f.exteriorEnd()):p===$e&&(y=f.interiorStart(),m=f.interiorEnd()),this.baseCorners.push(m,y)}}}}},{key:"updateWalls",value:function(){this.walls=[];for(var e=0;e<this.corners.length;e++){var t=this.corners[e],n=this.corners[(e+1)%this.corners.length],r=t.wallTo(n),o=t.wallFrom(n);if(r){var i=new we(this,r,this.offset);this.walls.push(r),i.generatePlane()}else o?(i=new we(this,o,this.offset),this.walls.push(o),i.generatePlane()):console.log("corners arent connected by a wall, uh oh")}}}]),e}();nt.getUuidByCorners=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return ve.Utils.map(e,(function(e){return e.id})).sort().join()};var rt=function(){function e(t,n,r){var o=this;Object(p.a)(this,e),this.floorplan=null,this.layerIndex=100,this.layerLabel="0",this.offset=0,this.height=ve.Configuration.getNumericValue(ve.configWallHeight),this.floorThickness=ve.Configuration.getNumericValue(ve.configFloorThickness),this.visible=!0,this.corners=[],this.walls=[],this.rooms=[],this.updated_callbacks=[],this.setLayerIndex=function(e){o.layerIndex=e,o.layerLabel=e<100?"B".concat(100-e):"".concat(e-100)},this.setOffset=function(e){var t=o.offset-e;o.offset=e;var n=[];o.walls.forEach((function(e){n.push.apply(n,Object(me.a)(e.items))})),n.forEach((function(e){e.position.y-=t,e.moveChildMeshes(),e.rotateChildMeshes()})),o.calculateRooms()},this.setHeight=function(e){o.height=e,o.walls.forEach((function(t){t.height=e}))},this.setVisible=function(e){o.visible=e,o.walls.forEach((function(t){return t.items.forEach((function(t){t.forceVisible=e,t.visible=e}))})),o.rooms.forEach((function(t){return t.visible=e}))},this.setFloorThickness=function(e){o.floorThickness=e},this.remove=function(){o.walls.forEach((function(e){e.removeItems()})),o.corners=[],o.walls=[]},this.update=function(){o.calculateRooms(),o.updated_callbacks.forEach((function(e){return e()}))},this.getCorners=function(){return o.corners.filter((function(e){return e.layer.layerIndex===o.layerIndex}))},this.removeCorner=function(e){ve.Utils.removeValue(o.corners,e),o.rooms.forEach((function(t){var n=t.corners;n.includes(e)&&ve.Utils.removeValue(n,e)}))},this.checkWallIsExist=function(e,t){var n=!1;return o.walls.forEach((function(r){var o=r.start,i=r.end;(0===o.distanceFrom(e.x,e.y)&&0===i.distanceFrom(t.x,t.y)||0===i.distanceFrom(e.x,e.y)&&0===o.distanceFrom(t.x,t.y))&&(n=!0)})),n},this.autoSplitWalls=function(e,t){for(var n=[e,t],r=ve.Configuration.getNumericValue(ve.configSnapTolernance),i=!1,a=o.walls,s=a.length,l=[],c=0;c<s;c++){var u=a[c];if(!n.includes(u.start)&&!n.includes(u.end)){var d=e,h=t,f=u.start,p=u.end,v=ve.Utils.findLineLineCrossPoint(d.x,d.y,h.x,h.y,f.x,f.y,p.x,p.y,!0);if(v){if(e.distanceFrom(v.x,v.y)<r||t.distanceFrom(v.x,v.y)<r)continue;i=!0;var g=o.newCorner(v.x,v.y);l.push(g),u.setEnd(g),o.newWall(g,p,o.height)}}}if(i){l.sort((function(t,n){return t.distanceFrom(e.x,e.y)-n.distanceFrom(e.x,e.y)})),n=[e].concat(l,[t]);for(var y=0;y<n.length-1;y++){var m=n[y],b=n[y+1];o.newWall(m,b,o.height)}}return i},this.getWalls=function(){return o.walls.forEach((function(e){e.edge||(e.orphan=!0,new we(null,e,o.offset).generatePlane())})),o.walls.filter((function(e){return e.layer.layerIndex===o.layerIndex}))},this.removeWall=function(e){e.removeItems(),ve.Utils.removeValue(o.walls,e)},this.getRooms=function(){return o.rooms.forEach((function(e){return e.floorThickness=o.floorThickness})),o.rooms},this.setLayerIndex(t),this.offset=n,this.height=r}return Object(v.a)(e,[{key:"newCorner",value:function(e,t,n){var r=new xe(this.floorplan,e,t,n);return r.layer=this,r.fireOnDelete(this.removeCorner),this.corners.push(r),r}},{key:"newWall",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.height,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(e&&t&&!this.checkWallIsExist(e,t)){var o=!1;if(r&&(o=this.autoSplitWalls(e,t)),!o){var i=new et(e,t,n);return i.layer=this,i.fireOnDelete(this.removeWall),this.walls.push(i),i}return null}}},{key:"reduceWalls",value:function(){for(var e=this.corners,t=e.length-1;t>=0;t--){var n=e[t],r=[].concat(Object(me.a)(n.wallStarts),Object(me.a)(n.wallEnds));if(2===r.length&&(n.updateAngles(),180===n.angles[0])){var o=r[1].oppositeCorner(n);o.detachWall(r[1]),r[0].isStart(n)?(r[0].start=o,o.attachStart(r[0])):(r[0].end=o,o.attachEnd(r[0])),this.removeCorner(n),this.removeWall(r[1])}}}},{key:"calculateRooms",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=[],r=this.findRooms(this.corners),o=function(){var t=n.length+1;return t<10&&(t="0"+t),"Room ".concat(e.layerLabel).concat(t)};r.forEach((function(r){var i=nt.getUuidByCorners(r),a=new nt(e,r,e.offset,e.height);if(t[i])a.name=t[i].name,a.tags=Array.isArray(t[i].tags)?t[i].tags:[],a.texture=t[i].texture,a.conduction=t[i].conduction;else{var s=e.rooms.filter((function(e){return e.getUuid()===i}));s.length?(a.name=s[0].nameChanged?s[0].name:o(),a.tags=s[0].tags,a.texture=s[0].texture,a.conduction=s[0].conduction,a.visible=s[0].visible):a.name=o()}n.push(a)})),this.rooms=n,this.walls.forEach((function(e){e.edge&&e.edge.generatePlane(),e.keepOutsideWall?e.prevIsOutsideWall&&!e.isOutsideWall&&(e.interiorTexture=Ze,e.exteriorTexture=Ze,e.removeItems(),e.prevIsOutsideWall=e.isOutsideWall):e.checkIsOutsideWall()?e.isOutsideWall=!0:e.isOutsideWall=!1}))}},{key:"findRooms",value:function(e){function t(e,t,n){return ve.Utils.angle2pi(e.x-t.x,e.y-t.y,n.x-t.x,n.y-t.y)}var n=[];e.forEach((function(e){e.adjacentCorners().forEach((function(r){n.push(function(e,n){var r=[],o={corner:n,previousCorners:[e]},i={};i[e.id]=!0;for(var a=function(){var a=o.corner;if(i[a.id]=!0,o.corner===e&&a!==n)return{v:o.previousCorners};for(var s=[],l=o.corner.adjacentCorners(),c=0;c<l.length;c++){var u=l[c];(!(u.id in i)||u===e&&a!==n)&&s.push(u)}var d=o.previousCorners.slice(0);if(d.push(a),s.length>1){var h=o.previousCorners[o.previousCorners.length-1];s.sort((function(e,n){return t(h,a,n)-t(h,a,e)}))}s.length>0&&s.forEach((function(e){r.push({corner:e,previousCorners:d})})),o=r.pop()};o;){var s=a();if("object"===typeof s)return s.v}return[]}(e,r))}))}));var r=function(e){for(var t=[],n={},r=function(e){return e.id},o=0;o<e.length;o++){for(var i=!0,a=e[o],s=0;s<a.length;s++){var l=ve.Utils.cycle(a,s),c=ve.Utils.map(l,r).join("-");n.hasOwnProperty(c)&&(i=!1)}i&&(t.push(e[o]),n[c]=!0)}return t}(n);return ve.Utils.removeIf(r,ve.Utils.isClockwise)}},{key:"getArea",value:function(){var e=0;return this.rooms.forEach((function(t){e+=t.updateArea(!0).area})),e}},{key:"getLayerMetadata",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=this,r=[],o=[],i=[],a=[],s=[],l=[],c=[],u=[],d=[],h=[],f=[],p=[],v=[],g=[],y=[],m=[],b=[],x=t;return n.getRooms().forEach((function(t){var w=n.offset+e.floorplan.buildingOffset,j=t.walls,k=t.inclinedWalls,O=t.getRoomCentriod();r.push(t.name),o.push(t.height),i.push(t.getRoomVolume()),v.push(t.getFloorArea()),g.push([O.x,O.y,w+t.height/2]),y.push(t.updateArea(!0).area||t.getFloorArea()),m.push(!0),b.push(w>=0);var C=[].concat(Object(me.a)(j),Object(me.a)(k)).filter((function(e){return e.exposedArea()>0})),E=C.map((function(e){return e.exposedArea()})),S=C.map((function(e){return e.checkIsOutsideWall()})),M=C.map((function(e){return e.getConduction()})),T=C.map((function(e){return e.getDirection(x)})),W=C.map((function(e){return e.getInclination()})),P=C.map((function(e){return e.getWallCentroid()})),I=C.map((function(e){return e.getWindowShare()})),L=C.map((function(e){return e.getWindowHeight()})),D=C.map((function(e){return e.getWindowSillHeight()}));t.getFloorArea()>0&&(E.push(t.getFloorArea()),S.push(!1),M.push(t.conduction||0),T.push(0),W.push(90),P.push([O.x,w,O.y]),I.push(0),L.push(0),D.push(0)),t.getCeilingArea()>0&&(E.push(t.getCeilingArea()),S.push(!1),M.push(0),T.push(0),W.push(90),P.push([O.x,w,O.y]),I.push(0),L.push(0),D.push(0)),a.push(E),s.push(S),l.push(M),c.push(T),u.push(W),d.push(P),h.push(I),f.push(L),p.push(D)})),{RoomName:r,RoomHeight:o,RoomVolume:i,WallArea:a,WallOutside:s,WallConduction:l,WallDirection:c,WallInclination:u,WallCentroid:d,WindowShare:h,WindowHeight:f,WindowSillHeight:p,UsableFloorArea:v,RoomCentroid:g,TotalFloorArea:y,FloorOutside:m,RoomAboveGround:b}}}]),e}(),ot="".concat(ve.Configuration.getStringValue("defaultPathPrefix"),"/rooms/textures/blank-dark.png"),it=function(e){Object(g.a)(n,e);var t=Object(y.a)(n);function n(){var e;Object(p.a)(this,n);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).height=0,e.reset=function(){e.corners=[],e.walls=[]},e.getLayerMetadata=function(){var t=[];return e.walls.forEach((function(e){var n=e.start,r=e.end,o=e.height;t.push([[r.x,r.y,o],[n.x,n.y,o]])})),t},e}return Object(v.a)(n,[{key:"newWall",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.height,r=new et(e,t,n);r.layer=this,r.isObstacleWall=!0,r.interiorTexture.url=ot,r.exteriorTexture.url=ot,r.fireOnDelete(this.removeWall);var o,i=this.floorplan,a=i.getRooms(),s=!1,l=Object(j.a)(a);try{for(l.s();!(o=l.n()).done;){var c=o.value;if(ve.Utils.linePolygonIntersect(e.x,e.y,t.x,t.y,c.corners)){s=!0;break}}}catch(u){l.e(u)}finally{l.f()}s||this.walls.push(r)}}]),n}(rt),at=function(){function e(t,n){Object(p.a)(this,e),this.locked=!1,this.moved_callbacks=[],this.deleted_callbacks=[],this.action_callbacks=[],this.start=t,this.end=n,this.id=this.getUuid(),this.start.attachStart(this),this.end.attachEnd(this)}return Object(v.a)(e,[{key:"getUuid",value:function(){return[this.start.id,this.end.id].join()}},{key:"resetFrontBack",value:function(){}},{key:"snapToAxis",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ve.Configuration.getNumericValue(ve.configSnapTolernance);this.start.snapToAxis(e),this.end.snapToAxis(e)}},{key:"fireOnMove",value:function(e){this.moved_callbacks.push(e)}},{key:"fireOnDelete",value:function(e){this.deleted_callbacks.push(e)}},{key:"dontFireOnDelete",value:function(e){var t=this.deleted_callbacks.indexOf(e);this.deleted_callbacks.splice(t,1)}},{key:"fireOnAction",value:function(e){this.action_callbacks.push(e)}},{key:"fireAction",value:function(e){this.action_callbacks.forEach((function(t){return"function"===typeof t&&t(e)}))}},{key:"relativeMove",value:function(e,t){if(!(this.locked||this.start.locked||this.end.locked)){this.start.move(this.getStartX()+e,this.getStartY()+t,!1),this.end.move(this.getEndX()+e,this.getEndY()+t,!1);var n={prev:{start:{x:this.getStartX(),y:this.getStartY()},end:{x:this.getEndX(),y:this.getEndY()}}};this.snapToAxis(),n.current={start:{x:this.getStartX(),y:this.getStartY()},end:{x:this.getEndX(),y:this.getEndY()}}}}},{key:"fireMoved",value:function(){this.moved_callbacks.forEach((function(e){return"function"===typeof e&&e()}))}},{key:"fireRedraw",value:function(){}},{key:"getStart",value:function(){return this.start}},{key:"getEnd",value:function(){return this.end}},{key:"getStartX",value:function(){return this.start.getX()}},{key:"getEndX",value:function(){return this.end.getX()}},{key:"getStartY",value:function(){return this.start.getY()}},{key:"getEndY",value:function(){return this.end.getY()}},{key:"remove",value:function(){var e=this;this.start.detachEdge(this),this.end.detachEdge(this),this.deleted_callbacks.forEach((function(t){return"function"===typeof t&&t(e)}))}},{key:"setStart",value:function(e){this.start.detachEdge(this),e.attachStart(this),this.start=e,this.fireMoved()}},{key:"setEnd",value:function(e){this.end.detachEdge(this),e.attachEnd(this),this.end=e,this.fireMoved()}},{key:"distanceFrom",value:function(e,t,n){var r=new k.Tb(e,t,n),o=new k.Tb(this.start.x,this.start.y,this.start.z),i=new k.Tb(this.end.x,this.end.y,this.end.z);return new k.G(o,i).closestPointToPoint(r).distanceTo(r)}},{key:"oppositeVertex",value:function(e){return this.start===e?this.end:this.end===e?this.start:void console.log("edge does not connect to vertex")}},{key:"setLocked",value:function(e){this.locked=e,this.start.setLocked(e),this.end.setLocked(e)}},{key:"getEdgeCenter",value:function(){var e=this.start.x,t=this.start.y,n=this.start.z;return{x:(e+this.end.x)/2,y:(t+this.end.y)/2,z:(n+this.end.z)/2}}},{key:"getEdgeLength",value:function(){var e=this.start.x,t=this.start.y,n=this.start.z,r=this.end.x,o=this.end.y,i=this.end.z;return Math.sqrt(Math.pow(e-r,2)+Math.pow(t-o,2)+Math.pow(n-i,2))}}]),e}(),st=ve.Configuration.getNumericValue(ve.configSnapTolernance),lt=function(){function e(t,n,r,o,i){var a=this;Object(p.a)(this,e),this.edgeStarts=[],this.edgeEnds=[],this.moved_callbacks=[],this.deleted_callbacks=[],this.action_callbacks=[],this.locked=!1,this.selected=!1,this.setLocked=function(e){return a.locked=e},this.setPosition=function(e,t){switch(e.toLowerCase()){case"x":a.x=t;break;case"z":a.y=t-a.parent.offset;break;case"y":a.z=t}a.moved_callbacks.forEach((function(e){return e()}))},this.parent=t,this.x=n,this.y=r,this.z=o,this.id=i||ve.Utils.guid()}return Object(v.a)(e,[{key:"toVec3",value:function(){return new k.Tb(this.x,this.y,this.z)}},{key:"fireOnMove",value:function(e){this.moved_callbacks.push(e)}},{key:"fireOnDelete",value:function(e){this.deleted_callbacks.push(e)}},{key:"fireOnAction",value:function(e){this.action_callbacks.push(e)}},{key:"getX",value:function(){return this.x}},{key:"getY",value:function(){return this.y}},{key:"getZ",value:function(){return this.z}},{key:"snapToAxis",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ve.Configuration.getNumericValue(ve.configSnapTolernance),t={x:!1,y:!1,z:!1},n=this;return this.adjacentVertices().forEach((function(r){Math.abs(r.x-n.x)<e&&(n.x=r.x,t.x=!0),Math.abs(r.y-n.y)<e&&(n.y=r.y,t.y=!0),Math.abs(r.z-n.z)<e&&(n.z=r.z,t.z=!0)})),t}},{key:"relativeMove",value:function(e,t,n){this.locked||this.move(this.x+e,this.y+t,this.z+n)}},{key:"fireAction",value:function(e){this.action_callbacks.forEach((function(t){return t(e)}))}},{key:"remove",value:function(){var e=this;this.deleted_callbacks.forEach((function(t){return t(e)}))}},{key:"removeAll",value:function(){[].concat(Object(me.a)(this.edgeStarts),Object(me.a)(this.edgeEnds)).forEach((function(e){return e.remove()})),this.remove()}},{key:"move",value:function(e,t,n){var r=this,o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!this.locked){var i=this.x,a=this.y,s=this.z;this.x=e,this.y=t,this.z=n,this.mergeWithIntersected(),o&&this.snapToAxis(),this.moved_callbacks.forEach((function(e){return e(r.x,r.y,r.z,i,a,s)}))}}},{key:"adjacentVertices",value:function(){for(var e=[],t=0;t<this.edgeStarts.length;t++)e.push(this.edgeStarts[t].getEnd());for(t=0;t<this.edgeEnds.length;t++)e.push(this.edgeEnds[t].getStart());return e}},{key:"isEdgeConnected",value:function(e){for(var t=0;t<this.edgeStarts.length;t++)if(this.edgeStarts[t]===e)return!0;for(t=0;t<this.edgeEnds.length;t++)if(this.edgeEnds[t]===e)return!0;return!1}},{key:"distanceFrom",value:function(e,t,n){return new k.Tb(e,t,n).distanceTo(new k.Tb(this.x,this.y,this.z))}},{key:"distanceFromEdge",value:function(e){return e.distanceFrom(this.x,this.y,this.z)}},{key:"distanceFromVertex",value:function(e){return this.distanceFrom(e.x,e.y,e.z)}},{key:"detachEdge",value:function(e){ve.Utils.removeValue(this.edgeStarts,e),ve.Utils.removeValue(this.edgeEnds,e),0===this.edgeStarts.length&&0===this.edgeEnds.length&&this.remove()}},{key:"attachStart",value:function(e){this.edgeStarts.push(e)}},{key:"attachEnd",value:function(e){this.edgeEnds.push(e)}},{key:"edgeTo",value:function(e){for(var t=0;t<this.edgeStarts.length;t++)if(this.edgeStarts[t].getEnd()===e)return this.edgeStarts[t];return null}},{key:"edgeFrom",value:function(e){for(var t=0;t<this.edgeEnds.length;t++)if(this.edgeEnds[t].getStart()===e)return this.edgeEnds[t];return null}},{key:"edgeToOrFrom",value:function(e){return this.edgeTo(e)||this.edgeFrom(e)}},{key:"combineWithVertex",value:function(e){this.x=e.x,this.y=e.y,this.z=e.z;for(var t=e.edgeStarts.length-1;t>=0;t--)e.edgeStarts[t].setStart(this);for(t=e.edgeEnds.length-1;t>=0;t--)e.edgeEnds[t].setEnd(this);e.removeAll(),this.removeDuplicateEdges(),this.parent.update()}},{key:"mergeWithIntersected",value:function(){for(var e=this.parent,t=e.vertices,n=e.edges,r=0;r<t.length;r++){var o=t[r];if(this.distanceFromVertex(o)<st&&o!==this)return this.combineWithVertex(o),!0}for(r=0;r<n.length;r++){var i=n[r];if(this.distanceFromEdge(i)<st&&!this.isEdgeConnected(i)){var a=ve.Utils.closestPointOnLine(this.x,this.y,i.getStart().x,i.getStart().y,i.getEnd().x,i.getEnd().y);return this.x=a.x,this.y=a.y,this.parent.newEdge(this,i.getEnd()),i.setEnd(this),this.parent.update(),!0}}return!1}},{key:"removeDuplicateEdges",value:function(){for(var e={},t={},n=this.edgeStarts.length-1;n>=0;n--)this.edgeStarts[n].getEnd()===this||this.edgeStarts[n].getEnd().id in e?this.edgeStarts[n].remove():e[this.edgeStarts[n].getEnd().id]=!0;for(n=this.edgeEnds.length-1;n>=0;n--)this.edgeEnds[n].getStart()===this||this.edgeEnds[n].getStart().id in t?this.edgeEnds[n].remove():t[this.edgeEnds[n].getStart().id]=!0}}]),e}(),ct=function(){function e(t){Object(p.a)(this,e),this.vertices=[],this.items=[],this.color=0,this.vertices=t}return Object(v.a)(e,[{key:"setColor",value:function(e){Number.isInteger(e)?this.color=e:"string"===typeof e&&"#"===e[0]&&(e=e.replace("#",""),this.color=parseInt(e,16))}},{key:"getUuid",value:function(){return this.constructor.getUuidByCorners(this.vertices)}}]),e}();ct.getUuidByCorners=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return ve.Utils.map(e,(function(e){return e.id})).sort().join()};var ut=ve.Configuration.getNumericValue(ve.configSnapTolernance),dt=function e(t){var n=this;Object(p.a)(this,e),this.vertices=[],this.edges=[],this.faces=[],this.items=[],this.offset=0,this.enabled=!1,this.getVertices=function(){return n.vertices.forEach((function(e){return e.enabled=n.enabled})),n.vertices},this.getEdges=function(){return n.edges.forEach((function(e){return e.enabled=n.enabled})),n.edges},this.reset=function(){n.vertices=[],n.edges=[],n.faces=[]},this.update=function(){n.floorplan.update(!1)},this.newVertex=function(e,t,r,o){var i,a=null,s=!1,l=Object(j.a)(n.vertices);try{for(l.s();!(i=l.n()).done;){var c=i.value;if(c.distanceFrom(e,t,r)<ut){s=!0,a=c;break}}}catch(u){l.e(u)}finally{l.f()}return s||((a=new lt(n,e,t,r,o)).fireOnMove(n.update),a.fireOnDelete(n.removeVertex),n.vertices.push(a)),a},this.removeVertex=function(e){ve.Utils.removeValue(n.vertices,e)},this.autoSplitEdges=function(e,t){for(var r=!1,o=n.getEdges(),i=o.length,a=[e,t],s=[],l=0;l<i;l++){var c=o[l];if(!a.includes(c.start)&&!a.includes(c.end)){var u=ve.Utils3D.findLineLineCrossPoint(e,t,c.start,c.end);if(u){if(e.distanceFrom(u.x,u.y,u.z)<ut||t.distanceFrom(u.x,u.y,u.z)<ut)continue;r=!0;var d=n.newVertex(u.x,u.y,u.z);s.push(d),n.newEdge(d,c.end),c.setEnd(d)}}}if(r){s.sort((function(t,n){return e.distanceFromVertex(t)-e.distanceFromVertex(n)})),a=[e].concat(s,[t]);for(var h=0;h<a.length-1;h++){var f=a[h],p=a[h+1];n.newEdge(f,p,!1)}}return r},this.checkEdgeIsExist=function(e,t){var r=!1;return n.getEdges().forEach((function(n){(e.distanceFromVertex(n.start)<ut&&t.distanceFromVertex(n.end)<ut||e.distanceFromVertex(n.end)<ut&&t.distanceFromVertex(n.start)<ut)&&(r=!0)})),r},this.newEdge=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e&&t&&!n.checkEdgeIsExist(e,t)){var o=!1;if(r&&(o=n.autoSplitEdges(e,t)),!o){var i=new at(e,t);return i.fireOnMove(n.update),i.fireOnDelete(n.removeEdge),n.edges.push(i),i}}},this.removeEdge=function(e){ve.Utils.removeValue(n.edges,e)},this.regenerate=function(e){if(n.reset(),Array.isArray(e)){for(var t=function(e){return n.newVertex(e.x,0,e.y)},r=[],o=0;o<e.length-1;o++)for(var i=e[o],a=e[o+1],s=Math.sqrt(Math.pow(i.x-a.x,2)+Math.pow(i.y-a.y,2)),l=a.x-i.x,c=a.y-i.y,u=0;u<s;u+=.5)r.push({x:i.x+l*u/s,y:i.y+c*u/s});(r=Ce()(r.map((function(e){return[e.x,e.y]}))).map((function(e){return{x:e[0],y:e[1]}}))).splice(r.length-1,1);for(var d=0;d<r.length;d++){var h=r[d],f=r[(d+1)%r.length],p=t(h),v=t(f);n.newEdge(p,v)}}},this.loadData=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{vertices:{},edges:[],faces:{}},t=e.offset,r=e.vertices,o=e.edges;n.offset=t;var i={};for(var a in r){var s=r[a],l=n.newVertex(s.x,s.y,s.z,s.id);i[a]=l}var c,u=Object(j.a)(o);try{for(u.s();!(c=u.n()).done;){var d=c.value;n.newEdge(i[d.start],i[d.end])}}catch(h){u.e(h)}finally{u.f()}n.calculateFaces(e.faces)},this.setFaceTexture=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";e||(n.faces.forEach((function(e){e.setColor(t)})),n.update())},this.getFaces=function(){return n.faces},this.calculateFaces=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=[],r=n.findFaces(n.vertices);r.forEach((function(r){var o=ct.getUuidByCorners(r),i=new ct(r);if(e[o])i.setColor(e[o].color);else{var a=n.faces.filter((function(e){return e.getUuid()===o}));a.length&&(i.setColor(a[0].color),i.items=a[0].items)}t.push(i)})),n.faces=t},this.findFaces=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.vertices;function t(e,t,n){return ve.Utils.angle2pi(e.x-t.x,e.z-t.z,n.x-t.x,n.z-t.z)}function r(e){var t=[];return e.forEach((function(e){return 3===e.length&&t.push(e)})),t}function o(e){for(var t=[],n={},r=0;r<e.length;r++){var o=!0,i=e[r].map((function(e){return e.id})).sort((function(e,t){return e.localeCompare(t)})).join("-");n.hasOwnProperty(i)&&(o=!1),o&&(t.push(e[r]),n[i]=!0)}return t}function i(e,n){var r=[],o={vertex:n,previousVertices:[e]},i={};i[e.id]=!0;for(var a=function(){var a=o.vertex;if(i[a.id]=!0,o.vertex===e&&a!==n)return{v:o.previousVertices};for(var s=[],l=o.vertex.adjacentVertices(),c=0;c<l.length;c++){var u=l[c];(!(u.id in i)||u===e&&a!==n)&&s.push(u)}var d=o.previousVertices.slice(0);if(d.push(a),s.length>1){var h=o.previousVertices[o.previousVertices.length-1];s.sort((function(e,n){return t(h,a,n)-t(h,a,e)}))}s.length>0&&s.forEach((function(e){r.push({vertex:e,previousVertices:d})})),o=r.pop()};o;){var s=a();if("object"===typeof s)return s.v}return[]}var a=[];e.forEach((function(e){e.adjacentVertices().forEach((function(t){a.push(i(e,t))}))}));var s=o(r(a));return s},this.floorplan=t},ht=ve.Configuration.getNumericValue(ve.configSnapTolernance),ft=function(){function e(){var t=this;Object(p.a)(this,e),this.scene=null,this.orientation=0,this.buildingOffset=0,this.layers=[],this.activeLayer=null,this.activeLayerIndex=null,this.roof=new dt(this),this.obstacleEditMode=!1,this.obstacleLayer=new it(-1,0,2.5),this.roofLayer=this.newLayer(-1,0,0),this.redraw_callbacks=[],this.updated_rooms=[],this.layerUpdatedCallbacks=[],this.buildingOffsetUpdatedCallbacks=[],this.activeLayerChangedCallbacks=[],this.roomLoadedCallbacks=[],this.fireOnRedraw=function(e){return t.redraw_callbacks.push(e)},this.fireOnUpdatedRooms=function(e){return t.updated_rooms.push(e)},this.fireOnLayersUpdated=function(e){return t.layerUpdatedCallbacks.push(e)},this.fireOnActiveLayerChanged=function(e){return t.activeLayerChangedCallbacks.push(e)},this.setBuildingOffset=function(e){var n=e-t.buildingOffset;if(t.getWalls().forEach((function(e){e.items.forEach((function(e){e.position.y+=n,e.dimensionHelper.position.y+=n}))})),e>0&&t.getLayer(99)){var r=t.getLayer(99).height;if(e>=r){for(var o=t.layers.length-1;o>=0;o--){t.layers[o+1]=t.layers[o];var i=t.layers[o+1];i&&(i.setLayerIndex(o+1),i.offset+=i.height,i.calculateRooms())}e-=r}}else if(e<0&&t.getLayer(100)){var a=t.getLayer(100).height;if(-e>=a){for(var s=0;s<t.layers.length-1;s++){t.layers[s]=t.layers[s+1];var l=t.layers[s];l&&(l.setLayerIndex(s),l.offset-=l.height,l.calculateRooms(),s<100&&l.getWalls().forEach((function(e){return e.removeItems()})))}t.layers.splice(t.layers.length-1),e+=a}}for(var c=t.layers.length-1;c>=0;c--)if(t.layers[c]){t.roof.offset=t.layers[c].offset+t.layers[c].height;break}t.buildingOffset=e,t.update(!1)},this.cloneLayer=function(e,n,r,o){if(e){var i=e.getCorners(),a=e.getWalls(),s=t.newLayer(n,r,o),l=[];return i.forEach((function(e){return l.push(s.newCorner(e.x,e.y))})),a.forEach((function(e){var t=l[i.indexOf(e.start)],n=l[i.indexOf(e.end)],r=s.newWall(t,n,s.height);r.thickness=e.thickness,r.thicknessDirection=e.thicknessDirection,r.isOutsideWall=e.isOutsideWall})),s.updated_callbacks.push((function(){return t.update()})),s}},this.setActiveLayerIndex=function(e){Number.isInteger(e)&&(e=e-0+100),t.activeLayerIndex=e,t.activeLayer=t.getLayer(e),t.activeLayerChangedCallbacks.forEach((function(t){return t(e)}))},this.setLayerHeight=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;n-=0,Number.isInteger(e)&&(e=e-0+100);var r=t.getLayer(e);if(r){if(e>=100){for(var o=n-r.height,i=e+1;i<t.layers.length;i++){var a=t.layers[i];a&&a.setOffset(a.offset+o)}r.setHeight(n);var s=null;t.layers.length&&(s=t.layers[t.layers.length-1]),s&&(t.roof.offset=s.offset+s.height)}else{for(var l=n-r.height,c=0;c<=e;c++){var u=t.layers[c];u&&u.setOffset(u.offset-l)}r.setHeight(n)}t.update(!1)}},this.setLayerVisible=function(e,n){Number.isInteger(e)&&(e=e-0+100);var r=t.getLayer(e);r&&(r.setVisible(n),t.update(!1))},this.cloneAboveLayer=function(e){if(Number.isInteger(e)){e=e-0+100;var n=t.getLayer(e);if(n){if(e>=100){for(var r=e+1,o=e+1;o<t.layers.length;o++){var i=t.layers[o];i&&(i.setLayerIndex(i.layerIndex+1),i.setOffset(i.offset+n.height))}var a=t.cloneLayer(n,r,n.offset+n.height,n.height);return a&&(t.layers.splice(r,0,a),a.calculateRooms(),t.roof.offset+=a.height,t.update(!1)),r-100}for(var s=e,l=0;l<=e;l++){var c=t.layers[l];c&&(c.setLayerIndex(c.layerIndex-1),c.setOffset(c.offset-n.height))}var u=t.cloneLayer(n,s,n.offset+n.height,n.height);if(u){for(var d=0;d<s;d++)t.layers[d]=t.layers[d+1];t.layers[s]=u,u.calculateRooms(),t.update(!1)}return s-100}}},this.cloneBelowLayer=function(e){if(Number.isInteger(e)){e=e-0+100;var n=t.getLayer(e);if(n){if(e>100){for(var r=e,o=e;o<t.layers.length;o++){var i=t.layers[o];i&&(i.setLayerIndex(i.layerIndex+1),i.setOffset(i.offset+n.height))}var a=t.cloneLayer(n,r,n.offset-n.height,n.height);return a&&(t.layers.splice(e,0,a),t.roof.offset+=a.height,a.calculateRooms(),t.update(!1)),r-100}for(var s=e-1,l=0;l<e;l++){var c=t.layers[l];c&&(c.setLayerIndex(c.layerIndex-1),c.setOffset(c.offset-n.height))}var u=t.cloneLayer(n,s,n.offset-n.height,n.height);if(u){for(var d=0;d<s;d++)t.layers[d]=t.layers[d+1];t.layers[s]=u,u.calculateRooms(),t.update(!1)}return s-100}}},this.swapLayers=function(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=t.getLayer(e),i=t.getLayer(n);return!(!o||!i)&&(i.setLayerIndex(e),o.setLayerIndex(n),1===r?(i.setOffset(o.offset),o.setOffset(i.offset+i.height-0)):-1===r&&(o.setOffset(i.offset),i.setOffset(o.offset+o.height-0)),t.layers[n]=o,t.layers[e]=i,!0)},this.moveAboveLayer=function(e){if(Number.isInteger(e)){var n=(e=e-0+100)+1;return e<100&&n>=100?null:t.swapLayers(e,n,1)?(t.update(!1),n-100):null}},this.moveBelowLayer=function(e){if(Number.isInteger(e)){var n=(e=e-0+100)-1;return n<100&&e>=100?null:t.swapLayers(e,n,-1)?(t.update(!1),n-100):null}},this.removeLayer=function(e){if(Number.isInteger(e)){e=e-0+100;var n=t.getLayer(e);if(n){if(e>=100){for(var r=e+1;r<t.layers.length;r++){var o=t.layers[r];o&&(o.setLayerIndex(r-1),o.setOffset(o.offset-n.height))}t.roof.offset-=n.height,n.remove(),ve.Utils.removeValue(t.layers,n)}else for(var i=e;i>0;i--){t.layers[i]=t.layers[i-1];var a=t.layers[i];a&&(a.setLayerIndex(i),a.setOffset(a.offset+n.height))}n.remove(),t.update(!1)}}},this.setRoomVisible=function(e,n){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];t.getRooms().forEach((function(t){t.getUuid()===e&&(t.visible=n)})),r&&t.update(!1)},this.setLayerFloorThickness=function(e,n){Number.isInteger(e)&&(e=e-0+100);var r=t.getLayer(e);r&&(r.setFloorThickness(n),t.update(!1))},this.regenerateRoof=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(e||!t.roof.vertices.length||!t.roof.edges.length){var n=[],r=null;if(t.layers.length&&(r=t.layers[t.layers.length-1]),r){var o=[];t.scene.items.forEach((function(e){return e.isRoofItem&&o.push(e)}));for(var i=o.length-1;i>=0;i--)o[i].remove();var a=r.getWalls().filter((function(e){return e.checkIsOutsideWall()}));a.forEach((function(e){var t=e.edge,r=e.getExposedSide();1===r?n.push(t.exteriorStart(),t.exteriorEnd()):-1===r&&n.push(t.interiorStart(),t.interiorEnd())})),t.roof.offset=r.offset+r.height,t.roof.regenerate(n),t.update(!1)}}},this.getSameLayerWalls=function(e){return e.start.layer.getWalls()},this.getSameFaceWalls=function(e){var n=t.getAllWalls(),r=[];return n.forEach((function(t){var n=e.checkIsSameFace(t);console.log(n),n&&r.push(t)})),r},this.getAllWalls=function(){var e=[];return t.layers.forEach((function(t){return t&&e.push.apply(e,Object(me.a)(t.getWalls()))})),e},this.overlappedRoom=function(e,n){var r=[];t.getActiveLayer()&&(r=t.getActiveLayer().getRooms());for(var o=0;o<r.length;o++){var i=r[o];if(ve.Utils.pointInPolygon(e,n,i.corners))return i}return null},this.obstacleLayer.floorplan=this}return Object(v.a)(e,[{key:"newLayer",value:function(e,t,n){var r=new rt(e,t,n);return r.floorplan=this,r}},{key:"getLayer",value:function(e){try{return this.layers[e]}catch(t){return null}}},{key:"getActiveLayer",value:function(){return this.getLayer(this.activeLayerIndex)}},{key:"getLayers",value:function(){var e=[];for(var t in this.layers){var n=this.layers[t];n&&e.push({index:t-100,offset:n.offset,height:n.height,visible:n.visible,floorThickness:n.floorThickness})}return e}},{key:"getRoomsInfo",value:function(){var e=this,t=[],n=function(n){var r=e.layers[n];if(!r)return"continue";r.getRooms().forEach((function(e){t.push({uuid:e.getUuid(),layerIndex:n-100,name:e.name,tags:e.tags,area:e.updateArea().area,visible:e.visible})}))};for(var r in e.layers)n(r);return t}},{key:"roofFaces",value:function(){var e=this,t=[];return this.roof.getFaces().forEach((function(n){var r=e.roof.offset;n.vertices.forEach((function(e){e.offset=r})),t.push(n)})),t}},{key:"roofEdges",value:function(){var e=this,t=[];return this.roof.getEdges().forEach((function(n){n.offset=e.roof.offset,t.push(n)})),t}},{key:"roofVertices",value:function(){var e=this,t=[];return this.roof.getVertices().forEach((function(n){n.offset=e.roof.offset,t.push(n)})),t}},{key:"wallEdges",value:function(){var e=[];return this.layers.forEach((function(t){t&&t.getWalls().forEach((function(n){n.edge&&(n.edge.layerOffset=t.offset,e.push(n.edge))}))})),e}},{key:"obstacleWallEdges",value:function(){var e=[];return this.obstacleLayer.getWalls().forEach((function(t){t.edge&&(t.edge.layerOffset=0,e.push(t.edge))})),e}},{key:"wallEdgePlanes",value:function(){var e=[];return this.layers.forEach((function(t){t&&t.getWalls().forEach((function(t){if(t.edge){var n=t.edge.plane;e.push(n)}}))})),e}},{key:"getWalls",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(null!==e){var t=this.layers[e];return t?t.getWalls():[]}var n=[];return this.layers.forEach((function(e){e&&n.push.apply(n,Object(me.a)(e.getWalls()))})),n}},{key:"getCorners",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(null!==e){var t=this.layers[e];return t?t.getCorners():[]}var n=[];return this.layers.forEach((function(e){e&&n.push.apply(n,Object(me.a)(e.getCorners()))})),n}},{key:"getItems",value:function(){return this.scene.items}},{key:"getRooms",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(null!==e){var t=this.layers[e];return t?t.getRooms():[]}var n=[];return this.layers.forEach((function(e){e&&n.push.apply(n,Object(me.a)(e.getRooms()))})),n}},{key:"overlappedCorner",value:function(e,t,n,r){var o,i=this.obstacleEditMode?this.obstacleLayer:this.getActiveLayer();if(i){o=i.getCorners(),n=n||ht;var a,s=Object(j.a)(o);try{for(s.s();!(a=s.n()).done;){var l=a.value;if(l.distanceFrom(e,t)<n){if(r&&r.start!==l&&r.end!==l)continue;return l}}}catch(c){s.e(c)}finally{s.f()}return null}}},{key:"overlappedWall",value:function(e,t,n){var r=[];r=(this.obstacleEditMode?this.obstacleLayer:this.getActiveLayer()).getWalls(),n=n||ht;for(var o=0;o<r.length;o++)if(r[o].distanceFrom(e,t)<n)return r[o];return null}},{key:"overlappedItem",value:function(e,t){var n,r=this.getItems(),o=null,i=Object(j.a)(r);try{for(i.s();!(n=i.n()).done;){var a,s=n.value,l=s.getSnapPoints(),c=!1,u=Object(j.a)(l);try{for(u.s();!(a=u.n()).done;){var d=a.value;if(ve.Utils.pointInPolygon(e,t,d)){c=!0;break}}}catch(h){u.e(h)}finally{u.f()}if(c){o=s;break}}}catch(h){i.e(h)}finally{i.f()}return o}},{key:"calculateRulerData",value:function(){for(var e=Object(me.a)(this.getCorners(this.activeLayerIndex).map((function(e){return{x:e.x,y:e.y}}))),t=[],n=[],r=0;r<e.length;r++){var o,i=!1,a=Object(j.a)(t);try{for(a.s();!(o=a.n()).done;){if(o.value.x===e[r].x){i=!0;break}}}catch(u){a.e(u)}finally{a.f()}!i&&t.push(e[r]),i=!1;var s,l=Object(j.a)(n);try{for(l.s();!(s=l.n()).done;){if(s.value.y===e[r].y){i=!0;break}}}catch(u){l.e(u)}finally{l.f()}!i&&n.push(e[r])}t=t.sort((function(e,t){return e.x-t.x})),n=n.sort((function(e,t){return e.y-t.y}));var c={x:[],y:[]};for(r=0;r<t.length-1;r++)c.x.push({start:t[r],end:t[r+1],length:Math.abs(t[r].x-t[r+1].x)});for(r=0;r<n.length-1;r++)c.y.push({start:n[r],end:n[r+1],length:Math.abs(n[r].y-n[r+1].y)});return c}},{key:"saveFloorplan",value:function(){var e=this,t=[],n=[],r={offset:0,vertices:{},edges:[],faces:{}},o={offset:0};r.offset=e.roof.offset,e.roof.vertices.forEach((function(e){r.vertices[e.id]={x:e.x,y:e.y,z:e.z,id:e.id}})),e.roof.edges.forEach((function(e){r.edges.push({start:e.start.id,end:e.end.id})})),e.roof.getFaces().forEach((function(e){r.faces[e.getUuid()]={color:e.color}})),e.roof.items.forEach((function(e){n.push({uuid:e.uuid,item_name:e.metadata.itemName,item_type:e.metadata.itemType,model_url:e.metadata.modelUrl||e.metadata.threeModel,xpos:e.position.x,ypos:e.position.y,zpos:e.position.z,rotation:e.rotation.y,metadata:e.metadata,options:e.getOptions()})})),function(){var t=e.obstacleLayer,n={corners:{},walls:[]};t.getCorners().forEach((function(e){n.corners[e.id]={x:e.x,y:e.y}})),t.getWalls().forEach((function(e){n.walls.push({corner1:e.getStart().id,corner2:e.getEnd().id,height:e.height})})),o.floorplan=n}();var i,a=Object(j.a)(this.layers.entries());try{var s=function(){var e=Object(ie.a)(i.value,2),r=e[0],o=e[1];if(!o)return"continue";var a=o.offset,s=o.height,l=o.floorThickness,c={corners:{},walls:[],rooms:{}};o.getCorners().forEach((function(e){c.corners[e.id]={x:e.x,y:e.y}})),o.getWalls().forEach((function(e){c.walls.push({corner1:e.getStart().id,corner2:e.getEnd().id,thickness:e.thickness,thicknessDirection:e.thicknessDirection,isOutsideWall:e.isOutsideWall,interiorTexture:e.interiorTexture,exteriorTexture:e.exteriorTexture,interiorConduction:e.interiorConduction,exteriorConduction:e.exteriorConduction})})),o.getRooms().forEach((function(e){c.rooms[e.getUuid()]={name:e.name,tags:e.tags,texture:e.texture,conduction:e.conduction}})),o.getWalls().forEach((function(e){e.items.forEach((function(e){n.push({uuid:e.uuid,item_name:e.metadata.itemName,item_type:e.metadata.itemType,model_url:e.metadata.modelUrl||e.metadata.threeModel,xpos:e.position.x,ypos:e.position.y,zpos:e.position.z,rotation:e.rotation.y,metadata:e.metadata,options:e.getOptions()})}))})),t[r]={offset:a,height:s,floorThickness:l,floorplan:c}};for(a.s();!(i=a.n()).done;)s()}catch(l){a.e(l)}finally{a.f()}return{buildingOffset:this.buildingOffset,layers:t,roof:r,obstacle:o,items:n}}},{key:"loadFloorplan",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.reset();var o=e.layers,i=e.roof,a=e.obstacle;this.buildingOffset=e.hasOwnProperty("buildingOffset")?e.buildingOffset:0;var s,l=Object(j.a)(o.entries());try{var c=function(){var e=Object(ie.a)(s.value,2),n=e[0],r=e[1];if(n-=0,!r)return"continue";var o=r.floorplan,i=r.offset,l=r.height,c=r.floorThickness,u=t.newLayer(n,i,l);c&&u.setFloorThickness(c);var d={};if(null===o||!("corners"in o)||!("walls"in o))return{v:void 0};for(var h in o.corners){var f=o.corners[h];d[h]=u.newCorner(f.x,f.y,h)}o.walls.forEach((function(e){var t=u.newWall(d[e.corner1],d[e.corner2]);e.hasOwnProperty("isOutsideWall")&&(t.isOutsideWall=e.isOutsideWall),e.hasOwnProperty("thickness")&&(t.thickness=e.thickness),e.hasOwnProperty("thicknessDirection")&&(t.thicknessDirection=e.thicknessDirection),t.interiorTexture=e.interiorTexture,t.exteriorTexture=e.exteriorTexture,t.interiorConduction=e.interiorConduction,t.exteriorConduction=e.exteriorConduction})),function(){var e=a.floorplan,n=t.obstacleLayer,r={};if(null!==e&&"corners"in e&&"walls"in e){for(var o in n.corners=[],n.walls=[],e.corners){var i=e.corners[o];r[o]=n.newCorner(i.x,i.y,o)}e.walls.forEach((function(e){n.newWall(r[e.corner1],r[e.corner2],e.height)}))}}(),u.calculateRooms(o.rooms),t.layers[n]=u};for(l.s();!(s=l.n()).done;){var u=c();if("continue"!==u&&"object"===typeof u)return u.v}}catch(d){l.e(d)}finally{l.f()}this.roof.loadData(i,r),this.update(n,r),this.roomLoadedCallbacks.forEach((function(e){return"function"===typeof e&&e()}))}},{key:"reset",value:function(){this.roof.reset(),this.obstacleLayer.reset(),this.layers=[]}},{key:"update",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this;n.getActiveLayer()&&n.getActiveLayer().calculateRooms(),n.obstacleLayer.calculateRooms(),n.roof.calculateFaces(),n.assignOrphanEdges(),t&&document.dispatchEvent(new CustomEvent(ve.BP3D_EVENT_ADD_TO_UNDO_STACK)),n.updated_rooms.forEach((function(t){return t(e)})),n.buildingOffsetUpdatedCallbacks.forEach((function(e){return e(n.buildingOffset)})),n.layerUpdatedCallbacks.forEach((function(e){return e(n.getLayers(),n.getRoomsInfo())}))}},{key:"getCenter",value:function(){return this.getDimensions(!0)}},{key:"getSize",value:function(){return this.getDimensions(!1)}},{key:"getDimensions",value:function(e){e=e||!1;var t=1/0,n=-1/0,r=1/0,o=-1/0;return this.getCorners().forEach((function(e){e.x<t&&(t=e.x),e.x>n&&(n=e.x),e.y<r&&(r=e.y),e.y>o&&(o=e.y)})),t===1/0||n===-1/0||r===1/0||o===-1/0?new k.Tb:e?new k.Tb(.5*(t+n),0,.5*(r+o)):new k.Tb(n-t,0,o-r)}},{key:"assignOrphanEdges",value:function(){}}]),e}(),pt=n(58),vt=.2,gt=function(e){Object(g.a)(n,e);var t=Object(y.a)(n);function n(){var e;Object(p.a)(this,n);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).getBottomObjectsForStack=function(){var t=[];return e.model.scene.items.forEach((function(e){e.stackontop&&t.push(t)})),t},e.getStackingPosition=function(t){var n,r=0,o=e.getCorners("x","z",t),i=e.model.scene.items,a=Object(j.a)(i);try{for(a.s();!(n=a.n()).done;){var s=n.value;if(s!==Object(je.a)(e)&&s.obstructFloorMoves&&(s.stackontop&&(!ve.Utils.polygonOutsidePolygon(o,s.getCorners("x","z"))||ve.Utils.polygonPolygonIntersect(o,s.getCorners("x","z"))))){var l=s.getBounding().max.y;l>r&&(r=l)}}}catch(c){a.e(c)}finally{a.f()}return r+0},e.getSnapPosition=function(t){for(var n=e.getCorners("x","z",t),r=1/0,o=1/0,i=n[0].x,a=n[1].x,s=n[0].y,l=n[2].y,c=e.model.scene.items,u=0;u<c.length;u++)if(c[u]!==Object(je.a)(e)&&c[u].obstructFloorMoves){var d,h=c[u].getSnapPoints(!0),f=Object(j.a)(h);try{for(f.s();!(d=f.n()).done;){var p=d.value;Math.abs(i-p.x)<vt&&Math.abs(i-p.x)<Math.abs(r)&&(r=p.x-i,r-=r/Math.abs(r)*0),Math.abs(a-p.x)<vt&&Math.abs(a-p.x)<Math.abs(r)&&(r=p.x-a,r-=r/Math.abs(r)*0),Math.abs(s-p.y)<vt&&Math.abs(s-p.y)<Math.abs(o)&&(o=p.y-s,o-=o/Math.abs(o)*0),Math.abs(l-p.y)<vt&&Math.abs(l-p.y)<Math.abs(o)&&(o=p.y-l,o-=o/Math.abs(o)*0)}}catch(v){f.e(v)}finally{f.f()}}r!==1/0&&(t.x+=r),o!==1/0&&(t.z+=o)},e.isOverlapped=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.getCorners("x","z"),r=e.getBounding(),o=0;o<t.length;o++)if(t[o]!==Object(je.a)(e)&&t[o].obstructFloorMoves&&!0!==t[o].isSet){var i=t[o].getBounding();if(!(i.min.y>=r.max.y)&&!(r.min.y>=i.max.y)){var a=t[o].getCorners("x","z");if(ve.Utils.polygonPolygonIntersect(n,a))return Xe}}return He},e.isValidPosition=function(t){for(var n=e.getCorners("x","z",t),r=e.model.scene.items,o=e.model.floorplan.getRooms(),i=!1,a=0;a<o.length;a++)ve.Utils.pointInPolygon(t.x,t.z,o[a].interiorCorners)&&!ve.Utils.polygonPolygonIntersect(n,o[a].interiorCorners)&&(i=!0);return i?(ve.Configuration.getBooleanValue(ve.configSnapMode)&&e.getSnapPosition(t),e.overlappable?He:e.isOverlapped(r,n)):Ue},e}return Object(v.a)(n,[{key:"placeInRoom",value:function(){}},{key:"resized",value:function(){}},{key:"moveToPosition",value:function(e,t){if(!(isNaN(e.x)||isNaN(e.y)||isNaN(e.z))){var n=this.isValidPosition(e);if(n===He||n===Xe){this.hideError();var r=(new k.Tb).copy(e),o=0;if(this.stackable){if(0===this.getBottomObjectsForStack().length)return console.log("no bottom objects"),void this.showError();var i=this.getStackingPosition(r);if(0===i)return void this.showError();o=i}if(r.y=o,n===Xe&&!this.overlappable)return void this.showError(e);if(isNaN(r.x)||isNaN(r.y)||isNaN(r.z))return;this.position.copy(r),this.dimensionHelper.position.copy(r),this.changed(),this.groupParent&&this.groupParent.isSet&&this.groupParent.update()}else this.showError(e)}}}]),n}(_e),yt=function(e){Object(g.a)(n,e);var t=Object(y.a)(n);function n(e,r,o,i,a,s){var l;return Object(p.a)(this,n),(l=t.call(this,e,r,o,i,a,s)).currentWallEdge=null,l.refVec=new k.Sb(0,1),l.wallOffsetScalar=0,l.sizeX=0,l.sizeY=0,l.addToWall=!1,l.boundToFloor=!1,l.frontVisible=!1,l.backVisible=!1,l.forceVisible=!0,l.setPosition=function(e){var t=l.closestWallEdge(e);l.changeWallEdge(t);var n=(new k.Tb).copy(e);l.boundMove(n),l.position.copy(n),l.dimensionHelper.position.copy(n),l.redrawWall(),l.changed()},l.allowRotate=!1,l.morphAlign=3,l}return Object(v.a)(n,[{key:"closestWallEdge",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.position,t=this.model.floorplan.buildingOffset,n=this.model.floorplan.wallEdges(),r=null,o=1/0,i=e.x,a=e.y,s=e.z;return n.forEach((function(e){var n=e.distanceTo(i,s),l=Math.sqrt(Math.pow(n,2)+Math.pow(a-e.layerOffset-t,2));l<o&&(o=l,r=e)})),r}},{key:"removed",value:function(){null!=this.currentWallEdge&&this.addToWall&&(ve.Utils.removeValue(this.currentWallEdge.wall.items,this),this.redrawWall())}},{key:"redrawWall",value:function(){this.addToWall&&this.currentWallEdge&&this.currentWallEdge.wall&&this.currentWallEdge.wall.fireRedraw()}},{key:"updateEdgeVisibility",value:function(e,t){t?this.frontVisible=e:this.backVisible=e,this.forceVisible?this.visible=this.frontVisible||this.backVisible:this.visible=!1}},{key:"updateSize",value:function(){var e=this.getBounding();this.wallOffsetScalar=(e.max.z-e.min.z)*this.scale.z/2,this.sizeX=(e.max.x-e.min.x)*this.scale.x,this.sizeY=(e.max.y-e.min.y)*this.scale.y}},{key:"resized",value:function(){this.boundToFloor,this.updateSize(),this.redrawWall()}},{key:"placeInRoom",value:function(){var e=this.closestWallEdge();if(this.changeWallEdge(e),this.updateSize(),!this.position_set){var t=e.interiorCenter(),n=new k.Tb(t.x,e.wall.height/2,t.y);this.boundMove(n),this.position.copy(n),this.redrawWall()}this.changed()}},{key:"moveToPosition",value:function(e,t){if(isNaN(e.x)||isNaN(e.y)||isNaN(e.z))console.log("nan detected");else{this.changeWallEdge(t.object.edge),this.boundMove(e),this.position.copy(e);var n=(new k.Tb).copy(e),r=this.getBounding();n.y=(r.max.y+r.min.y)/2,this.dimensionHelper.position.copy(n),this.redrawWall(),this.changed()}}},{key:"getWallOffset",value:function(){return this.wallOffsetScalar}},{key:"changeWallEdge",value:function(e){null!=this.currentWallEdge&&(this.addToWall?(ve.Utils.removeValue(this.currentWallEdge.wall.items,this),this.redrawWall()):ve.Utils.removeValue(this.currentWallEdge.wall.onItems,this)),null!=this.currentWallEdge&&this.currentWallEdge.wall.dontFireOnDelete(this.remove.bind(this)),e.wall.fireOnDelete(this.remove.bind(this));var t=new k.Sb,n=e.plane.geometry.faces[0].normal;t.x=n.x,t.y=n.z;var r=ve.Utils.angle(this.refVec.x,this.refVec.y,t.x,t.y);this.flipped&&(r=(r+Math.PI)%(2*Math.PI)),this.rotation.y=r,this.dimensionHelper.rotation.y=r,this.currentWallEdge=e,this.addToWall?(e.wall.items.push(this),this.redrawWall()):e.wall.onItems.push(this)}},{key:"customIntersectionPlanes",value:function(){return this.model.floorplan.wallEdgePlanes()}},{key:"boundMove",value:function(e){var t=this.currentWallEdge,n=.002,r=t.layerOffset+this.model.floorplan.buildingOffset;e.applyMatrix4(t.interiorTransform),e.x<this.sizeX/2+n?e.x=this.sizeX/2+n:e.x>t.interiorDistance()-this.sizeX/2-n&&(e.x=t.interiorDistance()-this.sizeX/2-n),this.boundToFloor?e.y=0*this.scale.y+.01+r:e.y<n+r?e.y=n+r:e.y>t.height-this.sizeY-n+r&&(e.y=t.height-this.sizeY-n+r),e.z=this.getWallOffset(),e.applyMatrix4(t.invInteriorTransform)}}]),n}(_e),mt=function(e){Object(g.a)(n,e);var t=Object(y.a)(n);function n(e,r,o,i,a,s){var l;return Object(p.a)(this,n),(l=t.call(this,e,r,o,i,a,s)).flipHorizontal=function(){l.flipped=!l.flipped,l.rotation.y=(l.rotation.y+Math.PI)%(2*Math.PI)},l.addToWall=!0,l.morphAlign=0,l.flippable=!0,l.flipped=!1,l}return Object(v.a)(n,[{key:"getWallOffset",value:function(){try{return this.currentWallEdge.offset+.03}catch(e){}return 0}}]),n}(yt),bt={1:gt,2:yt,3:mt,7:function(e){Object(g.a)(n,e);var t=Object(y.a)(n);function n(e,r,o,i,a,s){var l;return Object(p.a)(this,n),(l=t.call(this,e,r,o,i,a,s)).boundToFloor=!0,l}return n}(mt),8:function(e){Object(g.a)(n,e);var t=Object(y.a)(n);function n(e,r,o,i,a,s){var l;return Object(p.a)(this,n),(l=t.call(this,e,r,o,i,a,s)).obstructFloorMoves=!1,l.receiveShadow=!0,l}return n}(gt),9:function(e){Object(g.a)(n,e);var t=Object(y.a)(n);function n(e,r,o,i,a,s){var l;return Object(p.a)(this,n),(l=t.call(this,e,r,o,i,a,s)).boundToFloor=!0,l}return n}(yt),10:Je},xt=function(){function e(){Object(p.a)(this,e)}return Object(v.a)(e,null,[{key:"getClass",value:function(e){return bt[e]}}]),e}(),wt=c,jt=function(){function e(t,n){Object(p.a)(this,e),this.items=[],this.roofEdges=[],this.roofVertices=[],this.needsUpdate=!1,this.itemLoadingCallbacks=[],this.itemLoadedCallbacks=[],this.itemRemovedCallbacks=[],this.model=t,this.textureDir=n,this.scene=new k.yb,this.GLTFLoader=new pt.a,this.GLTFLoader.crossOrigin=""}return Object(v.a)(e,[{key:"add",value:function(e){this.scene.add(e)}},{key:"remove",value:function(e){this.scene.remove(e),ve.Utils.removeValue(this.items,e)}},{key:"getScene",value:function(){return this.scene}},{key:"getItems",value:function(){return this.items}},{key:"itemCount",value:function(){return this.items.length}},{key:"clearItems",value:function(){var e=this;this.items.forEach((function(t){t.dimensionHelper&&e.remove(t.dimensionHelper),e.removeItem(t,!0)})),this.items=[]}},{key:"removeItem",value:function(e,t){t=t||!1,this.itemRemovedCallbacks.forEach((function(t){return"function"===typeof t&&t(e)})),e.removed(),this.scene.remove(e),t||ve.Utils.removeValue(this.items,e)}},{key:"cloneItem",value:function(){var e=Object(x.a)(b.a.mark((function e(t){var n=this;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var r=n,o=t.cloneData;if(!o)return null;var i=o.metadata,a=o.options,s=o.meshList,l=o.position,c=o.rotation,u=i.itemType,d=[];s.forEach((function(e){var t=e.clone(),n=(new k.j).copy(e.geometry);t.geometryBackup=n,d.push(t)}));var h=new(wt.Factory.getClass(u))(r.model,i,d,l,c,a);h.initObject(s,l,c,a),r.items.push(h),r.add(h),setTimeout((function(){e(h)}),0)})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"addItem",value:function(){var e=Object(x.a)(b.a.mark((function e(t,n,r,o,i,a){var s,l=this,c=arguments;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=!(c.length>6&&void 0!==c[6])||c[6],e.abrupt("return",new Promise((function(e){t=t||1;var c=l;l.itemLoadingCallbacks.forEach((function(e){return"function"===typeof e&&e()})),l.GLTFLoader.load(n,(function(n){var l=[],u={},d={},h={};n.scene.traverse((function(e){if(e.isMesh)if(e.name.includes("morph-")||l.push(e),e.name.includes("morph-height")){var t=e.name.replace("-morph-height",""),n=[];e.geometry.attributes.uv.array.forEach((function(e){return n.push(e)})),u[t]=n}else if(e.name.includes("morph-width")){var r=e.name.replace("-morph-width",""),o=[];e.geometry.attributes.uv.array.forEach((function(e){return o.push(e)})),d[r]=o}else if(e.name.includes("morph-depth")){var i=e.name.replace("-morph-depth",""),a=[];e.geometry.attributes.uv.array.forEach((function(e){return a.push(e)})),h[i]=a}}));var f=[u,d,h],p=new(wt.Factory.getClass(t))(c.model,Object(w.a)(Object(w.a)({},r),{},{morphUVs:f}),l,o,i,a);p.initObject(l,o,i,a),c.items.push(p),c.add(p),console.log(p),s&&c.itemLoadedCallbacks.forEach((function(e){return e(p)})),e(p)}),void 0,(function(){e(null)}))})));case 2:case"end":return e.stop()}}),e)})));return function(t,n,r,o,i,a){return e.apply(this,arguments)}}()}]),e}(),kt=window.UndoRedoStack||function(){},Ot=function e(t){var n=this;Object(p.a)(this,e),this.undoHistory=null,this.roomLoadingCallbacks=[],this.roomLoadedCallbacks=[],this.roomSavedCallbacks=[],this.roomDeletedCallbacks=[],this.loadSerialized=function(){var e=Object(x.a)(b.a.mark((function e(t){var r,o,i,a=arguments;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=!(a.length>1&&void 0!==a[1])||a[1],o=!(a.length>2&&void 0!==a[2])||a[2],n.roomLoadingCallbacks.forEach((function(e){return e()})),i=JSON.parse(t),console.log(i),e.next=7,n.initializeFloorPlans(i,r,o);case 7:n.roomLoadedCallbacks.forEach((function(e){return e()}));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.exportSerialized=function(){return JSON.stringify(n.floorplan.saveFloorplan())},this.collectMetadata=function(){for(var e=n.floorplan,t=e.orientation,r={RoomName:[],RoomHeight:[],RoomVolume:[],UsableFloorArea:[],RoomCentroid:[],TotalFloorArea:[],FloorOutside:[],RoomAboveGround:[],WallArea:[],WallOutside:[],WallConduction:[],WallDirection:[],WallInclination:[],WallCentroid:[],WindowShare:[],WindowHeight:[],WindowSillHeight:[],ShadingObject:[]},o=[].concat(Object(me.a)(e.layers),[e.roofLayer]),i=o.length-1;i>=0;i--){var a,s,l,c,u,d,h,f,p,v,g,y,m,b,x,w,j,k=o[i];if(k){var O=k.getLayerMetadata(t);(a=r.RoomName).push.apply(a,Object(me.a)(O.RoomName)),(s=r.RoomHeight).push.apply(s,Object(me.a)(O.RoomHeight)),(l=r.RoomVolume).push.apply(l,Object(me.a)(O.RoomVolume)),(c=r.WallArea).push.apply(c,Object(me.a)(O.WallArea)),(u=r.WallOutside).push.apply(u,Object(me.a)(O.WallOutside)),(d=r.WallConduction).push.apply(d,Object(me.a)(O.WallConduction)),(h=r.WallDirection).push.apply(h,Object(me.a)(O.WallDirection)),(f=r.WallInclination).push.apply(f,Object(me.a)(O.WallInclination)),(p=r.WallCentroid).push.apply(p,Object(me.a)(O.WallCentroid)),(v=r.WindowShare).push.apply(v,Object(me.a)(O.WindowShare)),(g=r.WindowHeight).push.apply(g,Object(me.a)(O.WindowHeight)),(y=r.WindowSillHeight).push.apply(y,Object(me.a)(O.WindowSillHeight)),(m=r.UsableFloorArea).push.apply(m,Object(me.a)(O.UsableFloorArea)),(b=r.RoomCentroid).push.apply(b,Object(me.a)(O.RoomCentroid)),(x=r.TotalFloorArea).push.apply(x,Object(me.a)(O.TotalFloorArea)),(w=r.FloorOutside).push.apply(w,Object(me.a)(O.FloorOutside)),(j=r.RoomAboveGround).push.apply(j,Object(me.a)(O.RoomAboveGround))}}return r.ShadingObject=e.obstacleLayer.getLayerMetadata(),r},this.undo=function(){if(n.undoHistory){n.undoHistory.undo();var e=n.undoHistory.latest();e&&n.loadSerialized(e,!1,!1)}},this.redo=function(){if(n.undoHistory){n.undoHistory.redo();var e=n.undoHistory.latest();e&&n.loadSerialized(e,!1,!1)}},this.addToUndoStack=function(){if(n.undoHistory){var e=n.exportSerialized(),t=n.undoHistory.latest();0!==e.localeCompare(t)&&(n.undoHistory.push(e),console.log("undo history",n.undoHistory.getValues().undo.length))}},this.initializeFloorPlans=function(){var e=Object(x.a)(b.a.mark((function e(t){var r,o,i,a,s,l,c,u,d,h,f,p,v,g,y,m=arguments;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=!(m.length>1&&void 0!==m[1])||m[1],o=m.length>2&&void 0!==m[2]&&m[2],n.scene.clearItems(),n.floorplan.loadFloorplan(t,r,o),i=[],a=[],s=Object(j.a)(t.items),e.prev=7,s.s();case 9:if((l=s.n()).done){e.next=39;break}c=l.value,u=c.metadata,d=-1,e.t0=b.a.keys(i);case 14:if((e.t1=e.t0()).done){e.next=22;break}if(h=e.t1.value,h-=0,!JSON.stringify(i[h]).localeCompare(0===JSON.stringify(u))){e.next=20;break}return d=h,e.abrupt("break",22);case 20:e.next=14;break;case 22:if(f=new k.Tb(c.xpos,c.ypos,c.zpos),!(d>=0)){e.next=32;break}return e.next=26,n.scene.cloneItem(a[d]);case 26:for(g in p=e.sent,v=c.options.morph,p.setPosition(f),v)p.setMorph(parseInt(g),v[g]);e.next=37;break;case 32:return e.next=34,n.scene.addItem(c.item_type,c.model_url,u,f,c.rotation,c.options);case 34:y=e.sent,i.push(u),a.push(y);case 37:e.next=9;break;case 39:e.next=44;break;case 41:e.prev=41,e.t2=e.catch(7),s.e(e.t2);case 44:return e.prev=44,s.f(),e.finish(44);case 47:case"end":return e.stop()}}),e,null,[[7,41,44,47]])})));return function(t){return e.apply(this,arguments)}}(),this.floorplan=new ft,this.scene=new jt(this,t),this.floorplan.scene=this.scene,this.undoHistory=kt(),document.addEventListener("keypress",(function(e){26===e.keyCode&&e.ctrlKey&&n.undo()})),document.addEventListener(ve.BP3D_EVENT_ADD_TO_UNDO_STACK,(function(){n.addToUndoStack()}))},Ct=n(59);function Et(e,t){var n,r,o={turbidity:1,rayleigh:.558,mieCoefficient:.001,mieDirectionalG:.1,elevation:90,azimuth:180,exposure:.5};function i(){var e=n.material.uniforms;e.turbidity.value=o.turbidity,e.rayleigh.value=o.rayleigh,e.mieCoefficient.value=o.mieCoefficient,e.mieDirectionalG.value=o.mieDirectionalG;var t=k.T.degToRad(90-o.elevation),i=k.T.degToRad(o.azimuth);r.setFromSphericalCoords(1,t,i),e.sunPosition.value.copy(r)}this.updateSunPosition=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.PI/2,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI;o.azimuth=-e/Math.PI*180,o.elevation=t/Math.PI*180,i()},(n=new Ct.a).scale.setScalar(1e3),n.position.y=-1,e.add(n),r=new k.Tb,i()}var St=function(e,t){this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new k.Tb,this.center=this.target,this.noZoom=!1,this.zoomSpeed=1,this.minDistance=0,this.maxDistance=500,this.noRotate=!1,this.rotateSpeed=1,this.noPan=!1,this.keyPanSpeed=40,this.autoRotate=!1,this.autoRotateSpeed=2,this.minPolarAngle=0,this.maxPolarAngle=Math.PI/2,this.noKeys=!1,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.cameraMovedCallbacks=[],this.needsUpdate=!0;var n=this,r=1e-6,o=new k.Sb,i=new k.Sb,a=new k.Sb,s=new k.Sb,l=new k.Sb,c=new k.Sb,u=new k.Sb,d=new k.Sb,h=new k.Sb,f=0,p=0,v=1,g=new k.Tb,y=-1,m=0,b=1,x=2,w=3,j=4,O=5,C=y;function E(){return 2*Math.PI/60/60*n.autoRotateSpeed}function S(){return Math.pow(.95,n.zoomSpeed)}function M(e){if(!1!==n.enabled){e.preventDefault();var t=n.domElement===document?n.domElement.body:n.domElement;if(C===m){if(!0===n.noRotate)return;i.set(e.clientX,e.clientY),a.subVectors(i,o),n.rotateLeft(2*Math.PI*a.x/t.clientWidth*n.rotateSpeed),n.rotateUp(2*Math.PI*a.y/t.clientHeight*n.rotateSpeed),o.copy(i)}else if(C===b){if(!0===n.noZoom)return;d.set(e.clientX,e.clientY),h.subVectors(d,u),h.y>0?n.dollyIn():n.dollyOut(),u.copy(d)}else if(C===x){if(!0===n.noPan)return;l.set(e.clientX,e.clientY),c.subVectors(l,s),n.pan(c),s.copy(l)}n.update()}}function T(){!1!==n.enabled&&(n.domElement.removeEventListener("mousemove",M,!1),n.domElement.removeEventListener("mouseup",T,!1),C=y)}function W(e){if(!1!==n.enabled&&!0!==n.noZoom){var t=0;e.wheelDelta?t=e.wheelDelta:e.detail&&(t=-e.detail),t>0?n.dollyOut():n.dollyIn(),n.update()}}this.controlsActive=function(){return C===y},this.setPan=function(e){g=e},this.panTo=function(e){var t=new k.Tb(e.x,n.target.y,e.z),r=n.target.clone().sub(t);g.sub(r),n.update()},this.rotateLeft=function(e){void 0===e&&(e=E()),p-=e},this.rotateUp=function(e){void 0===e&&(e=E()),f-=e},this.panLeft=function(e){var t=new k.Tb,n=this.object.matrix.elements;t.set(n[0],0,n[2]),t.normalize(),t.multiplyScalar(-e),g.add(t)},this.panUp=function(e){var t=new k.Tb,n=this.object.matrix.elements;t.set(n[4],0,n[6]),t.normalize(),t.multiplyScalar(e),g.add(t)},this.pan=function(e){var t=n.domElement===document?n.domElement.body:n.domElement;if(void 0!==n.object.fov){var r=n.object.position.clone().sub(n.target).length();r*=Math.tan(n.object.fov/2*Math.PI/180),n.panLeft(2*e.x*r/t.clientHeight),n.panUp(2*e.y*r/t.clientHeight)}else void 0!==n.object.top?(n.panLeft(e.x*(n.object.right-n.object.left)/t.clientWidth),n.panUp(e.y*(n.object.top-n.object.bottom)/t.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.");n.update()},this.panXY=function(e,t){n.pan(new k.Sb(e,t))},this.dollyIn=function(e){void 0===e&&(e=S()),v/=e,this.update()},this.dollyOut=function(e){void 0===e&&(e=S()),v*=e,this.update()},this.update=function(){var e=this.object.position,t=e.clone().sub(this.target),n=Math.atan2(t.x,t.z),o=Math.atan2(Math.sqrt(t.x*t.x+t.z*t.z),t.y);this.autoRotate&&this.rotateLeft(E()),n+=p,o+=f,o=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,o)),o=Math.max(r,Math.min(Math.PI-r,o));var i=t.length()*v;i=Math.max(this.minDistance,Math.min(this.maxDistance,i)),this.target.add(g),t.x=i*Math.sin(o)*Math.sin(n),t.y=i*Math.cos(o),t.z=i*Math.sin(o)*Math.cos(n),e.copy(this.target).add(t),this.object.lookAt(this.target),p=0,f=0,v=1,g.set(0,0,0),this.cameraMovedCallbacks.forEach((function(e){return"function"===typeof e&&e()})),this.needsUpdate=!0},this.domElement.addEventListener("contextmenu",(function(e){e.preventDefault()}),!1),this.domElement.addEventListener("mousedown",(function(e){if(!1!==n.enabled){if(e.preventDefault(),2===e.button){if(!0===n.noRotate)return;C=m,o.set(e.clientX,e.clientY)}else if(1===e.button){if(!0===n.noZoom)return;C=b,u.set(e.clientX,e.clientY)}else if(0===e.button){if(!0===n.noPan)return;C=x,s.set(e.clientX,e.clientY)}n.domElement.addEventListener("mousemove",M,!1),n.domElement.addEventListener("mouseup",T,!1)}}),!1),this.domElement.addEventListener("mousewheel",W,!1),this.domElement.addEventListener("DOMMouseScroll",W,!1),this.domElement.addEventListener("touchstart",(function(e){if(!1!==n.enabled)switch(e.touches.length){case 3:if(!0===n.noRotate)return;C=w,o.set(e.touches[0].pageX,e.touches[0].pageY);break;case 2:if(!0===n.noZoom)return;C=j;var t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY,i=Math.sqrt(t*t+r*r);u.set(0,i);break;case 1:if(!0===n.noPan)return;C=O,s.set(e.touches[0].pageX,e.touches[0].pageY);break;default:C=y}}),!1),this.domElement.addEventListener("touchend",(function(){!1!==n.enabled&&(C=y)}),!1),this.domElement.addEventListener("touchmove",(function(e){if(!1!==n.enabled){e.preventDefault(),e.stopPropagation();var t=n.domElement===document?n.domElement.body:n.domElement;switch(e.touches.length){case 1:if(!0===n.noRotate)return;if(C!==w)return;i.set(e.touches[0].pageX,e.touches[0].pageY),a.subVectors(i,o),n.rotateLeft(2*Math.PI*a.x/t.clientWidth*n.rotateSpeed),n.rotateUp(2*Math.PI*a.y/t.clientHeight*n.rotateSpeed),o.copy(i);break;case 2:if(!0===n.noZoom)return;if(C!==j)return;var r=e.touches[0].pageX-e.touches[1].pageX,f=e.touches[0].pageY-e.touches[1].pageY,p=Math.sqrt(r*r+f*f);d.set(0,p),h.subVectors(d,u),h.y>0?n.dollyOut():n.dollyIn(),u.copy(d);break;case 3:if(!0===n.noPan)return;if(C!==O)return;l.set(e.touches[0].pageX,e.touches[0].pageY),c.subVectors(l,s),n.pan(c),s.copy(l);break;default:C=y}}}),!1),window.addEventListener("keydown",(function(e){if(!1!==n.enabled&&!0!==n.noKeys&&!0!==n.noPan)switch(e.keyCode){case n.keys.UP:case n.keys.BOTTOM:case n.keys.LEFT:case n.keys.RIGHT:}}),!1)},Mt=function(e){var t=this,n=e.scene,r=null,o=!1,i=!1,a=null;function s(){r=null,a&&(n.remove(a),a=null)}function l(e){e?r!==e&&(s(),e.allowRotate&&!e.fixed&&(a=function(e){var n=new k.x,r=new k.F(function(e){var t=new k.w;return t.vertices.push(new k.Tb(0,0,0),d(e)),t}(e),(t.rotating,new k.H({color:u(),linewidth:3,depthTest:!1})),k.K),o=function(e){var t=new k.o(.05,0,.1),n=new k.X({color:u()}),r=new k.W(t,n);return r.position.copy(d(e)),r.rotation.x=-Math.PI/2,r}(e),i=function(e){var t=new k.Gb(.04,16,16),n=new k.X({color:u(),depthTest:!1});return new k.W(t,n)}();return n.add(r),n.add(o),n.add(i),n.rotation.y=e.rotation.y,n.position.x=e.position.x,n.position.z=e.position.z,n.position.y=.05,n}(r=e),n.add(a))):s()}function c(){a&&a.children.forEach((function(e){e.material.color.set(u())})),e.needsUpdate()}function u(){return i||o?"#f1c40f":"#ffffff"}function d(e){return new k.Tb(0,0,Math.max(e.halfSize.x,e.halfSize.z)+.2)}this.getScene=function(){return n},this.getObject=function(){return a},this.setRotating=function(e){o=e,c()},this.setMouseover=function(e){i=e,c()},this.update=function(){if(a){a.rotation.y=r.rotation.y;var e=r.position;a.position.x=e.x,a.position.z=e.z}},e.itemSelectedCallbacks.push(l)},Tt=n(60),Wt=0,Pt=1,It=2,Lt=3,Dt=function(){function e(t,n){Object(p.a)(this,e),this.mode=Wt,this.enabled=!1,this.three=null,this.floorplan=null,this.roofModel=null,this.three=t,this.floorplan=n,this.roofModel=n.roof}return Object(v.a)(e,[{key:"setEnabled",value:function(e){this.enabled=e,this.roofModel.enabled=e,this.roofModel.update()}},{key:"setMode",value:function(e){this.mode=e,this.three.roofEditorModeChangedCallbacks.forEach((function(t){return t(e)}))}},{key:"addVertex",value:function(e,t,n,r){if(t-=this.roofModel.offset,r){var o=r.start,i=r.end,a=o.distanceFrom(e,t,n),s=o.distanceFrom(i.x,i.y,i.z);e=o.x+(i.x-o.x)*a/s,t=o.y+(i.y-o.y)*a/s,n=o.z+(i.z-o.z)*a/s}var l=this.roofModel.newVertex(e,t,n);r&&(this.roofModel.newEdge(l,r.getEnd()),r.setEnd(l)),this.roofModel.update()}},{key:"addEdge",value:function(e,t){e.roofVertex&&t.roofVertex&&(this.roofModel.newEdge(e.roofVertex,t.roofVertex,!0),this.roofModel.update())}}]),e}(),Rt=0,zt=1,Vt=2,At=3,Ft=4,Nt=function(e,t,n,r,o,i,a){var s=this;this.enabled=!0;var l,c,u,d,h,f=t.scene,p=t.floorplan,v=!1,g=!1,y=!1,m=!1,b=new Tt.a(n,r);this.transformControl=b,b.addEventListener("dragging-changed",(function(e){return o.enabled=!e.value})),b.addEventListener("change",(function(e){if(m&&!b.dragging&&b.object){var t=b.object;s.resetTransformControl(),t.moved_callback()}m=b.dragging})),f.add(b);var x=Rt;function w(t){try{if(!t.position_set){s.setSelectedObject(t),T(Vt);var n=t.position.clone();n.y=0,j(e.projectVector(n)),t.dimensionHelper&&t.dimensionHelper.position.copy(t.position)}t.position_set=!0}catch(r){console.log(r)}}function j(e){e=e||l;var t=s.itemIntersection(l,h);t&&h.clickPressed(t)}function O(e){e===h&&(h&&h.setUnselected(),h.mouseOff(),s.setSelectedObject(null))}function C(t){if(1===t.buttons&&x===Rt&&!d){var n=[],r=[];e.floorplan.floors.forEach((function(e){e.setHighlight(!1),n.push(e.getPlane())})),e.floorplan.edges.forEach((function(e){e.setHighlight(!1),r.push.apply(r,Object(me.a)(e.getPlanes()))}));var o=s.getIntersections(l,[].concat(r,n),!1);if(o.length>0){var i=o[0].object,a=i.room,c=i.edge;if(a)return i.threeFloor.setHighlight(!0),void e.floorClicked.forEach((function(e){return e(a)}));if(c){i.threeEdge.setHighlight(!0);var u=i.isInterior,h=i.isExterior;return c.isInterior=u,c.isExterior=h,void e.wallClicked.forEach((function(e){return e(c)}))}}e.nothingClicked.forEach((function(e){return"function"===typeof e&&e()}))}}function E(n){if(!ve.Configuration.getBooleanValue(ve.configSceneLocked)&&s.enabled)switch(n.preventDefault(),g=!0,l.x=n.offsetX,l.y=n.offsetY,v||function(){if(a.enabled){var n=t.scene.roofEdges.map((function(e){return e.mesh})),r=t.scene.roofVertices.map((function(e){return e.mesh})),o=e.floorplan.floors.map((function(e){return e.ceilingPlane})).sort((function(e,t){return t.position.y-e.position.y})),d=[].concat(Object(me.a)(n),Object(me.a)(r));!n.length&&o.length&&d.push(o[0]);var h=s.getIntersections(l,d,!1,!1);h.length>0?(c=h[0].object,u=h[0]):(c=null,u=h[0])}else{var f=i.getObject();if(null!=f)if(s.getIntersections(l,f,!1,!1,!0).length>0)return y=!0,i.setMouseover(!0),void(c=null);y=!1,i.setMouseover(!1);var p=t.scene.getItems().filter((function(e){return e instanceof Je})),v=s.getIntersections(l,p,!1,!0);c=v.length>0?v[0].object:null}}(),x){case Rt:case zt:P();break;case Vt:case At:case Ft:!function(e){e=e||l;var t=s.itemIntersection(l,h);t&&(s.isRotating()?!Boolean(h.fixed)&&h.rotate(t):h.clickDragged(t))}(),i.update(),s.needsUpdate=!0}}function S(t){if(!ve.Configuration.getBooleanValue(ve.configSceneLocked)&&s.enabled){if(t.preventDefault(),g=!1,v=!0,a.enabled)return void function(t){if(1===t.buttons){if(a.mode===Pt){if(u&&c){var n=null;c.isLine&&(n=c.roofEdge),s.resetTransformControl();var r=u.point,o=r.x,i=r.y,l=r.z;a.addVertex(o,i-0,l,n),p.update(!1),e.roof.setMode(Wt)}}else if(a.mode===It){if(h&&c&&h!==c){s.resetTransformControl();var d=h;s.setSelectedObject(c),a.addEdge(d,h),p.update(!1)}}else a.mode===Wt?c&&c.forRoof&&c.isMesh&&b.attach(c):a.mode===Lt&&c&&c.forRoof&&(s.resetTransformControl(),c.roofVertex&&c.roofVertex.removeAll(),c.roofEdge&&c.roofEdge.remove(),c=null,p.update(!1));s.setSelectedObject(c)}}(t);switch(x){case zt:y?T(At):null!=c?(s.setSelectedObject(c),c.fixed||T(Vt)):null!==c||g||(T(Rt),C(t));break;case Rt:null!=c&&(s.setSelectedObject(c),c.fixed||T(Vt)),g||C(t);break;case Vt:case At:break;case Ft:T(zt)}}}function M(e){if(!ve.Configuration.getBooleanValue(ve.configSceneLocked)&&s.enabled)switch(v=!1,x){case Vt:h.clickReleased(),T(zt),p.update(!1);break;case At:T(g?zt:Ft)}}function T(t){t!==x&&(function(t){switch(t){case Rt:case zt:break;case Vt:d?e.setCursorStyle("pointer"):e.setCursorStyle("auto")}}(x),function(t){switch(t){case Rt:s.setSelectedObject(null);break;case zt:o.enabled=!0;break;case At:case Ft:o.enabled=!1;break;case Vt:e.setCursorStyle("move"),j(),o.enabled=!1}}(t)),x=t,i.setRotating(s.isRotating())}function W(e){var t=function(e){var t=new k.Sb,n=r.getBoundingClientRect();return t.x=e.x/n.width*2-1,t.y=-e.y/n.height*2+1,t}(e),o=new k.Tb(t.x,t.y,.5);return o.unproject(n),o}function P(){null!=c?null!=d?d!==c&&("function"===typeof d.mouseOff&&d.mouseOff(),"function"===typeof(d=c).mouseOver&&d.mouseOver(),s.needsUpdate=!0):("function"===typeof(d=c).mouseOver&&d.mouseOver(),e.setCursorStyle("pointer"),s.needsUpdate=!0):null!=d&&("function"===typeof d.mouseOff&&d.mouseOff(),e.setCursorStyle("auto"),d=null,s.needsUpdate=!0)}this.needsUpdate=!0,this.resetTransformControl=function(){b.object&&b.detach(b.object)},this.selectedObject=function(){return h},this.isRotating=function(){return x===At||x===Ft},this.itemIntersection=function(e,t){var n="function"===typeof t.customIntersectionPlanes?t.customIntersectionPlanes():null,r=null;return(r=n&&n.length>0?this.getIntersections(e,n):this.getIntersections(e,undefined)).length>0?r[0]:null},this.getIntersections=function(e,t,r,o,i,a){o=o||!1,r=r||!1,i=i||!1,a=a||.25;var s,l=W(e).sub(n.position).normalize(),c=new k.wb(n.position,l);if(c.params.Line.threshold=a,Array.isArray(t)){var u=[];t.forEach((function(e){return e.traverse((function(e){(e.isMesh||e.isLine)&&u.push(e)}))})),(s=c.intersectObjects(u,i)).forEach((function(e){if(e.object.isMesh&&e.object.parent){if(e.object.parent instanceof k.yb)return;e.object.parent&&(e.object=e.object.parent)}}))}else s=c.intersectObject(t,i);return o&&(s=ve.Utils.removeIf(s,(function(e){return!e.object.visible}))),r&&(s=ve.Utils.removeIf(s,(function(e){return e.face.normal.dot(l)>0}))),s},this.setSelectedObject=function(n){if(x===Rt&&T(zt),null!=n){if(n===h)return;h&&"function"===typeof h.setUnselected&&h.setUnselected(),t.scene.roofVertices.map((function(e){return e.mesh})).forEach((function(e){return e.setUnselected()})),(h=n)&&"function"===typeof h.setSelected&&h.setSelected(),n.forRoof?n.roofVertex&&e.roofVertexSelectedCallbacks.forEach((function(e){return e(n.roofVertex)})):e.itemSelectedCallbacks.forEach((function(e){return e(n)}))}else h&&"function"===typeof h.setUnselected&&h.setUnselected(),h=null,e.itemSelectedCallbacks.forEach((function(e){return e()})),e.roofVertexSelectedCallbacks.forEach((function(e){return e()}));this.needsUpdate=!0},r.addEventListener("mousedown",S),r.addEventListener("mouseup",M),r.addEventListener("mousemove",E),l=new k.Sb,f.itemRemovedCallbacks.push(O),f.itemLoadedCallbacks.push(w)};function Bt(e,t){var n;this.getDirLight=function(){return n},this.updateSunPosition=function(e,t){var r=50*Math.sin(t),o=-50*Math.cos(t)*Math.sin(e),i=50*Math.cos(t)*Math.cos(e);n.visible=!(t<0),n.position.set(o,r,i)},function(){var t=new k.y(16777215,8947848,1);e.add(t),(n=new k.p(16777215,.4)).position.set(0,50,0),n.castShadow=!0,n.shadow.camera.top=50,n.shadow.camera.left=50,n.shadow.camera.right=-50,n.shadow.camera.bottom=-50,n.shadow.mapSize.width=2048,n.shadow.mapSize.height=2048,n.shadow.camera.near=0,n.shadow.camera.far=100,n.shadow.radius=1.4,n.shadow.bias=-.005,n.visible=!0,n.shadowCameraVisible=!1,n.castShadow=!0;var r=new k.gb;n.target=r,e.add(n),e.add(n.target)}()}var _t=n(43),Ut=ve.Utils3D,Ht=Ut.drawVertexSpriteLabel,Xt=Ut.makeVertexDimensionHelper,Yt=.01,Gt=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{roofFaces:[],roofLines:[]},a=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],s=i.roofFaces,l=i.roofLines,c=this;this.layer=o,this.room=t,r=r||ve.Configuration.getNumericValue(ve.configWallHeight),this.isHighlight=!1,this.ceilingPlane=null;var u=null,d=null,h=[],f=[],p=[],v=16777215,g=16768477;document.addEventListener(ve.BP3D_EVENT_CONFIG_CHANGED,(function(e){var t=e.detail;t&&(t.dimUnit&&f.forEach((function(e){if(e instanceof k.Ib){var t=E(e.vertex);Ht(e,t)}})),t.hasOwnProperty(ve.configDimensionVisible)&&x(),t.hasOwnProperty(ve.configShellMode)&&x())}));var y=function(){var e=c.room,t=e.ceilingCorners,o=e.floorCorners,i=e.walls,a=e.inclinedWalls,s=e.floorThickness,l=[];t.length>2&&t.forEach((function(e){l.push(new k.Tb(e.x,r,e.y))})),o.length>2&&o.forEach((function(e){l.push(new k.Tb(e.x,s,e.y))})),i.forEach((function(e){var t=e.edge,n=e.getRoomInteractionSide(c.room),r=[];n===Ke?r=t.interiorWallPoints:n===$e&&(r=t.exteriorWallPoints),r.forEach((function(e){e.y>=s&&l.push(e.clone())}))})),a.forEach((function(e){return e.corners.forEach((function(e){var t=new k.Tb(0,n,0);e.y-n>=s&&l.push(e.clone().sub(t))}))}));for(var u=[],d=0,h=l;d<h.length;d++){var f,p=h[d],v=!1,g=Object(j.a)(u);try{for(g.s();!(f=g.n()).done;){if(f.value.distanceTo(p)<Yt){v=!0;break}}}catch(m){g.e(m)}finally{g.f()}!v&&u.push(p)}try{var y=(new k.j).fromGeometry(new _t.a(u));c.room.hull=y}catch(b){}},m=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=c.room.walls,o=[],i=[];l.forEach((function(e){i.push([e[0],e[1]])})),function(){var e,a=Object(j.a)(r);try{for(a.s();!(e=a.n()).done;){var s=e.value,l=s.edge,u=s.getRoomInteractionSide(c.room),d=[],h=0;if(u===Ke?(d=l.interiorWallPoints,h=l.interiorArea()):u===$e&&(d=l.exteriorWallPoints,h=l.exteriorArea()),!(h<Yt))for(var f=0;f<d.length;f++){var p=d[f],v=d[(f+1)%d.length],g=new k.Tb(0,n,0),y=p.clone().add(g),m=v.clone().add(g);y.distanceTo(m)<Yt||(i.push([y,m]),0!==t&&(Math.abs(p.y-t)<Yt&&o.push(p),Math.abs(v.y-t)<Yt&&o.push(v)))}}}catch(b){a.e(b)}finally{a.f()}}(),i.forEach((function(t){var r=t[0],i=t[1],a=i.clone().sub(r).normalize(),s=i.distanceTo(r),l=new k.wb(r,a).intersectObject(e);if(l.length){var c=l[0];if(c.distance>s)return;var u=!1;c.point.y-=n;var d,h=Object(j.a)(o);try{for(h.s();!(d=h.n()).done;)if(d.value.distanceTo(c.point)<Yt){u=!0;break}}catch(f){h.e(f)}finally{h.f()}!u&&o.push(c.point)}}));var a=[];try{(a=Fe(o.map((function(e){return[e.x,e.z]})),20).map((function(e){return new k.Sb(e[0],e[1])}))).splice(a.length-1,1)}catch(s){}return a},b=function(){var e=c.room,t=e.ceilingCorners,o=e.floorCorners,i=e.walls,a=e.floorThickness,u=[],d=[],h=[],f=[];l.forEach((function(e){return[e[0],e[1]].forEach((function(t){return t.y>n&&u.push(e[0])}))}));t.forEach((function(e){u.push(new k.Tb(e.x,n+r,e.y))})),o.forEach((function(e){u.push(new k.Tb(e.x,n+a,e.y))})),i.forEach((function(e){var t=e.edge,r=e.getRoomInteractionSide(c.room),o=[],i=new k.Tb(0,n,0);r===Ke?o=t.interiorWallPoints:r===$e&&(o=t.exteriorWallPoints),o.forEach((function(e){e.y>0&&u.push(e.clone().add(i))}))})),u=function(e){var t=[];return e.forEach((function(e){var n,r=!1,o=Object(j.a)(t);try{for(o.s();!(n=o.n()).done;){if(n.value.distanceTo(e)<Yt){r=!0;break}}}catch(i){o.e(i)}finally{o.f()}!r&&t.push(e)})),t}(u);var p=[];s.forEach((function(e){var t,n=!1,r=Object(j.a)(p);try{for(r.s();!(t=r.n()).done;){var o=t.value;if(ve.Utils3D.checkIsSamePlane(o.plane,e.plane)){n=!0;break}}}catch(i){r.e(i)}finally{r.f()}!n&&p.push(e)}));for(var v=0,g=p;v<g.length;v++){var y,m=g[v].plane,b=[],x=Object(j.a)(u);try{for(x.s();!(y=x.n()).done;){var w=y.value,O=m.distanceToPoint(w);Math.abs(O)<Yt&&b.push(w)}}catch(M){x.e(M)}finally{x.f()}b.length>0&&(h.push(m),d.push(b))}for(var C in d.forEach((function(e){var t=Fe(e.map((function(e){return[e.x,e.z]})),20).map((function(e){return new k.Tb(e[0],0,e[1])})),n=[];t.splice(t.length-1,1),t.forEach((function(t){n.push(e.sort((function(e,n){var r=e.clone(),o=n.clone();return r.y=o.y=0,r.distanceTo(t)-o.distanceTo(t)}))[0])})),f.push(n)})),c.room.clearInclinedWalls(),f){var E=f[C],S=h[C];c.room.addInclinedWall(E,S)}},x=function(){u.visible=!0,h.forEach((function(e){return e.visible=!0})),d.visible=ve.Configuration.getBooleanValue(ve.configShellMode);var e=a?1:.1,t=1!==e;[u,d].concat(Object(me.a)(h)).forEach((function(n){n.material.opacity=e,n.material.transparent=t,n.material.depthWrite=!t}));var n=ve.Configuration.getBooleanValue(ve.configDimensionVisible);f.forEach((function(e){return e.visible=n}))},w=function(){var e=c.room.updateArea().areaCenter,r=new k.Tb(e.x,n+.01+t.floorThickness,e.y),o=c.room.getTexture(),i=(new k.Mb).load(o.url);i.wrapS=k.xb,i.wrapT=k.xb;var a=o.width||1,s=o.height||1;i.repeat.set(1/a,1/s);var l=new k.Y({map:i,side:k.q,color:v,transparent:!0,specular:657930});function u(e){var n=new k.Ab(e),o=new k.Bb(n),i=new k.W(o,l);return i.rotation.set(Math.PI/2,0,0),i.position.copy(r),i.receiveShadow=!0,i.castShadow=!0,i.room=t,i.threeFloor=c,i.updateMatrixWorld(),i}var d=[];c.room.baseCorners.forEach((function(t){d.push(new k.Sb(t.x-e.x,t.y-e.y))}));var f=u(d),p=m(f);p.length<3&&(p=[0,0].map((function(){return new k.Sb(e.x,e.y)})));var g=p.map((function(t){return new k.Sb(t.x-e.x,t.y-e.y)})),y=u(g);c.room.floorCorners=p.map((function(e){return new k.Sb(e.x,e.y)})),h=[];for(var b=t.floorThickness?t.floorThickness:0,x=function(e){var t=g[e],n=g[(e+1)%g.length],o=[new k.Tb(t.x,0,t.y),new k.Tb(n.x,0,n.y),new k.Tb(n.x,b,n.y),new k.Tb(t.x,b,t.y)],i=new k.w;o.forEach((function(e){i.vertices.push(e)})),i.faces.push(new k.s(0,1,2)),i.faces.push(new k.s(0,2,3));var a=new k.X({color:16777215,side:k.q,transparent:!0});i.computeVertexNormals();var s=new k.W(i,a),l=r.clone();l.y-=b,s.position.copy(l),h.push(s)},w=0;w<g.length;w++)x(w);return y},O=function(){var e=c.room.areaCenter,t=new k.Tb(e.x,n+r,e.y),o=new k.Y({side:k.q,transparent:!0,color:16777215});function i(e){var n=new k.Ab(e),r=new k.Bb(n),i=new k.W(r,o);return i.rotation.set(Math.PI/2,0,0),i.position.copy(t),i.threeFloor=c,i.castShadow=!0,i.receiveShadow=!0,i.updateMatrixWorld(),i}var a=i(c.room.baseCorners.map((function(t){return new k.Sb(t.x-e.x,t.y-e.y)}))),s=m(a,r);s.length<3&&(s=[0,0].map((function(){return new k.Sb(e.x,e.y)})));var l=i(s.map((function(t){return new k.Sb(t.x-e.x,t.y-e.y)})));return c.room.ceilingCorners=s.map((function(e){return new k.Sb(e.x,e.y)})),c.ceilingPlane=l,l},C=function(){f=[];var e,t=c.room,r=t.floorCorners,o=t.inclinedWalls,i=t.walls,a=t.layer,s=Object(j.a)(i);try{var l=function(){var t=e.value,r=t.edge,o=[],i=new k.Tb(0,n,0),a=t.getRoomInteractionSide(c.room);if(a===Ke?r.interiorArea()>Yt&&(o=r.interiorWallPoints.map((function(e){return e.clone().add(i)}))):a===$e&&r.exteriorArea()>Yt&&(o=r.exteriorWallPoints.map((function(e){return e.clone().add(i)}))),0===o.length)return"continue";var s=new k.H({color:255,depthTest:!1,transparent:!0,opacity:.5}),l=(new k.j).setFromPoints([].concat(Object(me.a)(o),[o[0]])),u=new k.F(l,s);f.push(u);var d,h=Object(j.a)(o);try{for(h.s();!(d=h.n()).done;){var p=d.value,v=Xt(p),g=E(p);Ht(v,g),f.push(v)}}catch(y){h.e(y)}finally{h.f()}};for(s.s();!(e=s.n()).done;)l()}catch(C){s.e(C)}finally{s.f()}var u,d=Object(j.a)(o);try{for(d.s();!(u=d.n()).done;){var h=u.value.corners,v=new k.H({color:65280,depthTest:!1,transparent:!0,opacity:.5}),g=(new k.j).setFromPoints([].concat(Object(me.a)(h),[h[0]])),y=new k.F(g,v);f.push(y);var m,b=Object(j.a)(h);try{for(b.s();!(m=b.n()).done;){var x=m.value,w=Xt(x),O=E(x);Ht(w,O),f.push(w)}}catch(C){b.e(C)}finally{b.f()}}}catch(C){d.e(C)}finally{d.f()}!function(){for(var e=r.map((function(e){return new k.Tb(e.x,n,e.y)})),t=new k.I({color:0,depthTest:!1,transparent:!0,opacity:.5,dashSize:.1,gapSize:.1}),o=[],i=0;i<e.length;i++){var s=e[i],l=e[(i+1)%e.length];if(o.push([s,l]),100===a.layerIndex){var c=s.clone(),u=l.clone();c.y=u.y=0,o.push([c,u]),o.push([s,c])}}o.forEach((function(e){var n=(new k.j).setFromPoints(e),r=new k.F(n,t);r.computeLineDistances(),r.renderOrder=100,p.push(r)}))}()};function E(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new k.Tb,t="x: "+ve.Dimensioning.cmToMeasure(100*e.x)+", \n";return t+="y: "+ve.Dimensioning.cmToMeasure(100*e.z)+", \n",t+="z: "+ve.Dimensioning.cmToMeasure(100*e.y)}this.getPlane=function(){return u},this.setHighlight=function(e){c.isHighlight=e,u.material.color.setHex(e?g:v)},this.addToScene=function(){e.add(u),e.add(d),h.forEach((function(t){return e.add(t)})),f.forEach((function(t){return e.add(t)})),p.forEach((function(t){return e.add(t)}))},this.removeFromScene=function(){e.remove(u),e.remove(d),h.forEach((function(t){return e.remove(t)})),f.forEach((function(t){return e.remove(t)})),p.forEach((function(t){return e.remove(t)})),h=[],f=[],p=[]};var S=function(){c.room.fireOnFloorChange(M),M()},M=function(){c.removeFromScene(),u=w(),d=O(),b(),C(),x(),y(),c.addToScene()};S()},Jt=function(e,t,n,r,o){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{clipPlanes:[],roofFaces:[],roofLines:[]},a=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],s=i.clipPlanes,l=i.roofFaces,c=i.roofLines,u=this;this.isHighlight=!1,this.layer=o;var d=t.wall,h=t.front,f=d.height,p=d.height,v=d.height,g=d.height,y=d.height,m=d.height,b=[],x=[],w=[],O=null,C=null,E=null,S=null,M=null,T=16777215,W=8947848,P=16768477;function I(e){d.hasRoofInteraction=R(),b=d.hasRoofInteraction?e:[]}function L(){var e=s.map((function(e){return e.roofFace}));v=z(t.interiorStart(),e),y=z(t.exteriorStart(),e),v>=d.height?y>=d.height?(v=d.height,y=d.height):v=y:y>=d.height&&(y=v),g=z(t.interiorEnd(),e),m=z(t.exteriorEnd(),e),g>=d.height?m>=d.height?(g=d.height,m=d.height):g=m:m>=d.height&&(m=g)}function D(e,t,n,o){var i=new k.w,a=new k.Tb(0,r,0),s=e.clone().add(a),u=t.clone().add(a),d=n.clone().add(a),h=o.clone().add(a),f=[];return function(){[s,u,d,h].forEach((function(e){return i.vertices.push(e)})),i.faces.push(new k.s(0,1,2)),i.faces.push(new k.s(0,2,3));var e=new k.W(i,M);e.updateMatrix(),c.forEach((function(t){var n=t[0],r=t[1],o=r.clone().sub(n).normalize(),i=r.distanceTo(n),a=new k.wb(n,o).intersectObject(e);if(a.length){var s=a[0];if(s.distance>i)return;var l,c=!1,u=Object(j.a)(f);try{for(u.s();!(l=u.n()).done;){if(l.value.distanceTo(s.point)<.001){c=!0;break}}}catch(d){u.e(d)}finally{u.f()}!c&&f.push(s.point)}}))}(),function(){var e,t=h.clone().sub(d).normalize(),n=new k.wb(d,t),r=h.distanceTo(d),o=n.intersectObjects(l,!0),i=Object(j.a)(o);try{for(i.s();!(e=i.n()).done;){var a=e.value;if(a.distance>r)return;var s,c=!1,u=Object(j.a)(f);try{for(u.s();!(s=u.n()).done;){if(s.value.distanceTo(a.point)<.001){c=!0;break}}}catch(p){u.e(p)}finally{u.f()}!c&&f.push(a.point)}}catch(p){i.e(p)}finally{i.f()}}(),function(){var e,t=u.clone().sub(s).normalize(),n=new k.wb(s,t),r=u.distanceTo(s),o=n.intersectObjects(l,!0),i=Object(j.a)(o);try{for(i.s();!(e=i.n()).done;){var a=e.value;if(a.distance>r)return;var c,d=!1,h=Object(j.a)(f);try{for(h.s();!(c=h.n()).done;){if(c.value.distanceTo(a.point)<.001){d=!0;break}}}catch(p){h.e(p)}finally{h.f()}!d&&f.push(a.point)}}catch(p){i.e(p)}finally{i.f()}}(),f.forEach((function(e){e.y-=r,e.y<0&&(e.y=0)})),f.sort((function(e,n){var r=e.clone(),o=n.clone();return r.distanceTo(t)-o.distanceTo(t)}))}function R(){var e=d.height,t=!1,n=!1;return(v<=e||y<=e)&&(t=!0),(g<=e||m<=e)&&(n=!0),!(!t&&!n)}this.visible=!1,document.addEventListener(ve.BP3D_EVENT_CONFIG_CHANGED,(function(e){var t=e.detail;t&&t.hasOwnProperty(ve.configShellMode)&&B()})),this.setHighlight=function(e){u.isHighlight=e,E.color.setHex(e?P:T),S.color.setHex(e?P:T)},this.setClipPlanes=function(){[M].forEach((function(e){e.clippingPlanes=b}))};var z=function(e,t){var n=new k.Tb(e.x,r-100,e.y),o=new k.Tb(e.x,r+d.height,e.y).clone().sub(n).normalize(),i=new k.wb(n,o).intersectObjects(t,!0),a=1e4;return i.length>0&&(a=i[0].distance-100),a<0&&(a=0),a};function V(){A(),t.redrawCallbacks.push(A),n.cameraMovedCallbacks.push(B)}function A(){L(),I(s),F(),U(),H(),N(),B(),u.setClipPlanes(),u.setHighlight(u.isHighlight)}function F(){x.forEach((function(t){return e.remove(t)})),w.forEach((function(t){return e.remove(t)})),x=[],w=[]}function N(){x.forEach((function(t){return e.add(t)})),w.forEach((function(t){return e.add(t)}))}function B(){var e=t.wall,r=n.object.position.clone(),o=e.getWallCenter(),i=new k.Tb(o.x,0,o.y);if(ve.Configuration.getBooleanValue(ve.configShellMode))u.visible=!0;else if(e.checkIsOutsideWall()){var s=e.findInsideRoomPoint();if(s&&r){var l=r.distanceTo(i),c=r.distanceTo(new k.Tb(s.x,0,s.y));u.visible=!(l<c)}else u.visible=!0}else u.visible=!0;var d=e.isObstacleWall?.6:a?1:.3,h=1!==d;[].concat(Object(me.a)(w),Object(me.a)(x)).forEach((function(t){t.visible=u.visible,t.material.opacity=d,t.material.transparent=h,t.material.depthWrite=!h,e.items.forEach((function(e){return e.forceVisible=!h}))})),_()}function _(){d.items.forEach((function(e){e.updateEdgeVisibility(u.visible,h)})),d.onItems.forEach((function(e){e.updateEdgeVisibility(u.visible,h)}))}function U(n){n=n||function(){e.needsUpdate=!0},function(){var e=t.getTexture(!0),n=e.url,r=e.width,o=e.height;(O=(new k.Mb).load(n)).wrapS=k.xb,O.wrapT=k.xb;var i=r||1,a=o||1;O.repeat.set(1/i,1/a)}(),function(){var e=t.getTexture(!1),n=e.url,r=e.width,o=e.height;(C=(new k.Mb).load(n)).wrapS=k.xb,C.wrapT=k.xb;var i=r||1,a=o||1;C.repeat.set(1/i,1/a)}()}function H(){if(d.hasRoofInteraction){var e=v,n=y,r=g,o=m;f=Math.min(Math.min(e,n),d.height),p=Math.min(Math.min(r,o),d.height)}M=new k.X({color:T,side:k.q,transparent:!0,clippingPlanes:[],clipShadows:!0}),E=new k.Y({color:d.isObstacleWall?W:T,side:k.d,clippingPlanes:[],clipShadows:!0,transparent:!0,opacity:d.isObstacleWall?.6:1});var i=G(t.interiorStart(),t.interiorEnd(),t.interiorTransform,t.invInteriorTransform,E,[v,g]);t.setInteriorWallPoints(i.points.map((function(e){return e.clone()})));var a=i.mesh;a.isInterior=!0,a.isExterior=!1,a.material.map=O,(S=E.clone()).side=k.v,i=G(t.exteriorStart(),t.exteriorEnd(),t.exteriorTransform,t.invExteriorTransform,S,[y,m]),t.setExteriorWallPoints(i.points.map((function(e){return e.clone()}))),t.adjustWallPoints();var s=i.mesh;s.isInterior=!1,s.isExterior=!0,s.material.map=C,x.push(s,a),w.push(q(t,0)),x.push(q(t,d.height)),[[t.interiorStart(),t.midStart(),f],[t.midStart(),t.exteriorStart(),f],[t.interiorEnd(),t.midEnd(),p],[t.midEnd(),t.exteriorEnd(),p]].forEach((function(e){return x.push(J(e[0],e[1],e[2]))}))}function X(e,t,n,o,i){var a=[];return d.items.forEach((function(t){var n=t.getBounding(),o=new k.Tb((n.max.x+n.min.x)/2,(n.max.y+n.min.y)/2,(n.max.z+n.min.z)/2);o.applyMatrix4(e);var i=t.halfSize.clone();i.x-=.01,i.y-=.01;var s=i.clone().multiplyScalar(-1),l=i.clone();s.add(o),l.add(o);var c=[new k.Sb(s.x,s.y-r),new k.Sb(l.x,s.y-r),new k.Sb(l.x,l.y-r),new k.Sb(s.x,l.y-r)];a.push(new k.kb(c))})),a}function Y(e){var t=e.length;return 0===e[t-1].y&&0===e[t-2].y&&(e[0].x=e[t-1].x=e[t-2].x,e[0].z=e[t-1].z=e[t-2].z),0===e[2].y&&0===e[3].y&&(e[1].x=e[2].x=e[3].x,e[1].z=e[2].z=e[3].z),function(e){var t=[];return e.forEach((function(e){var n,r=!1,o=Object(j.a)(t);try{for(o.s();!(n=o.n()).done;){var i=n.value;if(e.distanceTo(i)<.001){r=!0;break}}}catch(a){o.e(a)}finally{o.f()}!r&&t.push(e.clone())})),t}(e)}function G(e,n,o,i,a,s){var l,c=K(e),h=K(n),f=h.clone(),p=c.clone();f.y=d.height,p.y=d.height;var v=c.clone().add(f).multiplyScalar(.5);v.y=r;var g=D(c,h,f,p);f.y=s[1],p.y=s[0];var y=Y([c,h,f].concat(Object(me.a)(g),[p])),m=y.map((function(e){return e.clone()}));y.forEach((function(e){return e.applyMatrix4(o)}));var b=y.map((function(e){return new k.Sb(e.x,e.y)})),x=new k.Ab(b);(l=x.holes).push.apply(l,Object(me.a)(X(o)));var w=new k.Bb(x),j=new k.V;function O(e){var t=v,n=ve.Utils.distance(c.x-t.x,c.z-t.z,e.x,e.z),r=e.y;return new k.Sb(n,r)}j.makeTranslation(-v.x,0,-v.z),w.vertices.forEach((function(e){e.applyMatrix4(i),e.applyMatrix4(j)})),w.faceVertexUvs[0]=[],w.faces.forEach((function(e){var t=w.vertices[e.a],n=w.vertices[e.b],r=w.vertices[e.c];w.faceVertexUvs[0].push([O(t),O(n),O(r)])})),w.faceVertexUvs[1]=w.faceVertexUvs[0],w.computeFaceNormals(),w.computeVertexNormals();var C=new k.W(w,a);return C.position.copy(v),C.updateMatrixWorld(),C.castShadow=!0,C.receiveShadow=!0,C.edge=t,C.threeEdge=u,{mesh:C,points:m}}function J(e,t,n){var o=[K(e),K(t),K(t,n),K(e,n)],i=o[0].clone().add(o[2]).multiplyScalar(.5);i.y+=r;var a=new k.w,s=new k.V;s.makeTranslation(-i.x,-n/2,-i.z),o.forEach((function(e){e.applyMatrix4(s),a.vertices.push(e)})),a.faces.push(new k.s(0,1,2)),a.faces.push(new k.s(0,2,3));var l=new k.W(a,M);return l.castShadow=!0,l.receiveShadow=!0,l.position.copy(i),l}function q(e,t){var n=[Z(e.exteriorStart()),Z(e.exteriorEnd()),Z(e.midEnd()),Z(e.interiorEnd()),Z(e.interiorStart()),Z(e.midStart())],o=new k.Sb;n.forEach((function(e){o.x+=e.x,o.y+=e.y})),o.multiplyScalar(1/n.length);for(var i=new k.Tb(o.x,t+r,o.y),a=0,s=n;a<s.length;a++){var l=s[a];l.x-=o.x,l.y-=o.y}var c=new k.Ab(n),u=new k.Bb(c),d=new k.W(u,M);return d.castShadow=!0,d.receiveShadow=!0,d.rotation.set(Math.PI/2,0,0),d.position.copy(i),d}function Z(e){return new k.Sb(e.x,e.y)}function K(e,t){return t=t||0,new k.Tb(e.x,t,e.y)}this.remove=function(){var e=null;e=t.redrawCallbacks.indexOf(A),t.redrawCallbacks.splice(e,1),e=n.cameraMovedCallbacks.indexOf(B),n.cameraMovedCallbacks.splice(e,1),F()},this.getPlanes=function(){var e=[];return x[0].visible&&e.push(x[0]),x[1].visible&&e.push(x[1]),e},V()},qt=function(e,t,n){var r=this;this.mesh=null;var o=null;function i(){r.mesh&&e.remove(r.mesh)}this.remove=function(){i()};var a=function(){},s=function(){},l=function(){},c=function(){},u=function(){},d=function(){},h=function(){},f=function(){};i(),r.mesh=function(){var e=t.start,r=t.end,i=new k.Tb(e.x,e.y-0+n+0,e.z),p=new k.Tb(r.x,r.y-0+n+0,r.z);o=new k.H({color:16711680});var v=(new k.j).setFromPoints([i,p]),g=new k.F(v,o);return g.forRoof=!0,g.mouseOver=a,g.mouseOff=s,g.setSelected=l,g.setUnselected=c,g.customIntersectionPlanes=u,g.clickPressed=d,g.clickReleased=h,g.clickDragged=f,g.roofEdge=t,g}(),e.add(r.mesh),t.enabled?r.mesh.visible=!0:r.mesh.visible=!1},Zt=ve.Utils3D,Kt=Zt.drawVertexSpriteLabel,Qt=Zt.makeVertexDimensionHelper,$t=function(e,t,n){var r=this,o=this,i=null,a=.3;function s(){o.mesh&&e.remove(o.mesh),o.helper&&e.remove(o.helper)}o.mesh=null,o.helper=null,document.addEventListener(ve.BP3D_EVENT_CONFIG_CHANGED,(function(e){var t=e.detail;if(t){if(t.dimUnit){var n=o.helper;if(n instanceof k.Ib){var r=b(n.vertex);Kt(n,r)}}t.hasOwnProperty(ve.configDimensionVisible)&&l()}})),this.remove=function(){s()};var l=function(){var e=ve.Configuration.getBooleanValue(ve.configDimensionVisible);o.helper&&(o.helper.visible=e)},c=function(e){i&&(i.opacity=e?1:.5)},u=function(){c(!0)},d=function(){c(!1)},h=function(){r.mesh.roofVertex.selected=!0,i.color.setHex(16776960)},f=function(){r.mesh.roofVertex.selected=!1,i.color.setHex(255)},p=function(){},v=function(){},g=function(){},y=function(){},m=function(){var e=o.mesh.position,n=e.x,r=e.y,i=e.z;t.move(n,r-t.offset-0-t.parent.floorplan.buildingOffset,i)};function b(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new k.Tb,t="x: "+ve.Dimensioning.cmToMeasure(100*e.x)+", \n";return t+="y: "+ve.Dimensioning.cmToMeasure(100*e.z)+", \n",t+="z: "+ve.Dimensioning.cmToMeasure(100*e.y)}s(),o.mesh=function(){var e=t.x,r=t.y,s=t.z;i=new k.Y({color:255,transparent:!0,opacity:.5});var l=new k.h(a,a,a),c=new k.W(l,i),x=new k.Tb(e,r+n+0-0,s);c.position.copy(x),c.forRoof=!0,c.roofVertex=t,c.mouseOver=u,c.mouseOff=d,c.setSelected=h,c.setUnselected=f,c.customIntersectionPlanes=p,c.clickPressed=v,c.clickReleased=g,c.clickDragged=y,c.moved_callback=m,t.enabled||(c.visible=!1);var w=Qt(x),j=b(x);return Kt(w,j),o.helper=w,c}(),e.add(o.mesh),e.add(o.helper),l(),t.selected&&h()},en=n(64),tn=function(e,t,n){var r=t.vertices,o=this,i=t.color||4164045,a=new k.Y({color:i,side:k.q}),s=null;function l(){var e=!0;if(ve.Configuration.getBooleanValue(ve.configShellMode))e=!0;else{var i=n.object.position.clone(),a=new k.Tb(r[0].x,r[0].y,r[0].z),l=i.sub(a).normalize(),c=s.dot(l);e=c>=0}o.mesh.visible=!1,o.realMesh.visible=e;try{t.items.forEach((function(t){t.updateRoofVisibility(e,!0)}))}catch(u){}}function c(){e.remove(o.mesh),e.remove(o.realMesh)}function u(){var t=(new k.j).copy(o.mesh.geometry),n=new k.W(t);n.updateMatrix();var r=.001;e.items.filter((function(e){return e instanceof Je&&!(Math.abs(o.plane.distanceToPoint(e.position))>r)})).forEach((function(e){var t=e.halfSize,r=new k.W((new k.j).fromGeometry(new k.h(2*t.x,2*t.y,.1)),new k.ab),o=e.projectionBounding(),i=o[0].clone().add(o[2]).multiplyScalar(.5);r.position.copy(i),r.rotation.copy(e.rotation),r.updateMatrix(),n=en.a.subtract(n,r)}));for(var i=(new k.w).fromBufferGeometry(n.geometry),a=i.faces,s=i.vertices,l=a.length-1;l>=0;l--){var c=a[l],u=s[c.a],d=s[c.b],h=s[c.c];(Math.abs(o.plane.distanceToPoint(u))>r||Math.abs(o.plane.distanceToPoint(d))>r||Math.abs(o.plane.distanceToPoint(h))>r)&&a.splice(l,1)}o.realMesh.geometry.vertices=i.vertices,o.realMesh.geometry.faces=i.faces,o.realMesh.geometry.elementsNeedUpdate=!0}o.mesh=null,o.realMesh=null,o.plane=null,o.planeHelper=null,o.interactionLines=[],this.remove=function(){c();var e=n.cameraMovedCallbacks.indexOf(l);n.cameraMovedCallbacks.splice(e,1)},document.addEventListener(ve.BP3D_EVENT_CONFIG_CHANGED,(function(e){var t=e.detail;t&&t.hasOwnProperty(ve.configShellMode)&&l()})),document.addEventListener(ve.BP3D_REQUEST_REDRAW_ROOF,(function(){u(),l()})),n.cameraMovedCallbacks.push(l),c(),function(){if(Array.isArray(r)){var n=[];r.forEach((function(e){n.push(new k.Tb(e.x,e.y+e.offset+0-0+t.offset,e.z))}));var i=(new k.j).setFromPoints(n);i.computeVertexNormals();var s=new k.W(i,new k.Y({side:k.q}));s.castShadow=!0,s.forRoof=!0,s.face=t,o.interactionLines=[[n[0],n[1]],[n[1],n[2]],[n[0],n[2]]],o.interactionLines.forEach((function(e){var t=e[0].distanceTo(e[1]),n=.01,r=e[1].clone().sub(e[0]).normalize(),o=new k.c(r,e[0],t),i=e[0].clone().add(e[1]).multiplyScalar(.5),a=new k.W(new k.o(n,n,t),new k.Y({color:16711680}));a.visible=!1,a.position.copy(i),a.rotation.copy(o.rotation),a.updateMatrixWorld(),s.add(a)})),o.mesh=s,e.add(s),o.realMesh=new k.W((new k.w).fromBufferGeometry(i),a),e.add(o.realMesh)}}(),function(){var e=[];r.forEach((function(n){e.push(new k.Tb(n.x,n.y+n.offset+0-0+t.offset,n.z))}));var n=new k.Tb(e[1].x-e[0].x,e[1].y-e[0].y,e[1].z-e[0].z),a=new k.Tb(e[2].x-e[0].x,e[2].y-e[0].y,e[2].z-e[0].z);(s=n.cross(a).normalize()).y>0&&(s=s.multiplyScalar(-1)),o.mesh.vecV=s;var l=new k.mb,c=1/0;e.forEach((function(e){e.y<c&&(c=e.y)}));var u=new k.Tb(e[0].x,e[0].y,e[0].z);l.setFromNormalAndCoplanarPoint(s,u).normalize(),l.corners=e,l.roofFace=o.mesh,o.mesh.plane=l,l.lowest=c,l.conduction=i,o.plane=l}(),u(),l()},nn=ve.Utils3D,rn=(nn.drawVertexSpriteLabel,nn.makeVertexDimensionHelper,.001),on=function(e,t,n,r,o){var i=[],a=null,s=[];this.remove=function(){s.forEach((function(t){return e.remove(t)}))};(a=new nt(t,[],n,0)).setName("Room Roof Surface"),function(){i=[];var e=[];r.forEach((function(t){e.push.apply(e,Object(me.a)(t.plane.corners))})),o.forEach((function(t){return t.inclinedWalls.forEach((function(t){e.push.apply(e,Object(me.a)(t.corners))}))})),e.forEach((function(e){if(!(e.y<n)){var t,r=!1,o=Object(j.a)(i);try{for(o.s();!(t=o.n()).done;)if(t.value.distanceTo(e)<rn){r=!0;break}}catch(a){o.e(a)}finally{o.f()}!r&&i.push(e)}}))}(),i.length&&(t.offset=n,t.rooms=[a],function(){var e=0,t=[];if(i.forEach((function(r){Math.abs(r.y-n)<rn&&t.push(r),r.y>e&&(e=r.y)})),t.length){var r=Ce()(t.map((function(e){return[e.x,e.z]})));r.splice(r.length-1,1),a.floorCorners=r.map((function(e){return{x:e[0],y:e[1]}})),a.height=e-n}}(),function(){var e=[],t=[],n=[],o=i,s=[];r.forEach((function(e){var t,n=!1,r=Object(j.a)(s);try{for(r.s();!(t=r.n()).done;){var o=t.value;if(ve.Utils3D.checkIsSamePlane(o.plane,e.plane)){n=!0;break}}}catch(i){r.e(i)}finally{r.f()}!n&&s.push(e)}));for(var l=0,c=s;l<c.length;l++){var u,d=c[l].plane,h=[],f=Object(j.a)(o);try{for(f.s();!(u=f.n()).done;){var p=u.value,v=d.distanceToPoint(p);Math.abs(v)<rn&&h.push(p)}}catch(b){f.e(b)}finally{f.f()}h.length>0&&(e.push(d),t.push(h))}for(var g in t.forEach((function(e){var t=Ce()(e.map((function(e){return[e.x,e.z]})),20).map((function(e){return new k.Tb(e[0],0,e[1])})),r=[];t.splice(t.length-1,1),t.forEach((function(t){r.push(e.sort((function(e,n){var r=e.clone(),o=n.clone();return r.y=o.y=0,r.distanceTo(t)-o.distanceTo(t)}))[0])})),n.push(r)})),a.clearInclinedWalls(),n){var y=n[g],m=e[g];a.addInclinedWall(y,m)}}(),function(){if(i.length)try{var e=(new k.j).fromGeometry(new _t.a(i));a.hull=e}catch(t){}}())},an=function(e,t,n){var r=this;function o(e){r.floors.forEach((function(t){var n=!1;t.layer.layerIndex===e&&(n=!0),t.setHighlight(n)})),r.edges.forEach((function(t){var n=!1;t.layer.layerIndex===e&&(n=!0),t.setHighlight(n)}))}function i(){r.controller&&r.controller.resetTransformControl(),r.floors.forEach((function(e){return e.removeFromScene()})),[].concat(Object(me.a)(r.edges),Object(me.a)(r.obstacleEdges)).forEach((function(e){return e.remove()})),r.roofEdges.forEach((function(e){return e.remove()})),r.roofVertices.forEach((function(e){return e.remove()})),r.roofFaces.forEach((function(e){return e.remove()})),r.floors=[],r.edges=[],r.roofEdges=[],r.roofVertices=[],r.roofFaces=[],r.deadSpace&&r.deadSpace.remove(),r.deadSpace=null;var n=t.buildingOffset;r.floorplan.roofEdges().forEach((function(t){var o=new qt(e,t,t.offset+n);r.roofEdges.push(o)})),e.roofEdges=r.roofEdges,r.floorplan.roofVertices().forEach((function(t){var o=new $t(e,t,t.offset+n);r.roofVertices.push(o)})),e.roofVertices=r.roofVertices,r.floorplan.roofFaces().forEach((function(t){t.offset=n;var o=new tn(e,t,r.controls);r.roofFaces.push(o)}));var i=[],a=[],s=[];r.roofFaces.forEach((function(e){e.plane&&i.push(e.plane),s.push(e.mesh),a.push.apply(a,Object(me.a)(e.interactionLines))}));var l={clipPlanes:i,roofFaces:s,roofLines:a},c=0;r.floorplan.wallEdges().forEach((function(t){var o=t.wall.layer,i=!1;o.getRooms().forEach((function(e){e.visible&&e.walls.includes(t.wall)&&(i=!0)}));var a=new Jt(e,t,r.controls,t.layerOffset+n,o,l,i);r.edges.push(a)})),r.floorplan.getRooms().forEach((function(t){var o=t.offset+n+t.height;o>c&&(c=o);var i=new Gt(e,t,t.offset+n,t.height,t.layer,l,t.visible);r.floors.push(i),i.addToScene()})),r.deadSpace=new on(e,r.floorplan.roofLayer,c,s,r.floorplan.getRooms()),ve.Configuration.getBooleanValue(ve.configObstacleVisible)&&r.floorplan.obstacleWallEdges().forEach((function(t){var n=t.wall.layer,o=new Jt(e,t,r.controls,0,n);r.obstacleEdges.push(o)})),o(t.activeLayerIndex)}this.ground=null,this.compass=null,this.scene=e,this.floorplan=t,this.controls=n,this.floors=[],this.edges=[],this.obstacleEdges=[],this.roofEdges=[],this.roofVertices=[],this.roofFaces=[],this.deadSpace=null,t.fireOnUpdatedRooms(i),t.fireOnActiveLayerChanged(o)};function sn(e,t,n,r){var o=this,i=this;e.three=this;var a={resize:!0,pushHref:!1,spin:!0,spinSpeed:2e-5,clickPan:!0,canMoveFixedItems:!1};for(var s in a)a.hasOwnProperty(s)&&r.hasOwnProperty(s)&&(a[s]=r[s]);var l,c,u,d,h,f,p,v,g,y=e.scene;function m(){var t=e.floorplan.orientation,n=ve.Configuration.getBooleanValue(ve.configCompassVisible),r=-t/180*Math.PI;i.compass.rotation.y=r,i.compass.visible=n}this.scene=y,this.element=t,this.ground=null,this.compass=null,this.controls=null,this.floorplan=null,this.roof=null,this.heightMargin=0,this.widthMargin=0,this.elementHeight=0,this.elementWidth=0,this.itemSelectedCallbacks=[],this.roofVertexSelectedCallbacks=[],this.roofEditorModeChangedCallbacks=[],this.wallClicked=[],this.floorClicked=[],this.nothingClicked=[],this.outlineManager=null,this.updateSunPosition=function(t,n){var r=e.floorplan.orientation;f.updateSunPosition(t-r/180*Math.PI,n),p.updateSunPosition(t,n)};function b(){requestAnimationFrame(b),u.clear(),u.render(y.scene,c)}this.dataUrl=function(){return u.domElement.toDataURL("image/png")},this.options=function(){return a},this.getModel=function(){return e},this.getScene=function(){return y},this.getController=function(){return d},this.getCamera=function(){return c},this.needsUpdate=function(){},this.rotatePressed=function(){d.rotatePressed()},this.rotateReleased=function(){d.rotateReleased()},this.setCursorStyle=function(e){l.style.cursor=e},this.updateWindowSize=function(){var e=i.element.getBoundingClientRect();i.heightMargin=e.top,i.widthMargin=e.left,i.elementWidth=e.width,i.elementHeight=e.height,c.aspect=i.elementWidth/i.elementHeight,c.updateProjectionMatrix(),u.setSize(i.elementWidth,i.elementHeight)},this.centerCamera=function(t){var n=e.floorplan.getCenter();n.y=1.5,i.controls.target=n;var r=2*e.floorplan.getSize().z,o=n.clone().add(new k.Tb(0,r/3,r));t&&c.position.copy(o),i.controls.update()},this.projectVector=function(e,t){t=t||!1;var n=i.elementWidth/2,r=i.elementHeight/2,o=new k.Tb;o.copy(e),o.project(c);var a=new k.Sb;return a.x=o.x*n+n,a.y=-o.y*r+r,t||(a.x+=i.widthMargin,a.y+=i.heightMargin),a},this.setRoofEditorMode=function(e){return g.setMode(e)},this.setRoofEditorEnabled=function(e){return g.setEnabled(e)},this.setTransformControlAxis=function(e){var t=d.transformControl;switch(e){case"X":t.showX=!0,t.showY=!1,t.showZ=!1;break;case"Z":t.showX=!1,t.showY=!0,t.showZ=!1;break;case"Y":t.showX=!1,t.showY=!1,t.showZ=!0}},l=i.element,c=new k.lb(45,1,1,1e4),(u=new k.Vb({antialias:!0,preserveDrawingBuffer:!0})).autoClear=!1,u.shadowMap.enabled=!0,u.shadowMap.type=k.jb,u.localClippingEnabled=!0,p=new Et(y,u),i.controls=new St(c,l),function(){var e=new k.ob(1e3,1e3),t=new k.X({color:4222027,side:k.v,transparent:!0,opacity:.4}),n=new k.W(e,t);n.position.y=-.01,n.rotation.x=-Math.PI/2,n.renderOrder=100,i.ground=n,i.scene.add(i.ground)}(),function(){var e=new k.x,t=(new k.Mb).load("/Blueprint3D-assets/textures/compass.png");t.anisotropy=u.getMaxAnisotropy();var n=new k.W(new k.ob(5,5),new k.Y({map:t,depthTest:!1,transparent:!0}));n.rotation.x=-Math.PI/2,n.renderOrder=100,e.add(n),i.compass=e,i.scene.add(e)}(),m(),v=new Mt(i),g=new Dt(i,e.floorplan),o.roof=g,d=new Nt(i,e,c,u.domElement,i.controls,v,g),l.appendChild(u.domElement),i.updateWindowSize(),a.resize&&window.addEventListener("resize",i.updateWindowSize),i.centerCamera(),e.floorplan.fireOnUpdatedRooms(i.centerCamera),e.floorplan.fireOnUpdatedRooms(m),f=new Bt(y,e.floorplan),(h=new an(y,e.floorplan,i.controls)).controller=d,i.floorplan=h,b(),document.addEventListener(ve.BP3D_EVENT_HIGHLIGHT_CHANGED,(function(e){var t=e.detail;t&&t.objects})),document.addEventListener(ve.BP3D_EVENT_CONFIG_CHANGED,(function(e){var t=e.detail;t&&t.hasOwnProperty(ve.configCompassVisible)&&m()}))}var ln=0,cn=1,un=2,dn="#f1f1f1",hn="#6a8ed0",fn="#81bdff",pn="#ba8c00",vn="#ffff00",gn="#888888",yn="#008cba",mn="#ff0000",bn="#00ff00",xn="#000",wn=function(){function e(t,n,r){var o=this;Object(p.a)(this,e),this.handleWindowResize=function(){var e=o.canvas,t=e.parentNode;e.height=t.clientHeight,e.width=t.clientWidth,o.canvasElement.height=t.clientHeight,o.canvasElement.width=t.clientWidth,o.draw()},this.draw=function(){var e=o.viewmodel.obstacleEditMode;o.context.clearRect(0,0,o.canvasElement.width,o.canvasElement.height),o.drawGrid(),o.drawGridSpacing();var t=o.floorplan.getRooms(o.floorplan.activeLayerIndex),n=o.floorplan.getWalls(o.floorplan.activeLayerIndex),r=o.floorplan.getCorners(o.floorplan.activeLayerIndex);e&&(n.push.apply(n,Object(me.a)(o.floorplan.obstacleLayer.getWalls())),r.push.apply(r,Object(me.a)(o.floorplan.obstacleLayer.getCorners())));var i=[],a=[];t.forEach((function(e){return o.drawRoom(e)})),n.forEach((function(e){var t=o.drawWall(e);i.push.apply(i,Object(me.a)(t.corners)),a.push(t.line)})),r.forEach((function(e){return i.push.apply(i,Object(me.a)(o.drawCorner(e)))})),o.viewmodel.mode===cn&&o.drawTarget(o.viewmodel.targetX,o.viewmodel.targetY,o.viewmodel.lastNode),o.drawRulerData(),i.forEach((function(e){return o.drawCornerAngles(e)})),a.forEach((function(e){var t=e.start,n=e.end,r=e.wall;o.drawLine(o.viewmodel.convertX(t.x,t.y),o.viewmodel.convertY(t.y,t.x),o.viewmodel.convertX(n.x,n.y),o.viewmodel.convertY(n.y,n.x),1,"#000"),o.drawWallLabels(r)})),o.drawHints()},this.floorplan=t,this.viewmodel=n,this.canvas=r,this.canvasElement=r,this.context=this.canvasElement.getContext("2d");var i=this;window.addEventListener("resize",(function(){i.handleWindowResize()})),this.handleWindowResize(),document.addEventListener(ve.BP3D_EVENT_CONFIG_CHANGED,(function(e){var t=e.detail;t&&t.hasOwnProperty(ve.configDimensionVisible)&&o.draw()}))}return Object(v.a)(e,[{key:"drawGridSpacing",value:function(){var e=this.viewmodel.calculateGridSpacing()*this.viewmodel.pixelsPerCm*100;this.viewmodel.gridSpacingChangedCallbacks.forEach((function(t){return t(null,e)}))}},{key:"drawRulerData",value:function(){var e=this;if(ve.Configuration.getBooleanValue(ve.configDimensionVisible)){var t=this.floorplan.calculateRulerData();t.x.forEach((function(t){e.drawRuler(t.start,t.end,t.length,"x",30)})),t.y.forEach((function(t){e.drawRuler(t.start,t.end,t.length,"y",30)}))}}},{key:"drawRuler",value:function(e,t,n,r,o){var i=this;if(!(n<.01)){e={x:this.viewmodel.convertX(e.x,e.y),y:this.viewmodel.convertY(e.y,e.x)},t={x:this.viewmodel.convertX(t.x,t.y),y:this.viewmodel.convertY(t.y,t.x)};var a=Object(w.a)({},e),s=Object(w.a)({},t);"x"===r?(a.y=o,s.y=o):"y"===r&&(a.x=o,s.x=o),[{p:[a,s],dashed:!1},{p:[a,e],dashed:!0},{p:[t,s],dashed:!0}].forEach((function(e){var t="x"===r?"#ff000088":"#0000ff88";i.drawLine(e.p[0].x,e.p[0].y,e.p[1].x,e.p[1].y,1,t,e.dashed)})),function(){var e=15,t="x"===r?"#f00":"#00f",n=[];n.push(a),n.push({x:"x"===r?a.x+e:a.x-3.75,y:"x"===r?a.y-3.75:a.y+e}),n.push({x:"x"===r?a.x+e:a.x+3.75,y:"x"===r?a.y+3.75:a.y+e});var o=[];o.push(s),o.push({x:"x"===r?s.x-e:s.x-3.75,y:"x"===r?s.y-3.75:s.y-e}),o.push({x:"x"===r?s.x-e:s.x+3.75,y:"x"===r?s.y+3.75:s.y-e}),[n,o].forEach((function(e){var n=e.map((function(e){return e.x})),r=e.map((function(e){return e.y}));i.drawPolygon(n,r,!0,t,!0,t,1)}))}(),this.drawTextLabel({x:(a.x+s.x)/2+("y"===r?-10:0),y:(a.y+s.y)/2+("x"===r?-10:0)},ve.Dimensioning.cmToMeasure(100*n),16,"y"===r?-Math.PI/2:0,!0)}}},{key:"drawItem",value:function(e){var t=this;e.getSnapPoints().forEach((function(n){!function(n){var r=[],o=[];n.forEach((function(e){r.push(t.viewmodel.convertX(e.x,e.y)),o.push(t.viewmodel.convertY(e.y,e.x))})),t.drawPolygon(r,o,!0,e===t.viewmodel.activeItem?"#0000ff22":"#33333311",!0,"#444",1)}(n)}))}},{key:"drawTextLabel",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:12,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.context.textBaseline="middle",this.context.textAlign="center",this.context.lineWidth=1;var i=e.needConvert?this.viewmodel.convertX(e.x,e.y):e.x,a=e.needConvert?this.viewmodel.convertY(e.y,e.x):e.y;r?(this.context.save(),this.context.translate(i,a),this.context.rotate(r),o&&(this.context.font="700 ".concat(n,"px Arial"),this.context.fillStyle="#fff",this.context.fillText(t,0,0)),this.context.font="normal ".concat(n,"px Arial"),this.context.fillStyle=xn,this.context.fillText(t,0,0),this.context.restore()):(o&&(this.context.font="700 ".concat(n,"px Arial"),this.context.fillStyle="#fff",this.context.fillText(t,i,a)),this.context.font="normal ".concat(n,"px Arial"),this.context.fillStyle=xn,this.context.fillText(t,i,a))}},{key:"drawWallLabels",value:function(e){var t=e.start.x,n=e.start.y,r=e.end.x,o=e.end.y,i={x:(t+r)/2,y:(n+o)/2},a=Math.sqrt(Math.pow(t-r,2)+Math.pow(n-o,2));this.drawEdgeLabel(i,a)}},{key:"drawWall",value:function(e){var t=e===this.viewmodel.activeWall||e===this.viewmodel.selectedWall;e.edge&&this.drawEdge(e.edge,t,e.isOutsideWall,e.isObstacleWall);var n=e.start,r=e.end,o=[];if(e===this.viewmodel.activeWall)try{e.start.updateAngles(),e.end.updateAngles(),o.push(e.start,e.end)}catch(i){}return{corners:o,line:{start:n,end:r,wall:e}}}},{key:"drawWallItem",value:function(e,t){var n=this,r=e.getCorners(),o=[],i=[];r.forEach((function(e){o.push(n.viewmodel.convertX(e.x,e.y)),i.push(n.viewmodel.convertY(e.y,e.x))})),this.drawPolygon(o,i,!0,"#fff",!0,"#888",1)}},{key:"drawEdgeLabel",value:function(e,t){(t*=100)<60||(this.context.font="normal 12px Arial",this.context.fillStyle="#000000",this.context.textBaseline="middle",this.context.textAlign="center",this.context.strokeStyle="#ffffff",this.context.lineWidth=4,this.context.strokeText(ve.Dimensioning.cmToMeasure(t),this.viewmodel.convertX(e.x,e.y),this.viewmodel.convertY(e.y,e.x)),this.context.fillText(ve.Dimensioning.cmToMeasure(t),this.viewmodel.convertX(e.x,e.y),this.viewmodel.convertY(e.y,e.x)))}},{key:"drawEdge",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=r?gn:n?pn:hn;t&&this.viewmodel.mode===un?o=mn:t&&(o=r?yn:n?vn:fn);var i=e.corners(),a=this;this.drawPolygon(ve.Utils.map(i,(function(e){return a.viewmodel.convertX(e.x,e.y)})),ve.Utils.map(i,(function(e){return a.viewmodel.convertY(e.y,e.x)})),!0,o,!0,o,1)}},{key:"drawRoom",value:function(e){var t=this,n=e===this.viewmodel.activeRoom?"#ffe1e1":"#f9f9f9";this.drawPolygon(ve.Utils.map(e.corners,(function(e){return t.viewmodel.convertX(e.x,e.y)})),ve.Utils.map(e.corners,(function(e){return t.viewmodel.convertY(e.y,e.x)})),!0,n),e.updateArea();var r=e.areaCenter,o={x:this.viewmodel.convertX(r.x,r.y),y:this.viewmodel.convertY(r.y,r.x)},i=JSON.parse(JSON.stringify(o));i.y-=10;var a=JSON.parse(JSON.stringify(o));a.y+=10,i.needConvert=a.needConvert=!1;var s=ve.Dimensioning.cmToMeasure(1e4*e.area,2)+String.fromCharCode(178);this.drawTextLabel(i,e.name,18),this.drawTextLabel(a,s,18)}},{key:"drawCorner",value:function(e){var t=e===this.viewmodel.activeCorner||e===this.viewmodel.selectedCorner,n=e===this.viewmodel.lastNode&&this.viewmodel.mode===cn,r="#cccccc";t&&this.viewmodel.mode===un?r=mn:t&&(r=bn),this.drawCircle(this.viewmodel.convertX(e.x,e.y),this.viewmodel.convertY(e.y,e.x),t?7:0,r);var o=[];return t?(this.drawTextLabel({x:e.x,y:e.y+.5,needConvert:!0},"".concat(ve.Dimensioning.cmToMeasure(100*e.x),", ").concat(ve.Dimensioning.cmToMeasure(100*-e.y))),e.updateAngles(),o.push(e),e.adjacentCorners().forEach((function(e){return o.push(e)}))):n&&(e.updateAngles({x:this.viewmodel.targetX,y:this.viewmodel.targetY}),o.push(e)),o}},{key:"drawCornerAngles",value:function(e){for(var t=this.viewmodel.convertX(e.x,e.y),n=this.viewmodel.convertY(e.y,e.x),r=0;r<e.angles.length;r++){var o=e.angleDirections[r],i=o.clone().multiplyScalar(3).add(e.getLocation()),a=e.startAngles[r]*Math.PI/180,s=e.endAngles[r]*Math.PI/180,l=e.angles[r],c=2*o.length()*50;if(0!==l){var u=Math.abs(e.startAngles[r]-e.endAngles[r])>180;if(this.context.strokeStyle="#000000",this.context.lineWidth=4,this.context.beginPath(),90===l){var d=o.clone().multiplyScalar(2).add(e.getLocation()),h={x:this.viewmodel.convertX(d.x,d.y),y:this.viewmodel.convertY(d.y,d.x)},f=e.getLocation().clone(),p=f.clone().rotateAround(d,Math.PI/4);p=p.sub(p.clone().sub(d).multiplyScalar(1-1/Math.sqrt(2)));var v={x:this.viewmodel.convertX(p.x,p.y),y:this.viewmodel.convertY(p.y,p.x)},g=f.clone().rotateAround(d,-Math.PI/4);g=g.sub(g.clone().sub(d).multiplyScalar(1-1/Math.sqrt(2)));var y={x:this.viewmodel.convertX(g.x,g.y),y:this.viewmodel.convertY(g.y,g.x)};this.drawLine(v.x,v.y,h.x,h.y,this.context.strokeWidth,"#333"),this.drawLine(h.x,h.y,y.x,y.y,this.context.strokeWidth,"#333")}else{var m=Math.min(a,s)+0,b=Math.max(a,s+0);this.context.arc(t,n,c,m,b,u)}this.context.stroke(),i.needConvert=!0,this.drawTextLabel(i,"".concat(l,"\xb0"))}}}},{key:"drawTarget",value:function(e,t,n){this.drawCircle(this.viewmodel.convertX(e,t),this.viewmodel.convertY(t,e),7,bn),this.drawTextLabel({x:e,y:t+.5,needConvert:!0},"".concat(ve.Dimensioning.cmToMeasure(100*e),", ").concat(ve.Dimensioning.cmToMeasure(100*-t))),this.viewmodel.lastNode&&this.drawLine(this.viewmodel.convertX(n.x,n.y),this.viewmodel.convertY(n.y,n.x),this.viewmodel.convertX(e,t),this.viewmodel.convertY(t,e),7,"#008cba")}},{key:"drawLine",value:function(e,t,n,r){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"#000",a=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this.context.beginPath(),this.context.setLineDash([]),a&&this.context.setLineDash([3,6]),this.context.moveTo(e,t),this.context.lineTo(n,r),this.context.lineWidth=o,this.context.strokeStyle=i,this.context.stroke()}},{key:"drawPolygon",value:function(e,t,n,r,o,i,a){n=n||!1,o=o||!1,this.context.beginPath(),this.context.moveTo(e[0],t[0]);for(var s=1;s<e.length;s++)this.context.lineTo(e[s],t[s]);this.context.closePath(),n&&(this.context.fillStyle=r,this.context.fill()),o&&(this.context.lineWidth=a,this.context.strokeStyle=i,this.context.stroke())}},{key:"drawCircle",value:function(e,t,n,r){this.context.beginPath(),this.context.arc(e,t,n,0,2*Math.PI,!1),this.context.fillStyle=r,this.context.fill()}},{key:"drawGrid",value:function(){for(var e=this.viewmodel,t=e.gridX,n=e.gridY,r=this.canvasElement.width,o=0;o<t.length;o++){var i=t[o],a=i.start,s=i.end,l=o===Math.floor(t.length/2);l&&this.drawTextLabel({x:this.viewmodel.convertX(a.x,a.y)+20,y:20},"Y",20),this.drawLine(this.viewmodel.convertX(a.x,a.y),this.viewmodel.convertY(a.y,a.x),this.viewmodel.convertX(s.x,s.y),this.viewmodel.convertY(s.y,s.x),l?3:1,dn)}for(var c=0;c<n.length;c++){var u=n[c],d=u.start,h=u.end,f=c===Math.floor(n.length/2);f&&this.drawTextLabel({x:r-20,y:this.viewmodel.convertY(d.y,d.x)+20},"X",20),this.drawLine(this.viewmodel.convertX(d.x,d.y),this.viewmodel.convertY(d.y,d.x),this.viewmodel.convertX(h.x,h.y),this.viewmodel.convertY(h.y,h.x),f?3:1,dn)}}},{key:"drawHints",value:function(){var e=this.canvasElement.height,t=this.viewmodel,n=t.activeCorner,r=t.activeWall,o=t.activeRoom;this.context.textBaseline="middle",this.context.textAlign="left",this.context.lineWidth=1,this.context.font="normal 16px Arial",this.context.fillStyle="#333";var i="";n?i="Hint: You can click corner and edit position directly.":r?i="Hint: You can click wall and edit properties directly.":o&&(i="Hint: You can click room and edit name directly."),this.context.fillText(i,30,e-30)}}]),e}(),jn=ve.Configuration.getNumericValue(ve.configSnapTolernance),kn=30.48,On=function(){function e(t,n,r){var o=this;Object(p.a)(this,e),this.parent=null,this.mode=0,this.obstacleEditMode=!1,this.activeWall=null,this.selectedWall=null,this.wallMoveDirection={x:0,y:0},this.activeCorner=null,this.selectedCorner=null,this.activeRoom=null,this.selectedRoom=null,this.originX=0,this.originY=0,this.orientation=0,this.targetX=0,this.targetY=0,this.lastNode=null,this.modeResetCallbacks=[],this.orientationChangedCallbacks=[],this.mouseDown=!1,this.mouseMoved=!1,this.mouseButton=0,this.mouseX=0,this.mouseY=0,this.rawMouseX=0,this.rawMouseY=0,this.lastX=0,this.lastY=0,this.isDragging=!1,this.itemSelectedCallbacks=[],this.wallSelectedCallbacks=[],this.roomSelectedCallbacks=[],this.cornerSelectedCallbacks=[],this.nothingSelectedCallbacks=[],this.gridSpacingChangedCallbacks=[],this.gridX=[],this.gridY=[],this.staticGridSpacing=null,this.setObstacleEditMode=function(e){return o.obstacleEditMode=e},this.getSnapByWalls=function(e){var t=o.obstacleEditMode?o.floorplan.obstacleLayer:o.floorplan.getActiveLayer(),n=e?e.x:o.mouseX,r=e?e.y:o.mouseY,i=null;try{i=(i=t.getWalls().map((function(e){return e.closestPoint(n,r)})).sort((function(e,t){return e.distance-t.distance}))[0]).distance>=1*jn?null:i.point}catch(a){i=null}return i},this.getSnapByGrids=function(e){var t=null,n=e?e.x:o.mouseX,r=e?e.y:o.mouseY;try{var i=o.gridX.map((function(e){return e.start.x})).sort((function(e,t){return Math.abs(e-n)-Math.abs(t-n)}))[0],a=o.gridY.map((function(e){return e.start.y})).sort((function(e,t){return Math.abs(e-r)-Math.abs(t-r)}))[0];Math.abs(Math.pow(i-n,2)+Math.pow(a-r,2))<jn&&(t={x:i,y:a})}catch(s){t=null}return t},this.getSnapPoint=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0;if(ve.Configuration.getBooleanValue(ve.configSnapMode)){n=n||{x:o.mouseX,y:o.mouseY};var r=e?o.getSnapByWalls(n):null,i=t?o.getSnapByGrids(n):null,a=[];r&&a.push(r),i&&a.push(i);var s=a.sort((function(e,t){return Math.sqrt(Math.pow(n.x-e.x,2)+Math.pow(n.y-e.y,2))-Math.sqrt(Math.pow(n.x-t.x,2)+Math.pow(n.y-t.y,2))}));return s.length?s[0]:null}},this.getCornerSnapPoint=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=o.getSnapPoint(!1,!0,{x:t,y:n}),a=e.getSnapByAxis(jn,r,{x:t,y:n}),s=e.getSnapByAngles(2,t,n),l=[];i&&l.push(i),a&&l.push(a),s&&l.push(s);var c=l.sort((function(e,r){return Math.sqrt(Math.pow(e.x-t,2)+Math.pow(e.y-n,2))-Math.sqrt(Math.pow(r.x-t,2)+Math.pow(r.y-n,2))}));return c.length?c[0]:null};this.scale=50,this.parent=r,this.canvasElement=t,this.zoomLevel=100,this.floorplan=n,this.view=new wn(this.floorplan,this,t),this.cmPerPixel=2.032,this.pixelsPerCm=1/this.cmPerPixel,this.wallWidth=10*this.pixelsPerCm,this.setMode(ln);var i=this;this.updateGrid(),this.canvasElement.addEventListener("wheel",(function(e){return i.mouseWheel(e)})),this.canvasElement.addEventListener("mousedown",(function(e){i.mousedown(e)})),this.canvasElement.addEventListener("mousemove",(function(e){i.mousemove(e)})),this.canvasElement.addEventListener("mouseup",(function(e){i.mouseup(e)})),this.canvasElement.addEventListener("mouseleave",(function(){i.mouseleave()})),document.addEventListener(ve.BP3D_EVENT_CONFIG_CHANGED,(function(e){var t=e.detail;t&&t.dimUnit&&o.view.draw()})),document.addEventListener("keyup",(function(e){"Escape"===e.key&&i.cancelDraw()})),n.roomLoadedCallbacks.push((function(){i.reset()}))}return Object(v.a)(e,[{key:"calculateGridSpacing",value:function(){if(this.staticGridSpacing)return this.staticGridSpacing;var e=100,t=this.pixelsPerCm;return t<.15?e=400:t<.3?e=200:t<.5?e=100:t<1?e=50:t<2?e=25:t<4&&(e=12.5),this.gridSpacingChangedCallbacks.forEach((function(t){return t(e/100)})),e/100}},{key:"setGridSpacing",value:function(e){this.staticGridSpacing=e,e&&this.gridSpacingChangedCallbacks.forEach((function(t){return t(e)})),this.updateGrid(),this.view.draw()}},{key:"updateGrid",value:function(){this.gridX=[],this.gridY=[];for(var e=this.calculateGridSpacing(),t=100,n=-100;n<=t;n++){var r={x:e*n,y:-100*e},o={x:e*n,y:t*e};this.gridX.push({start:r,end:o})}for(var i=-100;i<=t;i++){var a={x:-100*e,y:e*i},s={x:t*e,y:e*i};this.gridY.push({start:a,end:s})}}},{key:"cancelDraw",value:function(){var e=this.obstacleEditMode?this.floorplan.obstacleLayer:this.floorplan.getActiveLayer();this.lastNode=null,e&&e.reduceWalls()}},{key:"updateTarget",value:function(){if(this.mode===cn&&this.lastNode){var e=this.getSnapPoint();Math.sqrt(Math.pow(this.mouseX-this.lastNode.x,2)+Math.pow(this.mouseY-this.lastNode.y,2))<jn?(this.targetX=this.lastNode.x,this.targetY=this.lastNode.y):(this.targetX=e?e.x:this.mouseX,this.targetY=e?e.y:this.mouseY)}else{var t=this.getSnapPoint();this.targetX=t?t.x:this.mouseX,this.targetY=t?t.y:this.mouseY}this.view.draw()}},{key:"zoomIn",value:function(){var e=this.scale;e+=2,this.scale=Math.min(1e3,e);var t=30*this.scale/100;this.cmPerPixel=kn/t,this.pixelsPerCm=1/this.cmPerPixel,this.updateGrid(),this.view.draw()}},{key:"zoomOut",value:function(){var e=this.scale;e-=2,this.scale=Math.max(10,e);var t=30*this.scale/100;this.cmPerPixel=kn/t,this.pixelsPerCm=1/this.cmPerPixel,this.updateGrid(),this.view.draw()}},{key:"resetZoom",value:function(){this.scale=50;var e=30*this.scale/100;this.cmPerPixel=kn/e,this.pixelsPerCm=1/this.cmPerPixel,this.updateGrid(),this.view.draw()}},{key:"mouseWheel",value:function(e){var t=this.scale;e.deltaY>0?(t-=2,this.scale=Math.max(10,t)):(t+=2,this.scale=Math.min(1e3,t));var n=30*this.scale/100;this.cmPerPixel=kn/n,this.pixelsPerCm=1/this.cmPerPixel,this.updateGrid(),this.view.draw()}},{key:"mousedown",value:function(e){this.mouseDown=!0,this.mouseMoved=!1,this.lastX=this.rawMouseX,this.lastY=this.rawMouseY,this.mouseButton=e.buttons,this.view.draw()}},{key:"mousemove",value:function(e){this.mouseMoved=!0,this.rawMouseX=e.clientX,this.rawMouseY=e.clientY,this.mouseX=(e.clientX-this.canvasElement.getBoundingClientRect().left)*this.cmPerPixel+this.originX*this.cmPerPixel,this.mouseY=(e.clientY-this.canvasElement.getBoundingClientRect().top)*this.cmPerPixel+this.originY*this.cmPerPixel,this.mouseX/=this.zoomLevel,this.mouseY/=this.zoomLevel;var t=new k.Sb(this.mouseX,this.mouseY);if(t.rotateAround(new k.Sb,0),this.mouseX=t.x,this.mouseY=t.y,(this.mode===cn||this.mode===ln&&this.mouseDown)&&this.updateTarget(),this.mode!==cn&&!this.mouseDown){var n=this.floorplan.overlappedCorner(this.mouseX,this.mouseY,0,this.selectedWall),r=this.floorplan.overlappedWall(this.mouseX,this.mouseY),o=this.floorplan.overlappedRoom(this.mouseX,this.mouseY),i=!1;n!==this.activeCorner&&(this.activeCorner=n,i=!0),r!==this.activeWall&&(this.activeWall=r,i=!0),o!==this.activeRoom&&(this.activeRoom=o,i=!0),i&&this.view.draw()}if(this.mouseDown&&!this.activeCorner&&!this.activeWall){if(e.ctrlKey){var a=this.orientation+Math.round(this.lastX-this.rawMouseX);a<0&&(a+=360),a%=360,this.setOrientation(a)}else this.originX+=this.lastX-this.rawMouseX,this.originY+=this.lastY-this.rawMouseY;this.lastX=this.rawMouseX,this.lastY=this.rawMouseY,this.view.draw()}if(this.mode===ln&&this.mouseDown){if(this.activeCorner){if(this.selectedWall){var s=[].concat(Object(me.a)(this.activeCorner.wallStarts),Object(me.a)(this.activeCorner.wallEnds));s.length>1&&s.includes(this.selectedWall)&&(this.activeCorner=this.selectedWall.detachCorner(this.activeCorner))}var l=this.getCornerSnapPoint(this.activeCorner,this.mouseX,this.mouseY);this.activeCorner.move(l?l.x:this.mouseX,l?l.y:this.mouseY,ve.Configuration.getBooleanValue(ve.configSnapMode),!1),this.isDragging=!0}else if(this.activeWall){var c=(this.rawMouseX-this.lastX)*this.cmPerPixel/this.zoomLevel,u=(this.rawMouseY-this.lastY)*this.cmPerPixel/this.zoomLevel;0===this.wallMoveDirection.x&&0===this.wallMoveDirection.y&&(Math.abs(c)>Math.abs(u)?this.wallMoveDirection.x=1:this.wallMoveDirection.y=1),c*=this.wallMoveDirection.x,u*=this.wallMoveDirection.y,this.activeWall.relativeMove(c,u,!0,!1),this.isDragging=!0}this.view.draw()}this.lastX=this.rawMouseX,this.lastY=this.rawMouseY}},{key:"mouseup",value:function(e){var t=this;this.mouseDown=!1;var n=this.obstacleEditMode?this.floorplan.obstacleLayer:this.floorplan.getActiveLayer();if(n){if(this.mode===cn&&!this.mouseMoved){if(1===this.mouseButton){var r=n.newCorner(this.targetX,this.targetY);null!=this.lastNode&&n.newWall(this.lastNode,r,n.height,!0),r.mergeWithIntersected()&&this.lastNode,this.lastNode=r}else this.cancelDraw();this.floorplan.update(!1)}this.isDragging&&(this.activeCorner&&this.activeCorner.mergeWithIntersected(),n.reduceWalls(),this.floorplan.update(!1),this.isDragging=!1),this.mode===un&&(this.activeCorner?(this.activeCorner.removeAll(),this.activeCorner=null):this.activeWall&&(this.activeWall.remove(),this.activeWall=null),n.reduceWalls(),this.floorplan.update(!1)),this.mouseMoved||(this.selectedCorner=this.activeCorner,this.selectedWall=this.activeWall,this.selectedRoom=this.activeRoom,this.selectedCorner?this.cornerSelectedCallbacks.forEach((function(e){return e(t.selectedCorner)})):this.selectedWall?this.wallSelectedCallbacks.forEach((function(e){return e(t.selectedWall)})):this.selectedRoom?this.roomSelectedCallbacks.forEach((function(e){return e(t.selectedRoom)})):this.nothingSelectedCallbacks.forEach((function(e){return e()}))),this.wallMoveDirection={x:0,y:0},this.view.draw()}}},{key:"mouseleave",value:function(){this.mouseDown=!1}},{key:"reset",value:function(){this.resizeView(),this.setMode(ln),this.resetOrigin(),this.view.draw()}},{key:"resizeView",value:function(){this.view.handleWindowResize()}},{key:"setMode",value:function(e){this.lastNode=null,this.mode=e,this.modeResetCallbacks.forEach((function(t){return"function"===typeof t&&t(e)})),this.selectedCorner=null,this.selectedWall=null,this.selectedRoom=null,this.updateTarget()}},{key:"setOrientation",value:function(e){var t=this;this.orientation=e,this.floorplan.orientation=e,this.floorplan.update(),this.view.draw(),this.orientationChangedCallbacks.forEach((function(e){return e(t.orientation)}))}},{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e&&this.floorplan.update(!1),this.view.draw()}},{key:"resetOrigin",value:function(){var e=this.canvasElement.parentNode,t=e.clientHeight,n=e.clientWidth/2,r=t/2,o=this.floorplan.getCenter();this.originX=o.x*this.zoomLevel*this.pixelsPerCm-n,this.originY=o.z*this.zoomLevel*this.pixelsPerCm-r}},{key:"convertX",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0,r=new k.Sb(e,t);r.rotateAround(new k.Sb,n);var o=(r.x*this.zoomLevel-this.originX*this.cmPerPixel)*this.pixelsPerCm;return o}},{key:"convertY",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0,r=new k.Sb(t,e);r.rotateAround(new k.Sb,n);var o=(r.y*this.zoomLevel-this.originY*this.cmPerPixel)*this.pixelsPerCm;return o}}]),e}(),Cn=function e(t){Object(p.a)(this,e),this.changeUnit=function(e){switch(e){case"cm":ve.Configuration.setValue("dimUnit",I);break;case"in":ve.Configuration.setValue("dimUnit",T);break;case"ft":ve.Configuration.setValue("dimUnit",W);break;case"m":ve.Configuration.setValue("dimUnit",P)}},this.setShellMode=function(e){return ve.Configuration.setValue(ve.configShellMode,e)},this.setSceneLocked=function(e){return ve.Configuration.setValue(ve.configSceneLocked,e)},this.setSnap=function(e){return ve.Configuration.setValue(ve.configSnapMode,e)},this.setDimensionVisible=function(e){return ve.Configuration.setValue(ve.configDimensionVisible,e)},this.setCompassVisible=function(e){return ve.Configuration.setValue(ve.configCompassVisible,e)},this.setObstacleVisible=function(e){return ve.Configuration.setValue(ve.configObstacleVisible,e)},this.toggleXRayMode=function(){var e=ve.Configuration.getBooleanValue(ve.configXRayMode);ve.Configuration.setValue(ve.configXRayMode,!e)};var n=t.threeElement,r=t.threeCanvasElement,o=t.floorplannerElement;this.model=new Ot(t.textureDir),this.three=new sn(this.model,n,r,{}),this.floorplanner=new On(o,this.model.floorplan,this)},En={layers:[],roof:{vertices:[],edges:[],faces:[]},obstacle:{offset:0,height:2.5,floorplan:{corners:{},walls:[]}},items:[]};En.layers[100]={offset:0,height:2.5,floorplan:{corners:{"f90da5e3-9e0e-eba7-173d-eb0b071e838e":{x:-9,y:6},"da026c08-d76a-a944-8e7b-096b752da9ed":{x:9,y:6},"4e3d65cb-54c0-0681-28bf-bddcc7bdb571":{x:9,y:-6},"71d4f128-ae80-3d58-9bd2-711c6ce6cdf2":{x:-9,y:-6}},walls:[{corner1:"71d4f128-ae80-3d58-9bd2-711c6ce6cdf2",corner2:"f90da5e3-9e0e-eba7-173d-eb0b071e838e",thicknessDirection:1,interiorTexture:{url:"Blueprint3D-assets/rooms/textures/blank.png",stretch:!0,scale:0},exteriorTexture:{url:"Blueprint3D-assets/rooms/textures/blank.png",stretch:!0,scale:0}},{corner1:"f90da5e3-9e0e-eba7-173d-eb0b071e838e",corner2:"da026c08-d76a-a944-8e7b-096b752da9ed",thicknessDirection:1,interiorTexture:{url:"Blueprint3D-assets/rooms/textures/blank.png",stretch:!0,scale:0},exteriorTexture:{url:"Blueprint3D-assets/rooms/textures/blank.png",stretch:!0,scale:0}},{corner1:"da026c08-d76a-a944-8e7b-096b752da9ed",corner2:"4e3d65cb-54c0-0681-28bf-bddcc7bdb571",thicknessDirection:1,interiorTexture:{url:"Blueprint3D-assets/rooms/textures/blank.png",stretch:!0,scale:0},exteriorTexture:{url:"Blueprint3D-assets/rooms/textures/blank.png",stretch:!0,scale:0}},{corner1:"4e3d65cb-54c0-0681-28bf-bddcc7bdb571",corner2:"71d4f128-ae80-3d58-9bd2-711c6ce6cdf2",thicknessDirection:1,interiorTexture:{url:"Blueprint3D-assets/rooms/textures/blank.png",stretch:!0,scale:0},exteriorTexture:{url:"Blueprint3D-assets/rooms/textures/blank.png",stretch:!0,scale:0}}],wallTextures:[],floorTextures:{},newFloorTextures:{}},items:[]},En.layers[99]={offset:-2.5,height:2.5,floorplan:{corners:{"f978a5e3-9e0e-eba7-173d-eb0b071e838e":{x:-9,y:6},"da786c08-d76a-a944-8e7b-096b752da9ed":{x:9,y:6},"4e7865cb-54c0-0681-28bf-bddcc7bdb571":{x:9,y:-6},"7178f128-ae80-3d58-9bd2-711c6ce6cdf2":{x:-9,y:-6}},walls:[{corner1:"7178f128-ae80-3d58-9bd2-711c6ce6cdf2",corner2:"f978a5e3-9e0e-eba7-173d-eb0b071e838e",thicknessDirection:1,interiorTexture:{url:"Blueprint3D-assets/rooms/textures/blank.png",stretch:!0,scale:0},exteriorTexture:{url:"Blueprint3D-assets/rooms/textures/blank.png",stretch:!0,scale:0}},{corner1:"f978a5e3-9e0e-eba7-173d-eb0b071e838e",corner2:"da786c08-d76a-a944-8e7b-096b752da9ed",thicknessDirection:1,interiorTexture:{url:"Blueprint3D-assets/rooms/textures/blank.png",stretch:!0,scale:0},exteriorTexture:{url:"Blueprint3D-assets/rooms/textures/blank.png",stretch:!0,scale:0}},{corner1:"da786c08-d76a-a944-8e7b-096b752da9ed",corner2:"4e7865cb-54c0-0681-28bf-bddcc7bdb571",thicknessDirection:1,interiorTexture:{url:"Blueprint3D-assets/rooms/textures/blank.png",stretch:!0,scale:0},exteriorTexture:{url:"Blueprint3D-assets/rooms/textures/blank.png",stretch:!0,scale:0}},{corner1:"4e7865cb-54c0-0681-28bf-bddcc7bdb571",corner2:"7178f128-ae80-3d58-9bd2-711c6ce6cdf2",thicknessDirection:1,interiorTexture:{url:"Blueprint3D-assets/rooms/textures/blank.png",stretch:!0,scale:0},exteriorTexture:{url:"Blueprint3D-assets/rooms/textures/blank.png",stretch:!0,scale:0}}],wallTextures:[],floorTextures:{},newFloorTextures:{}},items:[]},En.layers[101]={offset:2.5,height:2.5,floorplan:{corners:{"a90da5e3-9e0e-eba7-173d-eb0b071e838e":{x:-9,y:6},"aa026c08-d76a-a944-8e7b-096b752da9ed":{x:9,y:6},"ae3d65cb-54c0-0681-28bf-bddcc7bdb571":{x:9,y:-6},"a1d4f128-ae80-3d58-9bd2-711c6ce6cdf2":{x:-9,y:-6}},walls:[{corner1:"a1d4f128-ae80-3d58-9bd2-711c6ce6cdf2",corner2:"a90da5e3-9e0e-eba7-173d-eb0b071e838e",thicknessDirection:1,interiorTexture:{url:"Blueprint3D-assets/rooms/textures/blank.png",stretch:!0,scale:0},exteriorTexture:{url:"Blueprint3D-assets/rooms/textures/blank.png",stretch:!0,scale:0}},{corner1:"a90da5e3-9e0e-eba7-173d-eb0b071e838e",corner2:"aa026c08-d76a-a944-8e7b-096b752da9ed",thicknessDirection:1,interiorTexture:{url:"Blueprint3D-assets/rooms/textures/blank.png",stretch:!0,scale:0},exteriorTexture:{url:"Blueprint3D-assets/rooms/textures/blank.png",stretch:!0,scale:0}},{corner1:"aa026c08-d76a-a944-8e7b-096b752da9ed",corner2:"ae3d65cb-54c0-0681-28bf-bddcc7bdb571",thicknessDirection:1,interiorTexture:{url:"Blueprint3D-assets/rooms/textures/blank.png",stretch:!0,scale:0},exteriorTexture:{url:"Blueprint3D-assets/rooms/textures/blank.png",stretch:!0,scale:0}},{corner1:"ae3d65cb-54c0-0681-28bf-bddcc7bdb571",corner2:"a1d4f128-ae80-3d58-9bd2-711c6ce6cdf2",thicknessDirection:1,interiorTexture:{url:"Blueprint3D-assets/rooms/textures/blank.png",stretch:!0,scale:0},exteriorTexture:{url:"Blueprint3D-assets/rooms/textures/blank.png",stretch:!0,scale:0}}],wallTextures:[],floorTextures:{},newFloorTextures:{}},items:[]};n(82);var Sn=function(e){Object(g.a)(n,e);var t=Object(y.a)(n);function n(){var e;Object(p.a)(this,n);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).state={selectedItem:null,showSwapDialog:!1,newProduct:null,orientation:0,gridSpacing:1,gridSpacingInCanvas:0},e.initializeBP3D=function(){var t=e.props,n=t.defaultJson,r=t.onLayersUpdated,o=t.onBuildingOffsetUpdated,i=t.onRoofVertexSelected,a=t.roofEditorModeChanged,s=t.onWallClicked,l=t.onFloorClicked,c=t.onNothingClicked,u=t.floorPlannerModeChanged,d=t.onWall2DClicked,h=t.onRoom2DClicked,f=t.onCorner2DClicked,p=new Cn({floorplannerElement:e.elFloorPlannerElement,threeElement:e.elThreeElemContainer,textureDir:"models/textures/",widget:!1}),v=p.model.floorplan,g=p.three,y=p.floorplanner;v.layerUpdatedCallbacks.push(r),v.buildingOffsetUpdatedCallbacks.push(o),g.itemSelectedCallbacks.push(e.handleItemSelected),g.roofVertexSelectedCallbacks.push(i),g.roofEditorModeChangedCallbacks.push(a),g.wallClicked.push(s),g.floorClicked.push(l),g.nothingClicked.push(c),y.modeResetCallbacks.push(u),y.orientationChangedCallbacks.push(e.handleOrientationChanged),y.gridSpacingChangedCallbacks.push(e.handleGridSpacingChanged),y.wallSelectedCallbacks.push(d),y.roomSelectedCallbacks.push(h),y.cornerSelectedCallbacks.push(f),y.nothingSelectedCallbacks.push((function(){d(null),h(null),f(null)}));var m=n||JSON.stringify(En);p.model.loadSerialized(m),p.model.roomLoadingCallbacks.push(e.props.isLoading),p.model.roomLoadedCallbacks.push(e.props.isLoaded),e.bp3d=p},e.componentDidMount=function(){return e.initializeBP3D()},e.UNSAFE_componentWillReceiveProps=function(t){t.measureUnit!==e.props.measureUnit&&e.bp3d.changeUnit(t.measureUnit),t.viewMode!==e.props.viewMode&&setTimeout((function(){e.bp3d.model.floorplan.update(),window.dispatchEvent(new Event("resize"))}),10)},e.takeSnapshot=function(){return e.bp3d.three.dataUrl()},e.setJSON=function(t){return e.bp3d.model.loadSerialized(t)},e.getJSON=function(){return e.bp3d.model.exportSerialized()},e.undo=function(){return e.bp3d.model.undo()},e.redo=function(){return e.bp3d.model.redo()},e.collectMetadata=function(){return e.bp3d.model.collectMetadata()},e.update=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];try{t&&e.bp3d.model.floorplan.update(!1),e.bp3d.floorplanner.update(n)}catch(r){}},e.regenerateRoof=function(t){return e.bp3d.model.floorplan.regenerateRoof(t)},e.handleItemSelected=function(e){},e.handleOrientationChanged=function(t){return e.setState({orientation:t})},e.handleGridSpacingChanged=function(t,n){t&&e.setState({gridSpacing:t}),n&&e.setState({gridSpacingInCanvas:n})},e.getDefaultOption=function(e){var t={};if(Array.isArray(e.morph)){var n,r=Object(j.a)(e.morph);try{for(r.s();!(n=r.n()).done;){var o=n.value;t[o.index]=(o.min-5)/295}}catch(c){r.e(c)}finally{r.f()}}var i={};if(Array.isArray(e.styles)){var a,s=Object(j.a)(e.styles);try{for(s.s();!(a=s.n()).done;){var l=a.value;i[l.name_in_model]=l.types[0].name_in_model}}catch(c){s.e(c)}finally{s.f()}}return{defaultMorph:t,defaultStyles:i,metadata:Object(w.a)(Object(w.a)({},e),{},{itemName:e.name,modelUrl:e.model,itemType:e.type})}},e.addItem=function(){var t=Object(x.a)(b.a.mark((function t(n){var r,o,i,a,s,l,c=arguments;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=!(c.length>1&&void 0!==c[1])||c[1],t.prev=1,o=e.getDefaultOption(n),i=o.defaultMorph,a=o.defaultStyles,s=o.metadata,t.next=5,e.bp3d.model.scene.addItem(n.type,n.model,s,null,null,{styles:a,morph:i,stackable:n.stackable,stackontop:n.stackontop,overlappable:n.overlappable},r);case 5:return l=t.sent,t.abrupt("return",l);case 9:return t.prev=9,t.t0=t.catch(1),t.abrupt("return",null);case 12:case"end":return t.stop()}}),t,null,[[1,9]])})));return function(e){return t.apply(this,arguments)}}(),e.setFloorTexture=function(e,t,n){console.log(e),e.setTexture(t,n)},e.setEdgeTexture=function(t,n,r,o,i){var a=[],s=t.wall,l=t.isInterior,c=t.isExterior,u=e.bp3d.model.floorplan;switch(o){case 0:a.push(t);break;case 1:a=u.getSameLayerWalls(s).map((function(e){var t=e.isOutsideWall,n=e.getExposedSide();return i?t?n===$e?(e.edge.isInterior=!1,e.edge.isExterior=!0):(e.edge.isInterior=!0,e.edge.isExterior=!1):(e.edge.isInterior=!1,e.edge.isExterior=!1):t?n===$e?(e.edge.isInterior=!0,e.edge.isExterior=!1):(e.edge.isInterior=!1,e.edge.isExterior=!0):(e.edge.isInterior=!0,e.edge.isExterior=!0),e.edge}));break;case 2:a=u.getSameFaceWalls(s).map((function(e){return e.edge.isInterior=l,e.edge.isExterior=c,e.edge}));break;case 3:a=u.getAllWalls().map((function(e){var t=e.isOutsideWall,n=e.getExposedSide();return i?t?n===$e?(e.edge.isInterior=!1,e.edge.isExterior=!0):(e.edge.isInterior=!0,e.edge.isExterior=!1):(e.edge.isInterior=!1,e.edge.isExterior=!1):t?n===$e?(e.edge.isInterior=!0,e.edge.isExterior=!1):(e.edge.isInterior=!1,e.edge.isExterior=!0):(e.edge.isInterior=!0,e.edge.isExterior=!0),e.edge}))}a.forEach((function(e){return e.setTexture(n,r)})),e.update()},e.addRoofWindow=function(){var t=Object(x.a)(b.a.mark((function t(n,r,o){var i,a,s;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.type=10,t.next=3,e.addItem(n);case 3:for(s in i=t.sent,a=[(100*o/2.54-5)/295,(100*r/2.54-5)/295])i.setMorph(parseInt(s),a[s]);case 8:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}(),e.handleRemoveAllRoofWindows=function(){var t=[];e.bp3d.model.scene.items.forEach((function(e){return e.isRoofItem&&t.push(e)}));for(var n=t.length-1;n>=0;n--)t[n].remove();e.bp3d.model.floorplan.update(!1)},e.addWindows=function(){var t=Object(x.a)(b.a.mark((function t(n,r,o,i,a,s){var l,c,u,d,h,f,p,v,g,y,m,x,w,j,O,C,E,S,M,T,W,P,I,L,D,R,z,V,A,F,N,B,_,U,H,X,Y,G,J,q,Z,K,Q,$,ee,te,ne,re,oe,ie,ae,se,le,ce,ue,de,he,fe,pe,ge,ye,me,be,xe,we,je,ke,Oe,Ce,Ee,Se,Me,Te,We,Pe,Ie,Le;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(l=i.coverMethod,c=i.coverRate,u=i.windowCount,e.props.isLoading(),d=e.bp3d.model,h=d.floorplan,f=d.scene,p=e.bp3d.model.floorplan.buildingOffset,v=r.baseWidth,g=r.baseHeight,y=.005,m=o.vertical,x={state:0,msg:""},n&&r&&o){t.next=10;break}return t.abrupt("return",null);case 10:if(w=v*g,j=0,0,O=0,C=[],E=a.wall,S=a.wallMode,E||![0,1,2].includes(S)){t.next=19;break}return e.props.isLoaded(),t.abrupt("return",{state:1,msg:"No wall Selected"});case 19:t.t0=S,t.next=0===t.t0?22:1===t.t0?24:2===t.t0?26:3===t.t0?28:30;break;case 22:return C.push(E),t.abrupt("break",31);case 24:return C=h.getSameLayerWalls(E).filter((function(e){return e.checkIsOutsideWall()})),t.abrupt("break",31);case 26:return C=h.getSameFaceWalls(E).filter((function(e){return e.checkIsOutsideWall()})),t.abrupt("break",31);case 28:return C=h.getAllWalls().filter((function(e){return e.checkIsOutsideWall()})),t.abrupt("break",31);case 30:return t.abrupt("break",31);case 31:if(C.forEach((function(t){return e.removeWindowByWall(t)})),0!==C.length){t.next=34;break}return t.abrupt("return",null);case 34:return t.next=36,e.addItem(n,!1);case 36:M=t.sent,T=[],W=0;case 39:if(!(W<C.length)){t.next=89;break}if(P=C[W],I=P.layer,L=P.edge,!(I.layerIndex<100)){t.next=44;break}return t.abrupt("continue",86);case 44:if(P.hasRoofInteraction){t.next=59;break}for(D=L.exteriorDistance(),R=L.interiorDistance(),z=Math.min(D,R)-y,V=P.height-y,j+=A=V*z,F=0,0===l?(N=Math.floor(A*c/w),B=Math.floor(z/(v+y)),F=Math.min(N,B)):1===l&&(F=u),O+=F,_=I.offset+m+p,U=P.start,H=P.end,X=0;X<F;X++)Y=(X+.5)/F,G=Math.round(100*(U.x+(H.x-U.x)*Y))/100,J=Math.round(100*(U.y+(H.y-U.y)*Y))/100,T.push({wall:P,wallArea:A,wallLength:z,wallHeight:V,offset:I.offset+p,count:F,pos:{x:G,y:_,z:J}});t.next=86;break;case 59:if(q=[],Z=0,-1===(K=P.getExposedSide())?(q=L.validExteriorWallPoints,Z=L.exteriorArea()):1===K&&(q=L.validInteriorWallPoints,Z=L.interiorArea()),j+=Z*=.99,Q=ve.Utils3D.findLargestInscribedRectOfWallCorners,$=Q(q)){t.next=69;break}return t.abrupt("continue",86);case 69:if(ee=$.area,te=$.length,ne=$.height,re=$.corners,oe=0,ie=I.offset+m+p,ae={x:re[0].x,y:re[0].z},se={x:re[1].x,y:re[1].z},0!==l){t.next=83;break}if(!(ee<Z*c)){t.next=78;break}return e.props.isLoaded(),t.abrupt("return",{state:1,msg:"Cannot fit cover rate"});case 78:le=Math.floor(Z*c/w),ce=Math.floor(te/(v+y)),oe=Math.min(le,ce),t.next=84;break;case 83:1===l&&(oe=u);case 84:for(O+=oe,ue=0;ue<oe;ue++)de=(ue+.5)/oe,he=Math.round(100*(ae.x+(se.x-ae.x)*de))/100,fe=Math.round(100*(ae.y+(se.y-ae.y)*de))/100,T.push({wall:P,wallArea:Z,wallLength:te,wallHeight:ne,offset:I.offset+p,count:oe,pos:{x:he,y:ie,z:fe}});case 86:W++,t.next=39;break;case 89:pe=j*c/O,ge=v,ye=g,0===l&&(ye=g*pe/w),t.t1=b.a.keys(T);case 95:if((t.t2=t.t1()).done){t.next=115;break}return me=t.t2.value,be=ge,xe=ye,we=m,je=T[me],ke=je.wall,Oe=je.wallArea,Ce=je.wallLength,Ee=je.count,Se=je.wallHeight,Me=je.pos,Te=je.offset,0===l?Se<=xe+m&&(Se<xe&&(xe=Se),be=Oe*c/xe/Ee,we=(Se-xe)/2,T[me].pos.y=Te+we):1===l&&(Se<=xe+m&&(Se<xe&&(xe=Se),we=(Se-xe)/2,T[me].pos.y=Te+we),be>Ce/Ee&&(be=Ce/Ee)),ke.windowInfo={width:be,height:xe,sillHeight:we,coverRate:100*c},We=[(100*(xe-=.001)/2.54-5)/295,(100*(be-=.001)/2.54-5)/295],t.next=110,f.cloneItem(M);case 110:if(Pe=t.sent)for(Le in Ie=new k.Tb(Me.x,Me.y,Me.z),Pe.calculatedPosition=Ie,Pe.setPosition(Ie),We)Pe.setMorph(parseInt(Le),We[Le]);"function"===typeof s&&s({finished:!1,totalCount:T.length,current:me-0+1}),t.next=95;break;case 115:return M.remove(),e.bp3d.model.floorplan.update(!1),e.props.onNothingClicked(),e.props.isLoaded(),"function"===typeof s&&s({finished:!0}),t.abrupt("return",x);case 121:case"end":return t.stop()}}),t)})));return function(e,n,r,o,i,a){return t.apply(this,arguments)}}(),e.removeWindowByWall=function(t){t&&(t.removeItems(),e.bp3d.model.floorplan.update(!1),e.props.onNothingClicked())},e.removeWindows=function(t){var n=t.wall,r=t.wallMode,o=[];if(!n&&[0,1,2].includes(r))return e.props.isLoaded(),{state:1,msg:"No wall Selected"};switch(r){case 0:o.push(n);break;case 1:o=e.bp3d.model.floorplan.getSameLayerWalls(n).filter((function(e){return e.checkIsOutsideWall()}));break;case 2:o=e.bp3d.model.floorplan.getSameFaceWalls(n).filter((function(e){return e.checkIsOutsideWall()}));break;case 3:o=e.bp3d.model.floorplan.getAllWalls().filter((function(e){return e.checkIsOutsideWall()}))}o.forEach((function(t){return e.removeWindowByWall(t)})),e.bp3d.model.floorplan.update(!1),e.props.onNothingClicked()},e.updateMaterial=function(t,n,r){e.state.selectedItem&&e.state.selectedItem.updateMaterial(t,n,r,(function(){return setTimeout(e.update,100)}))},e.updateStyle=function(t,n){e.state.selectedItem&&e.state.selectedItem.updateStyle(t,n,(function(){return setTimeout(e.update,100)}))},e.setBuildingOffset=function(t){e.bp3d.model.floorplan.setBuildingOffset(t)},e.setActiveLayerIndex=function(t){e.bp3d.model.floorplan.setActiveLayerIndex(t),e.bp3d.floorplanner.update()},e.setLayerVisible=function(t,n){return e.bp3d.model.floorplan.setLayerVisible(t,n)},e.setLayerHeight=function(t,n){return e.bp3d.model.floorplan.setLayerHeight(t,n)},e.setLayerFloorThickness=function(t,n){return e.bp3d.model.floorplan.setLayerFloorThickness(t,n)},e.setRoomVisible=function(t,n){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];e.bp3d.model.floorplan.setRoomVisible(t,n,r)},e.cloneAboveLayer=function(t){return e.bp3d.model.floorplan.cloneAboveLayer(t)},e.cloneBelowLayer=function(t){return e.bp3d.model.floorplan.cloneBelowLayer(t)},e.moveAboveLayer=function(t){return e.bp3d.model.floorplan.moveAboveLayer(t)},e.moveBelowLayer=function(t){return e.bp3d.model.floorplan.moveBelowLayer(t)},e.removeLayer=function(t){return e.bp3d.model.floorplan.removeLayer(t)},e.setFloorplanMode=function(t){return e.bp3d.floorplanner.setMode(t)},e.setRoofEditorEnabled=function(t){return e.bp3d.three.setRoofEditorEnabled(t)},e.setRoofEditorMode=function(t){return e.bp3d.three.setRoofEditorMode(t)},e.setRoofEditorTransformControlAxis=function(t){return e.bp3d.three.setTransformControlAxis(t)},e.setRoofFaceTexture=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e.bp3d.model.floorplan.roof.setFaceTexture(t,n)},e.setMorph=function(t,n){return e.state.selectedItem.setMorph(t,n)},e.setLocked=function(t){return e.bp3d.setSceneLocked(t)},e.setShellMode=function(t){return e.bp3d.setShellMode(t)},e.setObstacleEditMode=function(t){e.bp3d.floorplanner.setObstacleEditMode(t),e.bp3d.model.floorplan.obstacleEditMode=t,e.update()},e.setToggleXRay=function(){return e.bp3d.toggleXRayMode()},e.setSnap=function(t){return e.bp3d.setSnap(t)},e.setDimensionVisible=function(t){return e.bp3d.setDimensionVisible(t)},e.setCompassVisible=function(t){return e.bp3d.setCompassVisible(t)},e.setObstacleVisible=function(t){e.bp3d.setObstacleVisible(t),e.update()},e.updateGeolocationData=function(t,n,r){var o=new Date(r),i=C.a.getPosition(o,t,n);e.bp3d.three.updateSunPosition(i.azimuth,i.altitude)},e.zoomInFloorPlanner=function(){return e.bp3d.floorplanner.zoomIn()},e.zoomOutFloorPlanner=function(){return e.bp3d.floorplanner.zoomOut()},e.resetZoomFloorPlanner=function(){return e.bp3d.floorplanner.resetZoom()},e.zoomInScene=function(){return e.bp3d.three.controls.dollyIn(1.1)},e.zoomOutScene=function(){return e.bp3d.three.controls.dollyOut(1.1)},e.resetZoomScene=function(){return e.bp3d.three.centerCamera(!0)},e}return Object(v.a)(n,[{key:"render",value:function(){var e=this,t=this.props.viewMode,n=this.state,r=n.orientation,o=n.gridSpacing,i=n.gridSpacingInCanvas;return Object(E.jsxs)("div",{style:{height:"100%"},onContextMenu:function(e){return e.preventDefault(),e.stopPropagation(),!1},children:[Object(E.jsx)(S,{hidden:"3d"!==t,onDomLoaded:function(t){return e.elThreeElemContainer=t}}),Object(E.jsx)(ye,{hidden:"3d"===t,onDomLoaded:function(t){return e.elFloorPlannerElement=t},orientation:r,gridSpacing:o,gridSpacingInCanvas:i,onOrientationChanged:function(t){return e.bp3d.floorplanner.setOrientation(t)},onGridSpacingChanged:function(t){return e.bp3d.floorplanner.setGridSpacing(t)},onResetGridSpacing:function(){return e.bp3d.floorplanner.setGridSpacing(null)}})]})}}]),n}(d.a.Component);function Mn(e){var t=e.title,n=e.onClose;return Object(E.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[Object(E.jsx)("h3",{style:{flex:1,margin:0,fontWeight:500},children:t}),Object(E.jsx)("div",{onClick:n,children:Object(E.jsx)("i",{className:"fa fa-close"})})]})}d.a.Component;var Tn=function(e){Object(g.a)(n,e);var t=Object(y.a)(n);function n(e){var r;return Object(p.a)(this,n),(r=t.call(this,e)).state={opened:!1},r}return Object(v.a)(n,[{key:"render",value:function(){var e=this,t=this.state.opened,n=this.props,r=n.label,o=n.title,i=n.children;return Object(E.jsxs)("div",{className:"custom-accordion",children:[Object(E.jsx)("div",{className:"title",onClick:function(){return e.setState({opened:!t})},children:r||o}),t&&i]})}}]),n}(d.a.Component),Wn=n(21),Pn=n(20),In=(n(36),d.a.Component,function(e){Object(g.a)(n,e);var t=Object(y.a)(n);function n(){var e;Object(p.a)(this,n);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).handleToggleLock=function(){e.props.onLockSceneToggled(!e.state.locked),e.setState({locked:!e.state.locked})},e.handleToggleDimensions=function(){e.props.onShowDimensionsToggled(!e.state.showDimension),e.setState({showDimension:!e.state.showDimension})},e.handleToggleSnap=function(){e.props.onSnapToggled(!e.state.snap),e.setState({snap:!e.state.snap})},e.handleToggleXRay=function(){e.props.onXRayToggled(!e.state.xRay),e.setState({xRay:!e.state.xRay})},e.getButtons=function(){var t=e.props,n=t.viewMode,r=t.obstacleMode,o=t.showLayers,i=t.showRoofEditor,a=t.showWindowEditor,s=t.shellMode,l=t.showSettings;return[{font:"fa fa-solar-panel",toggled:"2d"===n&&!r,tooltip:"2D View",callback:e.props.onShow2DPlanner},{font:"fa fa-cube",tooltip:"3D x-ray",toggled:"3d"===n&&!s&&!i&&!a,callback:e.props.onShow3DViewClicked},{font:"fa fa-building",toggled:"3d"===n&&s&&!i&&!a,tooltip:"3D Shell",callback:e.props.onShellModePressed},null,{font:"fa fa-exclamation-triangle",toggled:"2d"===n&&r,tooltip:"Obstacle Editor",callback:e.props.onShowObstacleMode},{font:"fa fa-campground",toggled:i,tooltip:"Roof Editor",callback:e.props.onRoofPressed},{font:"fa fa-border-all",toggled:a,tooltip:"Window Editor",callback:e.props.onWindowPressed},null,{font:"fa fa-layer-group",toggled:o,tooltip:"Show Layers",callback:e.props.onLayerPressed},null,{font:"fa fa-undo",tooltip:"Undo",callback:e.props.onUndo},{font:"fa fa-redo",tooltip:"Redo",callback:e.props.onRedo},{font:"fa fa-save",tooltip:"Save",callback:e.props.onSaveClicked},{font:"fas fa-upload",tooltip:"Load",callback:e.props.onLoadClicked},{font:"fa fa-file-export",tooltip:"Collect metadata",callback:e.props.onCollectMetadataClicked},null,{font:"fa fa-gear",toggled:l,tooltip:"Settings",callback:e.props.onSettingsClicked}]},e}return Object(v.a)(n,[{key:"render",value:function(){var e=this.getButtons();return Object(E.jsxs)("div",{className:"left-toolbar",children:[e.map((function(e,t){return e?Object(E.jsx)("div",{className:"left-toolbar-button ".concat(e.toggled?"toggled":""),"data-tip":e.tooltip,onClick:e.callback,children:Object(E.jsx)("span",{className:e.font,style:e.fontStyle,children:e.label})},t):Object(E.jsx)("div",{className:"hr"},t)})),Object(E.jsx)(Pn.a,{position:"bottom-center",autoClose:3e3,hideProgressBar:!1,newestOnTop:!1,closeOnClick:!0,rtl:!1,pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!0}),Object(E.jsx)(Wn.a,{})]})}}]),n}(d.a.Component)),Ln=(d.a.Component,function(e){Object(g.a)(n,e);var t=Object(y.a)(n);function n(){var e;Object(p.a)(this,n);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).parseLayerData=function(){var t=e.props.layers;if(!Array.isArray(t))return[];var n=[{label:"Select Floor To Edit",value:"",disabled:!0}],r=JSON.parse(JSON.stringify(t));return r.sort((function(e,t){return t.index-e.index})),r.forEach((function(e){n.push({label:"Floor ".concat(e.index),value:e.index})})),n},e._renderDrawTools=function(){var t=e.props,n=t.selectedLayerIndex,r=t.obstacleMode,o=t.mode;if(Number.isInteger(n)||r){var i=[{label:"Edit",active:o===ln,callback:e.props.onModeChanged,value:ln},{label:"Draw",active:o===cn,callback:e.props.onModeChanged,value:cn},{label:"Delete",active:o===un,callback:e.props.onModeChanged,value:un}];return Object(E.jsx)("div",{style:{padding:"0 10px"},children:i.map((function(e,t){return Object(E.jsx)("div",{className:"button inline auto-width ".concat(e.active?"active":""),onClick:function(){return e.callback(e.value)},children:e.label},t)}))})}},e._renderZoomButtons=function(){var t=e.props,n=(t.autoMerge,t.autoSplit,[{font:"fa fa-search-minus",tooltip:"Zoom Out",callback:e.props.onZoomOut},{font:"fa fa-home",tooltip:"Reset Zoom",callback:e.props.onResetZoom},{font:"fa fa-search-plus",tooltip:"Zoom In",callback:e.props.onZoomIn}]);return Object(E.jsx)("div",{style:{padding:"0 10px"},children:n.map((function(e,t){return e?Object(E.jsx)("div",{className:"button inline auto-width ".concat(e.toggled?"active":""),"data-tip":e.tooltip,onClick:function(){"function"===typeof e.callback&&e.callback()},children:Object(E.jsx)("span",{className:e.font,style:e.fontStyle,children:e.label})},t):Object(E.jsx)("div",{className:"hr"},t)}))})},e._renderLayers=function(){var t=e.props.selectedLayerIndex,n=e.parseLayerData(),r=Number.isInteger(t)?t:"";return Object(E.jsx)("div",{children:Object(E.jsx)("select",{style:{margin:"0 20px",padding:5,fontSize:16},value:r,onChange:function(t){var n=null;Number.isInteger(parseInt(t.target.value))&&(n=parseInt(t.target.value)),e.props.onLayerSelected({value:n})},children:n.map((function(e,t){return Object(E.jsx)("option",{value:e.value,disabled:e.disabled,children:e.label},t)}))})})},e._renderGraphicLayerIndicators=function(){var t=e.props.selectedLayerIndex;return e.parseLayerData().map((function(e,n){return e.disabled?null:0===e.value?Object(E.jsxs)(d.a.Fragment,{children:[Object(E.jsx)("div",{className:"item ".concat(t===e.value?"active":"")}),Object(E.jsx)("div",{className:"ground-line"})]},n):Object(E.jsx)("div",{className:"item ".concat(t===e.value?"active":"")},n)}))},e}return Object(v.a)(n,[{key:"render",value:function(){var e=this.props.obstacleMode;return Object(E.jsxs)("div",{className:"floorplan-tool-section",children:[Object(E.jsxs)("div",{children:[this._renderZoomButtons(),!e&&this._renderLayers(),this._renderDrawTools()]}),!e&&Object(E.jsx)("div",{className:"graphic-layer-indicator",children:this._renderGraphicLayerIndicators()}),Object(E.jsx)(Wn.a,{})]})}}]),n}(d.a.Component)),Dn=function(e){Object(g.a)(n,e);var t=Object(y.a)(n);function n(){var e;Object(p.a)(this,n);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).renderButtons=function(){var t=[{font:"fa fa-search-minus",tooltip:"Zoom Out",callback:e.props.onZoomOut},{font:"fa fa-home",tooltip:"Reset Zoom",callback:e.props.onResetZoom},{font:"fa fa-search-plus",tooltip:"Zoom In",callback:e.props.onZoomIn}];return Object(E.jsx)("div",{style:{padding:"0 10px"},children:t.map((function(e,t){return e?Object(E.jsx)("div",{className:"button inline auto-width ".concat(e.toggled?"active":""),"data-tip":e.tooltip,onClick:function(){"function"===typeof e.callback&&e.callback()},children:Object(E.jsx)("span",{className:e.font,style:e.fontStyle,children:e.label})},t):Object(E.jsx)("div",{className:"hr"},t)}))})},e}return Object(v.a)(n,[{key:"render",value:function(){return Object(E.jsxs)("div",{className:"floorplan-tool-section",children:[this.renderButtons(),Object(E.jsx)(Wn.a,{})]})}}]),n}(d.a.Component),Rn=(d.a.Component,function(e){Object(g.a)(n,e);var t=Object(y.a)(n);function n(e){var r;Object(p.a)(this,n),(r=t.call(this,e)).elInput=null,r.handleChanged=function(e){var t=r.props,n=t.min,o=t.max,i=(t.autoTrigger,e.target.value);Number.isInteger(n)&&i<n&&(i=n),Number.isInteger(o)&&i>o&&(i=o),r.setState({value:i},(function(){return r.handleCompleted()}))},r.handleArrowUp=function(){return r.elInput.stepUp()},r.handleArrowDown=function(){return r.elInput.stepDown()},r.handleCompleted=function(){var e=r.state.value,t=ve.Dimensioning.measureToCm(e)/100;r.props.onChange(t)},r.componentWillReceiveProps=function(e){if(r.props.rawValue!==e.rawValue){var t=e.rawValue||0;r.setState({value:ve.Dimensioning.cmToMeasureWithoutUnit(100*t)})}};var o=e.rawValue||0;return r.state={value:ve.Dimensioning.cmToMeasureWithoutUnit(100*o)},r}return Object(v.a)(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.step,r=t.style,o=this.state.value,i=ve.Dimensioning.getUnit();return Object(E.jsxs)(E.Fragment,{children:[Object(E.jsxs)("div",{className:"input-with-unit",children:[Object(E.jsx)("input",{ref:function(t){return e.elInput=t},style:r||{},type:"number",step:n||.1,value:o,min:-1e3,max:1e3,lang:"en",onChange:this.handleChanged,onKeyDown:function(t){return 13===t.keyCode&&e.handleCompleted()},onBlur:this.handleCompleted,name:"input-with-unit"}),Object(E.jsx)("div",{className:"arrow arrow-up",onClick:this.handleArrowUp,children:Object(E.jsx)("span",{className:"fas fa-chevron-up"})}),Object(E.jsx)("div",{className:"arrow arrow-down",onClick:this.handleArrowDown,children:Object(E.jsx)("span",{className:"fas fa-chevron-down"})})]}),Object(E.jsxs)("label",{htmlFor:"input-with-unit",children:[" ",i]})]})}}]),n}(d.a.Component)),zn=.0254;function Vn(e){var t,n=e.item,r=e.info,o=e.onChange,i=n.index,a=parseInt(n.min||0,10),s=parseInt(n.max||100,10);a*=zn,s*=zn;var l=r.getMorph(i);t=Math.round(5+295*l);var c=function(e){var t=e.target.value;t<a||t>s||"function"===typeof o&&o(i,(t/zn-5)/295)};return Object(E.jsxs)("div",{className:"input-container",children:[Object(E.jsx)("label",{children:n.label}),Object(E.jsxs)("div",{className:"input",children:[Object(E.jsx)("input",{type:"range",className:"input-slider",min:a,max:s,value:t*zn,step:.01,onChange:c}),Object(E.jsx)("div",{children:Object(E.jsx)(Rn,{rawValue:t*zn,style:{width:50},step:.1,onChange:function(e){return c({target:{value:e}})}})})]})]})}d.a.Component;var An=function(e){Object(g.a)(n,e);var t=Object(y.a)(n);function n(){var e;Object(p.a)(this,n);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).state={selectedTags:[]},e.handleHeightChanged=function(t,n){var r=parseFloat(n.target.value);e.props.onHeightChanged(t,ve.Dimensioning.measureToCm(r)/100)},e.handleCloneAbovePressed=function(t){var n=e.props.onCloneAboveLayer(t);e.props.onLayerSelected({value:n})},e.handleCloneBelowPressed=function(t){var n=e.props.onCloneBelowLayer(t);e.props.onLayerSelected({value:n})},e.handleMoveAbovePressed=function(t){var n=e.props.onMoveAboveLayer(t);e.props.onLayerSelected({value:n})},e.handleMoveBelowPressed=function(t){var n=e.props.onMoveBelowLayer(t);e.props.onLayerSelected({value:n})},e.handleRemovePressed=function(t){e.props.onRemoveLayer(t),e.props.onLayerSelected({value:null})},e.handleToggleSelectedTag=function(t){var n=Object(me.a)(e.state.selectedTags);if(n.includes(t)){var r=n.indexOf(t);n.splice(r,1)}else n.push(t);e.getRoomData().forEach((function(t){var r,o=!1,i=Object(j.a)(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;if(t.tags.includes(a)){o=!0;break}}}catch(s){i.e(s)}finally{i.f()}o?e.props.onSetRoomVisible(t.uuid,!0,!1):e.props.onSetRoomVisible(t.uuid,!1,!1)})),e.props.onUpdate(),e.setState({selectedTags:n})},e.getFloorData=function(){var t=e.props,n=t.layers,r=t.activeIndex,o=[{label:"All Floors",isValid:!1,value:null,height:0}],i=null;if(Array.isArray(n)){var a=JSON.parse(JSON.stringify(n));a.sort((function(e,t){return t.index-e.index}));for(var s=0;s<a.length;s++){var l=a[s];o[0].height+=l.height-0;var c={isValid:!0,isTopLayer:0===s||-1===l.index,isBottomLayer:s===a.length-1||0===l.index,isNotRemovable:a.length<=1,isVisible:l.visible,label:"Floor ".concat(l.index>=0?l.index:"B"+Math.abs(l.index)),value:l.index,offset:l.offset,height:l.height,floorThickness:l.floorThickness};c.value===r&&(i=c),o.push(c)}}return{data:o,selectedLayer:i}},e.getRoomData=function(){var t=e.props.rooms,n=[];if(Array.isArray(t)){var r=JSON.parse(JSON.stringify(t));r.sort((function(e,t){return t.layerIndex-e.layerIndex}));for(var o=0;o<r.length;o++){var i=r[o],a={uuid:i.uuid,tags:i.tags,isValid:!0,isVisible:i.visible,layerLabel:"Floor ".concat(i.layerIndex>=0?i.layerIndex:"B"+Math.abs(i.layerIndex)),label:i.name};n.push(a)}}return n},e._renderHeightInput=function(t,n){var r=ve.Dimensioning.cmToMeasure(100*t.height);return n?Object(E.jsx)("td",{style:{textAlign:"right"},children:Object(E.jsx)(Rn,{rawValue:t.height,style:{width:60,fontSize:16},min:0,step:.1,onChange:function(n){e.props.onHeightChanged(t.value,n)}})}):Object(E.jsx)("td",{style:{textAlign:"right"},children:r})},e._renderFloorsTable=function(t){if(Array.isArray(t)){var n=e.props.activeIndex;return Object(E.jsx)(E.Fragment,{children:Object(E.jsxs)("table",{className:"table",children:[Object(E.jsx)("thead",{children:Object(E.jsxs)("tr",{children:[Object(E.jsx)("th",{children:"Label"}),Object(E.jsx)("th",{children:"Below"}),Object(E.jsx)("th",{children:"Height"}),Object(E.jsx)("th",{})]})}),Object(E.jsx)("tbody",{children:t.map((function(t,r){return Object(E.jsxs)("tr",{className:n===t.value?"active":"",children:[Object(E.jsx)("td",{className:"label",onClick:function(){return e.props.onLayerSelected(t)},children:"".concat(t.label)}),Object(E.jsx)("td",{children:null!==t.value&&Object(E.jsx)("input",{type:"checkbox",checked:t.value<0,onChange:function(){}})}),e._renderHeightInput(t,t.isValid&&n===t.value),Object(E.jsx)("td",{children:null!==t.value&&Object(E.jsx)("span",{className:"fa fa-eye".concat(t.isVisible?"":"-slash"),onClick:function(){return e.props.onSetLayerVisible(t.value,!t.isVisible)}})})]},r)}))})]})})}},e._renderRoomsTable=function(t){if(Array.isArray(t)){var n=e.state.selectedTags,r=[];return t.forEach((function(e){return e.tags.forEach((function(e){r.includes(e)||r.push(e)}))})),Object(E.jsxs)(E.Fragment,{children:[Object(E.jsx)("div",{style:{paddingTop:10},children:r.map((function(t,r){return Object(E.jsx)("div",{style:{border:"1px solid #3575a5",borderRadius:3,display:"inline-block",padding:5,margin:3,cursor:"pointer",background:n.includes(t)?"#888888":"transparent"},onClick:function(){return e.handleToggleSelectedTag(t)},children:Object(E.jsx)("span",{children:t})},r)}))}),Object(E.jsxs)("table",{className:"table",children:[Object(E.jsx)("thead",{children:Object(E.jsxs)("tr",{children:[Object(E.jsx)("th",{children:"Floor"}),Object(E.jsx)("th",{children:"Name"}),Object(E.jsx)("th",{children:"Visible"})]})}),Object(E.jsx)("tbody",{children:t.map((function(t,n){return Object(E.jsxs)("tr",{children:[Object(E.jsx)("td",{className:"label",children:t.layerLabel}),Object(E.jsx)("td",{children:t.label}),Object(E.jsx)("td",{children:null!==t.value&&Object(E.jsx)("span",{className:"fa fa-eye".concat(t.isVisible?"":"-slash"),onClick:function(){return e.props.onSetRoomVisible(t.uuid,!t.isVisible)}})})]},n)}))})]})]})}},e._renderButtons=function(t){if(t){var n=t.value,r=[{hidden:t.isTopLayer,label:"Move Above",callback:function(){return e.handleMoveAbovePressed(n)}},{hidden:t.isBottomLayer,label:"Move Below",callback:function(){return e.handleMoveBelowPressed(n)}},{label:"Clone Above",callback:function(){return e.handleCloneAbovePressed(n)}},{label:"Clone Below",callback:function(){return e.handleCloneBelowPressed(n)}},{hidden:t.isNotRemovable,label:"Remove Floor",callback:function(){return e.handleRemovePressed(n)}}];return Object(E.jsxs)("div",{children:[Object(E.jsxs)("div",{className:"input-container",children:[Object(E.jsx)("label",{children:"Floor Thickness"}),Object(E.jsx)("div",{children:Object(E.jsx)(Rn,{step:.1,min:0,rawValue:t.floorThickness,onChange:function(t){return e.props.onFloorThicknessChanged(n,t)}})})]}),r.map((function(e,t){return Object(E.jsx)("div",{hidden:e.hidden,className:"button ".concat(e.active?"active":""),onClick:function(){return e.callback(e.value)},children:e.label},t)}))]})}},e._renderBuildingOffset=function(){var t=e.props.buildingOffset;return Object(E.jsxs)("div",{className:"input-container",children:[Object(E.jsx)("label",{children:"Building Offset"}),Object(E.jsx)("div",{children:Object(E.jsx)(Rn,{step:.1,style:{width:50},rawValue:t,onChange:function(t){e.props.onBuildingOffsetChanged(t)}})})]})},e}return Object(v.a)(n,[{key:"render",value:function(){var e=this.getFloorData(),t=e.data,n=e.selectedLayer,r=this.getRoomData();return Object(E.jsxs)("div",{className:"property-section",children:[Object(E.jsx)(Mn,{title:"Edit Floors",onClose:this.props.onClose}),this._renderBuildingOffset(),Object(E.jsx)("div",{style:{padding:10},children:this._renderFloorsTable(t)}),this._renderButtons(n),Object(E.jsx)("h3",{style:{fontWeight:500},children:"Rooms"}),Object(E.jsx)("div",{style:{padding:10},children:this._renderRoomsTable(r)}),Object(E.jsx)(Wn.a,{})]})}}]),n}(d.a.Component),Fn=[{url:"/Blueprint3D-assets/rooms/textures/marbletiles.jpg",conduction:.1},{url:"/Blueprint3D-assets/rooms/textures/tile-01.jpg",conduction:.3},{url:"/Blueprint3D-assets/rooms/textures/tile-02.jpg",conduction:.5}],Nn=[{url:"/Blueprint3D-assets/rooms/textures/light_brick.jpg",conduction:.7}],Bn=[{url:"/Blueprint3D-assets/rooms/textures/hardwood.png",conduction:.2},{url:"/Blueprint3D-assets/rooms/textures/light_fine_wood.jpg",conduction:.6}],_n=["#3f89cd","#ff0000","#00ff00","#0000ff","#3f8900","#893fcd","#89cd3f","#cd3f89","#cd893f","#123456"],Un=function(e){Object(g.a)(n,e);var t=Object(y.a)(n);function n(e){var r;return Object(p.a)(this,n),(r=t.call(this,e)).componentDidMount=function(){r.props.isFirst&&r.props.onRegenerateClicked(!1),r.props.onTransformControlAxisChanged(r.state.transformControlAxis)},r._renderModeButtons=function(){var e=r.props.mode,t=[{label:"Move",active:e===Wt,callback:r.props.onModeChanged,value:Wt},{label:"Add Vertex",active:e===Pt,callback:r.props.onModeChanged,value:Pt},{label:"Connect Vertices",active:e===It,callback:r.props.onModeChanged,value:It},{label:"Delete",active:e===Lt,callback:r.props.onModeChanged,value:Lt}];return Object(E.jsxs)("div",{children:[Object(E.jsx)("div",{children:Object(E.jsx)("h4",{children:"Mode"})}),t.map((function(e,t){return Object(E.jsx)("div",{className:"button ".concat(e.active?"active":""),onClick:function(){return e.callback(e.value)},children:e.label},t)}))]})},r._renderAxisManagementPanel=function(){var e=r.state.transformControlAxis;return Object(E.jsxs)("div",{children:[Object(E.jsx)("h4",{children:"Select axis of transform control"}),["X","Y","Z"].map((function(t,n){return Object(E.jsxs)("span",{onClick:function(){r.setState({transformControlAxis:t}),r.props.onTransformControlAxisChanged(t)},children:[Object(E.jsx)("input",{type:"radio",id:"enable-axis-".concat(t),checked:t===e,onChange:function(){}}),Object(E.jsx)("label",{htmlFor:"enable-axis-".concat(t),children:t})]},n)}))]})},r._renderVertexEditPanel=function(){var e=r.props.roofVertex;if(e){var t=[{label:"x",value:e.x,callback:function(t){var n=function(){return e.setPosition("x",t)};n(),setTimeout(n,1)}},{label:"y",value:e.z,callback:function(t){var n=function(){return e.setPosition("y",t)};n(),setTimeout(n,1)}},{label:"z (height)",value:e.y+e.parent.offset,callback:function(t){var n=function(){return e.setPosition("z",t)};n(),setTimeout(n,1)}}];return Object(E.jsxs)("div",{children:[Object(E.jsx)("h4",{children:"Edit Vertex Position"}),t.map((function(e,t){return Object(E.jsxs)("div",{className:"input-container",children:[Object(E.jsxs)("label",{children:[e.label," "]}),Object(E.jsx)("div",{children:Object(E.jsx)(Rn,{rawValue:e.value,step:.1,style:{width:60,fontSize:16,textAlign:"right"},onChange:e.callback})})]},t)}))]})}},r._renderTextureEditPanel=function(){var e={display:"inline-block",width:50,height:50,borderRadius:25,margin:10,cursor:"pointer"};return Object(E.jsxs)("div",{children:[Object(E.jsx)("h4",{children:"Entire Color"}),Object(E.jsx)("div",{children:_n.map((function(t,n){return Object(E.jsx)("div",{style:Object(w.a)(Object(w.a)({},e),{},{background:t}),onClick:function(){return r.props.onEntireTextureChanged(t)}},n)}))})]})},r.state={transformControlAxis:"X"},r}return Object(v.a)(n,[{key:"render",value:function(){return Object(E.jsxs)("div",{className:"property-section",children:[Object(E.jsx)(Mn,{title:"Roof Editor",onClose:this.props.onClose}),Object(E.jsx)("p",{style:{color:"gray"},children:"Tip: Roof faces should be triangle."}),Object(E.jsx)("div",{onClick:this.props.onRegenerateClicked,className:"button",children:"Reset Roof"}),this._renderModeButtons(),this._renderAxisManagementPanel(),this._renderVertexEditPanel(),this._renderTextureEditPanel()]})}}]),n}(d.a.Component),Hn={category:"Window",styles:[{name:"Window Type 1",image:"/blueprint3D-assets/models/thumbnails/window-01.jpg",model:"/blueprint3D-assets/models/glb/window-01.glb",type:"3",morph:[{label:"Height",index:0,min:10,max:100},{label:"Width",index:1,min:10,max:300}]},{name:"Window Type 2",image:"/blueprint3D-assets/models/thumbnails/window-02.jpg",model:"/blueprint3D-assets/models/glb/window-02.glb",type:"3",morph:[{label:"Height",index:0,min:10,max:100},{label:"Width",index:1,min:10,max:300}]},{name:"Window Type 3",image:"/blueprint3D-assets/models/thumbnails/window-03.jpg",model:"/blueprint3D-assets/models/glb/window-03.glb",type:"3",morph:[{label:"Height",index:0,min:10,max:100},{label:"Width",index:1,min:10,max:300}]}]},Xn=[Hn],Yn=function(e){Object(g.a)(n,e);var t=Object(y.a)(n);function n(){var e;Object(p.a)(this,n);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).state={wallMode:0,baseWidth:1,baseHeight:1.5,marginVertical:.5,coverMethod:0,coverRate:50,windowCount:5,selectedWindowType:0,isAdding:!1,loadingMessage:"",tabIndex:1},e._getWallData=function(){var t=e.props.selectedEdge,n=e.state.wallMode;return{wall:t?t.wall:null,wallMode:n}},e.UNSAFE_componentWillReceiveProps=function(e){},e.handleAddRoofWindow=function(){var t=e.state,n=t.baseWidth,r=t.baseHeight,o=t.selectedWindowType,i=JSON.parse(JSON.stringify(Xn[0].styles[o]));e.props.onAddRoofWindow(i,n,r)},e.handleRemoveAllRoofWindows=function(){e.props.onRemoveAllRoofWindows()},e.handleAddWallWindows=Object(x.a)(b.a.mark((function t(){var n,r,o,i,a,s,l,c,u,d,h;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.state,r=n.baseWidth,o=n.baseHeight,i=n.marginVertical,a=n.coverMethod,s=n.coverRate,l=n.windowCount,c=n.selectedWindowType,u=Xn[0].styles[c],d=function(t){t.finished||e.setState({loadingMessage:"".concat(t.current," / ").concat(t.totalCount," windows added(").concat(parseInt(t.current/t.totalCount*100),"%).")})},e.setState({isAdding:!0}),t.next=6,e.props.onAddWindows(u,{baseWidth:r,baseHeight:o},{horizontal:0,vertical:i},{coverMethod:a,coverRate:s/100,windowCount:l},e._getWallData(),d);case 6:h=t.sent,e.setState({isAdding:!1}),h&&1===h.state&&Pn.b.error(h.msg);case 9:case"end":return t.stop()}}),t)}))),e.handleRemoveWallWindows=function(){e.props.onRemoveWindows(e._getWallData())},e._renderWindowTypes=function(){var t=e.state.selectedWindowType,n=Xn[0],r={width:80,height:80,margin:10,cursor:"pointer"};return Object(E.jsxs)("div",{children:[Object(E.jsx)("p",{children:"Select Window"}),n.styles.map((function(n,o){return Object(E.jsx)("img",{alt:"",src:n.image,style:Object(w.a)(Object(w.a)({},r),{},{border:"3px solid ".concat(t===o?"gray":"transparent")}),onClick:function(){return e.setState({selectedWindowType:o})}},o)}))]})},e._renderWallWindowDimensioning=function(){var t=e.state,n=[{label:"Base Width:",value:t.baseWidth,callback:function(t){return e.setState({baseWidth:t})}},{label:"Base Height:",value:t.baseHeight,callback:function(t){return e.setState({baseHeight:t})}},{label:"Base Distance to Floor Level:",value:t.marginVertical,min:.1,callback:function(t){return e.setState({marginVertical:t})}}];try{var r=e.props.selectedEdge.wall;0===e.state.coverMethod&&0===e.state.tabIndex&&r&&r.windowInfo&&(n[0].value=r.windowInfo.width,n[1].value=r.windowInfo.height,n[2].value=r.windowInfo.sillHeight)}catch(o){}return Object(E.jsx)("div",{children:n.map((function(e,t){return Object(E.jsxs)("div",{className:"input-container",children:[Object(E.jsx)("label",{children:e.label}),Object(E.jsx)("div",{children:Object(E.jsx)(Rn,{rawValue:e.value,min:e.min||0,step:.1,style:{width:50},onChange:e.callback})})]},t)}))})},e._renderRoofWindowDimensioning=function(){var t=e.state,n=[{label:"Width:",value:t.baseWidth,callback:function(t){return e.setState({baseWidth:t})}},{label:"Height:",value:t.baseHeight,callback:function(t){return e.setState({baseHeight:t})}}];return Object(E.jsx)("div",{children:n.map((function(e,t){return Object(E.jsxs)("div",{className:"input-container",children:[Object(E.jsx)("label",{children:e.label}),Object(E.jsx)("div",{children:Object(E.jsx)(Rn,{rawValue:e.value,min:e.min||0,step:.1,style:{width:50},onChange:e.callback})})]},t)}))})},e._renderWallCoverMethods=function(){var t=e.state,n=t.coverMethod,r=t.coverRate,o=t.windowCount;return Object(E.jsxs)("div",{children:[Object(E.jsxs)("div",{className:"input-container",children:[Object(E.jsxs)("div",{children:[Object(E.jsx)("input",{type:"radio",checked:0===n,id:"cover-by-rate",onChange:function(){return e.setState({coverMethod:0})}}),Object(E.jsx)("label",{htmlFor:"cover-by-rate",children:"Expected Cover Rate:"})]}),Object(E.jsxs)("div",{children:[Object(E.jsx)("input",{type:"number",value:r,min:0,max:100,style:{width:50},onChange:function(t){var n=parseFloat(t.target.value);n<0&&(n=0),n>100&&(n=100),e.setState({coverRate:n})}}),Object(E.jsx)("label",{children:" %"})]})]}),Object(E.jsxs)("div",{className:"input-container",children:[Object(E.jsxs)("div",{children:[Object(E.jsx)("input",{type:"radio",checked:1===n,id:"cover-by-count",onChange:function(){return e.setState({coverMethod:1,wallMode:0})}}),Object(E.jsx)("label",{htmlFor:"cover-by-count",children:"Count of Windows on wall"})]}),Object(E.jsxs)("div",{children:[Object(E.jsx)("input",{type:"number",value:o,min:0,max:100,style:{width:50},onChange:function(t){var n=parseInt(t.target.value);e.setState({windowCount:n})}}),Object(E.jsx)("label",{})]})]})]})},e._renderWallButtons=function(){var t=e.state,n=t.isAdding,r=t.loadingMessage,o=[{label:"Add Windows",callback:e.handleAddWallWindows},{label:"Remove Windows",callback:e.handleRemoveWallWindows}];return Object(E.jsxs)("div",{children:[o.map((function(e,t){return e?Object(E.jsx)("div",{className:"button ".concat(n?"disabled":""),onClick:function(){return!n&&e.callback()},children:e.label},t):Object(E.jsx)("hr",{},t)})),Object(E.jsx)("p",{children:r})]})},e._renderRoofButtons=function(){var t=e.state,n=t.isAdding,r=t.loadingMessage,o=[{label:"Add Roof Window",callback:e.handleAddRoofWindow},{label:"Remove All Roof Windows",callback:e.handleRemoveAllRoofWindows}];return Object(E.jsxs)("div",{children:[o.map((function(e,t){return e?Object(E.jsx)("div",{className:"button ".concat(n?"disabled":""),onClick:function(){return!n&&e.callback()},children:e.label},t):Object(E.jsx)("hr",{},t)})),Object(E.jsx)("p",{children:r})]})},e._renderWallManagementPanel=function(){var t=e.state,n=t.wallMode,r=t.coverMethod,o=e.props.selectedEdge,i=[{label:"1. Apply only to selected wall",disabled:!o},{label:"2. Apply to all walls on same floor",disabled:1===r||!o},{label:"3. Apply to all walls facing the same direction",disabled:1===r||!o},{label:"4. Apply to all walls of the building",disabled:1===r}];return Object(E.jsx)("div",{style:{padding:"20px 0"},children:Object(E.jsx)("div",{children:i.map((function(t,r){return Object(E.jsxs)("div",{children:[Object(E.jsx)("input",{id:"wall-mode-".concat(r),type:"radio",disabled:t.disabled,checked:r===n,onChange:function(){return e.setState({wallMode:r})}}),Object(E.jsx)("label",{htmlFor:"wall-mode-".concat(r),children:t.label})]},r)}))})})},e._renderTabs=function(){var t=e.state.tabIndex;return Object(E.jsx)("div",{style:{padding:"20px 0"},children:["Wall Windows","Roof Windows"].map((function(n,r){return Object(E.jsx)("span",{className:"tab ".concat(t===r?"active":""),onClick:function(){return e.setState({tabIndex:r})},children:n},r)}))})},e._renderWallWindowsPanel=function(){if(0===e.state.tabIndex)return Object(E.jsxs)("div",{children:[e._renderWallWindowDimensioning(),e._renderWallCoverMethods(),e._renderWallManagementPanel(),e._renderWallButtons()]})},e._renderRoofWindowsPanel=function(){if(1===e.state.tabIndex)return Object(E.jsxs)("div",{children:[e._renderRoofWindowDimensioning(),e._renderRoofButtons()]})},e}return Object(v.a)(n,[{key:"render",value:function(){return Object(E.jsxs)("div",{className:"property-section",children:[Object(E.jsx)(Mn,{title:"Window Editor",onClose:this.props.onClose}),this._renderWindowTypes(),this._renderTabs(),this._renderWallWindowsPanel(),this._renderRoofWindowsPanel()]})}}]),n}(d.a.Component),Gn=function(e){Object(g.a)(n,e);var t=Object(y.a)(n);function n(e){var r;return Object(p.a)(this,n),(r=t.call(this,e)).handleFloorTextureClicked=function(){var e=r.props.floor,t=r.state.selectedFloorTexture;e&&t?r.props.onFloorTextureChanged(e,t.url,t.conduction):Pn.b.error("Please select texture")},r.handleEdgeTextureClicked=function(){var e=r.props,t=e.edge,n=e.isOutsideWall,o=t.wall,i=r.state,a=i.wallMode,s=i.selectedEdgeTexture;t&&s?r.props.onEdgeTextureChanged(t,s.url,s.conduction,a,n&&o.isOutsideWall):Pn.b.error("Please select texture")},r._renderFloorTexturePanel=function(){var e=r.props,t=e.mode,n=e.floor,o=r.state.selectedFloorTexture;if("floor"===t&&n){var i={display:"inline-block",width:50,height:50,margin:10,cursor:"pointer"};return Object(E.jsxs)("div",{children:[Object(E.jsx)("h4",{children:"Select Floor Texture"}),Object(E.jsx)("div",{children:Fn.map((function(e,t){return Object(E.jsx)("div",{style:Object(w.a)({},i),onClick:function(){r.setState({selectedFloorTexture:e})},children:Object(E.jsx)("img",{src:e.url,alt:"texture",style:{width:"100%",height:"100%",border:"3px solid ".concat(e===o?"black":"transparent")}})},t)}))}),Object(E.jsx)("div",{className:"button",onClick:r.handleFloorTextureClicked,children:"Apply"})]})}},r._renderEdgeTexturePanel=function(){var e=r.props,t=e.mode,n=e.edge,o=e.isOutsideWall;if(n){var i=n.wall;if("wall"===t&&n){var a=r.state,s=a.wallMode,l=a.selectedEdgeTexture,c={display:"inline-block",width:50,height:50,margin:10,cursor:"pointer"};return Object(E.jsxs)("div",{children:[Object(E.jsx)("h4",{children:"Select ".concat(o&&i.isOutsideWall?"Outside":"Inside"," Wall Texture")}),Object(E.jsx)("div",{children:(o&&i.isOutsideWall?Nn:Bn).map((function(e,t){return Object(E.jsx)("div",{style:Object(w.a)({},c),onClick:function(){return r.setState({selectedEdgeTexture:e})},children:Object(E.jsx)("img",{src:e.url,alt:"texture",style:{width:"100%",height:"100%",border:"3px solid ".concat(e===l?"black":"transparent")}})},t)}))}),Object(E.jsx)("div",{children:["1. Apply only to selected wall","2. Apply to all walls on same floor","3. Apply to all walls facing the same direction","4. Apply to all walls of the building"].map((function(e,t){return Object(E.jsxs)("div",{onClick:function(){return r.setState({wallMode:t})},children:[Object(E.jsx)("input",{type:"radio",id:"wall-mode-".concat(t),checked:t===s,onChange:function(){}}),Object(E.jsx)("label",{htmlFor:"wall-mode-".concat(t),children:e})]},t)}))}),Object(E.jsx)("div",{className:"button",onClick:r.handleEdgeTextureClicked,children:"Apply"})]})}}},r.state={wallMode:0,selectedFloorTexture:null,selectedEdgeTexture:null},r}return Object(v.a)(n,[{key:"render",value:function(){return Object(E.jsxs)("div",{className:"property-section",children:[Object(E.jsx)(Mn,{title:"Texture Editor",onClose:this.props.onClose}),this._renderFloorTexturePanel(),this._renderEdgeTexturePanel(),Object(E.jsx)(Pn.a,{position:"bottom-center",autoClose:3e3,hideProgressBar:!0,newestOnTop:!1,closeOnClick:!0,rtl:!1,pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!0})]})}}]),n}(d.a.Component),Jn=function(e){Object(g.a)(n,e);var t=Object(y.a)(n);function n(e){var r;return Object(p.a)(this,n),(r=t.call(this,e)).update=function(){r.props.onUpdate(),r.forceUpdate()},r.handleLengthChange=function(e){var t=r.props.wall,n=r.state.stretchDirection;if(e>0){var o=e/t.getWallLength(),i={x:0,y:0};if(0===n)i=t.getWallCenter();else if(-1===n)i={x:t.getStartX(),y:t.getStartY()};else{if(1!==n)return;i={x:t.getEndX(),y:t.getEndY()}}var a=0,s=0;a=i.x+(t.getStartX()-i.x)*o,s=i.y+(t.getStartY()-i.y)*o,t.start.move(a,s,!1),a=i.x+(t.getEndX()-i.x)*o,s=i.y+(t.getEndY()-i.y)*o,t.end.move(a,s,!1),r.update()}},r._renderDimensions=function(){var e=r.props,t=e.wall,n=e.obstacleMode,o=t?t.getWallLength():0,i=t?t.height:ve.Configuration.getNumericValue(ve.configWallHeight),a=[];return t&&a.push({label:"Length",value:o,callback:r.handleLengthChange}),n&&a.push({label:"Height",value:i,callback:function(e){t?t.height=e:ve.Configuration.setValue(ve.configWallHeight,e),r.update()}}),!n&&a.push({label:"Thickness",value:t?t.thickness:ve.Configuration.getNumericValue(ve.configWallThickness),callback:function(e){t?t.thickness=e:ve.Configuration.setValue(ve.configWallThickness,e),r.update()}}),Object(E.jsx)("div",{children:a.map((function(e,t){return Object(E.jsxs)("div",{className:"input-container",children:[Object(E.jsx)("label",{children:e.label}),Object(E.jsx)("div",{children:Object(E.jsx)(Rn,{rawValue:e.value,min:.1,step:.1,onChange:e.callback})})]},t)}))})},r._renderStretchDirections=function(){var e=r.state.stretchDirection,t=r.props.wall;if(t){var n=t.start,o=t.end,i=[{label:"Start Corner",value:-1},{label:"Both Sides",value:0},{label:"End Corner",value:1}];if(Math.abs(n.x-o.x)>Math.abs(n.y-o.y))if(n.x>o.x)i[0].label="Left Side",i[2].label="Right Side";else{i[0].label="Right Side",i[2].label="Left Side";var a=i[0];i[0]=i[2],i[2]=a}else if(n.y>o.y)i[0].label="Upper Side",i[2].label="Below Side";else{i[0].label="Below Side",i[2].label="Upper Side";var s=i[0];i[0]=i[2],i[2]=s}return Object(E.jsxs)("div",{children:[Object(E.jsx)("p",{children:"Stretch Direction"}),i.map((function(t,n){return Object(E.jsxs)("div",{children:[Object(E.jsx)("input",{type:"radio",id:"stretch-direction-".concat(n),checked:t.value===e,onChange:function(){return r.setState({stretchDirection:t.value})}}),Object(E.jsx)("label",{htmlFor:"stretch-direction-".concat(n),children:t.label})]},n)}))]})}},r._renderRadioButtons=function(){var e=r.props,t=e.wall;if(!e.obstacleMode){var n=t?t.start:null,o=t?t.end:null,i=t?t.thicknessDirection:ve.Configuration.getNumericValue(ve.configWallThicknessDirection),a=t?t.isOutsideWall:ve.Configuration.getBooleanValue(ve.configWallIsOutside),s=[{label:"Inside",value:-1},{label:"Both Sides",value:0},{label:"Outside",value:1}];if(n&&o)if(Math.abs(n.x-o.x)>Math.abs(n.y-o.y))if(n.x>o.x){s[0].label="Below Side",s[2].label="Upper Side";var l=s[0];s[0]=s[2],s[2]=l}else s[0].label="Upper Side",s[2].label="Below Side";else if(n.y>o.y)s[0].label="Left Side",s[2].label="Right Side";else{s[0].label="Right Side",s[2].label="Left Side";var c=s[0];s[0]=s[2],s[2]=c}return Object(E.jsxs)("div",{children:[Object(E.jsx)("p",{children:"Inside/Outside Wall"}),t&&Object(E.jsxs)("div",{children:[Object(E.jsx)("input",{type:"checkbox",id:"keep-status-inside/outside",checked:!t.keepOutsideWall,onChange:function(){t&&(t.keepOutsideWall=!t.keepOutsideWall,r.update())}}),Object(E.jsx)("label",{htmlFor:"keep-status-inside/outside",children:"Auto Detect"})]}),[{label:"Inside",value:!1},{label:"Outside",value:!0}].map((function(e,n){return Object(E.jsxs)("div",{children:[Object(E.jsx)("input",{type:"radio",id:"side-".concat(n),checked:e.value===a,onChange:function(){t?(t.prevIsOutsideWall=t.isOutsideWall,t.isOutsideWall=e.value):ve.Configuration.setValue(ve.configWallIsOutside,e.value),r.update()}}),Object(E.jsx)("label",{htmlFor:"side-".concat(n),children:e.label})]},n)})),Object(E.jsx)("p",{children:"Thickness Direction"}),s.map((function(e,n){return Object(E.jsxs)("div",{children:[Object(E.jsx)("input",{type:"radio",id:"thickness-direction-".concat(n),checked:e.value===i,onChange:function(){t?t.thicknessDirection=e.value:ve.Configuration.setValue(ve.configWallThicknessDirection,e.value),r.update()}}),Object(E.jsx)("label",{htmlFor:"thickness-direction-".concat(n),children:e.label})]},n)}))]})}},r.state={stretchDirection:0},r}return Object(v.a)(n,[{key:"render",value:function(){return Object(E.jsxs)("div",{className:"property-section",children:[Object(E.jsx)(Mn,{title:"Edit Wall Properties",onClose:this.props.onClose}),this._renderDimensions(),this._renderStretchDirections(),this._renderRadioButtons()]})}}]),n}(d.a.Component),qn=function(e){Object(g.a)(n,e);var t=Object(y.a)(n);function n(e){var r;return Object(p.a)(this,n),(r=t.call(this,e)).componentDidMount=function(){var e=r.props.room;if(e){var t=e.name,n=e.tags;r.setState({name:t,tags:n})}},r.UNSAFE_componentWillReceiveProps=function(e){var t=r.props.room,n=e.room;t&&n&&t.name!==n.name&&r.setState({name:n.name,tags:n.tags})},r.handleNameChanged=function(){var e=r.state.name,t=r.props.room;t&&(t.setName(e),r.props.onUpdate())},r.handleAddNewTag=function(){var e=r.props.room,t=r.state,n=t.tags,o=t.newTag;if(e&&o&&!n.includes(o)){var i=Object(me.a)(n);i.push(o),e.tags=i,r.setState({tags:i,newTag:""},r.props.onUpdate)}},r.handleRemoveTags=function(e){var t=r.props.room;if(t){var n=Object(me.a)(r.state.tags);n.splice(e,1),t.tags=n,r.setState({tags:n},r.props.onUpdate)}},r._renderTags=function(){var e=r.state,t=e.tags,n=e.newTag;return Object(E.jsxs)("div",{children:[Object(E.jsx)("h3",{style:{fontWeight:500},children:"Tags"}),Object(E.jsxs)("div",{children:[Object(E.jsx)("label",{htmlFor:"tag-input",children:"New Tag"}),Object(E.jsx)("input",{id:"tag-input",value:n,onChange:function(e){return r.setState({newTag:e.target.value})},onKeyDown:function(e){return 13===e.keyCode&&r.handleAddNewTag()}})]}),Object(E.jsx)("div",{style:{paddingTop:10},children:t.map((function(e,t){return Object(E.jsxs)("div",{style:{border:"1px solid #3575a5",borderRadius:3,display:"inline-block",padding:5,margin:3},children:[Object(E.jsx)("span",{children:e}),Object(E.jsx)("span",{className:"fa fa-close",style:{marginLeft:10},onClick:function(){return r.handleRemoveTags(t)}})]},t)}))})]})},r.state={name:"",tags:[],newTag:""},r}return Object(v.a)(n,[{key:"render",value:function(){var e=this;return Object(E.jsxs)("div",{className:"property-section",children:[Object(E.jsx)(Mn,{title:"Edit Room Properties",onClose:this.props.onClose}),Object(E.jsxs)("div",{className:"input-container",children:[Object(E.jsx)("label",{children:"Name"}),Object(E.jsx)("input",{value:this.state.name,onChange:function(t){return e.setState({name:t.target.value},e.handleNameChanged)}})]}),this._renderTags()]})}}]),n}(d.a.Component),Zn=function(e){Object(g.a)(n,e);var t=Object(y.a)(n);function n(){var e;Object(p.a)(this,n);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).update=function(){e.forceUpdate(),e.props.onUpdate()},e._renderDimensions=function(){var t=e.props.corner,n=[{label:"Position X",value:t.x,callback:function(n){t.x=n,e.update()}},{label:"Position Y",value:-t.y,callback:function(n){t.y=-n,e.update()}}];return Object(E.jsx)("div",{children:n.map((function(e,t){return Object(E.jsxs)("div",{className:"input-container",children:[Object(E.jsx)("label",{children:e.label}),Object(E.jsx)("div",{children:Object(E.jsx)(Rn,{rawValue:e.value,step:.1,onChange:e.callback})})]},t)}))})},e}return Object(v.a)(n,[{key:"render",value:function(){return Object(E.jsxs)("div",{className:"property-section",children:[Object(E.jsx)(Mn,{title:"Edit Corner Properties",onClose:this.props.onClose}),this._renderDimensions()]})}}]),n}(d.a.Component),Kn=function(e){Object(g.a)(n,e);var t=Object(y.a)(n);function n(e){var r;return Object(p.a)(this,n),(r=t.call(this,e))._renderTableHeader=function(e){return Object(E.jsx)("thead",{children:Object(E.jsx)("tr",{children:e.map((function(e,t){return Object(E.jsx)("th",{children:e},t)}))})})},r._renderTableRow=function(e){return e.map((function(e,t){return Array.isArray(e)?Object(E.jsx)("td",{children:e.join(", ")},t):"string"===typeof e?Object(E.jsx)("td",{children:e},t):"boolean"===typeof e?Object(E.jsx)("td",{children:Object(E.jsx)("input",{type:"checkbox",checked:e,onChange:function(){}})},t):Object(E.jsx)("td",{children:e},t)}))},r._renderLayerMetadata=function(e){var t=e.metadata,n=e.walls,o=e.rooms;if(t){var i=t.height,a=t.distanceFromGround,s=t.floorThickness,l=t.area,c=t.isUndergroundLayer,u=t.hasExposedCeiling,d=t.hasExposedFloor,h=["".concat(a.toFixed(2),"m"),"".concat(i.toFixed(2),"m"),"".concat(s.toFixed(2),"m"),"".concat(l.toFixed(2),"m").concat(String.fromCharCode(178)),c,u,d,o.length,n.length];return Object(E.jsx)("div",{className:"metadata-container",style:{paddingLeft:20},children:Object(E.jsxs)("table",{className:"table",children:[r._renderTableHeader(["Distance from ground","Height","Floor Thickness","Area","Underground","Lowest Layer(Attached to ground)","Highest Layer(Attached to Roof)","Rooms","Walls"]),Object(E.jsx)("tbody",{children:Object(E.jsx)("tr",{children:r._renderTableRow(h)})})]})})}},r._renderWallMetadata=function(e){var t=e.index,n=e.height,o=e.start,i=e.end,a=e.thickness,s=e.isOutsideWall,l=e.isExposedWall,c=e.isUndergroundWall,u=e.exposedArea,d=e.direction,h=e.windows,f=[t+1,"".concat(n.toFixed(2),"m"),"(".concat(o.x.toFixed(2),"m, ").concat(o.y.toFixed(2),"m, ").concat(o.z.toFixed(2),"m)"),"(".concat(i.x.toFixed(2),"m, ").concat(i.y.toFixed(2),"m, ").concat(i.z.toFixed(2),"m)"),"".concat(a.toFixed(2),"m"),l,"".concat(u.toFixed(2),"m").concat(String.fromCharCode(178)),d,s,c,h];return r._renderTableRow(f)},r._renderWindowMetadata=function(e){var t=e.index,n=e.wallIndex,o=e.type,i=e.size,a=e.direction,s=e.position,l=[t+1,n,o,a,"".concat(i.width.toFixed(2),"m"),"".concat(i.height.toFixed(2),"m"),"(".concat(s.x.toFixed(2),"m, ").concat(s.y.toFixed(2),"m, ").concat(s.z.toFixed(2),"m)")];return r._renderTableRow(l)},r._renderRoomMetadata=function(e){var t=e.index,n=e.label,o=e.area,i=e.corners,a=[t+1,n,"".concat(o.toFixed(2),"m").concat(String.fromCharCode(178)),i.map((function(e){return"(".concat(e.position.x.toFixed(2),"m, ").concat(e.position.y.toFixed(2),"m, ").concat(e.position.z.toFixed(2),"m)")})).join("-")];return r._renderTableRow(a)},r._renderLayerData=function(e){var t,n=e.metadata,o=e.walls,i=e.rooms,a=o.map((function(e){return Object(w.a)(Object(w.a)({},e.metadata),{},{windows:e.windows.length})})),s=[],l=Object(j.a)(o.entries());try{var c=function(){var e=Object(ie.a)(t.value,2),n=e[0];e[1].windows.forEach((function(e){s.push(Object(w.a)({wallIndex:n+1},e))}))};for(l.s();!(t=l.n()).done;)c()}catch(u){l.e(u)}finally{l.f()}return Object(E.jsx)(Tn,{title:n.label,children:Object(E.jsxs)("div",{style:{paddingBottom:20},children:[r._renderLayerMetadata(e),Object(E.jsxs)("div",{style:{paddingLeft:20},children:[Object(E.jsx)(Tn,{title:"Rooms",children:Object(E.jsx)("div",{style:{paddingLeft:20,paddingBottom:10},children:Object(E.jsxs)("table",{className:"table",children:[r._renderTableHeader(["No","Name","Area","Corners"]),Object(E.jsx)("tbody",{children:i.map((function(e,t){return Object(E.jsx)("tr",{children:r._renderRoomMetadata(Object(w.a)(Object(w.a)({index:t},e.metadata),{},{corners:e.corners}))},t)}))})]})})}),Object(E.jsx)(Tn,{title:"Walls",children:Object(E.jsx)("div",{style:{paddingLeft:20},children:Object(E.jsxs)("table",{className:"table",children:[r._renderTableHeader(["No","Height","Start","End","Thickness","Exposed to outside","Exposed Area","Direction","Outside","Underground","Windows"]),Object(E.jsx)("tbody",{children:a.map((function(e,t){return Object(E.jsx)("tr",{children:r._renderWallMetadata(Object(w.a)(Object(w.a)({},e),{},{index:t}))},t)}))})]})})}),Object(E.jsx)("div",{style:{paddingLeft:20,paddingTop:10},children:Object(E.jsx)(Tn,{title:"Windows",children:Object(E.jsx)("div",{style:{paddingLeft:20},children:Object(E.jsxs)("table",{className:"table",children:[r._renderTableHeader(["No","Wall Index","Type","Orientation","Width","Height","Position"]),Object(E.jsx)("tbody",{children:s.map((function(e,t){return Object(E.jsx)("tr",{children:r._renderWindowMetadata(Object(w.a)(Object(w.a)({},e),{},{index:t}))},t)}))})]})})})})]})]})})},r.getParsedData=function(){var e=r.props.raw;if(console.log(e),!e)return[];for(var t=[],n=e.RoomName.length,o=0;o<n;o++){var i={No:o+1,RoomName:e.RoomName[o],RoomHeight:e.RoomHeight[o],RoomVolume:e.RoomVolume[o],WallArea:e.WallArea[o],WallOutside:e.WallOutside[o],WallConduction:e.WallConduction[o],WallDirection:e.WallDirection[o],WallInclination:e.WallInclination[o],WallCentroid:e.WallCentroid[o],WindowShare:e.WindowShare[o],WindowHeight:e.WindowHeight[o],WindowSillHeight:e.WindowSillHeight[o],UsableFloorArea:e.UsableFloorArea[o],RoomCentroid:e.RoomCentroid[o],TotalFloorArea:e.TotalFloorArea[o],FloorOutside:e.FloorOutside[o],RoomAboveGround:e.RoomAboveGround[o]};t.push(i)}return t},r._renderRoomTableRow=function(e){var t=e.No,n=e.RoomName,o=e.RoomHeight,i=e.RoomVolume,a=e.UsableFloorArea,s=e.RoomCentroid,l=e.TotalFloorArea,c=e.FloorOutside,u=e.RoomAboveGround,d=e.WallArea,h=e.WallOutside,f=e.WallConduction,p=e.WallDirection,v=e.WallInclination,g=e.WallCentroid,y=e.WindowShare,m=e.WindowHeight,b=e.WindowSillHeight,x=[t,n,o.toFixed(2)+"m",i.toFixed(2)+"m"+String.fromCharCode(179),a.toFixed(2)+"m"+String.fromCharCode(178),s.map((function(e){return"".concat(e.toFixed(2),"m")})),l.toFixed(2)+"m"+String.fromCharCode(178),c?"True":"False",u?"True":"False",d.map((function(e){return"".concat(e.toFixed(2),"m").concat(String.fromCharCode(178))})),h.map((function(e){return e?"True":"False"})),f,p.map((function(e){return"".concat(e.toFixed(0),"\xb0")})),v.map((function(e){return"".concat(e.toFixed(0),"\xb0")})),g.map((function(e){return"[".concat(e.map((function(e){return"".concat(e.toFixed(2),"m")})).join(", "),"]")})),y.map((function(e){return"".concat((100*e).toFixed(0),"%")})),m.map((function(e){return"".concat(e.toFixed(2),"m")})),b.map((function(e){return"".concat(e.toFixed(2),"m")}))];return r._renderTableRow(x)},r._renderParsedData=function(){if(0===r.state.tabIndex){var e=r.props.raw;if(e){var t=["No"],n=["ShadingObject"];for(var o in e)!n.includes(o)&&t.push(o);var i=r.getParsedData();return Object(E.jsx)("div",{style:{height:"calc(100% - 90px)",overflow:"auto"},children:Object(E.jsxs)("table",{className:"table",children:[r._renderTableHeader(t),Object(E.jsx)("tbody",{children:i.map((function(e,t){return Object(E.jsx)("tr",{children:r._renderRoomTableRow(e)},t)}))})]})})}}},r._renderRawData=function(){var e=r.state.tabIndex,t=r.props.raw;if(1===e)return Object(E.jsx)("div",{style:{height:"calc(100% - 90px)"},children:Object(E.jsx)("textarea",{style:{width:"100%",height:"-webkit-fill-available",resize:"none"},defaultValue:JSON.stringify(t)})})},r.state={tabIndex:0},r}return Object(v.a)(n,[{key:"render",value:function(){var e=this,t=this.state.tabIndex,n=this.props.style;return Object(E.jsx)("div",{className:"modal-container",children:Object(E.jsxs)("div",{className:"modal-dialog",style:Object(w.a)({},n),children:[Object(E.jsx)(Mn,{title:"Floorplan Data",onClose:this.props.onClose}),Object(E.jsx)("div",{style:{padding:"25px 0"},children:["Parsed","Raw"].map((function(n,r){return Object(E.jsx)("span",{style:{border:"1px solid gray",cursor:"pointer",padding:10,margin:"10px 0",background:t===r?"#ddd":"transparent"},onClick:function(){return e.setState({tabIndex:r})},children:n},r)}))}),this._renderParsedData(),this._renderRawData()]})})}}]),n}(d.a.Component),Qn=n(61),$n=n.n(Qn),er=(n(86),[{label:"Meter",value:"m"},{label:"Centimeter",value:"cm"},{label:"Inch",value:"in"}]),tr=function(e){Object(g.a)(n,e);var t=Object(y.a)(n);function n(){var e;Object(p.a)(this,n);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).handleUnitChanged=function(t){var n=t.target.value;e.props.onUnitChanged(n)},e.handleGeolocationDataChanged=function(t){return e.props.onSolarInfoChanged(t)},e._renderCheckboxes=function(){var t=e.props,n=t.showCompass,r=t.showDimension,o=t.showObstacle,i=t.snap;return[{label:"Show Compass",checked:n,callback:function(){return e.props.onChangeCompassVisibility(!n)}},{label:"Show Dimension",checked:r,callback:function(){return e.props.onChangeDimensionVisibility(!r)}},{label:"Show Obstacle",checked:o,callback:function(){return e.props.onChangeObstacleVisibility(!o)}},{label:"Snap",checked:i,callback:function(){return e.props.onChangeSnap(!i)}}].map((function(e,t){return Object(E.jsxs)("div",{className:"input-container",children:[Object(E.jsx)("label",{htmlFor:e.label,children:e.label}),Object(E.jsx)("input",{type:"checkbox",id:e.label,checked:e.checked,onChange:e.callback})]},t)}))},e._renderGeolocationData=function(){var t=e.props.solarInfo,n=t.lat,r=t.long;return Object(E.jsxs)("div",{children:[Object(E.jsxs)("div",{className:"input-container",children:[Object(E.jsx)("label",{children:"Lat: "}),Object(E.jsx)("div",{children:Object(E.jsx)("input",{type:"number",value:n,min:-90,max:90,style:{width:100},onChange:function(t){return e.handleGeolocationDataChanged(Object(w.a)(Object(w.a)({},e.props.solarInfo),{},{lat:t.target.value}))}})})]}),Object(E.jsxs)("div",{className:"input-container",children:[Object(E.jsx)("label",{children:"Long: "}),Object(E.jsx)("div",{children:Object(E.jsx)("input",{type:"number",min:-180,max:180,value:r,style:{width:100},onChange:function(t){return e.handleGeolocationDataChanged(Object(w.a)(Object(w.a)({},e.props.solarInfo),{},{long:t.target.value}))}})})]})]})},e._renderTimePicker=function(){var t=e.props.solarInfo.time;return Object(E.jsxs)("div",{className:"input-container",children:[Object(E.jsx)("label",{children:"Time: "}),Object(E.jsx)("div",{children:Object(E.jsx)($n.a,{dateFormat:"yyyy/MM/dd",showTimeSelect:!0,selected:t,onChange:function(t){return e.handleGeolocationDataChanged(Object(w.a)(Object(w.a)({},e.props.solarInfo),{},{time:t}))}})})]})},e}return Object(v.a)(n,[{key:"render",value:function(){var e=this.props.unit;return Object(E.jsxs)("div",{className:"property-section",children:[Object(E.jsx)(Mn,{title:"Settings",onClose:this.props.onClose}),Object(E.jsxs)("div",{children:[Object(E.jsxs)("div",{className:"input-container",children:[Object(E.jsx)("label",{children:"Unit"}),Object(E.jsx)("select",{value:e,onChange:this.handleUnitChanged,children:er.map((function(e,t){return Object(E.jsx)("option",{value:e.value,children:e.label},t)}))})]}),this._renderCheckboxes(),Object(E.jsx)("h3",{style:{fontWeight:500},children:"Geolocation"}),this._renderGeolocationData(),this._renderTimePicker()]})]})}}]),n}(d.a.Component),nr=(n(128),function(e){Object(g.a)(n,e);var t=Object(y.a)(n);function n(){var e;Object(p.a)(this,n);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).state={viewMode:"3d",buildingOffset:0,layers:[],rooms:[],obstacleMode:!1,shellMode:!1,showObstacle:!0,showCompass:!0,showDimension:!1,snap:!0,solarInfo:{lat:39.9042,long:116.4074,time:new Date},subTool:null,propertyPanelTool:null,selectedLayerIndex:null,firstRoofEditMode:!0,selectedRoofVertex:null,selectWall:null,selectedFloor:null,selectedWall2D:null,selectedRoom2D:null,selectedCorner2D:null,measureUnit:"m",showLoadingScreen:!1,floorPlannerMode:0,roofEditorMode:0},e.setPropertyPanelTool=function(t){e.setState({propertyPanelTool:t}),"roof"===t?e.refBp3d.setRoofEditorEnabled(!0):e.refBp3d.setRoofEditorEnabled(!1)},e.handleShow2DPlannerClicked=function(){var t=e.state.layers;if(e.setPropertyPanelTool(null),e.setState({viewMode:"2d",obstacleMode:!1,subTool:"floorplan"}),t&&t.length){var n=Number.isInteger(e.state.selectedLayerIndex)?e.state.selectedLayerIndex:t[t.length-1].index;e.handleLayerSelected({value:n})}e.refBp3d.setObstacleEditMode(!1)},e.handleShowObstacleMode=function(){e.setPropertyPanelTool(null),e.setState({viewMode:"2d",obstacleMode:!0,subTool:"floorplan"}),e.handleLayerSelected(null),e.refBp3d.setObstacleEditMode(!0)},e.handle2DItemClicked=function(t,n,r){e.setState({selectedRoom2D:t,selectedWall2D:n,selectedCorner2D:r,propertyPanelTool:"floorplanner-2d"})},e.handleShow3DViewClicked=function(){e.setState({viewMode:"3d",subTool:null,shellMode:!1}),e.setPropertyPanelTool(null),e.refBp3d.setShellMode(!1)},e.handleShowShellModeClicked=function(){e.refBp3d.setShellMode(!0),e.setState({viewMode:"3d",shellMode:!0,subTool:null}),e.setPropertyPanelTool(null)},e.handleShowRoofEditorClicked=function(){e.handleShowShellModeClicked();var t="roof"===e.state.propertyPanelTool;e.refBp3d.setRoofEditorEnabled(!t),e.setPropertyPanelTool(t?null:"roof"),e.setState({viewMode:"3d"})},e.handleShowWindowEditorClicked=function(){var t="window"===e.state.propertyPanelTool;e.handleShowShellModeClicked(),e.setState({viewMode:"3d",selectedEdge:null,propertyPanelTool:t?null:"window"})},e.handleShowLayerEditorClicked=function(){var t="layer"===e.state.propertyPanelTool?null:"layer";e.setPropertyPanelTool(t),e.setState({viewMode:"3d"})},e.handleSettingsClicked=function(){var t="settings"===e.state.propertyPanelTool;e.setState({propertyPanelTool:t?null:"settings"})},e.handleLayerUpdated=function(t,n){e.setState({layers:t,rooms:n})},e.handleBuildingOffsetUpdated=function(t){e.setState({buildingOffset:t})},e.handleLayerSelected=function(t){var n=t?t.value:null;e.setState({selectedLayerIndex:n,selectedEdge:null}),e.refBp3d.setActiveLayerIndex(n)},e.handleWallClicked=function(t){var n=e.state.propertyPanelTool,r=null;if(r=n?"widnow"===n?"window":n:"texture",e.setState({selectedEdge:t,selectedFloor:null,propertyPanelTool:r}),t)try{var o=t.wall.layer.layerIndex-100;e.setState({selectedLayerIndex:o})}catch(i){}},e.handleFloorClicked=function(t){var n=e.state.propertyPanelTool,r=null;r=n?"widnow"===n?"window":n:"texture",e.setState({selectedEdge:null,selectedFloor:t,propertyPanelTool:r})},e.handleRoofFaceClicked=function(e){console.log("roof face clicked",e)},e.handleRoofVertexSelected=function(t){e.setState({selectedRoofVertex:t})},e.handleNothingClicked=function(){var t="window"===e.state.propertyPanelTool?"window":null;e.setState({selectedEdge:null,selectedFloor:null,propertyPanelTool:t})},e.handleUndo=function(){e.refBp3d.undo(),e.setState({selectedRoofVertex:null,selectedEdge:null,selectedFloor:null})},e.handleRedo=function(){return e.refBp3d.redo()},e.handleSaveJson=function(){console.log("save");var t=e.refBp3d.getJSON();window.localStorage.setItem("bp3dJson",t),console.log(JSON.parse(t))},e.handleLoadJson=function(){console.log("load");var t=window.localStorage.getItem("bp3dJson");if(t&&t.length){var n=t;e.refBp3d.setJSON(n)}},e.handleCollectMetadataClicked=function(){e.setState({parsedPlanData:e.refBp3d.collectMetadata(),showMetadataTable:!0})},e.handleSnapshot=function(){var t=e.refBp3d.takeSnapshot();console.log(t)},e._renderRightContainer=function(){return Object(E.jsxs)(E.Fragment,{children:[e._renderLayerInfoPanel(),e._renderRoofEditorPanel(),e._renderWindowEditorPanel(),e._renderTextureEditorPanel(),e._render2DWallEditorPanel(),e._render2DRoomEditorPanel(),e._render2DCornerEditorPanel(),e._render2DWallPropertyPanel(),e._renderSettingsPanel()]})},e._renderSettingsPanel=function(){var t=e.state,n=t.propertyPanelTool,r=t.measureUnit,o=t.showCompass,i=t.showDimension,a=t.showObstacle,s=t.snap,l=t.solarInfo;if("settings"===n)return Object(E.jsx)("div",{className:"right-container opened",children:Object(E.jsx)("div",{className:"product-info-container",children:Object(E.jsx)(tr,{unit:r,showCompass:o,showDimension:i,showObstacle:a,snap:s,solarInfo:l,onUnitChanged:function(t){return e.setState({measureUnit:t})},onChangeCompassVisibility:function(t){e.setState({showCompass:t}),e.refBp3d.setCompassVisible(t)},onChangeDimensionVisibility:function(t){e.setState({showDimension:t}),e.refBp3d.setDimensionVisible(t)},onChangeObstacleVisibility:function(t){e.setState({showObstacle:t}),e.refBp3d.setObstacleVisible(t)},onChangeSnap:function(t){e.setState({snap:t}),e.refBp3d.setSnap(t)},onSolarInfoChanged:function(t){e.setState({solarInfo:t});var n=t.lat,r=t.long,o=t.time;e.refBp3d.updateGeolocationData(n,r,o)},onClose:function(){e.setPropertyPanelTool(null),e.setState({selectedEdge:null,selectedFloor:null,propertyPanelTool:null})}})})})},e._renderTextureEditorPanel=function(){var t=e.state,n=t.viewMode,r=t.shellMode,o=t.selectedEdge,i=t.selectedFloor,a=t.propertyPanelTool;if("3d"===n&&"texture"===a&&(o||i)){var s="";return o?s="wall":i&&(s="floor"),Object(E.jsx)("div",{className:"right-container opened",children:Object(E.jsx)("div",{className:"product-info-container",children:Object(E.jsx)(Gn,{mode:s,edge:o,isOutsideWall:r,floor:i,onFloorTextureChanged:e.refBp3d.setFloorTexture,onEdgeTextureChanged:e.refBp3d.setEdgeTexture,onClose:function(){e.setPropertyPanelTool(null),e.setState({selectedEdge:null,selectedFloor:null,propertyPanelTool:null})}})})})}},e._renderRoofEditorPanel=function(){var t=e.state,n=t.viewMode,r=t.propertyPanelTool,o=t.roofEditorMode,i=t.selectedRoofVertex,a=t.firstRoofEditMode;if("3d"===n&&"roof"===r)return Object(E.jsx)("div",{className:"right-container opened",children:Object(E.jsx)("div",{className:"product-info-container",children:Object(E.jsx)(Un,{isFirst:a,mode:o,roofVertex:i,onRegenerateClicked:function(t){e.refBp3d.regenerateRoof(t),e.setState({firstRoofEditMode:!1})},onModeChanged:function(t){return e.refBp3d.setRoofEditorMode(t)},onTransformControlAxisChanged:function(t){return e.refBp3d.setRoofEditorTransformControlAxis(t)},onEntireTextureChanged:function(t){return e.refBp3d.setRoofFaceTexture(null,t)},onClose:function(){e.setPropertyPanelTool(null),e.refBp3d.setRoofEditorEnabled(!1)}})})})},e._renderWindowEditorPanel=function(){var t=e.state,n=t.viewMode,r=t.propertyPanelTool,o=t.selectedEdge;if("3d"===n&&"window"===r)return Object(E.jsx)("div",{className:"right-container opened",children:Object(E.jsx)("div",{className:"product-info-container",children:Object(E.jsx)(Yn,{selectedEdge:o,onClose:function(){e.setPropertyPanelTool(null),e.refBp3d.setRoofEditorEnabled(!1)},onAddWindows:e.refBp3d.addWindows,onRemoveWindows:e.refBp3d.removeWindows,onAddRoofWindow:e.refBp3d.addRoofWindow,onRemoveAllRoofWindows:e.refBp3d.handleRemoveAllRoofWindows})})})},e._renderLayerInfoPanel=function(){var t=e.state,n=t.propertyPanelTool,r=t.layers,o=t.rooms,i=t.selectedLayerIndex,a=t.buildingOffset;if("layer"===n)return Object(E.jsx)("div",{className:"right-container opened",children:Object(E.jsx)(An,{activeIndex:i,buildingOffset:a,layers:r,rooms:o,onUpdate:function(){return e.refBp3d.update()},onClose:function(){return e.setPropertyPanelTool(null)},onBuildingOffsetChanged:e.refBp3d.setBuildingOffset,onLayerSelected:e.handleLayerSelected,onSetLayerVisible:e.refBp3d.setLayerVisible,onSetRoomVisible:e.refBp3d.setRoomVisible,onFloorThicknessChanged:e.refBp3d.setLayerFloorThickness,onHeightChanged:e.refBp3d.setLayerHeight,onCloneAboveLayer:e.refBp3d.cloneAboveLayer,onCloneBelowLayer:e.refBp3d.cloneBelowLayer,onMoveAboveLayer:e.refBp3d.moveAboveLayer,onMoveBelowLayer:e.refBp3d.moveBelowLayer,onRemoveLayer:e.refBp3d.removeLayer})})},e._render2DWallEditorPanel=function(){var t=e.state,n=t.viewMode,r=t.obstacleMode,o=t.propertyPanelTool,i=t.selectedWall2D;if("2d"===n&&"floorplanner-2d"===o&&i)return Object(E.jsx)("div",{className:"right-container opened",children:Object(E.jsx)("div",{className:"product-info-container",children:Object(E.jsx)(Jn,{obstacleMode:r,wall:i,onUpdate:e.refBp3d.update,onClose:function(){e.setPropertyPanelTool(null)}})})})},e._render2DWallPropertyPanel=function(){var t=e.state,n=t.viewMode,r=t.obstacleMode,o=t.propertyPanelTool;if("2d"===n&&"floorplanner-wall-property"===o)return Object(E.jsx)("div",{className:"right-container opened",children:Object(E.jsx)("div",{className:"product-info-container",children:Object(E.jsx)(Jn,{obstacleMode:r,onUpdate:e.refBp3d.update,onClose:function(){e.setPropertyPanelTool(null)}})})})},e._render2DRoomEditorPanel=function(){var t=e.state,n=t.viewMode,r=t.propertyPanelTool,o=t.selectedRoom2D;if("2d"===n&&"floorplanner-2d"===r&&o)return Object(E.jsx)("div",{className:"right-container opened",children:Object(E.jsx)("div",{className:"product-info-container",children:Object(E.jsx)(qn,{room:o,onUpdate:function(){return e.refBp3d.update(!1,!1)},onClose:function(){e.setPropertyPanelTool(null)}})})})},e._render2DCornerEditorPanel=function(){var t=e.state,n=t.viewMode,r=t.propertyPanelTool,o=t.selectedCorner2D;if("2d"===n&&"floorplanner-2d"===r&&o)return Object(E.jsx)("div",{className:"right-container opened",children:Object(E.jsx)("div",{className:"product-info-container",children:Object(E.jsx)(Zn,{corner:o,onUpdate:e.refBp3d.update,onClose:function(){e.setPropertyPanelTool(null)}})})})},e._renderSubTools=function(){var t=e.state,n=t.viewMode,r=t.obstacleMode,o=t.subTool,i=t.selectedLayerIndex,a=t.floorPlannerMode,s=t.layers;return"2d"===n&&"floorplan"===o?Object(E.jsx)("div",{className:"sub-tools-section top transparent",children:Object(E.jsx)(Ln,{mode:a,layers:s,obstacleMode:r,selectedLayerIndex:i,onLayerSelected:e.handleLayerSelected,onModeChanged:function(t){e.refBp3d.setFloorplanMode(t),e.setState({selectedCorner2D:null,selectedWall2D:null,selectedRoom2D:null,propertyPanelTool:null}),t===cn&&e.setState({propertyPanelTool:"floorplanner-wall-property"})},onZoomIn:function(){return e.refBp3d.zoomInFloorPlanner()},onZoomOut:function(){return e.refBp3d.zoomOutFloorPlanner()},onResetZoom:function(){return e.refBp3d.resetZoomFloorPlanner()}})}):"3d"!==n||o?void 0:Object(E.jsx)("div",{className:"sub-tools-section top transparent",children:Object(E.jsx)(Dn,{onZoomIn:function(){return e.refBp3d.zoomInScene()},onZoomOut:function(){return e.refBp3d.zoomOutScene()},onResetZoom:function(){return e.refBp3d.resetZoomScene()}})})},e._renderFloorplanDataTable=function(){var t=e.state,n=t.showMetadataTable,r=t.parsedPlanData;if(n)return Object(E.jsx)(Kn,{raw:r,style:{width:"80%",height:"80%"},onClose:function(){return e.setState({showMetadataTable:!1})}})},e._renderLoadingScreen=function(){var t=e.state.showLoadingScreen;return Object(E.jsx)("div",{className:"loading-container",style:{display:t?"flex":"none"},children:Object(E.jsx)("span",{children:"loading..."})})},e}return Object(v.a)(n,[{key:"render",value:function(){var e=this,t=this.state,n=t.viewMode,r=t.obstacleMode,o=t.shellMode,i=t.propertyPanelTool;return Object(E.jsx)("div",{className:"App",children:Object(E.jsx)("div",{className:"bp3d",children:Object(E.jsxs)("div",{className:"container",children:[Object(E.jsx)("div",{className:"left-container",children:Object(E.jsx)(In,{viewMode:n,shellMode:o,obstacleMode:r,showLayers:"layer"===i,showRoofEditor:"roof"===i,showWindowEditor:"window"===i,showSettings:"settings"===i,onShowObstacleMode:this.handleShowObstacleMode,onShow3DViewClicked:this.handleShow3DViewClicked,onShow2DPlanner:this.handleShow2DPlannerClicked,onShellModePressed:this.handleShowShellModeClicked,onRoofPressed:this.handleShowRoofEditorClicked,onWindowPressed:this.handleShowWindowEditorClicked,onLayerPressed:this.handleShowLayerEditorClicked,onCollectMetadataClicked:this.handleCollectMetadataClicked,onUndo:this.handleUndo,onRedo:this.handleRedo,onSaveClicked:this.handleSaveJson,onLoadClicked:this.handleLoadJson,onSnapshotClicked:this.handleSnapshot,onSettingsClicked:this.handleSettingsClicked})}),Object(E.jsxs)("div",{className:"main-container",children:[Object(E.jsx)("div",{className:"scenes-container",children:Object(E.jsx)(Sn,{ref:function(t){return e.refBp3d=t},viewMode:n,measureUnit:this.state.measureUnit,isLoading:function(){return e.setState({showLoadingScreen:!0})},isLoaded:function(){return e.setState({showLoadingScreen:!1})},onLayersUpdated:this.handleLayerUpdated,onBuildingOffsetUpdated:this.handleBuildingOffsetUpdated,onWallClicked:this.handleWallClicked,onFloorClicked:this.handleFloorClicked,onRoofFaceClicked:this.handleRoofFaceClicked,onRoofVertexSelected:this.handleRoofVertexSelected,onNothingClicked:this.handleNothingClicked,onWall2DClicked:function(t){return e.handle2DItemClicked(null,t,null)},onRoom2DClicked:function(t){return e.handle2DItemClicked(t,null,null)},onCorner2DClicked:function(t){return e.handle2DItemClicked(null,null,t)},roofEditorModeChanged:function(t){return e.setState({roofEditorMode:t})},floorPlannerModeChanged:function(t){e.setState({floorPlannerMode:t})}})}),this._renderSubTools(),this._renderLoadingScreen()]}),this._renderRightContainer(),this._renderFloorplanDataTable()]})})})}}]),n}(d.a.Component)),rr=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,140)).then((function(t){var n=t.getCLS,r=t.getFID,o=t.getFCP,i=t.getLCP,a=t.getTTFB;n(e),r(e),o(e),i(e),a(e)}))};f.a.render(Object(E.jsx)(d.a.StrictMode,{children:Object(E.jsx)(nr,{})}),document.getElementById("root")),rr()},82:function(e,t,n){}},[[129,1,2]]]);